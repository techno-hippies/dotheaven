# ── PostsV1 — Post existence + metadata pointer ───────────────────

type Post @entity(immutable: true) {
  id: ID!                      # postId (bytes32 hex) — unique per post
  creator: Bytes!              # wallet address
  contentType: Int!            # 0=text, 1=photo
  metadataUri: String!         # IPFS URI to IPA metadata
  ipfsHash: String             # IPFS CID extracted from metadataUri
  contentId: Bytes             # keccak256("heaven:content:" + ipfsHash) for clustering
  isAdult: Boolean!            # 18+ content flag
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

# ── ScrobbleV3 — Track Registry + Scrobble Events ─────────────────

type Track @entity(immutable: false) {
  id: ID!                      # trackId (bytes32 hex)
  title: String!               # display title (from contract state)
  artist: String!              # display artist (from contract state)
  kind: Int!                   # 1=MBID, 2=ipId, 3=meta
  payload: Bytes!              # raw derivation input
  metaHash: Bytes!             # keccak256(abi.encode(title, artist, album))
  coverCid: String             # IPFS CID for album art (set once via setTrackCover)
  registeredAt: BigInt!        # block timestamp
  blockNumber: BigInt!
  transactionHash: Bytes!
  scrobbles: [Scrobble!]! @derivedFrom(field: "track")
}

type Scrobble @entity(immutable: true) {
  id: ID!                      # "{txHash}-{logIndex}"
  user: Bytes!                 # wallet address
  track: Track!                # link to registered track
  timestamp: BigInt!           # play timestamp (unix seconds)
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}
