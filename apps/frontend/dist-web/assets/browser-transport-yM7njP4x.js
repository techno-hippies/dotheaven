var Be=Object.defineProperty;var be=r=>{throw TypeError(r)};var Pe=(r,t,e)=>t in r?Be(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var S=(r,t,e)=>Pe(r,typeof t!="symbol"?t+"":t,e),ne=(r,t,e)=>t.has(r)||be("Cannot "+e);var o=(r,t,e)=>(ne(r,t,"read from private field"),e?e.call(r):t.get(r)),l=(r,t,e)=>t.has(r)?be("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(r):t.set(r,e),g=(r,t,e,n)=>(ne(r,t,"write to private field"),n?n.call(r,e):t.set(r,e),e),St=(r,t,e)=>(ne(r,t,"access private method"),e);let i,xt=null;function At(){return(xt===null||xt.byteLength===0)&&(xt=new Uint8Array(i.memory.buffer)),xt}let Zt=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});Zt.decode();const We=2146435072;let re=0;function Le(r,t){return re+=t,re>=We&&(Zt=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}),Zt.decode(),re=t),Zt.decode(At().subarray(r,r+t))}function p(r,t){return r=r>>>0,Le(r,t)}let u=0;const Rt=new TextEncoder;"encodeInto"in Rt||(Rt.encodeInto=function(r,t){const e=Rt.encode(r);return t.set(e),{read:r.length,written:e.length}});function m(r,t,e){if(e===void 0){const _=Rt.encode(r),b=t(_.length,1)>>>0;return At().subarray(b,b+_.length).set(_),u=_.length,b}let n=r.length,s=t(n,1)>>>0;const a=At();let c=0;for(;c<n;c++){const _=r.charCodeAt(c);if(_>127)break;a[s+c]=_}if(c!==n){c!==0&&(r=r.slice(c)),s=e(s,n,n=c+r.length*3,1)>>>0;const _=At().subarray(s+c,s+n),b=Rt.encodeInto(r,_);c+=b.written,s=e(s,n,c,1)>>>0}return u=c,s}let st=null;function T(){return(st===null||st.buffer.detached===!0||st.buffer.detached===void 0&&st.buffer!==i.memory.buffer)&&(st=new DataView(i.memory.buffer)),st}function d(r){return r==null}function oe(r){const t=typeof r;if(t=="number"||t=="boolean"||r==null)return`${r}`;if(t=="string")return`"${r}"`;if(t=="symbol"){const s=r.description;return s==null?"Symbol":`Symbol(${s})`}if(t=="function"){const s=r.name;return typeof s=="string"&&s.length>0?`Function(${s})`:"Function"}if(Array.isArray(r)){const s=r.length;let a="[";s>0&&(a+=oe(r[0]));for(let c=1;c<s;c++)a+=", "+oe(r[c]);return a+="]",a}const e=/\[object ([^\]]+)\]/.exec(toString.call(r));let n;if(e&&e.length>1)n=e[1];else return toString.call(r);if(n=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:n}function M(r){const t=i.__externref_table_alloc();return i.__wbindgen_externrefs.set(t,r),t}function w(r,t){try{return r.apply(this,t)}catch(e){const n=M(e);i.__wbindgen_exn_store(n)}}function J(r,t){return r=r>>>0,At().subarray(r/1,r/1+t)}function H(r,t){r=r>>>0;const e=T(),n=[];for(let s=r;s<r+4*t;s+=4)n.push(i.__wbindgen_externrefs.get(e.getUint32(s,!0)));return i.__externref_drop_slice(r,t),n}const le=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(r=>r.dtor(r.a,r.b));function Yt(r,t,e,n){const s={a:r,b:t,cnt:1,dtor:e},a=(...c)=>{s.cnt++;const _=s.a;s.a=0;try{return n(_,s.b,...c)}finally{s.a=_,a._wbg_cb_unref()}};return a._wbg_cb_unref=()=>{--s.cnt===0&&(s.dtor(s.a,s.b),s.a=0,le.unregister(s))},le.register(a,s,s),a}function q(r,t){const e=t(r.length*4,4)>>>0;for(let n=0;n<r.length;n++){const s=M(r[n]);T().setUint32(e+4*n,s,!0)}return u=r.length,e}function Ne(r,t,e){const n=m(r,i.__wbindgen_malloc,i.__wbindgen_realloc),s=u;var a=d(t)?0:m(t,i.__wbindgen_malloc,i.__wbindgen_realloc),c=u;const _=q(e,i.__wbindgen_malloc),b=u;return i.inboxStateFromInboxIds(n,s,a,c,_,b)}function f(r){const t=i.__wbindgen_externrefs.get(r);return i.__externref_table_dealloc(r),t}function Ft(r,t){if(!(r instanceof t))throw new Error(`expected instance of ${t.name}`)}function Ue(r,t,e,n){const s=m(r,i.__wbindgen_malloc,i.__wbindgen_realloc),a=u;var c=d(t)?0:m(t,i.__wbindgen_malloc,i.__wbindgen_realloc),_=u;return i.getInboxIdForIdentifier(s,a,c,_,e,n)}function je(r,t,e,n,s){const a=m(r,i.__wbindgen_malloc,i.__wbindgen_realloc),c=u;var _=d(t)?0:m(t,i.__wbindgen_malloc,i.__wbindgen_realloc),b=u;const k=m(n,i.__wbindgen_malloc,i.__wbindgen_realloc),B=u,L=q(s,i.__wbindgen_malloc),x=u,P=i.revokeInstallationsSignatureRequest(a,c,_,b,e,k,B,L,x);if(P[2])throw f(P[1]);return K.__wrap(P[0])}function ze(r,t,e){const n=m(r,i.__wbindgen_malloc,i.__wbindgen_realloc),s=u;var a=d(t)?0:m(t,i.__wbindgen_malloc,i.__wbindgen_realloc),c=u;return Ft(e,K),i.applySignatureRequest(n,s,a,c,e.__wbg_ptr)}function Ge(r,t,e){i.wasm_bindgen__convert__closures_____invoke__hdff293b41f2cecc6(r,t,e)}function Ve(r,t){i.wasm_bindgen__convert__closures_____invoke__hceddd2b8fc291040(r,t)}function Ke(r,t){i.wasm_bindgen__convert__closures_____invoke__h6af3cd86eb56f4b1(r,t)}function $e(r,t){i.wasm_bindgen__convert__closures_____invoke__h956b60152b2cf005(r,t)}function He(r,t,e,n){i.wasm_bindgen__convert__closures_____invoke__h47a8fb56fc48c5fb(r,t,e,n)}const nt=Object.freeze({Unknown:0,0:"Unknown",Allowed:1,1:"Allowed",Denied:2,2:"Denied"}),G=Object.freeze({Dm:0,0:"Dm",Group:1,1:"Group",Sync:2,2:"Sync",Oneshot:3,3:"Oneshot"}),Me=Object.freeze({Application:0,0:"Application",MembershipChange:1,1:"MembershipChange"}),Te=Object.freeze({Ethereum:0,0:"Ethereum",Passkey:1,1:"Passkey"}),Xe=Object.freeze({Off:0,0:"Off",Error:1,1:"Error",Warn:2,2:"Warn",Info:3,3:"Info",Debug:4,4:"Debug",Trace:5,5:"Trace"}),fe=Object.freeze({Ascending:0,0:"Ascending",Descending:1,1:"Descending"}),Je=["","no-referrer","no-referrer-when-downgrade","origin","origin-when-cross-origin","unsafe-url","same-origin","strict-origin","strict-origin-when-cross-origin"],Ye=["default","no-store","reload","no-cache","force-cache","only-if-cached"],Qe=["omit","same-origin","include"],Ze=["same-origin","no-cors","cors","navigate"],tn=["follow","error","manual"];typeof FinalizationRegistry>"u"||new FinalizationRegistry(r=>i.__wbg_authhandle_free(r>>>0,1));const we=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(r=>i.__wbg_client_free(r>>>0,1));class Mt{static __wrap(t){t=t>>>0;const e=Object.create(Mt.prototype);return e.__wbg_ptr=t,we.register(e,e.__wbg_ptr,e),e}__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,we.unregister(this),t}free(){const t=this.__destroy_into_raw();i.__wbg_client_free(t,0)}inboxState(t){return i.client_inboxState(this.__wbg_ptr,t)}getLatestInboxState(t){const e=m(t,i.__wbindgen_malloc,i.__wbindgen_realloc),n=u;return i.client_getLatestInboxState(this.__wbg_ptr,e,n)}getKeyPackageStatusesForInstallationIds(t){const e=q(t,i.__wbindgen_malloc),n=u;return i.client_getKeyPackageStatusesForInstallationIds(this.__wbg_ptr,e,n)}getConsentState(t,e){const n=m(e,i.__wbindgen_malloc,i.__wbindgen_realloc),s=u;return i.client_getConsentState(this.__wbg_ptr,t,n,s)}setConsentStates(t){const e=q(t,i.__wbindgen_malloc),n=u;return i.client_setConsentStates(this.__wbg_ptr,e,n)}registerIdentity(t){Ft(t,K);var e=t.__destroy_into_raw();return i.client_registerIdentity(this.__wbg_ptr,e)}applySignatureRequest(t){return Ft(t,K),i.client_applySignatureRequest(this.__wbg_ptr,t.__wbg_ptr)}signWithInstallationKey(t){const e=m(t,i.__wbindgen_malloc,i.__wbindgen_realloc),n=u,s=i.client_signWithInstallationKey(this.__wbg_ptr,e,n);if(s[2])throw f(s[1]);return f(s[0])}createInboxSignatureRequest(){const t=i.client_createInboxSignatureRequest(this.__wbg_ptr);if(t[2])throw f(t[1]);return t[0]===0?void 0:K.__wrap(t[0])}addWalletSignatureRequest(t){return i.client_addWalletSignatureRequest(this.__wbg_ptr,t)}revokeWalletSignatureRequest(t){return i.client_revokeWalletSignatureRequest(this.__wbg_ptr,t)}verifySignedWithInstallationKey(t,e){const n=m(t,i.__wbindgen_malloc,i.__wbindgen_realloc),s=u,a=i.client_verifySignedWithInstallationKey(this.__wbg_ptr,n,s,e);if(a[1])throw f(a[0])}revokeInstallationsSignatureRequest(t){const e=q(t,i.__wbindgen_malloc),n=u;return i.client_revokeInstallationsSignatureRequest(this.__wbg_ptr,e,n)}changeRecoveryIdentifierSignatureRequest(t){return i.client_changeRecoveryIdentifierSignatureRequest(this.__wbg_ptr,t)}revokeAllOtherInstallationsSignatureRequest(){return i.client_revokeAllOtherInstallationsSignatureRequest(this.__wbg_ptr)}get appVersion(){let t,e;try{const n=i.client_appVersion(this.__wbg_ptr);return t=n[0],e=n[1],p(n[0],n[1])}finally{i.__wbindgen_free(t,e,1)}}canMessage(t){const e=q(t,i.__wbindgen_malloc),n=u;return i.client_canMessage(this.__wbg_ptr,e,n)}conversations(){const t=i.client_conversations(this.__wbg_ptr);return Dt.__wrap(t)}get isRegistered(){return i.client_isRegistered(this.__wbg_ptr)!==0}apiStatistics(){return i.client_apiStatistics(this.__wbg_ptr)}get installationId(){let t,e;try{const n=i.client_installationId(this.__wbg_ptr);return t=n[0],e=n[1],p(n[0],n[1])}finally{i.__wbindgen_free(t,e,1)}}get libxmtpVersion(){let t,e;try{const n=i.client_libxmtpVersion(this.__wbg_ptr);return t=n[0],e=n[1],p(n[0],n[1])}finally{i.__wbindgen_free(t,e,1)}}syncPreferences(){return i.client_syncPreferences(this.__wbg_ptr)}sendSyncRequest(){return i.client_sendSyncRequest(this.__wbg_ptr)}get accountIdentifier(){return i.client_accountIdentifier(this.__wbg_ptr)}clearAllStatistics(){i.client_clearAllStatistics(this.__wbg_ptr)}get installationIdBytes(){return i.client_installationIdBytes(this.__wbg_ptr)}apiIdentityStatistics(){return i.client_apiIdentityStatistics(this.__wbg_ptr)}apiAggregateStatistics(){let t,e;try{const n=i.client_apiAggregateStatistics(this.__wbg_ptr);return t=n[0],e=n[1],p(n[0],n[1])}finally{i.__wbindgen_free(t,e,1)}}inboxStateFromInboxIds(t,e){const n=q(t,i.__wbindgen_malloc),s=u;return i.client_inboxStateFromInboxIds(this.__wbg_ptr,n,s,e)}findInboxIdByIdentifier(t){return i.client_findInboxIdByIdentifier(this.__wbg_ptr,t)}get inboxId(){let t,e;try{const n=i.client_inboxId(this.__wbg_ptr);return t=n[0],e=n[1],p(n[0],n[1])}finally{i.__wbindgen_free(t,e,1)}}}Symbol.dispose&&(Mt.prototype[Symbol.dispose]=Mt.prototype.free);const he=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(r=>i.__wbg_conversation_free(r>>>0,1));class z{static __wrap(t){t=t>>>0;const e=Object.create(z.prototype);return e.__wbg_ptr=t,he.register(e,e.__wbg_ptr,e),e}__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,he.unregister(this),t}free(){const t=this.__destroy_into_raw();i.__wbg_conversation_free(t,0)}adminList(){const t=i.conversation_adminList(this.__wbg_ptr);if(t[3])throw f(t[2]);var e=H(t[0],t[1]).slice();return i.__wbindgen_free(t[0],t[1]*4,4),e}getDebugInfo(){return i.conversation_getDebugInfo(this.__wbg_ptr)}groupName(){let t,e;try{const a=i.conversation_groupName(this.__wbg_ptr);var n=a[0],s=a[1];if(a[3])throw n=0,s=0,f(a[2]);return t=n,e=s,p(n,s)}finally{i.__wbindgen_free(t,e,1)}}sendReply(t,e){return i.conversation_sendReply(this.__wbg_ptr,t,d(e)?16777215:e?1:0)}addMembers(t){const e=q(t,i.__wbindgen_malloc),n=u;return i.conversation_addMembers(this.__wbg_ptr,e,n)}leaveGroup(){return i.conversation_leaveGroup(this.__wbg_ptr)}sendIntent(t,e){return i.conversation_sendIntent(this.__wbg_ptr,t,d(e)?16777215:e?1:0)}listMembers(){return i.conversation_listMembers(this.__wbg_ptr)}removeAdmin(t){const e=m(t,i.__wbindgen_malloc,i.__wbindgen_realloc),n=u;return i.conversation_removeAdmin(this.__wbg_ptr,e,n)}sendActions(t,e){return i.conversation_sendActions(this.__wbg_ptr,t,d(e)?16777215:e?1:0)}createdAtNs(){return i.conversation_createdAtNs(this.__wbg_ptr)}findMessages(t){return i.conversation_findMessages(this.__wbg_ptr,d(t)?0:M(t))}getHmacKeys(){const t=i.conversation_getHmacKeys(this.__wbg_ptr);if(t[2])throw f(t[1]);return f(t[0])}sendMarkdown(t,e){const n=m(t,i.__wbindgen_malloc,i.__wbindgen_realloc),s=u;return i.conversation_sendMarkdown(this.__wbg_ptr,n,s,d(e)?16777215:e?1:0)}sendReaction(t,e){return i.conversation_sendReaction(this.__wbg_ptr,t,d(e)?16777215:e?1:0)}countMessages(t){return i.conversation_countMessages(this.__wbg_ptr,d(t)?0:M(t))}groupMetadata(){return i.conversation_groupMetadata(this.__wbg_ptr)}isSuperAdmin(t){const e=m(t,i.__wbindgen_malloc,i.__wbindgen_realloc),n=u,s=i.conversation_isSuperAdmin(this.__wbg_ptr,e,n);if(s[2])throw f(s[1]);return s[0]!==0}removeMembers(t){const e=q(t,i.__wbindgen_malloc),n=u;return i.conversation_removeMembers(this.__wbg_ptr,e,n)}addSuperAdmin(t){const e=m(t,i.__wbindgen_malloc,i.__wbindgen_realloc),n=u;return i.conversation_addSuperAdmin(this.__wbg_ptr,e,n)}sendAttachment(t,e){return i.conversation_sendAttachment(this.__wbg_ptr,t,d(e)?16777215:e?1:0)}sendOptimistic(t,e){let n,s;try{const _=i.conversation_sendOptimistic(this.__wbg_ptr,t,e);var a=_[0],c=_[1];if(_[3])throw a=0,c=0,f(_[2]);return n=a,s=c,p(a,c)}finally{i.__wbindgen_free(n,s,1)}}updateAppData(t){const e=m(t,i.__wbindgen_malloc,i.__wbindgen_realloc),n=u;return i.conversation_updateAppData(this.__wbg_ptr,e,n)}dmPeerInboxId(){let t,e;try{const a=i.conversation_dmPeerInboxId(this.__wbg_ptr);var n=a[0],s=a[1];if(a[3])throw n=0,s=0,f(a[2]);return t=n,e=s,p(n,s)}finally{i.__wbindgen_free(t,e,1)}}membershipState(){const t=i.conversation_membershipState(this.__wbg_ptr);if(t[2])throw f(t[1]);return t[0]}publishMessages(){return i.conversation_publishMessages(this.__wbg_ptr)}superAdminList(){const t=i.conversation_superAdminList(this.__wbg_ptr);if(t[3])throw f(t[2]);var e=H(t[0],t[1]).slice();return i.__wbindgen_free(t[0],t[1]*4,4),e}addedByInboxId(){let t,e;try{const a=i.conversation_addedByInboxId(this.__wbg_ptr);var n=a[0],s=a[1];if(a[3])throw n=0,s=0,f(a[2]);return t=n,e=s,p(n,s)}finally{i.__wbindgen_free(t,e,1)}}groupDescription(){let t,e;try{const a=i.conversation_groupDescription(this.__wbg_ptr);var n=a[0],s=a[1];if(a[3])throw n=0,s=0,f(a[2]);return t=n,e=s,p(n,s)}finally{i.__wbindgen_free(t,e,1)}}groupPermissions(){const t=i.conversation_groupPermissions(this.__wbg_ptr);if(t[2])throw f(t[1]);return f(t[0])}sendReadReceipt(t){return i.conversation_sendReadReceipt(this.__wbg_ptr,d(t)?16777215:t?1:0)}updateGroupName(t){const e=m(t,i.__wbindgen_malloc,i.__wbindgen_realloc),n=u;return i.conversation_updateGroupName(this.__wbg_ptr,e,n)}findDuplicateDms(){return i.conversation_findDuplicateDms(this.__wbg_ptr)}pausedForVersion(){const t=i.conversation_pausedForVersion(this.__wbg_ptr);if(t[3])throw f(t[2]);let e;return t[0]!==0&&(e=p(t[0],t[1]).slice(),i.__wbindgen_free(t[0],t[1]*1,1)),e}removeSuperAdmin(t){const e=m(t,i.__wbindgen_malloc,i.__wbindgen_realloc),n=u;return i.conversation_removeSuperAdmin(this.__wbg_ptr,e,n)}getLastReadTimes(){return i.conversation_getLastReadTimes(this.__wbg_ptr)}findEnrichedMessages(t){return i.conversation_findEnrichedMessages(this.__wbg_ptr,d(t)?0:M(t))}groupImageUrlSquare(){let t,e;try{const a=i.conversation_groupImageUrlSquare(this.__wbg_ptr);var n=a[0],s=a[1];if(a[3])throw n=0,s=0,f(a[2]);return t=n,e=s,p(n,s)}finally{i.__wbindgen_free(t,e,1)}}sendRemoteAttachment(t,e){return i.conversation_sendRemoteAttachment(this.__wbg_ptr,t,d(e)?16777215:e?1:0)}sendWalletSendCalls(t,e){return i.conversation_sendWalletSendCalls(this.__wbg_ptr,t,d(e)?16777215:e?1:0)}addMembersByInboxId(t){const e=q(t,i.__wbindgen_malloc),n=u;return i.conversation_addMembersByInboxId(this.__wbg_ptr,e,n)}updateGroupDescription(t){const e=m(t,i.__wbindgen_malloc,i.__wbindgen_realloc),n=u;return i.conversation_updateGroupDescription(this.__wbg_ptr,e,n)}updatePermissionPolicy(t,e,n){return i.conversation_updatePermissionPolicy(this.__wbg_ptr,t,e,d(n)?6:n)}removeMembersByInboxId(t){const e=q(t,i.__wbindgen_malloc),n=u;return i.conversation_removeMembersByInboxId(this.__wbg_ptr,e,n)}sendTransactionReference(t,e){return i.conversation_sendTransactionReference(this.__wbg_ptr,t,d(e)?16777215:e?1:0)}findMessagesWithReactions(t){return i.conversation_findMessagesWithReactions(this.__wbg_ptr,d(t)?0:M(t))}sendMultiRemoteAttachment(t,e){return i.conversation_sendMultiRemoteAttachment(this.__wbg_ptr,t,d(e)?16777215:e?1:0)}messageDisappearingSettings(){const t=i.conversation_messageDisappearingSettings(this.__wbg_ptr);if(t[2])throw f(t[1]);return f(t[0])}updateGroupImageUrlSquare(t){const e=m(t,i.__wbindgen_malloc,i.__wbindgen_realloc),n=u;return i.conversation_updateGroupImageUrlSquare(this.__wbg_ptr,e,n)}id(){let t,e;try{const n=i.conversation_id(this.__wbg_ptr);return t=n[0],e=n[1],p(n[0],n[1])}finally{i.__wbindgen_free(t,e,1)}}processStreamedGroupMessage(t){return i.conversation_processStreamedGroupMessage(this.__wbg_ptr,t)}isMessageDisappearingEnabled(){const t=i.conversation_isMessageDisappearingEnabled(this.__wbg_ptr);if(t[2])throw f(t[1]);return t[0]!==0}removeMessageDisappearingSettings(){return i.conversation_removeMessageDisappearingSettings(this.__wbg_ptr)}updateMessageDisappearingSettings(t){return i.conversation_updateMessageDisappearingSettings(this.__wbg_ptr,t)}send(t,e){return i.conversation_send(this.__wbg_ptr,t,e)}sync(){return i.conversation_sync(this.__wbg_ptr)}stream(t){const e=i.conversation_stream(this.__wbg_ptr,t);if(e[2])throw f(e[1]);return V.__wrap(e[0])}appData(){let t,e;try{const a=i.conversation_appData(this.__wbg_ptr);var n=a[0],s=a[1];if(a[3])throw n=0,s=0,f(a[2]);return t=n,e=s,p(n,s)}finally{i.__wbindgen_free(t,e,1)}}isAdmin(t){const e=m(t,i.__wbindgen_malloc,i.__wbindgen_realloc),n=u,s=i.conversation_isAdmin(this.__wbg_ptr,e,n);if(s[2])throw f(s[1]);return s[0]!==0}addAdmin(t){const e=m(t,i.__wbindgen_malloc,i.__wbindgen_realloc),n=u;return i.conversation_addAdmin(this.__wbg_ptr,e,n)}isActive(){const t=i.conversation_isActive(this.__wbg_ptr);if(t[2])throw f(t[1]);return t[0]!==0}sendText(t,e){const n=m(t,i.__wbindgen_malloc,i.__wbindgen_realloc),s=u;return i.conversation_sendText(this.__wbg_ptr,n,s,d(e)?16777215:e?1:0)}consentState(){const t=i.conversation_consentState(this.__wbg_ptr);if(t[2])throw f(t[1]);return t[0]}updateConsentState(t){const e=i.conversation_updateConsentState(this.__wbg_ptr,t);if(e[1])throw f(e[0])}}Symbol.dispose&&(z.prototype[Symbol.dispose]=z.prototype.free);const se=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(r=>i.__wbg_conversationlistitem_free(r>>>0,1));class Tt{static __wrap(t){t=t>>>0;const e=Object.create(Tt.prototype);return e.__wbg_ptr=t,se.register(e,e.__wbg_ptr,e),e}__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,se.unregister(this),t}free(){const t=this.__destroy_into_raw();i.__wbg_conversationlistitem_free(t,0)}get conversation(){const t=i.__wbg_get_conversationlistitem_conversation(this.__wbg_ptr);return z.__wrap(t)}set conversation(t){Ft(t,z);var e=t.__destroy_into_raw();i.__wbg_set_conversationlistitem_conversation(this.__wbg_ptr,e)}get lastMessage(){return i.__wbg_get_conversationlistitem_lastMessage(this.__wbg_ptr)}set lastMessage(t){i.__wbg_set_conversationlistitem_lastMessage(this.__wbg_ptr,d(t)?0:M(t))}get isCommitLogForked(){const t=i.__wbg_get_conversationlistitem_isCommitLogForked(this.__wbg_ptr);return t===16777215?void 0:t!==0}set isCommitLogForked(t){i.__wbg_set_conversationlistitem_isCommitLogForked(this.__wbg_ptr,d(t)?16777215:t?1:0)}constructor(t,e,n){Ft(t,z);var s=t.__destroy_into_raw();const a=i.conversationlistitem_new(s,d(e)?0:M(e),d(n)?16777215:n?1:0);return this.__wbg_ptr=a>>>0,se.register(this,this.__wbg_ptr,this),this}}Symbol.dispose&&(Tt.prototype[Symbol.dispose]=Tt.prototype.free);const pe=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(r=>i.__wbg_conversations_free(r>>>0,1));class Dt{static __wrap(t){t=t>>>0;const e=Object.create(Dt.prototype);return e.__wbg_ptr=t,pe.register(e,e.__wbg_ptr,e),e}__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,pe.unregister(this),t}free(){const t=this.__destroy_into_raw();i.__wbg_conversations_free(t,0)}createGroup(t,e){const n=q(t,i.__wbindgen_malloc),s=u;return i.conversations_createGroup(this.__wbg_ptr,n,s,d(e)?0:M(e))}getHmacKeys(){const t=i.conversations_getHmacKeys(this.__wbg_ptr);if(t[2])throw f(t[1]);return f(t[0])}streamConsent(t){const e=i.conversations_streamConsent(this.__wbg_ptr,t);if(e[2])throw f(e[1]);return V.__wrap(e[0])}findGroupById(t){const e=m(t,i.__wbindgen_malloc,i.__wbindgen_realloc),n=u,s=i.conversations_findGroupById(this.__wbg_ptr,e,n);if(s[2])throw f(s[1]);return z.__wrap(s[0])}createDm(t,e){return i.conversations_createDm(this.__wbg_ptr,t,d(e)?0:M(e))}findMessageById(t){const e=m(t,i.__wbindgen_malloc,i.__wbindgen_realloc),n=u,s=i.conversations_findMessageById(this.__wbg_ptr,e,n);if(s[2])throw f(s[1]);return f(s[0])}streamPreferences(t){const e=i.conversations_streamPreferences(this.__wbg_ptr,t);if(e[2])throw f(e[1]);return V.__wrap(e[0])}streamAllMessages(t,e,n){var s=d(n)?0:q(n,i.__wbindgen_malloc),a=u;const c=i.conversations_streamAllMessages(this.__wbg_ptr,t,d(e)?4:e,s,a);if(c[2])throw f(c[1]);return V.__wrap(c[0])}deleteMessageById(t){const e=m(t,i.__wbindgen_malloc,i.__wbindgen_realloc),n=u,s=i.conversations_deleteMessageById(this.__wbg_ptr,e,n);if(s[2])throw f(s[1]);return s[0]>>>0}syncAllConversations(t){var e=d(t)?0:q(t,i.__wbindgen_malloc),n=u;return i.conversations_syncAllConversations(this.__wbg_ptr,e,n)}createGroupOptimistic(t){const e=i.conversations_createGroupOptimistic(this.__wbg_ptr,d(t)?0:M(t));if(e[2])throw f(e[1]);return z.__wrap(e[0])}streamMessageDeletions(t){const e=i.conversations_streamMessageDeletions(this.__wbg_ptr,t);if(e[2])throw f(e[1]);return V.__wrap(e[0])}createGroupByInboxIds(t,e){const n=q(t,i.__wbindgen_malloc),s=u;return i.conversations_createGroupByInboxIds(this.__wbg_ptr,n,s,d(e)?0:M(e))}findDmByTargetInboxId(t){const e=m(t,i.__wbindgen_malloc,i.__wbindgen_realloc),n=u,s=i.conversations_findDmByTargetInboxId(this.__wbg_ptr,e,n);if(s[2])throw f(s[1]);return z.__wrap(s[0])}streamLocal(t){return i.conversations_streamLocal(this.__wbg_ptr,d(t)?4:t)}findEnrichedMessageById(t){const e=m(t,i.__wbindgen_malloc,i.__wbindgen_realloc),n=u;return i.conversations_findEnrichedMessageById(this.__wbg_ptr,e,n)}createDmByInboxId(t,e){const n=m(t,i.__wbindgen_malloc,i.__wbindgen_realloc),s=u;return i.conversations_createDmByInboxId(this.__wbg_ptr,n,s,d(e)?0:M(e))}list(t){const e=i.conversations_list(this.__wbg_ptr,d(t)?0:M(t));if(e[2])throw f(e[1]);return f(e[0])}sync(){return i.conversations_sync(this.__wbg_ptr)}stream(t,e){const n=i.conversations_stream(this.__wbg_ptr,t,d(e)?4:e);if(n[2])throw f(n[1]);return V.__wrap(n[0])}}Symbol.dispose&&(Dt.prototype[Symbol.dispose]=Dt.prototype.free);typeof FinalizationRegistry>"u"||new FinalizationRegistry(r=>i.__wbg_intounderlyingbytesource_free(r>>>0,1));typeof FinalizationRegistry>"u"||new FinalizationRegistry(r=>i.__wbg_intounderlyingsink_free(r>>>0,1));const me=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(r=>i.__wbg_intounderlyingsource_free(r>>>0,1));class kt{static __wrap(t){t=t>>>0;const e=Object.create(kt.prototype);return e.__wbg_ptr=t,me.register(e,e.__wbg_ptr,e),e}__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,me.unregister(this),t}free(){const t=this.__destroy_into_raw();i.__wbg_intounderlyingsource_free(t,0)}pull(t){return i.intounderlyingsource_pull(this.__wbg_ptr,t)}cancel(){const t=this.__destroy_into_raw();i.intounderlyingsource_cancel(t)}}Symbol.dispose&&(kt.prototype[Symbol.dispose]=kt.prototype.free);const ye=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(r=>i.__wbg_signaturerequesthandle_free(r>>>0,1));class K{static __wrap(t){t=t>>>0;const e=Object.create(K.prototype);return e.__wbg_ptr=t,ye.register(e,e.__wbg_ptr,e),e}__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,ye.unregister(this),t}free(){const t=this.__destroy_into_raw();i.__wbg_signaturerequesthandle_free(t,0)}signatureText(){return i.signaturerequesthandle_signatureText(this.__wbg_ptr)}addScwSignature(t,e,n,s){return i.signaturerequesthandle_addScwSignature(this.__wbg_ptr,t,e,n,!d(s),d(s)?BigInt(0):s)}addEcdsaSignature(t){return i.signaturerequesthandle_addEcdsaSignature(this.__wbg_ptr,t)}addPasskeySignature(t){return i.signaturerequesthandle_addPasskeySignature(this.__wbg_ptr,t)}}Symbol.dispose&&(K.prototype[Symbol.dispose]=K.prototype.free);const ve=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(r=>i.__wbg_streamcloser_free(r>>>0,1));class V{static __wrap(t){t=t>>>0;const e=Object.create(V.prototype);return e.__wbg_ptr=t,ve.register(e,e.__wbg_ptr,e),e}__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,ve.unregister(this),t}free(){const t=this.__destroy_into_raw();i.__wbg_streamcloser_free(t,0)}endAndWait(){return i.streamcloser_endAndWait(this.__wbg_ptr)}waitForReady(){return i.streamcloser_waitForReady(this.__wbg_ptr)}end(){i.streamcloser_end(this.__wbg_ptr)}isClosed(){return i.streamcloser_isClosed(this.__wbg_ptr)!==0}}Symbol.dispose&&(V.prototype[Symbol.dispose]=V.prototype.free);const en=new Set(["basic","cors","default"]);async function nn(r,t){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,t)}catch(n){if(r.ok&&en.has(r.type)&&r.headers.get("Content-Type")!=="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve Wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const e=await r.arrayBuffer();return await WebAssembly.instantiate(e,t)}else{const e=await WebAssembly.instantiate(r,t);return e instanceof WebAssembly.Instance?{instance:e,module:r}:e}}function rn(){const r={};return r.wbg={},r.wbg.__wbg_Error_e83987f665cf5504=function(t,e){return Error(p(t,e))},r.wbg.__wbg_Number_bb48ca12f395cd08=function(t){return Number(t)},r.wbg.__wbg_String_8f0eb39a4a4c2f66=function(t,e){const n=String(e),s=m(n,i.__wbindgen_malloc,i.__wbindgen_realloc),a=u;T().setInt32(t+4,a,!0),T().setInt32(t+0,s,!0)},r.wbg.__wbg___wbindgen_bigint_get_as_i64_f3ebc5a755000afd=function(t,e){const n=e,s=typeof n=="bigint"?n:void 0;T().setBigInt64(t+8,d(s)?BigInt(0):s,!0),T().setInt32(t+0,!d(s),!0)},r.wbg.__wbg___wbindgen_boolean_get_6d5a1ee65bab5f68=function(t){const e=t,n=typeof e=="boolean"?e:void 0;return d(n)?16777215:n?1:0},r.wbg.__wbg___wbindgen_debug_string_df47ffb5e35e6763=function(t,e){const n=oe(e),s=m(n,i.__wbindgen_malloc,i.__wbindgen_realloc),a=u;T().setInt32(t+4,a,!0),T().setInt32(t+0,s,!0)},r.wbg.__wbg___wbindgen_in_bb933bd9e1b3bc0f=function(t,e){return t in e},r.wbg.__wbg___wbindgen_is_bigint_cb320707dcd35f0b=function(t){return typeof t=="bigint"},r.wbg.__wbg___wbindgen_is_function_ee8a6c5833c90377=function(t){return typeof t=="function"},r.wbg.__wbg___wbindgen_is_object_c818261d21f283a4=function(t){const e=t;return typeof e=="object"&&e!==null},r.wbg.__wbg___wbindgen_is_string_fbb76cb2940daafd=function(t){return typeof t=="string"},r.wbg.__wbg___wbindgen_is_undefined_2d472862bd29a478=function(t){return t===void 0},r.wbg.__wbg___wbindgen_jsval_eq_6b13ab83478b1c50=function(t,e){return t===e},r.wbg.__wbg___wbindgen_jsval_loose_eq_b664b38a2f582147=function(t,e){return t==e},r.wbg.__wbg___wbindgen_number_get_a20bf9b85341449d=function(t,e){const n=e,s=typeof n=="number"?n:void 0;T().setFloat64(t+8,d(s)?0:s,!0),T().setInt32(t+0,!d(s),!0)},r.wbg.__wbg___wbindgen_string_get_e4f06c90489ad01b=function(t,e){const n=e,s=typeof n=="string"?n:void 0;var a=d(s)?0:m(s,i.__wbindgen_malloc,i.__wbindgen_realloc),c=u;T().setInt32(t+4,c,!0),T().setInt32(t+0,a,!0)},r.wbg.__wbg___wbindgen_throw_b855445ff6a94295=function(t,e){throw new Error(p(t,e))},r.wbg.__wbg___wbindgen_try_into_number_e60ef6e208abc399=function(t){let e;try{e=+t}catch(s){e=s}return e},r.wbg.__wbg__wbg_cb_unref_2454a539ea5790d9=function(t){t._wbg_cb_unref()},r.wbg.__wbg_abort_28ad55c5825b004d=function(t,e){t.abort(e)},r.wbg.__wbg_abort_e7eb059f72f9ed0c=function(t){t.abort()},r.wbg.__wbg_append_b577eb3a177bc0fa=function(){return w(function(t,e,n,s,a){t.append(p(e,n),p(s,a))},arguments)},r.wbg.__wbg_arrayBuffer_b375eccb84b4ddf3=function(){return w(function(t){return t.arrayBuffer()},arguments)},r.wbg.__wbg_body_587542b2fd8e06c0=function(t){const e=t.body;return d(e)?0:M(e)},r.wbg.__wbg_buffer_ccc4520b36d3ccf4=function(t){return t.buffer},r.wbg.__wbg_byobRequest_2344e6975f27456e=function(t){const e=t.byobRequest;return d(e)?0:M(e)},r.wbg.__wbg_byteLength_bcd42e4025299788=function(t){return t.byteLength},r.wbg.__wbg_byteOffset_ca3a6cf7944b364b=function(t){return t.byteOffset},r.wbg.__wbg_call_525440f72fbfc0ea=function(){return w(function(t,e,n){return t.call(e,n)},arguments)},r.wbg.__wbg_call_e762c39fa8ea36bf=function(){return w(function(t,e){return t.call(e)},arguments)},r.wbg.__wbg_cancel_48ab6f9dc366e369=function(t){return t.cancel()},r.wbg.__wbg_catch_943836faa5d29bfb=function(t,e){return t.catch(e)},r.wbg.__wbg_clearInterval_dd1e598f425db353=function(t){return clearInterval(t)},r.wbg.__wbg_clearTimeout_2e2c4939388cdfbb=function(t){return clearTimeout(t)},r.wbg.__wbg_clearTimeout_5a54f8841c30079a=function(t){return clearTimeout(t)},r.wbg.__wbg_clearTimeout_7a42b49784aea641=function(t){return clearTimeout(t)},r.wbg.__wbg_client_new=function(t){return Mt.__wrap(t)},r.wbg.__wbg_close_5a6caed3231b68cd=function(){return w(function(t){t.close()},arguments)},r.wbg.__wbg_close_6956df845478561a=function(){return w(function(t){t.close()},arguments)},r.wbg.__wbg_close_6b987dbb02427741=function(t){t.close()},r.wbg.__wbg_code_218f5fdf8c7fcabd=function(t){return t.code},r.wbg.__wbg_conversation_new=function(t){return z.__wrap(t)},r.wbg.__wbg_conversationlistitem_new=function(t){return Tt.__wrap(t)},r.wbg.__wbg_createSyncAccessHandle_63bd856e74273e32=function(t){return t.createSyncAccessHandle()},r.wbg.__wbg_create_f2b6bfa66a83e88e=function(t){return Object.create(t)},r.wbg.__wbg_crypto_574e78ad8b13b65f=function(t){return t.crypto},r.wbg.__wbg_debug_e55e1461940eb14d=function(t,e,n,s){console.debug(t,e,n,s)},r.wbg.__wbg_debug_f4b0c59db649db48=function(t){console.debug(t)},r.wbg.__wbg_done_2042aa2670fb1db1=function(t){return t.done},r.wbg.__wbg_enqueue_7b18a650aec77898=function(){return w(function(t,e){t.enqueue(e)},arguments)},r.wbg.__wbg_entries_a1e792d46512c8bf=function(t){return t.entries()},r.wbg.__wbg_entries_e171b586f8f6bdbf=function(t){return Object.entries(t)},r.wbg.__wbg_error_7534b8e9a36f1ab4=function(t,e){let n,s;try{n=t,s=e,console.error(p(t,e))}finally{i.__wbindgen_free(n,s,1)}},r.wbg.__wbg_error_a7f8fbb0523dae15=function(t){console.error(t)},r.wbg.__wbg_error_d8b22cf4e59a6791=function(t,e,n,s){console.error(t,e,n,s)},r.wbg.__wbg_error_e98c298703cffa97=function(t,e){console.error(p(t,e))},r.wbg.__wbg_fetch_53eef7df7b439a49=function(t,e){return fetch(t,e)},r.wbg.__wbg_fetch_74a3e84ebd2c9a0e=function(t){return fetch(t)},r.wbg.__wbg_fetch_8725865ff47e7fcc=function(t,e,n){return t.fetch(e,n)},r.wbg.__wbg_fetch_f8ba0e29a9d6de0d=function(t,e){return t.fetch(e)},r.wbg.__wbg_fill_f6f1b48c9e4bb626=function(t,e,n,s){return t.fill(e,n>>>0,s>>>0)},r.wbg.__wbg_flush_b49c3916f841ba87=function(){return w(function(t){t.flush()},arguments)},r.wbg.__wbg_from_a4ad7cbddd0d7135=function(t){return Array.from(t)},r.wbg.__wbg_getDate_5a70d2f6a482d99f=function(t){return t.getDate()},r.wbg.__wbg_getDay_a150a3fd757619d1=function(t){return t.getDay()},r.wbg.__wbg_getDirectoryHandle_45b9305ebb42f05a=function(t,e,n,s){return t.getDirectoryHandle(p(e,n),s)},r.wbg.__wbg_getDirectory_7e7a55f640412401=function(t){return t.getDirectory()},r.wbg.__wbg_getFileHandle_acd9b5e4404b60dd=function(t,e,n,s){return t.getFileHandle(p(e,n),s)},r.wbg.__wbg_getFullYear_8240d5a15191feae=function(t){return t.getFullYear()},r.wbg.__wbg_getHours_5e476e0b9ebc42d1=function(t){return t.getHours()},r.wbg.__wbg_getMinutes_c95dfb65f1ea8f02=function(t){return t.getMinutes()},r.wbg.__wbg_getMonth_25c1c5a601d72773=function(t){return t.getMonth()},r.wbg.__wbg_getRandomValues_1c61fac11405ffdc=function(){return w(function(t,e){globalThis.crypto.getRandomValues(J(t,e))},arguments)},r.wbg.__wbg_getRandomValues_b8f5dbd5f3995a9e=function(){return w(function(t,e){t.getRandomValues(e)},arguments)},r.wbg.__wbg_getRandomValues_d8c71ea8f97a0b46=function(){return w(function(t,e){globalThis.crypto.getRandomValues(J(t,e))},arguments)},r.wbg.__wbg_getReader_48e00749fe3f6089=function(){return w(function(t){return t.getReader()},arguments)},r.wbg.__wbg_getSeconds_8113bf8709718eb2=function(t){return t.getSeconds()},r.wbg.__wbg_getSize_f43fed70ca1762f1=function(){return w(function(t){return t.getSize()},arguments)},r.wbg.__wbg_getTime_14776bfb48a1bff9=function(t){return t.getTime()},r.wbg.__wbg_getTimezoneOffset_d391cb11d54969f8=function(t){return t.getTimezoneOffset()},r.wbg.__wbg_getUint32_741d4a7dc32fc0d5=function(t,e){return t.getUint32(e>>>0)},r.wbg.__wbg_get_7bed016f185add81=function(t,e){return t[e>>>0]},r.wbg.__wbg_get_done_a0463af43a1fc764=function(t){const e=t.done;return d(e)?16777215:e?1:0},r.wbg.__wbg_get_efcb449f58ec27c2=function(){return w(function(t,e){return Reflect.get(t,e)},arguments)},r.wbg.__wbg_get_index_af1d9818a935f6ae=function(t,e){return t[e>>>0]},r.wbg.__wbg_get_value_5ce96c9f81ce7398=function(t){return t.value},r.wbg.__wbg_get_with_ref_key_1dc361bd10053bfe=function(t,e){return t[e]},r.wbg.__wbg_has_787fafc980c3ccdb=function(){return w(function(t,e){return Reflect.has(t,e)},arguments)},r.wbg.__wbg_headers_b87d7eaba61c3278=function(t){return t.headers},r.wbg.__wbg_info_68cd5b51ef7e5137=function(t,e,n,s){console.info(t,e,n,s)},r.wbg.__wbg_info_e674a11f4f50cc0c=function(t){console.info(t)},r.wbg.__wbg_instanceof_ArrayBuffer_70beb1189ca63b38=function(t){let e;try{e=t instanceof ArrayBuffer}catch{e=!1}return e},r.wbg.__wbg_instanceof_DomException_83b15e7b042a0b1a=function(t){let e;try{e=t instanceof DOMException}catch{e=!1}return e},r.wbg.__wbg_instanceof_Map_8579b5e2ab5437c7=function(t){let e;try{e=t instanceof Map}catch{e=!1}return e},r.wbg.__wbg_instanceof_Response_f4f3e87e07f3135c=function(t){let e;try{e=t instanceof Response}catch{e=!1}return e},r.wbg.__wbg_instanceof_Uint8Array_20c8e73002f7af98=function(t){let e;try{e=t instanceof Uint8Array}catch{e=!1}return e},r.wbg.__wbg_instanceof_WorkerGlobalScope_e31f49b6d33fcadd=function(t){let e;try{e=t instanceof WorkerGlobalScope}catch{e=!1}return e},r.wbg.__wbg_isArray_96e0af9891d0945d=function(t){return Array.isArray(t)},r.wbg.__wbg_isSafeInteger_d216eda7911dde36=function(t){return Number.isSafeInteger(t)},r.wbg.__wbg_iterator_e5822695327a3c39=function(){return Symbol.iterator},r.wbg.__wbg_length_69bca3cb64fc8748=function(t){return t.length},r.wbg.__wbg_length_a95b69f903b746c4=function(t){return t.length},r.wbg.__wbg_length_cdd215e10d9dd507=function(t){return t.length},r.wbg.__wbg_mark_05056c522bddc362=function(){return w(function(t,e,n){t.mark(p(e,n))},arguments)},r.wbg.__wbg_mark_24a1a597f4f00679=function(){return w(function(t,e,n,s){t.mark(p(e,n),s)},arguments)},r.wbg.__wbg_measure_0b7379f5cfacac6d=function(){return w(function(t,e,n,s,a,c,_){t.measure(p(e,n),p(s,a),p(c,_))},arguments)},r.wbg.__wbg_measure_7728846525e2cced=function(){return w(function(t,e,n,s){t.measure(p(e,n),s)},arguments)},r.wbg.__wbg_message_bd42dbe3f2f3ed8e=function(t,e){const n=e.message,s=m(n,i.__wbindgen_malloc,i.__wbindgen_realloc),a=u;T().setInt32(t+4,a,!0),T().setInt32(t+0,s,!0)},r.wbg.__wbg_msCrypto_a61aeb35a24c1329=function(t){return t.msCrypto},r.wbg.__wbg_name_3a33ad25b892b2dd=function(t,e){const n=e.name,s=m(n,i.__wbindgen_malloc,i.__wbindgen_realloc),a=u;T().setInt32(t+4,a,!0),T().setInt32(t+0,s,!0)},r.wbg.__wbg_navigator_ae06f1666ea7c968=function(t){return t.navigator},r.wbg.__wbg_new_0_f9740686d739025c=function(){return new Date},r.wbg.__wbg_new_1acc0b6eea89d040=function(){return new Object},r.wbg.__wbg_new_1c342efbe54a5bfd=function(t,e,n){return new DataView(t,e>>>0,n>>>0)},r.wbg.__wbg_new_2531773dac38ebb3=function(){return w(function(){return new AbortController},arguments)},r.wbg.__wbg_new_3c3d849046688a66=function(t,e){try{var n={a:t,b:e},s=(c,_)=>{const b=n.a;n.a=0;try{return He(b,n.b,c,_)}finally{n.a=b}};return new Promise(s)}finally{n.a=n.b=0}},r.wbg.__wbg_new_5a79be3ab53b8aa5=function(t){return new Uint8Array(t)},r.wbg.__wbg_new_68651c719dcda04e=function(){return new Map},r.wbg.__wbg_new_8a6f238a6ece86ea=function(){return new Error},r.wbg.__wbg_new_93d9417ed3fb115d=function(t){return new Date(t)},r.wbg.__wbg_new_9edf9838a2def39c=function(){return w(function(){return new Headers},arguments)},r.wbg.__wbg_new_a7442b4b19c1a356=function(t,e){return new Error(p(t,e))},r.wbg.__wbg_new_e17d9f43105b08be=function(){return new Array},r.wbg.__wbg_new_from_slice_92f4d78ca282a2d2=function(t,e){return new Uint8Array(J(t,e))},r.wbg.__wbg_new_no_args_ee98eee5275000a4=function(t,e){return new Function(p(t,e))},r.wbg.__wbg_new_with_byte_offset_and_length_46e3e6a5e9f9e89b=function(t,e,n){return new Uint8Array(t,e>>>0,n>>>0)},r.wbg.__wbg_new_with_into_underlying_source_b47f6a6a596a7f24=function(t,e){return new ReadableStream(kt.__wrap(t),e)},r.wbg.__wbg_new_with_length_01aa0dc35aa13543=function(t){return new Uint8Array(t>>>0)},r.wbg.__wbg_new_with_str_and_init_0ae7728b6ec367b1=function(){return w(function(t,e,n){return new Request(p(t,e),n)},arguments)},r.wbg.__wbg_new_with_year_month_day_6236812cf591750d=function(t,e,n){return new Date(t>>>0,e,n)},r.wbg.__wbg_next_020810e0ae8ebcb0=function(){return w(function(t){return t.next()},arguments)},r.wbg.__wbg_next_2c826fe5dfec6b6a=function(t){return t.next},r.wbg.__wbg_next_eedaffcadc567b75=function(){return w(function(t){return t.next()},arguments)},r.wbg.__wbg_node_905d3e251edff8a2=function(t){return t.node},r.wbg.__wbg_now_2c95c9de01293173=function(t){return t.now()},r.wbg.__wbg_now_793306c526e2e3b6=function(){return Date.now()},r.wbg.__wbg_on_auth_required_bd4fddb2d64ca1f6=function(){return w(function(t){return t.on_auth_required()},arguments)},r.wbg.__wbg_on_close_b7db71fe8139a5f0=function(t){t.on_close()},r.wbg.__wbg_on_consent_update_f646a191e881f57d=function(t,e){t.on_consent_update(e)},r.wbg.__wbg_on_conversation_9187414aca96940c=function(t,e){t.on_conversation(z.__wrap(e))},r.wbg.__wbg_on_error_c58307424c85aaf5=function(t,e){t.on_error(e)},r.wbg.__wbg_on_message_b60ee485d291967a=function(t,e){t.on_message(e)},r.wbg.__wbg_on_message_deleted_dc9cf7d3b9aefde7=function(t,e,n){let s,a;try{s=e,a=n,t.on_message_deleted(p(e,n))}finally{i.__wbindgen_free(s,a,1)}},r.wbg.__wbg_on_user_preference_update_82574376a4af8566=function(t,e,n){var s=H(e,n).slice();i.__wbindgen_free(e,n*4,4),t.on_user_preference_update(s)},r.wbg.__wbg_performance_121b9855d716e029=function(){return globalThis.performance},r.wbg.__wbg_performance_7a3ffd0b17f663ad=function(t){return t.performance},r.wbg.__wbg_postMessage_de7175726e2c1bc7=function(){return w(function(t,e){t.postMessage(e)},arguments)},r.wbg.__wbg_process_dc0fbacc7c1c06f7=function(t){return t.process},r.wbg.__wbg_prototypesetcall_2a6620b6922694b2=function(t,e,n){Uint8Array.prototype.set.call(J(t,e),n)},r.wbg.__wbg_push_df81a39d04db858c=function(t,e){return t.push(e)},r.wbg.__wbg_queueMicrotask_34d692c25c47d05b=function(t){return t.queueMicrotask},r.wbg.__wbg_queueMicrotask_9d76cacb20c84d58=function(t){queueMicrotask(t)},r.wbg.__wbg_randomFillSync_ac0988aba3254290=function(){return w(function(t,e){t.randomFillSync(e)},arguments)},r.wbg.__wbg_random_babe96ffc73e60a2=function(){return Math.random()},r.wbg.__wbg_read_48f1593df542f968=function(t){return t.read()},r.wbg.__wbg_read_e2b5efb864451cae=function(){return w(function(t,e,n){return t.read(e,n)},arguments)},r.wbg.__wbg_read_f7d59b68d039d64d=function(){return w(function(t,e,n,s){return t.read(J(e,n),s)},arguments)},r.wbg.__wbg_releaseLock_5d0b5a68887b891d=function(t){t.releaseLock()},r.wbg.__wbg_require_60cc747a6bc5215a=function(){return w(function(){return module.require},arguments)},r.wbg.__wbg_resolve_caf97c30b83f7053=function(t){return Promise.resolve(t)},r.wbg.__wbg_respond_0f4dbf5386f5c73e=function(){return w(function(t,e){t.respond(e>>>0)},arguments)},r.wbg.__wbg_setInterval_ed3b5e3c3ebb8a6d=function(){return w(function(t,e){return setInterval(t,e)},arguments)},r.wbg.__wbg_setTimeout_7bb3429662ab1e70=function(t,e){return setTimeout(t,e)},r.wbg.__wbg_setTimeout_8f06012fba12034e=function(t,e){globalThis.setTimeout(t,e)},r.wbg.__wbg_setTimeout_929c97a7c0f23d36=function(t,e){return setTimeout(t,e)},r.wbg.__wbg_setTimeout_db2dbaeefb6f39c7=function(){return w(function(t,e){return setTimeout(t,e)},arguments)},r.wbg.__wbg_setUint32_7c19a62c08deac62=function(t,e,n){t.setUint32(e>>>0,n>>>0)},r.wbg.__wbg_set_3f1d0b984ed272ed=function(t,e,n){t[e]=n},r.wbg.__wbg_set_8b342d8cd9d2a02c=function(){return w(function(t,e,n,s,a){t.set(p(e,n),p(s,a))},arguments)},r.wbg.__wbg_set_907fb406c34a251d=function(t,e,n){return t.set(e,n)},r.wbg.__wbg_set_9e6516df7b7d0f19=function(t,e,n){t.set(J(e,n))},r.wbg.__wbg_set_at_ec187fadbab331e2=function(t,e){t.at=e},r.wbg.__wbg_set_body_3c365989753d61f4=function(t,e){t.body=e},r.wbg.__wbg_set_c213c871859d6500=function(t,e,n){t[e>>>0]=n},r.wbg.__wbg_set_c2abbebe8b9ebee1=function(){return w(function(t,e,n){return Reflect.set(t,e,n)},arguments)},r.wbg.__wbg_set_cache_2f9deb19b92b81e3=function(t,e){t.cache=Ye[e]},r.wbg.__wbg_set_create_89d91caa5a7a3a2b=function(t,e){t.create=e!==0},r.wbg.__wbg_set_create_cd6996d11cc76544=function(t,e){t.create=e!==0},r.wbg.__wbg_set_credentials_f621cd2d85c0c228=function(t,e){t.credentials=Qe[e]},r.wbg.__wbg_set_headers_6926da238cd32ee4=function(t,e){t.headers=e},r.wbg.__wbg_set_high_water_mark_5142ac1d2fb46365=function(t,e){t.highWaterMark=e},r.wbg.__wbg_set_integrity_62a46fc792832f41=function(t,e,n){t.integrity=p(e,n)},r.wbg.__wbg_set_method_c02d8cbbe204ac2d=function(t,e,n){t.method=p(e,n)},r.wbg.__wbg_set_mode_52ef73cfa79639cb=function(t,e){t.mode=Ze[e]},r.wbg.__wbg_set_redirect_df0285496ec45ff8=function(t,e){t.redirect=tn[e]},r.wbg.__wbg_set_referrer_ec9cf8a8a315d50c=function(t,e,n){t.referrer=p(e,n)},r.wbg.__wbg_set_referrer_policy_99c1f299b4e37446=function(t,e){t.referrerPolicy=Je[e]},r.wbg.__wbg_set_signal_dda2cf7ccb6bee0f=function(t,e){t.signal=e},r.wbg.__wbg_signal_4db5aa055bf9eb9a=function(t){return t.signal},r.wbg.__wbg_signaturerequesthandle_new=function(t){return K.__wrap(t)},r.wbg.__wbg_slice_3e7e2fc0da7cc625=function(t,e,n){return t.slice(e>>>0,n>>>0)},r.wbg.__wbg_stack_0ed75d68575b0f3c=function(t,e){const n=e.stack,s=m(n,i.__wbindgen_malloc,i.__wbindgen_realloc),a=u;T().setInt32(t+4,a,!0),T().setInt32(t+0,s,!0)},r.wbg.__wbg_static_accessor_GLOBAL_89e1d9ac6a1b250e=function(){const t=typeof global>"u"?null:global;return d(t)?0:M(t)},r.wbg.__wbg_static_accessor_GLOBAL_THIS_8b530f326a9e48ac=function(){const t=typeof globalThis>"u"?null:globalThis;return d(t)?0:M(t)},r.wbg.__wbg_static_accessor_SELF_6fdf4b64710cc91b=function(){const t=typeof self>"u"?null:self;return d(t)?0:M(t)},r.wbg.__wbg_static_accessor_WINDOW_b45bfc5a37f6cfa2=function(){const t=typeof window>"u"?null:window;return d(t)?0:M(t)},r.wbg.__wbg_status_de7eed5a7a5bfd5d=function(t){return t.status},r.wbg.__wbg_storage_2fd28cd0598c9a9b=function(t){return t.storage},r.wbg.__wbg_stringify_b5fb28f6465d9c3e=function(){return w(function(t){return JSON.stringify(t)},arguments)},r.wbg.__wbg_subarray_480600f3d6a9f26c=function(t,e,n){return t.subarray(e>>>0,n>>>0)},r.wbg.__wbg_text_dc33c15c17bdfb52=function(){return w(function(t){return t.text()},arguments)},r.wbg.__wbg_then_4f46f6544e6b4a28=function(t,e){return t.then(e)},r.wbg.__wbg_then_70d05cf780a18d77=function(t,e,n){return t.then(e,n)},r.wbg.__wbg_toString_331854e6e3c16849=function(){return w(function(t,e){return t.toString(e)},arguments)},r.wbg.__wbg_toString_7da7c8dbec78fcb8=function(t){return t.toString()},r.wbg.__wbg_truncate_6511a04243d4c36b=function(){return w(function(t,e){t.truncate(e)},arguments)},r.wbg.__wbg_truncate_f99e4636535b6562=function(){return w(function(t,e){t.truncate(e>>>0)},arguments)},r.wbg.__wbg_url_b36d2a5008eb056f=function(t,e){const n=e.url,s=m(n,i.__wbindgen_malloc,i.__wbindgen_realloc),a=u;T().setInt32(t+4,a,!0),T().setInt32(t+0,s,!0)},r.wbg.__wbg_value_692627309814bb8c=function(t){return t.value},r.wbg.__wbg_versions_c01dfd4722a88165=function(t){return t.versions},r.wbg.__wbg_view_f6c15ac9fed63bbd=function(t){const e=t.view;return d(e)?0:M(e)},r.wbg.__wbg_warn_1d74dddbe2fd1dbb=function(t){console.warn(t)},r.wbg.__wbg_warn_8f5b5437666d0885=function(t,e,n,s){console.warn(t,e,n,s)},r.wbg.__wbg_write_0c22b53589bfcada=function(){return w(function(t,e,n,s){return t.write(J(e,n),s)},arguments)},r.wbg.__wbg_write_5c1be3e4039a6ed1=function(){return w(function(t,e,n){return t.write(e,n)},arguments)},r.wbg.__wbindgen_cast_173fbbcd3a731426=function(t,e){return Yt(t,e,i.wasm_bindgen__closure__destroy__hed8af60076250245,Ge)},r.wbg.__wbindgen_cast_2241b6af4c4b2941=function(t,e){return p(t,e)},r.wbg.__wbindgen_cast_25a0a844437d0e92=function(t,e){var n=H(t,e).slice();return i.__wbindgen_free(t,e*4,4),n},r.wbg.__wbindgen_cast_2900838d07f16ff6=function(t,e){return Yt(t,e,i.wasm_bindgen__closure__destroy__hfbd660e60d498df9,Ve)},r.wbg.__wbindgen_cast_3ab6bb23fa77e709=function(t,e){return Yt(t,e,i.wasm_bindgen__closure__destroy__h3c5639ee43c80f22,$e)},r.wbg.__wbindgen_cast_4625c577ab2ec9ee=function(t){return BigInt.asUintN(64,t)},r.wbg.__wbindgen_cast_4a7a1cd401354e65=function(t,e){var n=H(t,e).slice();return i.__wbindgen_free(t,e*4,4),n},r.wbg.__wbindgen_cast_8e37b4ad2f2ba653=function(t,e){var n=H(t,e).slice();return i.__wbindgen_free(t,e*4,4),n},r.wbg.__wbindgen_cast_998222446b91a002=function(t,e){var n=H(t,e).slice();return i.__wbindgen_free(t,e*4,4),n},r.wbg.__wbindgen_cast_9ae0607507abb057=function(t){return t},r.wbg.__wbindgen_cast_cb9088102bce6b30=function(t,e){return J(t,e)},r.wbg.__wbindgen_cast_d6cd19b81560fd6e=function(t){return t},r.wbg.__wbindgen_cast_e081be35fe620ec4=function(t,e){var n=H(t,e).slice();return i.__wbindgen_free(t,e*4,4),n},r.wbg.__wbindgen_cast_f20a506f31063fd0=function(t,e){var n=H(t,e).slice();return i.__wbindgen_free(t,e*4,4),n},r.wbg.__wbindgen_cast_f22164ae3d0f310b=function(t,e){return Yt(t,e,i.wasm_bindgen__closure__destroy__he7b712e0eb1b5ac1,Ke)},r.wbg.__wbindgen_init_externref_table=function(){const t=i.__wbindgen_externrefs,e=t.grow(4);t.set(0,void 0),t.set(e+0,void 0),t.set(e+1,null),t.set(e+2,!0),t.set(e+3,!1)},r}function sn(r,t){return i=r.exports,Ct.__wbindgen_wasm_module=t,st=null,xt=null,i.__wbindgen_start(),i}async function Ct(r){if(i!==void 0)return i;typeof r<"u"&&(Object.getPrototypeOf(r)===Object.prototype?{module_or_path:r}=r:console.warn("using deprecated parameters for the initialization function; pass a single object instead")),typeof r>"u"&&(r=new URL(""+new URL("bindings_wasm_bg-B-5N5IsC.wasm",import.meta.url).href,import.meta.url));const t=rn();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:e,module:n}=await nn(await r,t);return sn(e,n)}const ae=r=>`${r.authorityId}/${r.typeId}:${r.versionMajor}.${r.versionMinor}`;var Et;class on{constructor(t){l(this,Et);g(this,Et,new Map(t.map((e=>[ae(e.contentType),e]))))}getCodec(t){return o(this,Et).get(ae(t))}}Et=new WeakMap;function ce(r){return new Date(Number(r/BigInt(1000000)))}const Ie=r=>{switch(r.type){case"text":case"markdown":case"reply":case"reaction":case"attachment":case"remoteAttachment":case"multiRemoteAttachment":case"transactionReference":case"groupUpdated":case"readReceipt":case"leaveRequest":case"walletSendCalls":case"intent":case"actions":case"custom":return r.content;default:return null}};class tt{constructor(t,e){S(this,"content");S(this,"contentType");S(this,"conversationId");S(this,"deliveryStatus");S(this,"expiresAtNs");S(this,"expiresAt");S(this,"fallback");S(this,"id");S(this,"kind");S(this,"numReplies");S(this,"reactions");S(this,"senderInboxId");S(this,"sentAt");S(this,"sentAtNs");var n,s;switch(this.id=e.id,this.expiresAtNs=e.expiresAtNs,this.expiresAt=e.expiresAtNs?ce(e.expiresAtNs):void 0,this.sentAtNs=e.sentAtNs,this.sentAt=ce(e.sentAtNs),this.conversationId=e.conversationId,this.senderInboxId=e.senderInboxId,this.contentType=e.contentType,this.fallback=(n=e.fallback)!=null?n:void 0,this.kind=e.kind,this.deliveryStatus=e.deliveryStatus,this.numReplies=e.numReplies,this.reactions=e.reactions.map((a=>new tt(t,a))),this.content=(s=Ie(e.content))!=null?s:void 0,e.content.type){case"reply":{const a=e.content.content;let c=Ie(a.content);if(a.content.type==="custom"){const _=t.getCodec(a.content.content.type);if(_)try{c=_.decode(c)}catch(b){b instanceof Error?console.warn(`Error decoding custom content: ${b.message}`):console.warn("Error decoding custom content")}}this.content={referenceId:a.referenceId,content:c,inReplyTo:a.inReplyTo?new tt(t,a.inReplyTo):null};break}case"custom":{const a=e.content.content,c=t.getCodec(this.contentType);if(c)try{this.content=c.decode(a)}catch(_){_ instanceof Error?console.warn(`Error decoding custom content: ${_.message}`):console.warn("Error decoding custom content"),this.content=void 0}else console.warn(`No codec found for content type "${ae(this.contentType)}"`),this.content=void 0;break}}}}var Y,Q;class an{constructor(){S(this,"isDone",!1);l(this,Y,[]);l(this,Q);S(this,"onDone");S(this,"onReturn");S(this,"push",t=>{if(this.isDone)return;const e=o(this,Y).shift();e?e({done:!1,value:t}):o(this,Q).push(t)});S(this,"next",()=>this.isDone?Promise.resolve({done:!0,value:void 0}):o(this,Q).length>0?Promise.resolve({done:!1,value:o(this,Q).shift()}):new Promise((t=>{o(this,Y).push(t)})));S(this,"return",()=>{var t;return(t=this.onReturn)==null||t.call(this),this.done(),Promise.resolve({done:!0,value:void 0})});S(this,"end",()=>this.return());g(this,Q,[]),this.isDone=!1}flush(){for(;o(this,Y).length>0;){const t=o(this,Y).shift();t&&t({done:!0,value:void 0})}}done(){var t;this.flush(),g(this,Q,[]),g(this,Y,[]),this.isDone=!0,(t=this.onDone)==null||t.call(this)}[Symbol.asyncIterator](){return this}}Y=new WeakMap,Q=new WeakMap;const De=["end","isDone","next","return",Symbol.asyncIterator],ie=r=>De.includes(r);class _t extends Error{constructor(){super("Signer unavailable, use Client.create to create a client with a signer")}}class Se extends Error{constructor(){super("Unable to create add account signature text, `allowInboxReassign` must be true")}}class cn extends Error{constructor(t){super(`Account already associated with inbox ${t}`)}}class xe extends Error{constructor(t){super(`Stream failed, retried ${t} ${"time"+(t!==1?"s":"")}`)}}class _n extends Error{constructor(){super("Stream retry attempts must be greater than 0")}}const un=1e4,dn=6,dt=async(r,t,e)=>{const{onEnd:n,onError:s,onFail:a,onRestart:c,onRetry:_,onValue:b,retryAttempts:k=dn,retryDelay:B=un,retryOnFail:L=!0}=e!=null?e:{};if(L&&k<0)throw new _n;const x=new an,P=(C,O)=>{if(C)s==null||s(C);else if(O!==void 0)try{if(t){const N=t(O);(U=>!!U&&(typeof U=="object"||typeof U=="function")&&"then"in U&&typeof U.then=="function")(N)?N.then((U=>{x.push(U),b==null||b(U)})).catch((U=>{s==null||s(U)})):(x.push(N),b==null||b(N))}else x.push(O),b==null||b(O)}catch(N){s==null||s(N)}},$=async(C=k)=>{try{if(C===0)throw x.end(),new xe(k);await(O=B,new Promise((U=>setTimeout(U,O)))),_==null||_(k-C+1,k);const N=await r(P,(()=>{a==null||a(),$()}));x.onDone=()=>{N(),n==null||n()},c==null||c()}catch(N){s==null||s(N),$(C-1)}var O},ct=()=>{if(!L)throw x.end(),new xe(0);$()};try{const C=await r(P,(()=>{a==null||a(),ct()}));x.onDone=()=>{C(),n==null||n()}}catch(C){s==null||s(C),ct()}return new Proxy(x,{get(C,O,N){if(ie(O))return Reflect.get(C,O,N)},set:()=>!0,has:(C,O)=>ie(O),ownKeys:()=>De,getOwnPropertyDescriptor(C,O){if(ie(O))return{enumerable:!0,configurable:!0,value:Reflect.get(C,O)}}})},W=()=>{const r=new Uint8Array(16);return crypto.getRandomValues(r),Array.from(r,(t=>t.toString(16).padStart(2,"0"))).join("")};var qt,it,ot,y,Bt,v,Pt,_e;class ke{constructor(t,e,n,s){l(this,Pt);l(this,qt);l(this,it);l(this,ot);l(this,y);l(this,Bt);l(this,v);g(this,v,t),g(this,it,e),g(this,y,n),St(this,Pt,_e).call(this,s)}get id(){return o(this,y)}get addedByInboxId(){return o(this,qt)}get createdAtNs(){return o(this,ot)}get createdAt(){return o(this,ot)?ce(o(this,ot)):void 0}get metadata(){return o(this,Bt)}async lastMessage(){const t=await o(this,v).action("conversation.lastMessage",{id:o(this,y)});return t?new tt(o(this,it),t):void 0}async isActive(){return o(this,v).action("conversation.isActive",{id:o(this,y)})}async members(){return o(this,v).action("conversation.members",{id:o(this,y)})}async sync(){const t=await o(this,v).action("conversation.sync",{id:o(this,y)});return St(this,Pt,_e).call(this,t),t}async publishMessages(){return o(this,v).action("conversation.publishMessages",{id:o(this,y)})}async send(t,e){return o(this,v).action("conversation.send",{id:o(this,y),content:t,options:e})}async sendText(t,e){return o(this,v).action("conversation.sendText",{id:o(this,y),text:t,isOptimistic:e})}async sendMarkdown(t,e){return o(this,v).action("conversation.sendMarkdown",{id:o(this,y),markdown:t,isOptimistic:e})}async sendReaction(t,e){return o(this,v).action("conversation.sendReaction",{id:o(this,y),reaction:t,isOptimistic:e})}async sendReadReceipt(t){return o(this,v).action("conversation.sendReadReceipt",{id:o(this,y),isOptimistic:t})}async sendReply(t,e){return o(this,v).action("conversation.sendReply",{id:o(this,y),reply:t,isOptimistic:e})}async sendTransactionReference(t,e){return o(this,v).action("conversation.sendTransactionReference",{id:o(this,y),transactionReference:t,isOptimistic:e})}async sendWalletSendCalls(t,e){return o(this,v).action("conversation.sendWalletSendCalls",{id:o(this,y),walletSendCalls:t,isOptimistic:e})}async sendActions(t,e){return o(this,v).action("conversation.sendActions",{id:o(this,y),actions:t,isOptimistic:e})}async sendIntent(t,e){return o(this,v).action("conversation.sendIntent",{id:o(this,y),intent:t,isOptimistic:e})}async sendAttachment(t,e){return o(this,v).action("conversation.sendAttachment",{id:o(this,y),attachment:t,isOptimistic:e})}async sendMultiRemoteAttachment(t,e){return o(this,v).action("conversation.sendMultiRemoteAttachment",{id:o(this,y),multiRemoteAttachment:t,isOptimistic:e})}async sendRemoteAttachment(t,e){return o(this,v).action("conversation.sendRemoteAttachment",{id:o(this,y),remoteAttachment:t,isOptimistic:e})}async messages(t){return(await o(this,v).action("conversation.messages",{id:o(this,y),options:t})).map((e=>new tt(o(this,it),e)))}async countMessages(t){return await o(this,v).action("conversation.countMessages",{id:o(this,y),options:t})}async consentState(){return o(this,v).action("conversation.consentState",{id:o(this,y)})}async updateConsentState(t){return o(this,v).action("conversation.updateConsentState",{id:o(this,y),state:t})}async messageDisappearingSettings(){return o(this,v).action("conversation.messageDisappearingSettings",{id:o(this,y)})}async updateMessageDisappearingSettings(t,e){return o(this,v).action("conversation.updateMessageDisappearingSettings",{id:o(this,y),fromNs:t,inNs:e})}async removeMessageDisappearingSettings(){return o(this,v).action("conversation.removeMessageDisappearingSettings",{id:o(this,y)})}async isMessageDisappearingEnabled(){return o(this,v).action("conversation.isMessageDisappearingEnabled",{id:o(this,y)})}async stream(t){return dt((async(e,n)=>{const s=W();return t!=null&&t.disableSync||await this.sync(),await o(this,v).action("conversation.stream",{groupId:o(this,y),streamId:s}),o(this,v).handleStreamMessage(s,e,{...t,onFail:n})}),(e=>new tt(o(this,it),e)),t)}async pausedForVersion(){return o(this,v).action("conversation.pausedForVersion",{id:o(this,y)})}async hmacKeys(){return o(this,v).action("conversation.hmacKeys",{id:o(this,y)})}async debugInfo(){return o(this,v).action("conversation.debugInfo",{id:o(this,y)})}async lastReadTimes(){return o(this,v).action("conversation.lastReadTimes",{id:o(this,y)})}}qt=new WeakMap,it=new WeakMap,ot=new WeakMap,y=new WeakMap,Bt=new WeakMap,v=new WeakMap,Pt=new WeakSet,_e=function(t){g(this,qt,t==null?void 0:t.addedByInboxId),g(this,Bt,t==null?void 0:t.metadata),g(this,ot,t==null?void 0:t.createdAtNs)};var Wt,at,gt;const ge=class ge extends ke{constructor(e,n,s,a){super(e,n,s,a);l(this,Wt);l(this,at);l(this,gt);g(this,at,e),g(this,Wt,n),g(this,gt,s)}async peerInboxId(){return o(this,at).action("dm.peerInboxId",{id:o(this,gt)})}async duplicateDms(){return(await o(this,at).action("dm.duplicateDms",{id:o(this,gt)})).map((e=>new ge(o(this,at),o(this,Wt),e.id,e)))}};Wt=new WeakMap,at=new WeakMap,gt=new WeakMap;let X=ge;var bt,lt,A,ft,R,wt,ht,pt,Lt,ue;class rt extends ke{constructor(e,n,s,a){super(e,n,s,a);l(this,Lt);l(this,bt,[]);l(this,lt);l(this,A);l(this,ft);l(this,R);l(this,wt);l(this,ht);l(this,pt,[]);g(this,A,e),g(this,R,s),St(this,Lt,ue).call(this,a)}async sync(){const e=await super.sync();return St(this,Lt,ue).call(this,e),e}get name(){return o(this,ht)}async updateName(e){await o(this,A).action("group.updateName",{id:o(this,R),name:e}),g(this,ht,e)}get imageUrl(){return o(this,wt)}async updateImageUrl(e){await o(this,A).action("group.updateImageUrl",{id:o(this,R),imageUrl:e}),g(this,wt,e)}get description(){return o(this,ft)}async updateDescription(e){await o(this,A).action("group.updateDescription",{id:o(this,R),description:e}),g(this,ft,e)}get appData(){return o(this,lt)}async updateAppData(e){await o(this,A).action("group.updateAppData",{id:o(this,R),appData:e}),g(this,lt,e)}get admins(){return o(this,bt)}get superAdmins(){return o(this,pt)}async listAdmins(){const e=await o(this,A).action("group.listAdmins",{id:o(this,R)});return g(this,bt,e),e}async listSuperAdmins(){const e=await o(this,A).action("group.listSuperAdmins",{id:o(this,R)});return g(this,pt,e),e}async permissions(){return o(this,A).action("group.permissions",{id:o(this,R)})}async updatePermission(e,n,s){return o(this,A).action("group.updatePermission",{id:o(this,R),permissionType:e,policy:n,metadataField:s})}async isAdmin(e){return(await this.listAdmins()).includes(e)}async isSuperAdmin(e){return(await this.listSuperAdmins()).includes(e)}async addMembersByIdentifiers(e){return o(this,A).action("group.addMembersByIdentifiers",{id:o(this,R),identifiers:e})}async addMembers(e){return o(this,A).action("group.addMembers",{id:o(this,R),inboxIds:e})}async removeMembersByIdentifiers(e){return o(this,A).action("group.removeMembersByIdentifiers",{id:o(this,R),identifiers:e})}async removeMembers(e){return o(this,A).action("group.removeMembers",{id:o(this,R),inboxIds:e})}async addAdmin(e){return o(this,A).action("group.addAdmin",{id:o(this,R),inboxId:e})}async removeAdmin(e){return o(this,A).action("group.removeAdmin",{id:o(this,R),inboxId:e})}async addSuperAdmin(e){return o(this,A).action("group.addSuperAdmin",{id:o(this,R),inboxId:e})}async removeSuperAdmin(e){return o(this,A).action("group.removeSuperAdmin",{id:o(this,R),inboxId:e})}async requestRemoval(){return o(this,A).action("group.requestRemoval",{id:o(this,R)})}async isPendingRemoval(){return o(this,A).action("group.isPendingRemoval",{id:o(this,R)})}}bt=new WeakMap,lt=new WeakMap,A=new WeakMap,ft=new WeakMap,R=new WeakMap,wt=new WeakMap,ht=new WeakMap,pt=new WeakMap,Lt=new WeakSet,ue=function(e){var n,s,a,c,_,b;g(this,ht,(n=e==null?void 0:e.name)!=null?n:""),g(this,wt,(s=e==null?void 0:e.imageUrl)!=null?s:""),g(this,ft,(a=e==null?void 0:e.description)!=null?a:""),g(this,lt,(c=e==null?void 0:e.appData)!=null?c:""),g(this,bt,(_=e==null?void 0:e.admins)!=null?_:[]),g(this,pt,(b=e==null?void 0:e.superAdmins)!=null?b:[])};var D,h;class gn{constructor(t,e){l(this,D);l(this,h);g(this,h,t),g(this,D,e)}async sync(){return o(this,h).action("conversations.sync")}async syncAll(t){return o(this,h).action("conversations.syncAll",{consentStates:t})}async getConversationById(t){const e=await o(this,h).action("conversations.getConversationById",{id:t});if(e)switch(e.metadata.conversationType){case G.Group:return new rt(o(this,h),o(this,D),e.id,e);case G.Dm:return new X(o(this,h),o(this,D),e.id,e);default:return}}async getMessageById(t){const e=await o(this,h).action("conversations.getMessageById",{id:t});return e?new tt(o(this,D),e):void 0}async getDmByInboxId(t){const e=await o(this,h).action("conversations.getDmByInboxId",{inboxId:t});return e?new X(o(this,h),o(this,D),e.id,e):void 0}async fetchDmByIdentifier(t){const e=await o(this,h).action("client.getInboxIdByIdentifier",{identifier:t});if(e)return this.getDmByInboxId(e)}async list(t){return(await o(this,h).action("conversations.list",{options:t})).map((e=>{switch(e.metadata.conversationType){case G.Dm:return new X(o(this,h),o(this,D),e.id,e);case G.Group:return new rt(o(this,h),o(this,D),e.id,e);default:return}})).filter((e=>e!==void 0))}async listGroups(t){return(await o(this,h).action("conversations.listGroups",{options:t})).map((e=>new rt(o(this,h),o(this,D),e.id,e)))}async listDms(t){return(await o(this,h).action("conversations.listDms",{options:t})).map((e=>new X(o(this,h),o(this,D),e.id,e)))}async createGroupOptimistic(t){const e=await o(this,h).action("conversations.createGroupOptimistic",{options:t});return new rt(o(this,h),o(this,D),e.id,e)}async createGroupWithIdentifiers(t,e){const n=await o(this,h).action("conversations.createGroupWithIdentifiers",{identifiers:t,options:e});return new rt(o(this,h),o(this,D),n.id,n)}async createGroup(t,e){const n=await o(this,h).action("conversations.createGroup",{inboxIds:t,options:e});return new rt(o(this,h),o(this,D),n.id,n)}async createDmWithIdentifier(t,e){const n=await o(this,h).action("conversations.createDmWithIdentifier",{identifier:t,options:e});return new X(o(this,h),o(this,D),n.id,n)}async createDm(t,e){const n=await o(this,h).action("conversations.createDm",{inboxId:t,options:e});return new X(o(this,h),o(this,D),n.id,n)}async hmacKeys(){return o(this,h).action("conversations.hmacKeys")}async stream(t){return dt((async(e,n)=>{const s=W();return t!=null&&t.disableSync||await this.sync(),await o(this,h).action("conversations.stream",{streamId:s,conversationType:t==null?void 0:t.conversationType}),o(this,h).handleStreamMessage(s,e,{...t,onFail:n})}),(e=>{switch(e.metadata.conversationType){case G.Group:return new rt(o(this,h),o(this,D),e.id,e);case G.Dm:return new X(o(this,h),o(this,D),e.id,e);default:throw new Error(`Unknown conversation type: ${e.metadata.conversationType}`)}}),t)}async streamGroups(t){return this.stream({...t,conversationType:G.Group})}async streamDms(t){return this.stream({...t,conversationType:G.Dm})}async streamAllMessages(t){return dt((async(e,n)=>{const s=W();return t!=null&&t.disableSync||await this.sync(),await o(this,h).action("conversations.streamAllMessages",{streamId:s,conversationType:t==null?void 0:t.conversationType,consentStates:t==null?void 0:t.consentStates}),o(this,h).handleStreamMessage(s,e,{...t,onFail:n})}),(e=>new tt(o(this,D),e)),t)}async streamAllGroupMessages(t){return this.streamAllMessages({...t,conversationType:G.Group})}async streamAllDmMessages(t){return this.streamAllMessages({...t,conversationType:G.Dm})}async streamMessageDeletions(t){return dt((async e=>{const n=W();return await o(this,h).action("conversations.streamMessageDeletions",{streamId:n}),o(this,h).handleStreamMessage(n,e,t)}),void 0,t)}}D=new WeakMap,h=new WeakMap;var Z;class bn{constructor(t){l(this,Z);g(this,Z,t)}apiStatistics(){return o(this,Z).action("debugInformation.apiStatistics")}apiIdentityStatistics(){return o(this,Z).action("debugInformation.apiIdentityStatistics")}apiAggregateStatistics(){return o(this,Z).action("debugInformation.apiAggregateStatistics")}clearAllStatistics(){return o(this,Z).action("debugInformation.clearAllStatistics")}}Z=new WeakMap;var E;class ln{constructor(t){l(this,E);g(this,E,t)}sync(){return o(this,E).action("preferences.sync")}async inboxState(){return o(this,E).action("preferences.inboxState",{refreshFromNetwork:!1})}async fetchInboxState(){return o(this,E).action("preferences.inboxState",{refreshFromNetwork:!0})}async getInboxStates(t){return o(this,E).action("preferences.getInboxStates",{inboxIds:t,refreshFromNetwork:!1})}async fetchInboxStates(t){return o(this,E).action("preferences.getInboxStates",{inboxIds:t,refreshFromNetwork:!0})}async setConsentStates(t){return o(this,E).action("preferences.setConsentStates",{records:t})}async getConsentState(t,e){return o(this,E).action("preferences.getConsentState",{entityType:t,entity:e})}async streamConsent(t){return dt((async(e,n)=>{const s=W();return t!=null&&t.disableSync||await this.sync(),await o(this,E).action("preferences.streamConsent",{streamId:s}),o(this,E).handleStreamMessage(s,e,{...t,onFail:n})}),void 0,t)}async streamPreferences(t){return dt((async(e,n)=>{const s=W();return t!=null&&t.disableSync||await this.sync(),await o(this,E).action("preferences.streamPreferences",{streamId:s}),o(this,E).handleStreamMessage(s,e,{...t,onFail:n})}),void 0,t)}}E=new WeakMap;const Ot={local:"http://localhost:5557",dev:"https://api.dev.xmtp.network:5558",production:"https://api.production.xmtp.network:5558"},fn=async(r,t,e)=>{await Ct();const n=t?Ot[t]:Ot.dev,s=n.startsWith("https");return Ue(n,null,s,r)},wn=async(r,t,e,n,s)=>{var B;await Ct();const a=await r.getIdentifier(),{signatureText:c,signatureRequest:_}=await(async(L,x,P,$,ct)=>{await Ct();const C=je(Ot[$!=null?$:"dev"],ct!=null?ct:null,L,x,P);return{signatureText:await C.signatureText(),signatureRequest:C}})(a,t,e,n,s),b=await r.signMessage(c),k=Ot[n!=null?n:"dev"];switch(r.type){case"EOA":await _.addEcdsaSignature(b);break;case"SCW":await _.addScwSignature(a,b,r.getChainId(),(B=r.getBlockNumber)==null?void 0:B.call(r))}await ze(k,s!=null?s:null,_)},ut=async(r,t)=>{var e;switch(r.type){case"EOA":return{type:"EOA",identifier:await r.getIdentifier(),signature:t};case"SCW":return{type:"SCW",identifier:await r.getIdentifier(),signature:t,chainId:r.getChainId(),blockNumber:(e=r.getBlockNumber)==null?void 0:e.call(r)}}},Ae=r=>{console.error(`[worker] error: ${r.message}`)};var j,Nt,mt;class hn{constructor(t,e){l(this,j);l(this,Nt);l(this,mt,new Map);S(this,"handleMessage",t=>{const e=t.data;o(this,Nt)&&console.log("[worker] client received event data",e);const n=o(this,mt).get(e.id);n&&(o(this,mt).delete(e.id),"error"in e?n.reject(e.error):n.resolve(e.result))});S(this,"handleStreamMessage",(t,e,n)=>{const s=a=>{var _;const c=a.data;if(c.streamId===t){if(c.action==="stream.fail")return void((_=n==null?void 0:n.onFail)==null?void 0:_.call(n));"error"in c?e(c.error,void 0):e(null,c.result)}};return o(this,j).addEventListener("message",s),async()=>{await this.action("endStream",{streamId:t}),o(this,j).removeEventListener("message",s)}});g(this,j,t),o(this,j).addEventListener("message",this.handleMessage),o(this,j).addEventListener("error",Ae),g(this,Nt,e!=null?e:!1)}action(t,...e){const n=W();return o(this,j).postMessage({action:t,id:n,data:e[0]}),new Promise(((s,a)=>{o(this,mt).set(n,{resolve:s,reject:a})}))}close(){o(this,j).removeEventListener("message",this.handleMessage),o(this,j).removeEventListener("error",Ae),o(this,j).terminate()}}j=new WeakMap,Nt=new WeakMap,mt=new WeakMap;var Ut,jt,zt,Gt,Vt,Kt,$t,Ht,yt,Xt,vt,Jt,F,I;const ee=class ee{constructor(t){l(this,Ut);l(this,jt);l(this,zt);l(this,Gt);l(this,Vt);l(this,Kt);l(this,$t);l(this,Ht);l(this,yt,!1);l(this,Xt);l(this,vt);l(this,Jt);l(this,F);l(this,I);var s;const e=new Worker(new URL(""+new URL("client-C_kpJbyV.js",import.meta.url).href,import.meta.url),{type:"module"}),n=(t==null?void 0:t.loggingLevel)!==void 0&&t.loggingLevel!==Xe.Off;g(this,I,new hn(e,n)),g(this,vt,t),g(this,jt,new on([...(s=t==null?void 0:t.codecs)!=null?s:[]])),g(this,zt,new gn(o(this,I),o(this,jt))),g(this,Gt,new bn(o(this,I))),g(this,Jt,new ln(o(this,I)))}async init(t){const e=await o(this,I).action("client.init",{identifier:t,options:o(this,vt)});g(this,Ut,e.appVersion),g(this,Vt,t),g(this,Kt,e.inboxId),g(this,$t,e.installationId),g(this,Ht,e.installationIdBytes),g(this,Xt,e.libxmtpVersion),g(this,yt,!0)}close(){o(this,I).close(),g(this,yt,!1)}static async create(t,e){const n=new ee(e);return g(n,F,t),await n.init(await t.getIdentifier()),e!=null&&e.disableAutoRegister||await n.register(),n}static async build(t,e){const n=new ee({...e,disableAutoRegister:!0});return await n.init(t),n}get options(){return o(this,vt)}get signer(){return o(this,F)}get isReady(){return o(this,yt)}get inboxId(){return o(this,Kt)}get accountIdentifier(){return o(this,Vt)}get installationId(){return o(this,$t)}get installationIdBytes(){return o(this,Ht)}get conversations(){return o(this,zt)}get debugInformation(){return o(this,Gt)}get preferences(){return o(this,Jt)}get libxmtpVersion(){return o(this,Xt)}get appVersion(){return o(this,Ut)}async unsafe_createInboxSignatureText(){return o(this,I).action("client.createInboxSignatureText",{signatureRequestId:W()})}async unsafe_addAccountSignatureText(t,e=!1){if(!e)throw new Se;return o(this,I).action("client.addAccountSignatureText",{newIdentifier:t,signatureRequestId:W()})}async unsafe_removeAccountSignatureText(t){return o(this,I).action("client.removeAccountSignatureText",{identifier:t,signatureRequestId:W()})}async unsafe_revokeAllOtherInstallationsSignatureText(){return o(this,I).action("client.revokeAllOtherInstallationsSignatureText",{signatureRequestId:W()})}async unsafe_revokeInstallationsSignatureText(t){return o(this,I).action("client.revokeInstallationsSignatureText",{installationIds:t,signatureRequestId:W()})}async unsafe_changeRecoveryIdentifierSignatureText(t){return o(this,I).action("client.changeRecoveryIdentifierSignatureText",{identifier:t,signatureRequestId:W()})}async unsafe_applySignatureRequest(t,e){return o(this,I).action("client.applySignatureRequest",{signer:t,signatureRequestId:e})}async register(){if(!o(this,F))throw new _t;const{signatureText:t,signatureRequestId:e}=await this.unsafe_createInboxSignatureText();if(!t||!e)return;const n=await o(this,F).signMessage(t),s=await ut(o(this,F),n);return o(this,I).action("client.registerIdentity",{signer:s,signatureRequestId:e})}async unsafe_addAccount(t,e=!1){if(!o(this,F))throw new _t;if(!e)throw new Se;const n=await this.fetchInboxIdByIdentifier(await t.getIdentifier());if(n)throw new cn(n);const{signatureText:s,signatureRequestId:a}=await this.unsafe_addAccountSignatureText(await t.getIdentifier(),!0),c=await t.signMessage(s),_=await ut(t,c);return o(this,I).action("client.addAccount",{identifier:_.identifier,signer:_,signatureRequestId:a})}async removeAccount(t){if(!o(this,F))throw new _t;const{signatureText:e,signatureRequestId:n}=await this.unsafe_removeAccountSignatureText(t),s=await o(this,F).signMessage(e),a=await ut(o(this,F),s);return o(this,I).action("client.removeAccount",{identifier:t,signer:a,signatureRequestId:n})}async revokeAllOtherInstallations(){if(!o(this,F))throw new _t;const{signatureText:t,signatureRequestId:e}=await this.unsafe_revokeAllOtherInstallationsSignatureText();if(!t)return;const n=await o(this,F).signMessage(t),s=await ut(o(this,F),n);return o(this,I).action("client.revokeAllOtherInstallations",{signer:s,signatureRequestId:e})}async revokeInstallations(t){if(!o(this,F))throw new _t;const{signatureText:e,signatureRequestId:n}=await this.unsafe_revokeInstallationsSignatureText(t),s=await o(this,F).signMessage(e),a=await ut(o(this,F),s);return o(this,I).action("client.revokeInstallations",{installationIds:t,signer:a,signatureRequestId:n})}static async revokeInstallations(t,e,n,s,a){await wn(t,e,n,s,a)}static async fetchInboxStates(t,e,n){return(async(s,a,c)=>(await Ct(),Ne(Ot[a!=null?a:"dev"],c!=null?c:null,s)))(t,e,n)}async changeRecoveryIdentifier(t){if(!o(this,F))throw new _t;const{signatureText:e,signatureRequestId:n}=await this.unsafe_changeRecoveryIdentifierSignatureText(t),s=await o(this,F).signMessage(e),a=await ut(o(this,F),s);return o(this,I).action("client.changeRecoveryIdentifier",{identifier:t,signer:a,signatureRequestId:n})}async isRegistered(){return o(this,I).action("client.isRegistered")}async canMessage(t){return o(this,I).action("client.canMessage",{identifiers:t})}static async canMessage(t,e){const n=new Map;for(const s of t){const a=await fn(s,e);n.set(s.identifier.toLowerCase(),a!==void 0)}return n}async fetchInboxIdByIdentifier(t){return o(this,I).action("client.getInboxIdByIdentifier",{identifier:t})}signWithInstallationKey(t){return o(this,I).action("client.signWithInstallationKey",{signatureText:t})}verifySignedWithInstallationKey(t,e){return o(this,I).action("client.verifySignedWithInstallationKey",{signatureText:t,signatureBytes:e})}verifySignedWithPublicKey(t,e,n){return o(this,I).action("client.verifySignedWithPublicKey",{signatureText:t,signatureBytes:e,publicKey:n})}async fetchKeyPackageStatuses(t){return o(this,I).action("client.fetchKeyPackageStatuses",{installationIds:t})}async sendSyncRequest(){return o(this,I).action("client.sendSyncRequest")}};Ut=new WeakMap,jt=new WeakMap,zt=new WeakMap,Gt=new WeakMap,Vt=new WeakMap,Kt=new WeakMap,$t=new WeakMap,Ht=new WeakMap,yt=new WeakMap,Xt=new WeakMap,vt=new WeakMap,Jt=new WeakMap,F=new WeakMap,I=new WeakMap;let et=ee;const de="production",Re=2e4,te=3e4;function Ce(r){const t=r.startsWith("0x")?r.slice(2):r,e=new Uint8Array(t.length/2);for(let n=0;n<e.length;n++)e[n]=parseInt(t.slice(n*2,n*2+2),16);return e}function pn(){var r;return typeof window>"u"||typeof navigator>"u"||!window.isSecureContext?!1:typeof((r=navigator.storage)==null?void 0:r.getDirectory)=="function"}function It(r,t,e){if(!t||t<=0)return r;let n;const s=new Promise((a,c)=>{n=setTimeout(()=>{c(new Error(`[XMTP] ${e} timed out after ${t}ms`))},t)});return Promise.race([r,s]).finally(()=>{n&&clearTimeout(n)})}function Oe(r){return r instanceof Error?r.message:String(r)}function mn(r){const t=Oe(r);return/10\/10\s+installations/i.test(t)}function yn(r){var e,n,s;const t=(e=r.match(/InboxID\s+([a-f0-9]{64})/i))!=null?e:r.match(/inbox(?:\s*id)?[:\s]+([a-f0-9]{64})/i);return(s=(n=t==null?void 0:t[1])==null?void 0:n.toLowerCase())!=null?s:null}function Ee(r){return!r||typeof r!="object"?null:r}function vn(r){const t=r.startsWith("0x")?r.slice(2):r;return t.length===0||t.length%2!==0||!/^[0-9a-f]+$/i.test(t)?null:Ce(t)}function Qt(r){return r instanceof Uint8Array?r:Array.isArray(r)&&r.every(t=>Number.isInteger(t)&&t>=0&&t<=255)?new Uint8Array(r):typeof r=="string"?vn(r):null}function In(r){var e,n;const t=[];for(const s of r){const a=Qt(s);if(a){t.push(a);continue}const c=Ee(s);if(!c)continue;const _=(n=(e=Qt(c.bytes))!=null?e:Qt(c.id))!=null?n:Qt(c.installationId);_&&t.push(_)}return t}async function Sn(r){const t=et.fetchInboxStates.bind(et);try{return await It(t([r],de),te,"Client.fetchInboxStates")}catch{return It(t([r]),te,"Client.fetchInboxStates (no env)")}}async function xn(r,t,e){const n=et.revokeInstallations.bind(et);try{await It(n(r,t,e,de),te,"Client.revokeInstallations")}catch{await It(n(r,t,e),te,"Client.revokeInstallations (no env)")}}function An(r,t){return{type:"EOA",getIdentifier:()=>({identifier:r,identifierKind:Te.Ethereum}),signMessage:async e=>{const n=await t(e);return Ce(n)}}}function qe(r){var s;const t=r.kind;if(!(t===Me.Application||t==="application"))return null;const n=(s=r.contentType)==null?void 0:s.typeId;return n!=="text"&&n!=="markdown"?null:typeof r.content=="string"?r.content:typeof r.fallback=="string"&&r.fallback.length>0?r.fallback:null}function Fe(r,t){const e=qe(r);return e?{id:r.id,conversationId:t,senderAddress:r.senderInboxId,content:e,sentAtNs:String(r.sentAtNs),kind:"application"}:null}class Fn{constructor(){this.client=null,this.clientPromise=null,this.currentAddress=null,this.conversationCache=new Map,this.activeStreams=new Map}async init(t,e){if(!(this.client&&this.currentAddress===t.toLowerCase())){if(this.client&&this.currentAddress!==t.toLowerCase()&&this.disconnect(),this.clientPromise){await this.clientPromise;return}this.clientPromise=(async()=>{const n=An(t,e),s=pn(),a={env:de,dbPath:s?void 0:null,disableDeviceSync:s?void 0:!0};let c;try{c=await It(et.create(n,a),Re,"Client.create")}catch(_){if(mn(_)){const b=Oe(_),k=yn(b);if(!k)throw console.error("[XMTP/Browser] Installation limit reached but inboxId was not found in error:",b),_;console.warn(`[XMTP/Browser] Installation limit reached for inbox ${k}, revoking old installations...`);try{const B=await Sn(k),L=Ee(B[0]),x=Array.isArray(L==null?void 0:L.installations)?L.installations:[],P=In(x);if(P.length===0)throw new Error("Inbox state did not include any revocable installations");await xn(n,k,P),console.warn(`[XMTP/Browser] Revoked ${P.length} installations, retrying client creation`)}catch(B){throw console.error("[XMTP/Browser] Failed to revoke installations for auto-recovery:",B),_}c=await It(et.create(n,a),Re,"Client.create (retry)")}else throw _}return this.client=c,this.currentAddress=t.toLowerCase(),c})();try{await this.clientPromise}catch(n){throw console.error("[XMTP/Browser] Failed to initialize:",n),n}finally{this.clientPromise=null}}}disconnect(){this.activeStreams.forEach(t=>t()),this.activeStreams.clear(),this.conversationCache.clear(),this.client=null,this.clientPromise=null,this.currentAddress=null}isConnected(){return this.client!==null}getInboxId(){var t,e;return(e=(t=this.client)==null?void 0:t.inboxId)!=null?e:null}async listConversations(){var s;if(!this.client)throw new Error("Not connected");const t=[nt.Allowed,nt.Unknown];await this.client.conversations.syncAll(t);const e=await this.client.conversations.listDms({consentStates:t}),n=[];for(const a of e){this.conversationCache.set(a.id,a);const c=await a.members(),_=this.client.inboxId,b=c.find($=>$.inboxId!==_),k=(s=b==null?void 0:b.accountAddresses)==null?void 0:s[0],B=k||a.id;console.log("[BrowserTransport] listConversations dm:",a.id,"peer:",b==null?void 0:b.inboxId,"rawAddr:",k,"peerAddress:",B),this.conversationCache.set(B.toLowerCase(),a);const x=(await a.messages({limit:BigInt(1),direction:fe.Descending}))[0],P=x?qe(x):void 0;n.push({id:a.id,peerAddress:B,lastMessage:P||void 0,lastMessageAt:x?x.sentAt.getTime():void 0,lastMessageSender:x==null?void 0:x.senderInboxId})}return n}async getOrCreateConversation(t){if(!this.client)throw new Error("Not connected");const e=this.conversationCache.get(t.toLowerCase());if(e)return e.id;const n=await this.client.conversations.createDmWithIdentifier({identifier:t,identifierKind:Te.Ethereum});return await n.consentState()===nt.Unknown&&await n.updateConsentState(nt.Allowed),this.conversationCache.set(n.id,n),this.conversationCache.set(t.toLowerCase(),n),n.id}async sendMessage(t,e){const n=this.conversationCache.get(t);if(!n)throw new Error(`Conversation ${t} not found`);await n.sendText(e)}async loadMessages(t,e){const n=this.conversationCache.get(t);if(!n)throw new Error(`Conversation ${t} not found`);return await n.sync(),(await n.messages({direction:fe.Ascending,kind:Me.Application,limit:e!=null&&e.limit?BigInt(e.limit):void 0,sentAfterNs:e!=null&&e.sentAfterNs?BigInt(e.sentAfterNs):void 0})).map(a=>Fe(a,t)).filter(a=>a!==null)}streamMessages(t,e,n){if(this.activeStreams.has(t))return()=>{};const s=this.conversationCache.get(t);if(!s)return n==null||n(new Error(`Conversation ${t} not found`)),()=>{};let a=!0;return this.activeStreams.set(t,()=>{a=!1}),(async()=>{try{const c=await s.stream();for await(const _ of c){if(!a||_===void 0)break;const b=Fe(_,t);b&&e(b)}}catch(c){a&&c instanceof Error&&(n==null||n(c))}finally{this.activeStreams.delete(t)}})(),()=>{a=!1,this.activeStreams.delete(t)}}streamAllMessages(t,e){return console.warn("[BrowserTransport] streamAllMessages not yet implemented"),()=>{}}async updateConsent(t,e){const n=this.conversationCache.get(t);if(!n)throw new Error(`Conversation ${t} not found`);const s=e==="allowed"?nt.Allowed:e==="denied"?nt.Denied:nt.Unknown;await n.updateConsentState(s)}}export{Fn as BrowserTransport};
