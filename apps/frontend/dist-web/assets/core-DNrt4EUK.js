const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./index-CKx7VMlz.js","./index-GAgutWzb.js","./index-GNdCLOgv.css","./ccip-DZ_JRYUu.js","./index-CN7-A-E-.js","./features-CSPgGe_G.js","./basic-rtThR7jS.js","./index-mYP-c3GO.js","./dijkstra-COg3n3zL.js","./w3m-modal-BPTH6HZr.js"])))=>i.map(i=>d[i]);
import{z as rp,T as op,U as ap,E as cp,A as lp,C as jd,_ as Or,D as tr,F as sr,G as gc}from"./index-GAgutWzb.js";import{I as ii,U as Ma,c as dp,f as Mt,t as yt,a as F,b as Os,C as hp,d as up,e as _i,s as zo,g as ri,h as pp,i as fp,j as gp,r as mp,k as Sn,G as qd,R as Tt,l as yp,m as wp,n as Ot,o as rs,p as oi,q as Ba,u as bp,v as Fa,w as Wa,x as $i,F as ja,P as mc,Q as Ep,y as Cp,z as vp,A as yc,B as fn,D as Hd,E as ms,H as is,J as Ps,K as Kd}from"./index-CN7-A-E-.js";function wc(t,e={}){const{key:s="fallback",name:n="Fallback",rank:i=!1,shouldThrow:r=Ap,retryCount:o,retryDelay:a}=e;return(({chain:c,pollingInterval:l=4e3,timeout:d,...h})=>{var y;let u=t,p=()=>{};const m=rp({key:s,name:n,async request({method:g,params:w}){let b;const A=async(x=0)=>{const H=u[x]({...h,chain:c,retryCount:0,timeout:d});try{const L=await H.request({method:g,params:w});return p({method:g,params:w,response:L,transport:H,status:"success"}),L}catch(L){if(p({error:L,method:g,params:w,transport:H,status:"error"}),r(L)||x===u.length-1||(b!=null||(b=u.slice(x+1).some(J=>{const{include:Y,exclude:T}=J({chain:c}).config.methods||{};return Y?Y.includes(g):T?!T.includes(g):!0})),!b))throw L;return A(x+1)}};return A()},retryCount:o,retryDelay:a,type:"fallback"},{onResponse:g=>p=g,transports:u.map(g=>g({chain:c,retryCount:0}))});if(i){const g=typeof i=="object"?i:{};Ip({chain:c,interval:(y=g.interval)!=null?y:l,onTransports:w=>u=w,ping:g.ping,sampleCount:g.sampleCount,timeout:g.timeout,transports:u,weights:g.weights})}return m})}function Ap(t){return!!("code"in t&&typeof t.code=="number"&&(t.code===op.code||t.code===ap.code||cp.nodeMessage.test(t.message)||t.code===5e3))}function Ip({chain:t,interval:e=4e3,onTransports:s,ping:n,sampleCount:i=10,timeout:r=1e3,transports:o,weights:a={}}){const{stability:c=.7,latency:l=.3}=a,d=[],h=async()=>{const u=await Promise.all(o.map(async y=>{const g=y({chain:t,retryCount:0,timeout:r}),w=Date.now();let b,A;try{await(n?n({transport:g}):g.request({method:"net_listening"})),A=1}catch{A=0}finally{b=Date.now()}return{latency:b-w,success:A}}));d.push(u),d.length>i&&d.shift();const p=Math.max(...d.map(y=>Math.max(...y.map(({latency:g})=>g)))),m=o.map((y,g)=>{const w=d.map(L=>L[g].latency),A=1-w.reduce((L,J)=>L+J,0)/w.length/p,x=d.map(L=>L[g].success),H=x.reduce((L,J)=>L+J,0)/x.length;return H===0?[0,g]:[l*A+c*H,g]}).sort((y,g)=>g[0]-y[0]);s(m.map(([,y])=>o[y])),await lp(e),h()};h()}const Vd={isLowerCaseMatch(t,e){return(t==null?void 0:t.toLowerCase())===(e==null?void 0:e.toLowerCase())}};var bc={};const I={WC_NAME_SUFFIX:".reown.id",WC_NAME_SUFFIX_LEGACY:".wcn.id",BLOCKCHAIN_API_RPC_URL:"https://rpc.walletconnect.org",PULSE_API_URL:"https://pulse.walletconnect.org",W3M_API_URL:"https://api.web3modal.org",CONNECTOR_ID:{WALLET_CONNECT:"walletConnect",INJECTED:"injected",WALLET_STANDARD:"announced",COINBASE:"coinbaseWallet",COINBASE_SDK:"coinbaseWalletSDK",BASE_ACCOUNT:"baseAccount",SAFE:"safe",LEDGER:"ledger",OKX:"okx",EIP6963:"eip6963",AUTH:"AUTH"},CONNECTOR_NAMES:{AUTH:"Auth"},AUTH_CONNECTOR_SUPPORTED_CHAINS:["eip155","solana"],LIMITS:{PENDING_TRANSACTIONS:99},CHAIN:{EVM:"eip155",SOLANA:"solana",POLKADOT:"polkadot",BITCOIN:"bip122",TON:"ton"},CHAIN_NAME_MAP:{eip155:"EVM Networks",solana:"Solana",polkadot:"Polkadot",bip122:"Bitcoin",cosmos:"Cosmos",sui:"Sui",stacks:"Stacks",ton:"TON"},ADAPTER_TYPES:{BITCOIN:"bitcoin",SOLANA:"solana",WAGMI:"wagmi",ETHERS:"ethers",ETHERS5:"ethers5",TON:"ton"},USDT_CONTRACT_ADDRESSES:["0xdac17f958d2ee523a2206206994597c13d831ec7","0xc2132d05d31c914a87c6611c10748aeb04b58e8f","0x9702230a8ea53601f5cd2dc00fdbc13d4df4a8c7","0x919C1c267BC06a7039e03fcc2eF738525769109c","0x48065fbBE25f71C9282ddf5e1cD6D6A887483D5e","0x55d398326f99059fF775485246999027B3197955","0xfd086bc7cd5c481dcc9c85ebe478a1c0b69fcbb9"],SOLANA_SPL_TOKEN_ADDRESSES:{SOL:"So11111111111111111111111111111111111111112"},NATIVE_IMAGE_IDS_BY_NAMESPACE:{eip155:"ba0ba0cd-17c6-4806-ad93-f9d174f17900",solana:"3e8119e5-2a6f-4818-c50c-1937011d5900",bip122:"0b4838db-0161-4ffe-022d-532bf03dba00"},TOKEN_SYMBOLS_BY_ADDRESS:{"0xa0b86991c6218b36c1d19d4a2e9eb0ce3606eb48":"USDC","0x833589fcd6edb6e08f4c7c32d4f71b54bda02913":"USDC","0x0b2c639c533813f4aa9d7837caf62653d097ff85":"USDC","0xaf88d065e77c8cc2239327c5edb3a432268e5831":"USDC","0x3c499c542cef5e3811e1192ce70d8cc03d5c3359":"USDC","0x2791bca1f2de4661ed88a30c99a7a9449aa84174":"USDC",EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v:"USDC","0xdac17f958d2ee523a2206206994597c13d831ec7":"USDT","0x94b008aa00579c1307b0ef2c499ad98a8ce58e58":"USDT","0xfd086bc7cd5c481dcc9c85ebe478a1c0b69fcbb9":"USDT","0xc2132d05d31c914a87c6611c10748aeb04b58e8f":"USDT",Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB:"USDT"},HTTP_STATUS_CODES:{SERVER_ERROR:500,TOO_MANY_REQUESTS:429,SERVICE_UNAVAILABLE:503,FORBIDDEN:403},UNSUPPORTED_NETWORK_NAME:"Unknown Network",SECURE_SITE_SDK_ORIGIN:(typeof process<"u"&&typeof bc<"u"?bc.NEXT_PUBLIC_SECURE_SITE_ORIGIN:void 0)||"https://secure.walletconnect.org",REMOTE_FEATURES_ALERTS:{MULTI_WALLET_NOT_ENABLED:{DEFAULT:{displayMessage:"Multi-Wallet Not Enabled",debugMessage:"Multi-wallet support is not enabled. Please enable it in your AppKit configuration at cloud.reown.com."},CONNECTIONS_HOOK:{displayMessage:"Multi-Wallet Not Enabled",debugMessage:"Multi-wallet support is not enabled. Please enable it in your AppKit configuration at cloud.reown.com to use the useAppKitConnections hook."},CONNECTION_HOOK:{displayMessage:"Multi-Wallet Not Enabled",debugMessage:"Multi-wallet support is not enabled. Please enable it in your AppKit configuration at cloud.reown.com to use the useAppKitConnection hook."}},HEADLESS_NOT_ENABLED:{DEFAULT:{displayMessage:"",debugMessage:"Headless support is not enabled. Please enable it with the features.headless option in the AppKit configuration and make sure your current plan supports it."}}},IS_DEVELOPMENT:typeof process<"u"&&!1,DEFAULT_ALLOWED_ANCESTORS:["http://localhost:*","https://localhost:*","http://127.0.0.1:*","https://127.0.0.1:*","https://*.pages.dev","https://*.vercel.app","https://*.ngrok-free.app","https://secure-mobile.walletconnect.com","https://secure-mobile.walletconnect.org"],METMASK_CONNECTOR_NAME:"MetaMask",TRUST_CONNECTOR_NAME:"Trust Wallet",SOLFLARE_CONNECTOR_NAME:"Solflare",PHANTOM_CONNECTOR_NAME:"Phantom",COIN98_CONNECTOR_NAME:"Coin98",MAGIC_EDEN_CONNECTOR_NAME:"Magic Eden",BACKPACK_CONNECTOR_NAME:"Backpack",BITGET_CONNECTOR_NAME:"Bitget Wallet",FRONTIER_CONNECTOR_NAME:"Frontier",XVERSE_CONNECTOR_NAME:"Xverse Wallet",LEATHER_CONNECTOR_NAME:"Leather",OKX_CONNECTOR_NAME:"OKX Wallet",BINANCE_CONNECTOR_NAME:"Binance Wallet",EIP155:"eip155",ADD_CHAIN_METHOD:"wallet_addEthereumChain",EIP6963_ANNOUNCE_EVENT:"eip6963:announceProvider",EIP6963_REQUEST_EVENT:"eip6963:requestProvider",CONNECTOR_RDNS_MAP:{coinbaseWallet:"com.coinbase.wallet",coinbaseWalletSDK:"com.coinbase.wallet"},CONNECTOR_TYPE_EXTERNAL:"EXTERNAL",CONNECTOR_TYPE_WALLET_CONNECT:"WALLET_CONNECT",CONNECTOR_TYPE_INJECTED:"INJECTED",CONNECTOR_TYPE_ANNOUNCED:"ANNOUNCED",CONNECTOR_TYPE_AUTH:"AUTH",CONNECTOR_TYPE_MULTI_CHAIN:"MULTI_CHAIN",CONNECTOR_TYPE_W3M_AUTH:"AUTH"},zd={caipNetworkIdToNumber(t){return t?Number(t.split(":")[1]):void 0},parseEvmChainId(t){return typeof t=="string"?this.caipNetworkIdToNumber(t):t},getNetworksByNamespace(t,e){return(t==null?void 0:t.filter(s=>s.chainNamespace===e))||[]},getFirstNetworkByNamespace(t,e){return this.getNetworksByNamespace(t,e)[0]},getNetworkNameByCaipNetworkId(t,e){var i;if(!e)return;const s=t.find(r=>r.caipNetworkId===e);if(s)return s.name;const[n]=e.split(":");return((i=I.CHAIN_NAME_MAP)==null?void 0:i[n])||void 0}},Gd=["eip155","solana","polkadot","bip122","cosmos","sui","stacks"];var Np=20,_p=1,vn=1e6,Ec=1e6,Sp=-7,Tp=21,Op=!1,Ki="[big.js] ",Tn=Ki+"Invalid ",Gr=Tn+"decimal places",kp=Tn+"rounding mode",Yd=Ki+"Division by zero",Ne={},ds=void 0,xp=/^-?(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i;function Jd(){function t(e){var s=this;if(!(s instanceof t))return e===ds?Jd():new t(e);if(e instanceof t)s.s=e.s,s.e=e.e,s.c=e.c.slice();else{if(typeof e!="string"){if(t.strict===!0&&typeof e!="bigint")throw TypeError(Tn+"value");e=e===0&&1/e<0?"-0":String(e)}Pp(s,e)}s.constructor=t}return t.prototype=Ne,t.DP=Np,t.RM=_p,t.NE=Sp,t.PE=Tp,t.strict=Op,t.roundDown=0,t.roundHalfUp=1,t.roundHalfEven=2,t.roundUp=3,t}function Pp(t,e){var s,n,i;if(!xp.test(e))throw Error(Tn+"number");for(t.s=e.charAt(0)=="-"?(e=e.slice(1),-1):1,(s=e.indexOf("."))>-1&&(e=e.replace(".","")),(n=e.search(/e/i))>0?(s<0&&(s=n),s+=+e.slice(n+1),e=e.substring(0,n)):s<0&&(s=e.length),i=e.length,n=0;n<i&&e.charAt(n)=="0";)++n;if(n==i)t.c=[t.e=0];else{for(;i>0&&e.charAt(--i)=="0";);for(t.e=s-n-1,t.c=[],s=0;n<=i;)t.c[s++]=+e.charAt(n++)}return t}function On(t,e,s,n){var i=t.c;if(s===ds&&(s=t.constructor.RM),s!==0&&s!==1&&s!==2&&s!==3)throw Error(kp);if(e<1)n=s===3&&(n||!!i[0])||e===0&&(s===1&&i[0]>=5||s===2&&(i[0]>5||i[0]===5&&(n||i[1]!==ds))),i.length=1,n?(t.e=t.e-e+1,i[0]=1):i[0]=t.e=0;else if(e<i.length){if(n=s===1&&i[e]>=5||s===2&&(i[e]>5||i[e]===5&&(n||i[e+1]!==ds||i[e-1]&1))||s===3&&(n||!!i[0]),i.length=e,n){for(;++i[--e]>9;)if(i[e]=0,e===0){++t.e,i.unshift(1);break}}for(e=i.length;!i[--e];)i.pop()}return t}function kn(t,e,s){var n=t.e,i=t.c.join(""),r=i.length;if(e)i=i.charAt(0)+(r>1?"."+i.slice(1):"")+(n<0?"e":"e+")+n;else if(n<0){for(;++n;)i="0"+i;i="0."+i}else if(n>0)if(++n>r)for(n-=r;n--;)i+="0";else n<r&&(i=i.slice(0,n)+"."+i.slice(n));else r>1&&(i=i.charAt(0)+"."+i.slice(1));return t.s<0&&s?"-"+i:i}Ne.abs=function(){var t=new this.constructor(this);return t.s=1,t};Ne.cmp=function(t){var e,s=this,n=s.c,i=(t=new s.constructor(t)).c,r=s.s,o=t.s,a=s.e,c=t.e;if(!n[0]||!i[0])return n[0]?r:i[0]?-o:0;if(r!=o)return r;if(e=r<0,a!=c)return a>c^e?1:-1;for(o=(a=n.length)<(c=i.length)?a:c,r=-1;++r<o;)if(n[r]!=i[r])return n[r]>i[r]^e?1:-1;return a==c?0:a>c^e?1:-1};Ne.div=function(t){var e=this,s=e.constructor,n=e.c,i=(t=new s(t)).c,r=e.s==t.s?1:-1,o=s.DP;if(o!==~~o||o<0||o>vn)throw Error(Gr);if(!i[0])throw Error(Yd);if(!n[0])return t.s=r,t.c=[t.e=0],t;var a,c,l,d,h,u=i.slice(),p=a=i.length,m=n.length,y=n.slice(0,a),g=y.length,w=t,b=w.c=[],A=0,x=o+(w.e=e.e-t.e)+1;for(w.s=r,r=x<0?0:x,u.unshift(0);g++<a;)y.push(0);do{for(l=0;l<10;l++){if(a!=(g=y.length))d=a>g?1:-1;else for(h=-1,d=0;++h<a;)if(i[h]!=y[h]){d=i[h]>y[h]?1:-1;break}if(d<0){for(c=g==a?i:u;g;){if(y[--g]<c[g]){for(h=g;h&&!y[--h];)y[h]=9;--y[h],y[g]+=10}y[g]-=c[g]}for(;!y[0];)y.shift()}else break}b[A++]=d?l:++l,y[0]&&d?y[g]=n[p]||0:y=[n[p]]}while((p++<m||y[0]!==ds)&&r--);return!b[0]&&A!=1&&(b.shift(),w.e--,x--),A>x&&On(w,x,s.RM,y[0]!==ds),w};Ne.eq=function(t){return this.cmp(t)===0};Ne.gt=function(t){return this.cmp(t)>0};Ne.gte=function(t){return this.cmp(t)>-1};Ne.lt=function(t){return this.cmp(t)<0};Ne.lte=function(t){return this.cmp(t)<1};Ne.minus=Ne.sub=function(t){var e,s,n,i,r=this,o=r.constructor,a=r.s,c=(t=new o(t)).s;if(a!=c)return t.s=-c,r.plus(t);var l=r.c.slice(),d=r.e,h=t.c,u=t.e;if(!l[0]||!h[0])return h[0]?t.s=-c:l[0]?t=new o(r):t.s=1,t;if(a=d-u){for((i=a<0)?(a=-a,n=l):(u=d,n=h),n.reverse(),c=a;c--;)n.push(0);n.reverse()}else for(s=((i=l.length<h.length)?l:h).length,a=c=0;c<s;c++)if(l[c]!=h[c]){i=l[c]<h[c];break}if(i&&(n=l,l=h,h=n,t.s=-t.s),(c=(s=h.length)-(e=l.length))>0)for(;c--;)l[e++]=0;for(c=e;s>a;){if(l[--s]<h[s]){for(e=s;e&&!l[--e];)l[e]=9;--l[e],l[s]+=10}l[s]-=h[s]}for(;l[--c]===0;)l.pop();for(;l[0]===0;)l.shift(),--u;return l[0]||(t.s=1,l=[u=0]),t.c=l,t.e=u,t};Ne.mod=function(t){var e,s=this,n=s.constructor,i=s.s,r=(t=new n(t)).s;if(!t.c[0])throw Error(Yd);return s.s=t.s=1,e=t.cmp(s)==1,s.s=i,t.s=r,e?new n(s):(i=n.DP,r=n.RM,n.DP=n.RM=0,s=s.div(t),n.DP=i,n.RM=r,this.minus(s.times(t)))};Ne.neg=function(){var t=new this.constructor(this);return t.s=-t.s,t};Ne.plus=Ne.add=function(t){var e,s,n,i=this,r=i.constructor;if(t=new r(t),i.s!=t.s)return t.s=-t.s,i.minus(t);var o=i.e,a=i.c,c=t.e,l=t.c;if(!a[0]||!l[0])return l[0]||(a[0]?t=new r(i):t.s=i.s),t;if(a=a.slice(),e=o-c){for(e>0?(c=o,n=l):(e=-e,n=a),n.reverse();e--;)n.push(0);n.reverse()}for(a.length-l.length<0&&(n=l,l=a,a=n),e=l.length,s=0;e;a[e]%=10)s=(a[--e]=a[e]+l[e]+s)/10|0;for(s&&(a.unshift(s),++c),e=a.length;a[--e]===0;)a.pop();return t.c=a,t.e=c,t};Ne.pow=function(t){var e=this,s=new e.constructor("1"),n=s,i=t<0;if(t!==~~t||t<-Ec||t>Ec)throw Error(Tn+"exponent");for(i&&(t=-t);t&1&&(n=n.times(e)),t>>=1,!!t;)e=e.times(e);return i?s.div(n):n};Ne.prec=function(t,e){if(t!==~~t||t<1||t>vn)throw Error(Tn+"precision");return On(new this.constructor(this),t,e)};Ne.round=function(t,e){if(t===ds)t=0;else if(t!==~~t||t<-vn||t>vn)throw Error(Gr);return On(new this.constructor(this),t+this.e+1,e)};Ne.sqrt=function(){var t,e,s,n=this,i=n.constructor,r=n.s,o=n.e,a=new i("0.5");if(!n.c[0])return new i(n);if(r<0)throw Error(Ki+"No square root");r=Math.sqrt(+kn(n,!0,!0)),r===0||r===1/0?(e=n.c.join(""),e.length+o&1||(e+="0"),r=Math.sqrt(e),o=((o+1)/2|0)-(o<0||o&1),t=new i((r==1/0?"5e":(r=r.toExponential()).slice(0,r.indexOf("e")+1))+o)):t=new i(r+""),o=t.e+(i.DP+=4);do s=t,t=a.times(s.plus(n.div(s)));while(s.c.slice(0,o).join("")!==t.c.slice(0,o).join(""));return On(t,(i.DP-=4)+t.e+1,i.RM)};Ne.times=Ne.mul=function(t){var e,s=this,n=s.constructor,i=s.c,r=(t=new n(t)).c,o=i.length,a=r.length,c=s.e,l=t.e;if(t.s=s.s==t.s?1:-1,!i[0]||!r[0])return t.c=[t.e=0],t;for(t.e=c+l,o<a&&(e=i,i=r,r=e,l=o,o=a,a=l),e=new Array(l=o+a);l--;)e[l]=0;for(c=a;c--;){for(a=0,l=o+c;l>c;)a=e[l]+r[c]*i[l-c-1]+a,e[l--]=a%10,a=a/10|0;e[l]=a}for(a?++t.e:e.shift(),c=e.length;!e[--c];)e.pop();return t.c=e,t};Ne.toExponential=function(t,e){var s=this,n=s.c[0];if(t!==ds){if(t!==~~t||t<0||t>vn)throw Error(Gr);for(s=On(new s.constructor(s),++t,e);s.c.length<t;)s.c.push(0)}return kn(s,!0,!!n)};Ne.toFixed=function(t,e){var s=this,n=s.c[0];if(t!==ds){if(t!==~~t||t<0||t>vn)throw Error(Gr);for(s=On(new s.constructor(s),t+s.e+1,e),t=t+s.e+1;s.c.length<t;)s.c.push(0)}return kn(s,!1,!!n)};Ne[Symbol.for("nodejs.util.inspect.custom")]=Ne.toJSON=Ne.toString=function(){var t=this,e=t.constructor;return kn(t,t.e<=e.NE||t.e>=e.PE,!!t.c[0])};Ne.toNumber=function(){var t=+kn(this,!0,!0);if(this.constructor.strict===!0&&!this.eq(t.toString()))throw Error(Ki+"Imprecise conversion");return t};Ne.toPrecision=function(t,e){var s=this,n=s.constructor,i=s.c[0];if(t!==ds){if(t!==~~t||t<1||t>vn)throw Error(Tn+"precision");for(s=On(new n(s),t,e);s.c.length<t;)s.c.push(0)}return kn(s,t<=s.e||s.e<=n.NE||s.e>=n.PE,!!i)};Ne.valueOf=function(){var t=this,e=t.constructor;if(e.strict===!0)throw Error(Ki+"valueOf disallowed");return kn(t,t.e<=e.NE||t.e>=e.PE,!0)};var Qt=Jd();const Xd={bigNumber(t,e={safe:!1}){try{return t?new Qt(t):new Qt(0)}catch(s){if(e.safe)return new Qt(0);throw s}},formatNumber(t,e){const{decimals:s,round:n=8,safe:i=!0}=e;return Xd.bigNumber(t,{safe:i}).div(new Qt(10).pow(s)).round(n)},multiply(t,e){if(t===void 0||e===void 0)return new Qt(0);const s=new Qt(t),n=new Qt(e);return s.times(n)},toFixed(t,e=2){return t===void 0||t===""?new Qt(0).toFixed(e):new Qt(t).toFixed(e)},formatNumberToLocalString(t,e=2){return t===void 0||t===""?"0.00":typeof t=="number"?t.toLocaleString("en-US",{maximumFractionDigits:e,minimumFractionDigits:e,roundingMode:"floor"}):parseFloat(t).toLocaleString("en-US",{maximumFractionDigits:e,minimumFractionDigits:e,roundingMode:"floor"})},parseLocalStringToNumber(t){if(t===void 0||t==="")return 0;const e=t.replace(/,/gu,"");return new Qt(e).toNumber()}},Rp=[{type:"function",name:"transfer",stateMutability:"nonpayable",inputs:[{name:"_to",type:"address"},{name:"_value",type:"uint256"}],outputs:[{name:"",type:"bool"}]},{type:"function",name:"transferFrom",stateMutability:"nonpayable",inputs:[{name:"_from",type:"address"},{name:"_to",type:"address"},{name:"_value",type:"uint256"}],outputs:[{name:"",type:"bool"}]}],Up=[{type:"function",name:"approve",stateMutability:"nonpayable",inputs:[{name:"spender",type:"address"},{name:"amount",type:"uint256"}],outputs:[{type:"bool"}]}],$p=[{type:"function",name:"transfer",stateMutability:"nonpayable",inputs:[{name:"recipient",type:"address"},{name:"amount",type:"uint256"}],outputs:[]},{type:"function",name:"transferFrom",stateMutability:"nonpayable",inputs:[{name:"sender",type:"address"},{name:"recipient",type:"address"},{name:"amount",type:"uint256"}],outputs:[{name:"",type:"bool"}]}],Dp={getERC20Abi:t=>I.USDT_CONTRACT_ADDRESSES.includes(t)?$p:Rp,getSwapAbi:()=>Up},Un={ConnectorExplorerIds:{[I.CONNECTOR_ID.COINBASE]:"fd20dc426fb37566d803205b19bbc1d4096b248ac04548e3cfb6b3a38bd033aa",[I.CONNECTOR_ID.COINBASE_SDK]:"fd20dc426fb37566d803205b19bbc1d4096b248ac04548e3cfb6b3a38bd033aa",[I.CONNECTOR_ID.BASE_ACCOUNT]:"fd20dc426fb37566d803205b19bbc1d4096b248ac04548e3cfb6b3a38bd033aa",[I.CONNECTOR_ID.SAFE]:"225affb176778569276e484e1b92637ad061b01e13a048b35a9d280c3b58970f",[I.CONNECTOR_ID.LEDGER]:"19177a98252e07ddfc9af2083ba8e07ef627cb6103467ffebb3f8f4205fd7927",[I.CONNECTOR_ID.OKX]:"971e689d0a5be527bac79629b4ee9b925e82208e5168b733496a09c0faed0709",[I.METMASK_CONNECTOR_NAME]:"c57ca95b47569778a828d19178114f4db188b89b763c899ba0be274e97267d96",[I.TRUST_CONNECTOR_NAME]:"4622a2b2d6af1c9844944291e5e7351a6aa24cd7b23099efac1b2fd875da31a0",[I.SOLFLARE_CONNECTOR_NAME]:"1ca0bdd4747578705b1939af023d120677c64fe6ca76add81fda36e350605e79",[I.PHANTOM_CONNECTOR_NAME]:"a797aa35c0fadbfc1a53e7f675162ed5226968b44a19ee3d24385c64d1d3c393",[I.COIN98_CONNECTOR_NAME]:"2a3c89040ac3b723a1972a33a125b1db11e258a6975d3a61252cd64e6ea5ea01",[I.MAGIC_EDEN_CONNECTOR_NAME]:"8b830a2b724a9c3fbab63af6f55ed29c9dfa8a55e732dc88c80a196a2ba136c6",[I.BACKPACK_CONNECTOR_NAME]:"2bd8c14e035c2d48f184aaa168559e86b0e3433228d3c4075900a221785019b0",[I.BITGET_CONNECTOR_NAME]:"38f5d18bd8522c244bdd70cb4a68e0e718865155811c043f052fb9f1c51de662",[I.FRONTIER_CONNECTOR_NAME]:"85db431492aa2e8672e93f4ea7acf10c88b97b867b0d373107af63dc4880f041",[I.XVERSE_CONNECTOR_NAME]:"2a87d74ae02e10bdd1f51f7ce6c4e1cc53cd5f2c0b6b5ad0d7b3007d2b13de7b",[I.LEATHER_CONNECTOR_NAME]:"483afe1df1df63daf313109971ff3ef8356ddf1cc4e45877d205eee0b7893a13",[I.OKX_CONNECTOR_NAME]:"971e689d0a5be527bac79629b4ee9b925e82208e5168b733496a09c0faed0709",[I.BINANCE_CONNECTOR_NAME]:"2fafea35bb471d22889ccb49c08d99dd0a18a37982602c33f696a5723934ba25"}},Je={validateCaipAddress(t){var e;if(((e=t.split(":"))==null?void 0:e.length)!==3)throw new Error("Invalid CAIP Address");return t},parseCaipAddress(t){const e=t.split(":");if(e.length!==3)throw new Error(`Invalid CAIP-10 address: ${t}`);const[s,n,i]=e;if(!s||!n||!i)throw new Error(`Invalid CAIP-10 address: ${t}`);return{chainNamespace:s,chainId:n,address:i}},parseCaipNetworkId(t){const e=t.split(":");if(e.length!==2)throw new Error(`Invalid CAIP-2 network id: ${t}`);const[s,n]=e;if(!s||!n)throw new Error(`Invalid CAIP-2 network id: ${t}`);return{chainNamespace:s,chainId:n}}},As={RPC_ERROR_CODE:{USER_REJECTED_REQUEST:4001,USER_REJECTED_METHODS:5002,USER_REJECTED:5e3,SEND_TRANSACTION_ERROR:5001},PROVIDER_RPC_ERROR_NAME:{PROVIDER_RPC:"ProviderRpcError",USER_REJECTED_REQUEST:"UserRejectedRequestError",SEND_TRANSACTION_ERROR:"SendTransactionError"},isRpcProviderError(t){try{if(typeof t=="object"&&t!==null){const e=t,s=typeof e.message=="string",n=typeof e.code=="number";return s&&n}return!1}catch{return!1}},isUserRejectedMessage(t){return t.toLowerCase().includes("user rejected")||t.toLowerCase().includes("user cancelled")||t.toLowerCase().includes("user canceled")},isUserRejectedRequestError(t){if(As.isRpcProviderError(t)){const e=t.code===As.RPC_ERROR_CODE.USER_REJECTED_REQUEST,s=t.code===As.RPC_ERROR_CODE.USER_REJECTED_METHODS;return e||s||As.isUserRejectedMessage(t.message)}return t instanceof Error?As.isUserRejectedMessage(t.message):!1}};class Lp extends Error{constructor(e,s){super(s.message,{cause:e}),this.name=As.PROVIDER_RPC_ERROR_NAME.PROVIDER_RPC,this.code=s.code}}class Zd extends Lp{constructor(e){super(e,{code:As.RPC_ERROR_CODE.USER_REJECTED_REQUEST,message:"User rejected the request"}),this.name=As.PROVIDER_RPC_ERROR_NAME.USER_REJECTED_REQUEST}}const Z={WALLET_ID:"@appkit/wallet_id",WALLET_NAME:"@appkit/wallet_name",SOLANA_WALLET:"@appkit/solana_wallet",SOLANA_CAIP_CHAIN:"@appkit/solana_caip_chain",ACTIVE_CAIP_NETWORK_ID:"@appkit/active_caip_network_id",CONNECTED_SOCIAL:"@appkit/connected_social",CONNECTED_SOCIAL_USERNAME:"@appkit-wallet/SOCIAL_USERNAME",RECENT_WALLETS:"@appkit/recent_wallets",RECENT_WALLET:"@appkit/recent_wallet",DEEPLINK_CHOICE:"WALLETCONNECT_DEEPLINK_CHOICE",ACTIVE_NAMESPACE:"@appkit/active_namespace",CONNECTED_NAMESPACES:"@appkit/connected_namespaces",CONNECTION_STATUS:"@appkit/connection_status",SIWX_AUTH_TOKEN:"@appkit/siwx-auth-token",SIWX_NONCE_TOKEN:"@appkit/siwx-nonce-token",TELEGRAM_SOCIAL_PROVIDER:"@appkit/social_provider",NATIVE_BALANCE_CACHE:"@appkit/native_balance_cache",PORTFOLIO_CACHE:"@appkit/portfolio_cache",ENS_CACHE:"@appkit/ens_cache",IDENTITY_CACHE:"@appkit/identity_cache",PREFERRED_ACCOUNT_TYPES:"@appkit/preferred_account_types",CONNECTIONS:"@appkit/connections",DISCONNECTED_CONNECTOR_IDS:"@appkit/disconnected_connector_ids",HISTORY_TRANSACTIONS_CACHE:"@appkit/history_transactions_cache",TOKEN_PRICE_CACHE:"@appkit/token_price_cache",RECENT_EMAILS:"@appkit/recent_emails",LATEST_APPKIT_VERSION:"@appkit/latest_version",TON_WALLETS_CACHE:"@appkit/ton_wallets_cache"};function co(t){if(!t)throw new Error("Namespace is required for CONNECTED_CONNECTOR_ID");return`@appkit/${t}:connected_connector_id`}const X={setItem(t,e){vi()&&e!==void 0&&localStorage.setItem(t,e)},getItem(t){if(vi())return localStorage.getItem(t)||void 0},removeItem(t){vi()&&localStorage.removeItem(t)},clear(){vi()&&localStorage.clear()}};function vi(){return typeof window<"u"&&typeof localStorage<"u"}function kr(t,e){var n;const s=(n=t==null?void 0:t["--apkt-accent"])!=null?n:t==null?void 0:t["--w3m-accent"];return e==="light"?{"--w3m-accent":s||"hsla(231, 100%, 70%, 1)","--w3m-background":"#fff"}:{"--w3m-accent":s||"hsla(230, 100%, 67%, 1)","--w3m-background":"#202020"}}const Mp=Symbol(),Cc=Object.getPrototypeOf,Go=new WeakMap,Bp=t=>t&&(Go.has(t)?Go.get(t):Cc(t)===Object.prototype||Cc(t)===Array.prototype),Fp=t=>Bp(t)&&t[Mp]||null,vc=(t,e=!0)=>{Go.set(t,e)},xr={},qa=t=>typeof t=="object"&&t!==null,Wp=t=>qa(t)&&!Vi.has(t)&&(Array.isArray(t)||!(Symbol.iterator in t))&&!(t instanceof WeakMap)&&!(t instanceof WeakSet)&&!(t instanceof Error)&&!(t instanceof Number)&&!(t instanceof Date)&&!(t instanceof String)&&!(t instanceof RegExp)&&!(t instanceof ArrayBuffer)&&!(t instanceof Promise),Qd=(t,e)=>{const s=Yo.get(t);if((s==null?void 0:s[0])===e)return s[1];const n=Array.isArray(t)?[]:Object.create(Object.getPrototypeOf(t));return vc(n,!0),Yo.set(t,[e,n]),Reflect.ownKeys(t).forEach(i=>{if(Object.getOwnPropertyDescriptor(n,i))return;const r=Reflect.get(t,i),{enumerable:o}=Reflect.getOwnPropertyDescriptor(t,i),a={value:r,enumerable:o,configurable:!0};if(Vi.has(r))vc(r,!1);else if(Xs.has(r)){const[c,l]=Xs.get(r);a.value=Qd(c,l())}Object.defineProperty(n,i,a)}),Object.preventExtensions(n)},jp=(t,e,s,n)=>({deleteProperty(i,r){const o=Reflect.get(i,r);s(r);const a=Reflect.deleteProperty(i,r);return a&&n(["delete",[r],o]),a},set(i,r,o,a){const c=!t()&&Reflect.has(i,r),l=Reflect.get(i,r,a);if(c&&(Ac(l,o)||Di.has(o)&&Ac(l,Di.get(o))))return!0;s(r),qa(o)&&(o=Fp(o)||o);const d=!Xs.has(o)&&Hp(o)?xe(o):o;return e(r,d),Reflect.set(i,r,d,a),n(["set",[r],o,l]),!0}}),Xs=new WeakMap,Vi=new WeakSet,Yo=new WeakMap,Er=[1],Di=new WeakMap;let Ac=Object.is,qp=(t,e)=>new Proxy(t,e),Hp=Wp,Kp=Qd,Vp=jp;function xe(t={}){if(!qa(t))throw new Error("object required");const e=Di.get(t);if(e)return e;let s=Er[0];const n=new Set,i=(g,w=++Er[0])=>{s!==w&&(r=s=w,n.forEach(b=>b(g,w)))};let r=s;const o=(g=Er[0])=>(r!==g&&(r=g,c.forEach(([w])=>{const b=w[1](g);b>s&&(s=b)})),s),a=g=>(w,b)=>{const A=[...w];A[1]=[g,...A[1]],i(A,b)},c=new Map,l=(g,w)=>{const b=!Vi.has(w)&&Xs.get(w);if(b){if((xr?"production":void 0)!=="production"&&c.has(g))throw new Error("prop listener already exists");if(n.size){const A=b[2](a(g));c.set(g,[b,A])}else c.set(g,[b])}},d=g=>{var w;const b=c.get(g);b&&(c.delete(g),(w=b[1])==null||w.call(b))},h=g=>(n.add(g),n.size===1&&c.forEach(([b,A],x)=>{if((xr?"production":void 0)!=="production"&&A)throw new Error("remove already exists");const H=b[2](a(x));c.set(x,[b,H])}),()=>{n.delete(g),n.size===0&&c.forEach(([b,A],x)=>{A&&(A(),c.set(x,[b]))})});let u=!0;const p=Vp(()=>u,l,d,i),m=qp(t,p);Di.set(t,m);const y=[t,o,h];return Xs.set(m,y),Reflect.ownKeys(t).forEach(g=>{const w=Object.getOwnPropertyDescriptor(t,g);"value"in w&&w.writable&&(m[g]=t[g])}),u=!1,m}function Xe(t,e,s){const n=Xs.get(t);(xr?"production":void 0)!=="production"&&!n&&console.warn("Please use proxy object");let i;const r=[],o=n[2];let a=!1;const l=o(d=>{r.push(d),i||(i=Promise.resolve().then(()=>{i=void 0,a&&e(r.splice(0))}))});return a=!0,()=>{a=!1,l()}}function Li(t){const e=Xs.get(t);(xr?"production":void 0)!=="production"&&!e&&console.warn("Please use proxy object");const[s,n]=e;return Kp(s,n())}function Mi(t){return Vi.add(t),t}function zp(){return{proxyStateMap:Xs,refSet:Vi,snapCache:Yo,versionHolder:Er,proxyCache:Di}}function Ze(t,e,s,n){let i=t[e];return Xe(t,()=>{const r=t[e];Object.is(i,r)||s(i=r)})}const{proxyStateMap:Gp,snapCache:Yp}=zp(),nr=t=>Gp.has(t);function Jp(t){const e=[];let s=0;const n=new Map,i=new WeakMap,r=()=>{const l=Yp.get(a),d=l==null?void 0:l[1];if(d&&!i.has(d)){const h=new Map(n);i.set(d,h)}},o=l=>i.get(l)||n,a={data:e,index:s,epoch:0,get size(){return nr(this)||r(),o(this).size},get(l){const h=o(this).get(l);if(h===void 0){this.epoch;return}return this.data[h]},has(l){const d=o(this);return this.epoch,d.has(l)},set(l,d){if(!nr(this))throw new Error("Cannot perform mutations on a snapshot");const h=n.get(l);return h===void 0?(n.set(l,this.index),this.data[this.index++]=d):this.data[h]=d,this.epoch++,this},delete(l){if(!nr(this))throw new Error("Cannot perform mutations on a snapshot");const d=n.get(l);return d===void 0?!1:(delete this.data[d],n.delete(l),this.epoch++,!0)},clear(){if(!nr(this))throw new Error("Cannot perform mutations on a snapshot");this.data.length=0,this.index=0,this.epoch++,n.clear()},forEach(l){this.epoch,o(this).forEach((h,u)=>{l(this.data[h],u,this)})},*entries(){this.epoch;const l=o(this);for(const[d,h]of l)yield[d,this.data[h]]},*keys(){this.epoch;const l=o(this);for(const d of l.keys())yield d},*values(){this.epoch;const l=o(this);for(const d of l.values())yield this.data[d]},[Symbol.iterator](){return this.entries()},get[Symbol.toStringTag](){return"Map"},toJSON(){return new Map(this.entries())}},c=xe(a);return Object.defineProperties(c,{size:{enumerable:!1},index:{enumerable:!1},epoch:{enumerable:!1},data:{enumerable:!1},toJSON:{enumerable:!1}}),Object.seal(c),c}var Ic={};const lo=(typeof process<"u"&&typeof Ic<"u"?Ic.NEXT_PUBLIC_SECURE_SITE_ORIGIN:void 0)||"https://secure.walletconnect.org",eh=[{label:"Meld.io",name:"meld",feeRange:"1-2%",url:"https://meldcrypto.com",supportedChains:["eip155","solana"]}],Xp="WXETMuFUQmqqybHuRkSgxv:25B8LJHSfpG6LVjR2ytU5Cwh7Z4Sch2ocoU",le={FOUR_MINUTES_MS:24e4,TEN_SEC_MS:1e4,FIVE_SEC_MS:5e3,THREE_SEC_MS:3e3,ONE_SEC_MS:1e3,SECURE_SITE:lo,SECURE_SITE_DASHBOARD:`${lo}/dashboard`,SECURE_SITE_FAVICON:`${lo}/images/favicon.png`,SOLANA_NATIVE_TOKEN_ADDRESS:"So11111111111111111111111111111111111111111",RESTRICTED_TIMEZONES:["ASIA/SHANGHAI","ASIA/URUMQI","ASIA/CHONGQING","ASIA/HARBIN","ASIA/KASHGAR","ASIA/MACAU","ASIA/HONG_KONG","ASIA/MACAO","ASIA/BEIJING","ASIA/HARBIN"],SWAP_SUGGESTED_TOKENS:["ETH","UNI","1INCH","AAVE","SOL","ADA","AVAX","DOT","LINK","NITRO","GAIA","MILK","TRX","NEAR","GNO","WBTC","DAI","WETH","USDC","USDT","ARB","BAL","BICO","CRV","ENS","MATIC","OP"],SWAP_POPULAR_TOKENS:["ETH","UNI","1INCH","AAVE","SOL","ADA","AVAX","DOT","LINK","NITRO","GAIA","MILK","TRX","NEAR","GNO","WBTC","DAI","WETH","USDC","USDT","ARB","BAL","BICO","CRV","ENS","MATIC","OP","METAL","DAI","CHAMP","WOLF","SALE","BAL","BUSD","MUST","BTCpx","ROUTE","HEX","WELT","amDAI","VSQ","VISION","AURUM","pSP","SNX","VC","LINK","CHP","amUSDT","SPHERE","FOX","GIDDY","GFC","OMEN","OX_OLD","DE","WNT"],SUGGESTED_TOKENS_BY_CHAIN:{"eip155:42161":["USDâ‚®0"]},BALANCE_SUPPORTED_CHAINS:[I.CHAIN.EVM,I.CHAIN.SOLANA],SEND_PARAMS_SUPPORTED_CHAINS:[I.CHAIN.EVM],SWAP_SUPPORTED_NETWORKS:["eip155:1","eip155:42161","eip155:10","eip155:324","eip155:8453","eip155:56","eip155:137","eip155:100","eip155:43114","eip155:250","eip155:8217","eip155:1313161554"],NAMES_SUPPORTED_CHAIN_NAMESPACES:[I.CHAIN.EVM],ONRAMP_SUPPORTED_CHAIN_NAMESPACES:[I.CHAIN.EVM,I.CHAIN.SOLANA],PAY_WITH_EXCHANGE_SUPPORTED_CHAIN_NAMESPACES:[I.CHAIN.EVM,I.CHAIN.SOLANA],ACTIVITY_ENABLED_CHAIN_NAMESPACES:[I.CHAIN.EVM,I.CHAIN.TON],NATIVE_TOKEN_ADDRESS:{eip155:"0xeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee",solana:"So11111111111111111111111111111111111111111",polkadot:"0x",bip122:"0x",cosmos:"0x",sui:"0x",stacks:"0x",ton:"0x"},CONVERT_SLIPPAGE_TOLERANCE:1,CONNECT_LABELS:{MOBILE:"Open and continue in the wallet app",WEB:"Open and continue in the wallet app"},SEND_SUPPORTED_NAMESPACES:[I.CHAIN.EVM,I.CHAIN.SOLANA],DEFAULT_REMOTE_FEATURES:{swaps:["1inch"],onramp:["meld"],email:!0,socials:["google","x","discord","farcaster","github","apple","facebook"],activity:!0,reownBranding:!0,multiWallet:!1,emailCapture:!1,payWithExchange:!1,payments:!1,reownAuthentication:!1,headless:!1},DEFAULT_REMOTE_FEATURES_DISABLED:{email:!1,socials:!1,swaps:!1,onramp:!1,activity:!1,reownBranding:!1,emailCapture:!1,reownAuthentication:!1,headless:!1},DEFAULT_FEATURES:{receive:!0,send:!0,emailShowWallets:!0,connectorTypeOrder:["walletConnect","recent","injected","featured","custom","external","recommended"],analytics:!0,allWallets:!0,legalCheckbox:!1,smartSessions:!1,collapseWallets:!1,walletFeaturesOrder:["onramp","swaps","receive","send"],connectMethodsOrder:void 0,pay:!1,reownAuthentication:!1,headless:!1},DEFAULT_SOCIALS:["google","x","farcaster","discord","apple","github","facebook"],DEFAULT_ACCOUNT_TYPES:{bip122:"payment",eip155:"smartAccount",polkadot:"eoa",solana:"eoa",ton:"eoa"},ADAPTER_TYPES:{UNIVERSAL:"universal",SOLANA:"solana",WAGMI:"wagmi",ETHERS:"ethers",ETHERS5:"ethers5",BITCOIN:"bitcoin"},SIWX_DEFAULTS:{signOutOnDisconnect:!0},MANDATORY_WALLET_IDS_ON_MOBILE:[Un.ConnectorExplorerIds[I.CONNECTOR_ID.COINBASE],Un.ConnectorExplorerIds[I.CONNECTOR_ID.COINBASE_SDK],Un.ConnectorExplorerIds[I.CONNECTOR_ID.BASE_ACCOUNT],Un.ConnectorExplorerIds[I.SOLFLARE_CONNECTOR_NAME],Un.ConnectorExplorerIds[I.PHANTOM_CONNECTOR_NAME],Un.ConnectorExplorerIds[I.BINANCE_CONNECTOR_NAME]],DEFAULT_CONNECT_METHOD_ORDER:["email","social","wallet"]},k={cacheExpiry:{portfolio:3e4,nativeBalance:3e4,ens:3e5,identity:3e5,transactionsHistory:15e3,tokenPrice:15e3,latestAppKitVersion:6048e5,tonWallets:864e5},isCacheExpired(t,e){return Date.now()-t>e},getActiveNetworkProps(){const t=k.getActiveNamespace(),e=k.getActiveCaipNetworkId(),s=e?e.split(":")[1]:void 0,n=s?isNaN(Number(s))?s:Number(s):void 0;return{namespace:t,caipNetworkId:e,chainId:n}},setWalletConnectDeepLink({name:t,href:e}){try{X.setItem(Z.DEEPLINK_CHOICE,JSON.stringify({href:e,name:t}))}catch{console.info("Unable to set WalletConnect deep link")}},getWalletConnectDeepLink(){try{const t=X.getItem(Z.DEEPLINK_CHOICE);if(t)return JSON.parse(t)}catch{console.info("Unable to get WalletConnect deep link")}},deleteWalletConnectDeepLink(){try{X.removeItem(Z.DEEPLINK_CHOICE)}catch{console.info("Unable to delete WalletConnect deep link")}},setActiveNamespace(t){try{X.setItem(Z.ACTIVE_NAMESPACE,t)}catch{console.info("Unable to set active namespace")}},setActiveCaipNetworkId(t){try{X.setItem(Z.ACTIVE_CAIP_NETWORK_ID,t),k.setActiveNamespace(t.split(":")[0])}catch{console.info("Unable to set active caip network id")}},getActiveCaipNetworkId(){try{return X.getItem(Z.ACTIVE_CAIP_NETWORK_ID)}catch{console.info("Unable to get active caip network id");return}},deleteActiveCaipNetworkId(){try{X.removeItem(Z.ACTIVE_CAIP_NETWORK_ID)}catch{console.info("Unable to delete active caip network id")}},deleteConnectedConnectorId(t){try{const e=co(t);X.removeItem(e)}catch{console.info("Unable to delete connected connector id")}},setAppKitRecent(t){try{const e=k.getRecentWallets();e.find(n=>n.id===t.id)||(e.unshift(t),e.length>2&&e.pop(),X.setItem(Z.RECENT_WALLETS,JSON.stringify(e)),X.setItem(Z.RECENT_WALLET,JSON.stringify(t)))}catch{console.info("Unable to set AppKit recent")}},getRecentWallets(){try{const t=X.getItem(Z.RECENT_WALLETS);return t?JSON.parse(t):[]}catch{console.info("Unable to get AppKit recent")}return[]},getRecentWallet(){try{const t=X.getItem(Z.RECENT_WALLET);return t?JSON.parse(t):null}catch{console.info("Unable to get AppKit recent")}return null},deleteRecentWallet(){try{X.removeItem(Z.RECENT_WALLET)}catch{console.info("Unable to delete AppKit recent")}},setConnectedConnectorId(t,e){try{const s=co(t);X.setItem(s,e)}catch{console.info("Unable to set Connected Connector Id")}},getActiveNamespace(){try{return X.getItem(Z.ACTIVE_NAMESPACE)}catch{console.info("Unable to get active namespace")}},getConnectedConnectorId(t){if(t)try{const e=co(t);return X.getItem(e)}catch{console.info("Unable to get connected connector id in namespace",t)}},setConnectedSocialProvider(t){try{X.setItem(Z.CONNECTED_SOCIAL,t)}catch{console.info("Unable to set connected social provider")}},getConnectedSocialProvider(){try{return X.getItem(Z.CONNECTED_SOCIAL)}catch{console.info("Unable to get connected social provider")}},deleteConnectedSocialProvider(){try{X.removeItem(Z.CONNECTED_SOCIAL)}catch{console.info("Unable to delete connected social provider")}},getConnectedSocialUsername(){try{return X.getItem(Z.CONNECTED_SOCIAL_USERNAME)}catch{console.info("Unable to get connected social username")}},getStoredActiveCaipNetworkId(){var s;const t=X.getItem(Z.ACTIVE_CAIP_NETWORK_ID);return(s=t==null?void 0:t.split(":"))==null?void 0:s[1]},setConnectionStatus(t){try{X.setItem(Z.CONNECTION_STATUS,t)}catch{console.info("Unable to set connection status")}},getConnectionStatus(){try{return X.getItem(Z.CONNECTION_STATUS)}catch{return}},getConnectedNamespaces(){try{const t=X.getItem(Z.CONNECTED_NAMESPACES);return t!=null&&t.length?t.split(","):[]}catch{return[]}},setConnectedNamespaces(t){try{const e=Array.from(new Set(t));X.setItem(Z.CONNECTED_NAMESPACES,e.join(","))}catch{console.info("Unable to set namespaces in storage")}},addConnectedNamespace(t){try{const e=k.getConnectedNamespaces();e.includes(t)||(e.push(t),k.setConnectedNamespaces(e))}catch{console.info("Unable to add connected namespace")}},removeConnectedNamespace(t){try{const e=k.getConnectedNamespaces(),s=e.indexOf(t);s>-1&&(e.splice(s,1),k.setConnectedNamespaces(e))}catch{console.info("Unable to remove connected namespace")}},getTelegramSocialProvider(){try{return X.getItem(Z.TELEGRAM_SOCIAL_PROVIDER)}catch{return console.info("Unable to get telegram social provider"),null}},setTelegramSocialProvider(t){try{X.setItem(Z.TELEGRAM_SOCIAL_PROVIDER,t)}catch{console.info("Unable to set telegram social provider")}},removeTelegramSocialProvider(){try{X.removeItem(Z.TELEGRAM_SOCIAL_PROVIDER)}catch{console.info("Unable to remove telegram social provider")}},getBalanceCache(){let t={};try{const e=X.getItem(Z.PORTFOLIO_CACHE);t=e?JSON.parse(e):{}}catch{console.info("Unable to get balance cache")}return t},removeAddressFromBalanceCache(t){try{const e=k.getBalanceCache();X.setItem(Z.PORTFOLIO_CACHE,JSON.stringify({...e,[t]:void 0}))}catch{console.info("Unable to remove address from balance cache",t)}},getBalanceCacheForCaipAddress(t){try{const s=k.getBalanceCache()[t];if(s&&!this.isCacheExpired(s.timestamp,this.cacheExpiry.portfolio))return s.balance;k.removeAddressFromBalanceCache(t)}catch{console.info("Unable to get balance cache for address",t)}},updateBalanceCache(t){try{const e=k.getBalanceCache();e[t.caipAddress]=t,X.setItem(Z.PORTFOLIO_CACHE,JSON.stringify(e))}catch{console.info("Unable to update balance cache",t)}},getNativeBalanceCache(){let t={};try{const e=X.getItem(Z.NATIVE_BALANCE_CACHE);t=e?JSON.parse(e):{}}catch{console.info("Unable to get balance cache")}return t},removeAddressFromNativeBalanceCache(t){try{const e=k.getBalanceCache();X.setItem(Z.NATIVE_BALANCE_CACHE,JSON.stringify({...e,[t]:void 0}))}catch{console.info("Unable to remove address from balance cache",t)}},getNativeBalanceCacheForCaipAddress(t){try{const s=k.getNativeBalanceCache()[t];if(s&&!this.isCacheExpired(s.timestamp,this.cacheExpiry.nativeBalance))return s;console.info("Discarding cache for address",t),k.removeAddressFromBalanceCache(t)}catch{console.info("Unable to get balance cache for address",t)}},updateNativeBalanceCache(t){try{const e=k.getNativeBalanceCache();e[t.caipAddress]=t,X.setItem(Z.NATIVE_BALANCE_CACHE,JSON.stringify(e))}catch{console.info("Unable to update balance cache",t)}},getEnsCache(){let t={};try{const e=X.getItem(Z.ENS_CACHE);t=e?JSON.parse(e):{}}catch{console.info("Unable to get ens name cache")}return t},getEnsFromCacheForAddress(t){try{const s=k.getEnsCache()[t];if(s&&!this.isCacheExpired(s.timestamp,this.cacheExpiry.ens))return s.ens;k.removeEnsFromCache(t)}catch{console.info("Unable to get ens name from cache",t)}},updateEnsCache(t){try{const e=k.getEnsCache();e[t.address]=t,X.setItem(Z.ENS_CACHE,JSON.stringify(e))}catch{console.info("Unable to update ens name cache",t)}},removeEnsFromCache(t){try{const e=k.getEnsCache();X.setItem(Z.ENS_CACHE,JSON.stringify({...e,[t]:void 0}))}catch{console.info("Unable to remove ens name from cache",t)}},getIdentityCache(){let t={};try{const e=X.getItem(Z.IDENTITY_CACHE);t=e?JSON.parse(e):{}}catch{console.info("Unable to get identity cache")}return t},getIdentityFromCacheForAddress(t){try{const s=k.getIdentityCache()[t];if(s&&!this.isCacheExpired(s.timestamp,this.cacheExpiry.identity))return s.identity;k.removeIdentityFromCache(t)}catch{console.info("Unable to get identity from cache",t)}},updateIdentityCache(t){try{const e=k.getIdentityCache();e[t.address]={identity:t.identity,timestamp:t.timestamp},X.setItem(Z.IDENTITY_CACHE,JSON.stringify(e))}catch{console.info("Unable to update identity cache",t)}},removeIdentityFromCache(t){try{const e=k.getIdentityCache();X.setItem(Z.IDENTITY_CACHE,JSON.stringify({...e,[t]:void 0}))}catch{console.info("Unable to remove identity from cache",t)}},getTonWalletsCache(){try{const t=X.getItem(Z.TON_WALLETS_CACHE),e=t?JSON.parse(t):void 0;if(e&&!this.isCacheExpired(e.timestamp,this.cacheExpiry.tonWallets))return e;k.removeTonWalletsCache()}catch{console.info("Unable to get ton wallets cache")}},updateTonWalletsCache(t){try{const e=k.getTonWalletsCache()||{timestamp:0,wallets:[]};e.timestamp=new Date().getTime(),e.wallets=t,X.setItem(Z.TON_WALLETS_CACHE,JSON.stringify(e))}catch{console.info("Unable to update ton wallets cache",t)}},removeTonWalletsCache(){try{X.removeItem(Z.TON_WALLETS_CACHE)}catch{console.info("Unable to remove ton wallets cache")}},clearAddressCache(){try{X.removeItem(Z.PORTFOLIO_CACHE),X.removeItem(Z.NATIVE_BALANCE_CACHE),X.removeItem(Z.ENS_CACHE),X.removeItem(Z.IDENTITY_CACHE),X.removeItem(Z.HISTORY_TRANSACTIONS_CACHE)}catch{console.info("Unable to clear address cache")}},setPreferredAccountTypes(t){try{X.setItem(Z.PREFERRED_ACCOUNT_TYPES,JSON.stringify(t))}catch{console.info("Unable to set preferred account types",t)}},getPreferredAccountTypes(){try{const t=X.getItem(Z.PREFERRED_ACCOUNT_TYPES);return t?JSON.parse(t):{}}catch{console.info("Unable to get preferred account types")}return{}},setConnections(t,e){var s;try{const n=k.getConnections(),i=(s=n[e])!=null?s:[],r=new Map;for(const a of i)r.set(a.connectorId,{...a});for(const a of t){const c=r.get(a.connectorId),l=a.connectorId===I.CONNECTOR_ID.AUTH;if(c&&!l){const d=new Set(c.accounts.map(u=>u.address.toLowerCase())),h=a.accounts.filter(u=>!d.has(u.address.toLowerCase()));c.accounts.push(...h)}else r.set(a.connectorId,{...a})}const o={...n,[e]:Array.from(r.values())};X.setItem(Z.CONNECTIONS,JSON.stringify(o))}catch(n){console.error("Unable to sync connections to storage",n)}},getConnections(){try{const t=X.getItem(Z.CONNECTIONS);return t?JSON.parse(t):{}}catch(t){return console.error("Unable to get connections from storage",t),{}}},deleteAddressFromConnection({connectorId:t,address:e,namespace:s}){var n;try{const i=k.getConnections(),r=(n=i[s])!=null?n:[],o=new Map(r.map(c=>[c.connectorId,c])),a=o.get(t);a&&(a.accounts.filter(l=>l.address.toLowerCase()!==e.toLowerCase()).length===0?o.delete(t):o.set(t,{...a,accounts:a.accounts.filter(l=>l.address.toLowerCase()!==e.toLowerCase())})),X.setItem(Z.CONNECTIONS,JSON.stringify({...i,[s]:Array.from(o.values())}))}catch{console.error(`Unable to remove address "${e}" from connector "${t}" in namespace "${s}"`)}},getDisconnectedConnectorIds(){try{const t=X.getItem(Z.DISCONNECTED_CONNECTOR_IDS);return t?JSON.parse(t):{}}catch{console.info("Unable to get disconnected connector ids")}return{}},addDisconnectedConnectorId(t,e){var s;try{const n=k.getDisconnectedConnectorIds(),i=(s=n[e])!=null?s:[];i.push(t),X.setItem(Z.DISCONNECTED_CONNECTOR_IDS,JSON.stringify({...n,[e]:Array.from(new Set(i))}))}catch{console.error(`Unable to set disconnected connector id "${t}" for namespace "${e}"`)}},removeDisconnectedConnectorId(t,e){var s;try{const n=k.getDisconnectedConnectorIds();let i=(s=n[e])!=null?s:[];i=i.filter(r=>r.toLowerCase()!==t.toLowerCase()),X.setItem(Z.DISCONNECTED_CONNECTOR_IDS,JSON.stringify({...n,[e]:Array.from(new Set(i))}))}catch{console.error(`Unable to remove disconnected connector id "${t}" for namespace "${e}"`)}},isConnectorDisconnected(t,e){var s;try{return((s=k.getDisconnectedConnectorIds()[e])!=null?s:[]).some(r=>r.toLowerCase()===t.toLowerCase())}catch{console.info(`Unable to get disconnected connector id "${t}" for namespace "${e}"`)}return!1},getTransactionsCache(){try{const t=X.getItem(Z.HISTORY_TRANSACTIONS_CACHE);return t?JSON.parse(t):{}}catch{console.info("Unable to get transactions cache")}return{}},getTransactionsCacheForAddress({address:t,chainId:e=""}){var s;try{const i=(s=k.getTransactionsCache()[t])==null?void 0:s[e];if(i&&!this.isCacheExpired(i.timestamp,this.cacheExpiry.transactionsHistory))return i.transactions;k.removeTransactionsCache({address:t,chainId:e})}catch{console.info("Unable to get transactions cache")}},updateTransactionsCache({address:t,chainId:e="",timestamp:s,transactions:n}){try{const i=k.getTransactionsCache();i[t]={...i[t],[e]:{timestamp:s,transactions:n}},X.setItem(Z.HISTORY_TRANSACTIONS_CACHE,JSON.stringify(i))}catch{console.info("Unable to update transactions cache",{address:t,chainId:e,timestamp:s,transactions:n})}},removeTransactionsCache({address:t,chainId:e}){try{const s=k.getTransactionsCache(),n=(s==null?void 0:s[t])||{},{[e]:i,...r}=n;X.setItem(Z.HISTORY_TRANSACTIONS_CACHE,JSON.stringify({...s,[t]:r}))}catch{console.info("Unable to remove transactions cache",{address:t,chainId:e})}},getTokenPriceCache(){try{const t=X.getItem(Z.TOKEN_PRICE_CACHE);return t?JSON.parse(t):{}}catch{console.info("Unable to get token price cache")}return{}},getTokenPriceCacheForAddresses(t){try{const s=k.getTokenPriceCache()[t.join(",")];if(s&&!this.isCacheExpired(s.timestamp,this.cacheExpiry.tokenPrice))return s.tokenPrice;k.removeTokenPriceCache(t)}catch{console.info("Unable to get token price cache for addresses",t)}},updateTokenPriceCache(t){try{const e=k.getTokenPriceCache();e[t.addresses.join(",")]={timestamp:t.timestamp,tokenPrice:t.tokenPrice},X.setItem(Z.TOKEN_PRICE_CACHE,JSON.stringify(e))}catch{console.info("Unable to update token price cache",t)}},removeTokenPriceCache(t){try{const e=k.getTokenPriceCache();X.setItem(Z.TOKEN_PRICE_CACHE,JSON.stringify({...e,[t.join(",")]:void 0}))}catch{console.info("Unable to remove token price cache",t)}},getLatestAppKitVersion(){try{const t=this.getLatestAppKitVersionCache(),e=t==null?void 0:t.version;return e&&!this.isCacheExpired(t.timestamp,this.cacheExpiry.latestAppKitVersion)?e:void 0}catch{console.info("Unable to get latest AppKit version")}},getLatestAppKitVersionCache(){try{const t=X.getItem(Z.LATEST_APPKIT_VERSION);return t?JSON.parse(t):{}}catch{console.info("Unable to get latest AppKit version cache")}return{}},updateLatestAppKitVersion(t){try{const e=k.getLatestAppKitVersionCache();e.timestamp=t.timestamp,e.version=t.version,X.setItem(Z.LATEST_APPKIT_VERSION,JSON.stringify(e))}catch{console.info("Unable to update latest AppKit version on local storage",t)}}},j={getWindow(){if(!(typeof window>"u"))return window},isMobile(){var t;return this.isClient()?!!(window!=null&&window.matchMedia&&typeof window.matchMedia=="function"&&((t=window.matchMedia("(pointer:coarse)"))!=null&&t.matches)||/Android|webOS|iPhone|iPad|iPod|BlackBerry|Opera Mini/u.test(navigator.userAgent)):!1},checkCaipNetwork(t,e=""){return t==null?void 0:t.caipNetworkId.toLocaleLowerCase().includes(e.toLowerCase())},isAndroid(){if(!this.isMobile())return!1;const t=window==null?void 0:window.navigator.userAgent.toLowerCase();return j.isMobile()&&t.includes("android")},isIos(){if(!this.isMobile())return!1;const t=window==null?void 0:window.navigator.userAgent.toLowerCase();return t.includes("iphone")||t.includes("ipad")},isSafari(){return this.isClient()?(window==null?void 0:window.navigator.userAgent.toLowerCase()).includes("safari"):!1},isClient(){return typeof window<"u"},isPairingExpired(t){return t?t-Date.now()<=le.TEN_SEC_MS:!0},isAllowedRetry(t,e=le.ONE_SEC_MS){return Date.now()-t>=e},copyToClopboard(t){navigator.clipboard.writeText(t)},isIframe(){try{return(window==null?void 0:window.self)!==(window==null?void 0:window.top)}catch{return!1}},isSafeApp(){var t,e;if(j.isClient()&&window.self!==window.top)try{const s=(e=(t=window==null?void 0:window.location)==null?void 0:t.ancestorOrigins)==null?void 0:e[0],n="https://app.safe.global";if(s){const i=new URL(s),r=new URL(n);return i.hostname===r.hostname}}catch{return!1}return!1},getPairingExpiry(){return Date.now()+le.FOUR_MINUTES_MS},getNetworkId(t){return t==null?void 0:t.split(":")[1]},getPlainAddress(t){return t==null?void 0:t.split(":")[2]},async wait(t){return new Promise(e=>{setTimeout(e,t)})},debounce(t,e=500){let s;return(...n)=>{function i(){t(...n)}s&&clearTimeout(s),s=setTimeout(i,e)}},isHttpUrl(t){return t.startsWith("http://")||t.startsWith("https://")},formatNativeUrl(t,e,s=null){if(j.isHttpUrl(t))return this.formatUniversalUrl(t,e);let n=t,i=s;n.includes("://")||(n=t.replaceAll("/","").replaceAll(":",""),n=`${n}://`),n.endsWith("/")||(n=`${n}/`),i&&!(i!=null&&i.endsWith("/"))&&(i=`${i}/`),this.isTelegram()&&this.isAndroid()&&(e=encodeURIComponent(e));const r=encodeURIComponent(e);return{redirect:`${n}wc?uri=${r}`,redirectUniversalLink:i?`${i}wc?uri=${r}`:void 0,href:n}},formatUniversalUrl(t,e){if(!j.isHttpUrl(t))return this.formatNativeUrl(t,e);let s=t;s.endsWith("/")||(s=`${s}/`);const n=encodeURIComponent(e);return{redirect:`${s}wc?uri=${n}`,href:s}},getOpenTargetForPlatform(t){return t==="popupWindow"?t:this.isTelegram()?k.getTelegramSocialProvider()?"_top":"_blank":t},openHref(t,e,s){window==null||window.open(t,this.getOpenTargetForPlatform(e),s||"noreferrer noopener")},returnOpenHref(t,e,s){return window==null?void 0:window.open(t,this.getOpenTargetForPlatform(e),s||"noreferrer noopener")},isTelegram(){return typeof window<"u"&&(!!window.TelegramWebviewProxy||!!window.Telegram||!!window.TelegramWebviewProxyProto)},isPWA(){var s,n;if(typeof window>"u")return!1;const t=window!=null&&window.matchMedia&&typeof window.matchMedia=="function"?(s=window.matchMedia("(display-mode: standalone)"))==null?void 0:s.matches:!1,e=(n=window==null?void 0:window.navigator)==null?void 0:n.standalone;return!!(t||e)},async preloadImage(t){const e=new Promise((s,n)=>{const i=new Image;i.onload=s,i.onerror=n,i.crossOrigin="anonymous",i.src=t});return Promise.race([e,j.wait(2e3)])},parseBalance(t,e){let s="0.000";if(typeof t=="string"){const c=Number(t);if(!isNaN(c)){const l=(Math.floor(c*1e3)/1e3).toFixed(3);l&&(s=l)}}const[n,i]=s.split("."),r=n||"0",o=i||"000";return{formattedText:`${r}.${o}${e?` ${e}`:""}`,value:r,decimals:o,symbol:e}},getApiUrl(){return I.W3M_API_URL},getBlockchainApiUrl(){return I.BLOCKCHAIN_API_RPC_URL},getAnalyticsUrl(){return I.PULSE_API_URL},getUUID(){return crypto!=null&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/gu,t=>{const e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)})},parseError(t){var e,s;return typeof t=="string"?t:typeof((s=(e=t==null?void 0:t.issues)==null?void 0:e[0])==null?void 0:s.message)=="string"?t.issues[0].message:t instanceof Error?t.message:"Unknown error"},sortRequestedNetworks(t,e=[]){const s={};return e&&t&&(t.forEach((n,i)=>{s[n]=i}),e.sort((n,i)=>{const r=s[n.id],o=s[i.id];return r!==void 0&&o!==void 0?r-o:r!==void 0?-1:o!==void 0?1:0})),e},calculateBalance(t){var s;let e=0;for(const n of t)e+=(s=n.value)!=null?s:0;return e},formatTokenBalance(t){const e=t.toFixed(2),[s,n]=e.split(".");return{dollars:s,pennies:n}},isAddress(t,e="eip155"){switch(e){case"eip155":if(/^(?:0x)?[0-9a-f]{40}$/iu.test(t)){if(/^(?:0x)?[0-9a-f]{40}$/iu.test(t)||/^(?:0x)?[0-9A-F]{40}$/iu.test(t))return!0}else return!1;return!1;case"solana":return/[1-9A-HJ-NP-Za-km-z]{32,44}$/iu.test(t);case"bip122":{const s=/^[1][a-km-zA-HJ-NP-Z1-9]{25,34}$/u.test(t),n=/^[3][a-km-zA-HJ-NP-Z1-9]{25,34}$/u.test(t),i=/^bc1[a-z0-9]{39,87}$/u.test(t),r=/^bc1p[a-z0-9]{58}$/u.test(t);return s||n||i||r}default:return!1}},uniqueBy(t,e){const s=new Set;return t.filter(n=>{const i=n[e];return s.has(i)?!1:(s.add(i),!0)})},generateSdkVersion(t,e,s){const i=t.length===0?le.ADAPTER_TYPES.UNIVERSAL:t.map(r=>r.adapterType).join(",");return`${e}-${i}-${s}`},createAccount(t,e,s,n,i){return{namespace:t,address:e,type:s,publicKey:n,path:i}},isCaipAddress(t){if(typeof t!="string")return!1;const e=t.split(":"),s=e[0];return e.filter(Boolean).length===3&&s in I.CHAIN_NAME_MAP},getAccount(t){return t?typeof t=="string"?{address:t,chainId:void 0}:{address:t.address,chainId:t.chainId}:{address:void 0,chainId:void 0}},isMac(){const t=window==null?void 0:window.navigator.userAgent.toLowerCase();return t.includes("macintosh")&&!t.includes("safari")},formatTelegramSocialLoginUrl(t){const e=`--${encodeURIComponent(window==null?void 0:window.location.href)}`,s="state=";if(new URL(t).host==="auth.magic.link"){const i="provider_authorization_url=",r=t.substring(t.indexOf(i)+i.length),o=this.injectIntoUrl(decodeURIComponent(r),s,e);return t.replace(r,encodeURIComponent(o))}return this.injectIntoUrl(t,s,e)},injectIntoUrl(t,e,s){const n=t.indexOf(e);if(n===-1)throw new Error(`${e} parameter not found in the URL: ${t}`);const i=t.indexOf("&",n),r=e.length,o=i!==-1?i:t.length,a=t.substring(0,n+r),c=t.substring(n+r,o),l=t.substring(i),d=c+s;return a+d+l},isNumber(t){return typeof t!="number"&&typeof t!="string"?!1:!isNaN(Number(t))}},Cr={STORAGE_KEY:"@appkit-wallet/",SMART_ACCOUNT_ENABLED_NETWORKS:"SMART_ACCOUNT_ENABLED_NETWORKS"},Is={SAFE_RPC_METHODS:["eth_accounts","eth_blockNumber","eth_call","eth_chainId","eth_estimateGas","eth_feeHistory","eth_gasPrice","eth_getAccount","eth_getBalance","eth_getBlockByHash","eth_getBlockByNumber","eth_getBlockReceipts","eth_getBlockTransactionCountByHash","eth_getBlockTransactionCountByNumber","eth_getCode","eth_getFilterChanges","eth_getFilterLogs","eth_getLogs","eth_getProof","eth_getStorageAt","eth_getTransactionByBlockHashAndIndex","eth_getTransactionByBlockNumberAndIndex","eth_getTransactionByHash","eth_getTransactionCount","eth_getTransactionReceipt","eth_getUncleCountByBlockHash","eth_getUncleCountByBlockNumber","eth_maxPriorityFeePerGas","eth_newBlockFilter","eth_newFilter","eth_newPendingTransactionFilter","eth_sendRawTransaction","eth_syncing","eth_uninstallFilter","wallet_getCapabilities","wallet_getCallsStatus","eth_getUserOperationReceipt","eth_estimateUserOperationGas","eth_getUserOperationByHash","eth_supportedEntryPoints","wallet_getAssets"],NOT_SAFE_RPC_METHODS:["personal_sign","eth_signTypedData_v4","eth_sendTransaction","solana_signMessage","solana_signTransaction","solana_signAllTransactions","solana_signAndSendTransaction","wallet_sendCalls","wallet_grantPermissions","wallet_revokePermissions","eth_sendUserOperation"],GET_CHAIN_ID:"eth_chainId",RPC_METHOD_NOT_ALLOWED_MESSAGE:"Requested RPC call is not allowed",RPC_METHOD_NOT_ALLOWED_UI_MESSAGE:"Action not allowed",ACCOUNT_TYPES:{EOA:"eoa",SMART_ACCOUNT:"smartAccount"}},Zp={set(t,e){ho.isClient&&localStorage.setItem(`${Cr.STORAGE_KEY}${t}`,e)},get(t){return ho.isClient?localStorage.getItem(`${Cr.STORAGE_KEY}${t}`):null},delete(t,e){ho.isClient&&(e?localStorage.removeItem(t):localStorage.removeItem(`${Cr.STORAGE_KEY}${t}`))}},ho={isClient:typeof window<"u"};async function li(...t){const e=await fetch(...t);if(!e.ok)throw new Error(`HTTP status code: ${e.status}`,{cause:e});return e}class zi{constructor({baseUrl:e,clientId:s}){this.baseUrl=e,this.clientId=s}async get({headers:e,signal:s,cache:n,...i}){const r=this.createUrl(i);return(await li(r,{method:"GET",headers:e,signal:s,cache:n})).json()}async getBlob({headers:e,signal:s,...n}){const i=this.createUrl(n);return(await li(i,{method:"GET",headers:e,signal:s})).blob()}async post({body:e,headers:s,signal:n,...i}){const r=this.createUrl(i);return(await li(r,{method:"POST",headers:s,body:e?JSON.stringify(e):void 0,signal:n})).json()}async put({body:e,headers:s,signal:n,...i}){const r=this.createUrl(i);return(await li(r,{method:"PUT",headers:s,body:e?JSON.stringify(e):void 0,signal:n})).json()}async delete({body:e,headers:s,signal:n,...i}){const r=this.createUrl(i);return(await li(r,{method:"DELETE",headers:s,body:e?JSON.stringify(e):void 0,signal:n})).json()}createUrl({path:e,params:s}){const n=new URL(e,this.baseUrl);return s&&Object.entries(s).forEach(([i,r])=>{r&&n.searchParams.append(i,r)}),this.clientId&&n.searchParams.append("clientId",this.clientId),n}sendBeacon({body:e,...s}){const n=this.createUrl(s);return navigator.sendBeacon(n.toString(),e?JSON.stringify(e):void 0)}}const Jo={getFeatureValue(t,e){const s=e==null?void 0:e[t];return s===void 0?le.DEFAULT_FEATURES[t]:s},filterSocialsByPlatform(t){if(!t||!t.length)return t;let e=t;return j.isTelegram()&&(j.isIos()&&(e=e.filter(s=>s!=="google")),j.isMac()&&(e=e.filter(s=>s!=="x")),j.isAndroid()&&(e=e.filter(s=>!["facebook","x"].includes(s)))),j.isMobile()&&(e=e.filter(s=>s!=="facebook")),e},isSocialsEnabled(){var t,e,s,n;return Array.isArray((t=_.state.features)==null?void 0:t.socials)&&((e=_.state.features)==null?void 0:e.socials.length)>0||Array.isArray((s=_.state.remoteFeatures)==null?void 0:s.socials)&&((n=_.state.remoteFeatures)==null?void 0:n.socials.length)>0},isEmailEnabled(){var t,e;return!!((t=_.state.features)!=null&&t.email||(e=_.state.remoteFeatures)!=null&&e.email)}},Q=xe({features:le.DEFAULT_FEATURES,projectId:"",sdkType:"appkit",sdkVersion:"html-wagmi-undefined",defaultAccountTypes:le.DEFAULT_ACCOUNT_TYPES,enableNetworkSwitch:!0,experimental_preferUniversalLinks:!1,remoteFeatures:{},enableMobileFullScreen:!1,coinbasePreference:"all"}),_={state:Q,subscribeKey(t,e){return Ze(Q,t,e)},setOptions(t){Object.assign(Q,t)},setRemoteFeatures(t){var s,n;if(!t)return;const e={...Q.remoteFeatures,...t};Q.remoteFeatures=e,(s=Q.remoteFeatures)!=null&&s.socials&&(Q.remoteFeatures.socials=Jo.filterSocialsByPlatform(Q.remoteFeatures.socials)),(n=Q.features)!=null&&n.pay&&(Q.remoteFeatures.email=!1,Q.remoteFeatures.socials=!1)},setFeatures(t){var s;if(!t)return;Q.features||(Q.features=le.DEFAULT_FEATURES);const e={...Q.features,...t};Q.features=e,(s=Q.features)!=null&&s.pay&&Q.remoteFeatures&&(Q.remoteFeatures.email=!1,Q.remoteFeatures.socials=!1)},setProjectId(t){Q.projectId=t},setCustomRpcUrls(t){Q.customRpcUrls=t},setAllWallets(t){Q.allWallets=t},setIncludeWalletIds(t){Q.includeWalletIds=t},setExcludeWalletIds(t){Q.excludeWalletIds=t},setFeaturedWalletIds(t){Q.featuredWalletIds=t},setTokens(t){Q.tokens=t},setTermsConditionsUrl(t){Q.termsConditionsUrl=t},setPrivacyPolicyUrl(t){Q.privacyPolicyUrl=t},setCustomWallets(t){Q.customWallets=t},setIsSiweEnabled(t){Q.isSiweEnabled=t},setIsUniversalProvider(t){Q.isUniversalProvider=t},setSdkVersion(t){Q.sdkVersion=t},setMetadata(t){Q.metadata=t},setDisableAppend(t){Q.disableAppend=t},setEIP6963Enabled(t){Q.enableEIP6963=t},setDebug(t){Q.debug=t},setEnableWalletGuide(t){Q.enableWalletGuide=t},setEnableAuthLogger(t){Q.enableAuthLogger=t},setEnableWallets(t){Q.enableWallets=t},setPreferUniversalLinks(t){Q.experimental_preferUniversalLinks=t},setSIWX(t){var e;if(t)for(const[s,n]of Object.entries(le.SIWX_DEFAULTS))(e=t[s])!=null||(t[s]=n);Q.siwx=t},setConnectMethodsOrder(t){Q.features={...Q.features,connectMethodsOrder:t}},setWalletFeaturesOrder(t){Q.features={...Q.features,walletFeaturesOrder:t}},setSocialsOrder(t){Q.remoteFeatures={...Q.remoteFeatures,socials:t}},setCollapseWallets(t){Q.features={...Q.features,collapseWallets:t}},setEnableEmbedded(t){Q.enableEmbedded=t},setAllowUnsupportedChain(t){Q.allowUnsupportedChain=t},setManualWCControl(t){Q.manualWCControl=t},setEnableNetworkSwitch(t){Q.enableNetworkSwitch=t},setEnableMobileFullScreen(t){Q.enableMobileFullScreen=j.isMobile()&&t},setEnableReconnect(t){Q.enableReconnect=t},setCoinbasePreference(t){Q.coinbasePreference=t},setDefaultAccountTypes(t={}){Object.entries(t).forEach(([e,s])=>{s&&(Q.defaultAccountTypes[e]=s)})},setUniversalProviderConfigOverride(t){Q.universalProviderConfigOverride=t},getUniversalProviderConfigOverride(){return Q.universalProviderConfigOverride},getSnapshot(){return Li(Q)}},ln=Object.freeze({message:"",variant:"success",svg:void 0,open:!1,autoClose:!0}),Fe=xe({...ln}),Qp={state:Fe,subscribeKey(t,e){return Ze(Fe,t,e)},showLoading(t,e={}){this._showMessage({message:t,variant:"loading",...e})},showSuccess(t){this._showMessage({message:t,variant:"success"})},showSvg(t,e){this._showMessage({message:t,svg:e})},showError(t){const e=j.parseError(t);this._showMessage({message:e,variant:"error"})},hide(){Fe.message=ln.message,Fe.variant=ln.variant,Fe.svg=ln.svg,Fe.open=ln.open,Fe.autoClose=ln.autoClose},_showMessage({message:t,svg:e,variant:s="success",autoClose:n=ln.autoClose}){Fe.open?(Fe.open=!1,setTimeout(()=>{Fe.message=t,Fe.variant=s,Fe.svg=e,Fe.open=!0,Fe.autoClose=n},150)):(Fe.message=t,Fe.variant=s,Fe.svg=e,Fe.open=!0,Fe.autoClose=n)}},as=Qp,ef={purchaseCurrencies:[{id:"2b92315d-eab7-5bef-84fa-089a131333f5",name:"USD Coin",symbol:"USDC",networks:[{name:"ethereum-mainnet",display_name:"Ethereum",chain_id:"1",contract_address:"0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48"},{name:"polygon-mainnet",display_name:"Polygon",chain_id:"137",contract_address:"0x2791Bca1f2de4661ED88A30C99A7a9449Aa84174"}]},{id:"2b92315d-eab7-5bef-84fa-089a131333f5",name:"Ether",symbol:"ETH",networks:[{name:"ethereum-mainnet",display_name:"Ethereum",chain_id:"1",contract_address:"0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48"},{name:"polygon-mainnet",display_name:"Polygon",chain_id:"137",contract_address:"0x2791Bca1f2de4661ED88A30C99A7a9449Aa84174"}]}],paymentCurrencies:[{id:"USD",payment_method_limits:[{id:"card",min:"10.00",max:"7500.00"},{id:"ach_bank_account",min:"10.00",max:"25000.00"}]},{id:"EUR",payment_method_limits:[{id:"card",min:"10.00",max:"7500.00"},{id:"ach_bank_account",min:"10.00",max:"25000.00"}]}]},th=j.getBlockchainApiUrl(),rt=xe({clientId:null,api:new zi({baseUrl:th,clientId:null}),supportedChains:{http:[],ws:[]}}),te={state:rt,async get(t){const{st:e,sv:s}=te.getSdkProperties(),n=_.state.projectId,i={...t.params||{},st:e,sv:s,projectId:n};return rt.api.get({...t,params:i})},getSdkProperties(){const{sdkType:t,sdkVersion:e}=_.state;return{st:t||"unknown",sv:e||"unknown"}},async isNetworkSupported(t){if(!t)return!1;try{rt.supportedChains.http.length||await te.getSupportedNetworks()}catch{return!1}return rt.supportedChains.http.includes(t)},async getSupportedNetworks(){try{const t=await te.get({path:"v1/supported-chains"});return rt.supportedChains=t,t}catch{return rt.supportedChains}},async fetchIdentity({address:t}){const e=k.getIdentityFromCacheForAddress(t);if(e)return e;const s=await te.get({path:`/v1/identity/${t}`,params:{sender:f.state.activeCaipAddress?j.getPlainAddress(f.state.activeCaipAddress):void 0}});return k.updateIdentityCache({address:t,identity:s,timestamp:Date.now()}),s},async fetchTransactions({account:t,cursor:e,signal:s,cache:n,chainId:i}){var c;if(!await te.isNetworkSupported((c=f.state.activeCaipNetwork)==null?void 0:c.caipNetworkId))return{data:[],next:void 0};const o=k.getTransactionsCacheForAddress({address:t,chainId:i});if(o)return o;const a=await te.get({path:`/v1/account/${t}/history`,params:{cursor:e,chainId:i},signal:s,cache:n});return k.updateTransactionsCache({address:t,chainId:i,timestamp:Date.now(),transactions:a}),a},async fetchSwapQuote({amount:t,userAddress:e,from:s,to:n,gasPrice:i}){var o;return await te.isNetworkSupported((o=f.state.activeCaipNetwork)==null?void 0:o.caipNetworkId)?te.get({path:"/v1/convert/quotes",headers:{"Content-Type":"application/json"},params:{amount:t,userAddress:e,from:s,to:n,gasPrice:i}}):{quotes:[]}},async fetchSwapTokens({chainId:t}){var s;return await te.isNetworkSupported((s=f.state.activeCaipNetwork)==null?void 0:s.caipNetworkId)?te.get({path:"/v1/convert/tokens",params:{chainId:t}}):{tokens:[]}},async getAddressBalance({caipNetworkId:t,address:e}){return rt.api.post({path:`/v1?chainId=${t}&projectId=${_.state.projectId}`,body:{id:"1",jsonrpc:"2.0",method:"getAddressBalance",params:{address:e}}}).then(s=>s.result)},async fetchTokenPrice({addresses:t,caipNetworkId:e=(s=>(s=f.state.activeCaipNetwork)==null?void 0:s.caipNetworkId)()}){if(!await te.isNetworkSupported(e))return{fungibles:[]};const i=k.getTokenPriceCacheForAddresses(t);if(i)return i;const r=await rt.api.post({path:"/v1/fungible/price",body:{currency:"usd",addresses:t,projectId:_.state.projectId},headers:{"Content-Type":"application/json"}});return k.updateTokenPriceCache({addresses:t,timestamp:Date.now(),tokenPrice:r}),r},async fetchSwapAllowance({tokenAddress:t,userAddress:e}){var n;return await te.isNetworkSupported((n=f.state.activeCaipNetwork)==null?void 0:n.caipNetworkId)?te.get({path:"/v1/convert/allowance",params:{tokenAddress:t,userAddress:e},headers:{"Content-Type":"application/json"}}):{allowance:"0"}},async fetchGasPrice({chainId:t}){var i;const{st:e,sv:s}=te.getSdkProperties();if(!await te.isNetworkSupported((i=f.state.activeCaipNetwork)==null?void 0:i.caipNetworkId))throw new Error("Network not supported for Gas Price");return te.get({path:"/v1/convert/gas-price",headers:{"Content-Type":"application/json"},params:{chainId:t,st:e,sv:s}})},async generateSwapCalldata({amount:t,from:e,to:s,userAddress:n,disableEstimate:i}){var o;if(!await te.isNetworkSupported((o=f.state.activeCaipNetwork)==null?void 0:o.caipNetworkId))throw new Error("Network not supported for Swaps");return rt.api.post({path:"/v1/convert/build-transaction",headers:{"Content-Type":"application/json"},body:{amount:t,eip155:{slippage:le.CONVERT_SLIPPAGE_TOLERANCE},projectId:_.state.projectId,from:e,to:s,userAddress:n,disableEstimate:i}})},async generateApproveCalldata({from:t,to:e,userAddress:s}){var o;const{st:n,sv:i}=te.getSdkProperties();if(!await te.isNetworkSupported((o=f.state.activeCaipNetwork)==null?void 0:o.caipNetworkId))throw new Error("Network not supported for Swaps");return te.get({path:"/v1/convert/build-approve",headers:{"Content-Type":"application/json"},params:{userAddress:s,from:t,to:e,st:n,sv:i}})},async getBalance(t,e,s){var l;const{st:n,sv:i}=te.getSdkProperties();if(!await te.isNetworkSupported((l=f.state.activeCaipNetwork)==null?void 0:l.caipNetworkId))return as.showError("Token Balance Unavailable"),{balances:[]};const o=`${e}:${t}`,a=k.getBalanceCacheForCaipAddress(o);if(a)return a;const c=await te.get({path:`/v1/account/${t}/balance`,params:{currency:"usd",chainId:e,forceUpdate:s,st:n,sv:i}});return k.updateBalanceCache({caipAddress:o,balance:c,timestamp:Date.now()}),c},async lookupEnsName(t){var s;return await te.isNetworkSupported((s=f.state.activeCaipNetwork)==null?void 0:s.caipNetworkId)?te.get({path:`/v1/profile/account/${t}`,params:{apiVersion:"2"}}):{addresses:{},attributes:[]}},async reverseLookupEnsName({address:t}){var n,i;if(!await te.isNetworkSupported((n=f.state.activeCaipNetwork)==null?void 0:n.caipNetworkId))return[];const s=(i=f.getAccountData())==null?void 0:i.address;return te.get({path:`/v1/profile/reverse/${t}`,params:{sender:s,apiVersion:"2"}})},async getEnsNameSuggestions(t){var s;return await te.isNetworkSupported((s=f.state.activeCaipNetwork)==null?void 0:s.caipNetworkId)?te.get({path:`/v1/profile/suggestions/${t}`,params:{zone:"reown.id"}}):{suggestions:[]}},async registerEnsName({coinType:t,address:e,message:s,signature:n}){var r;return await te.isNetworkSupported((r=f.state.activeCaipNetwork)==null?void 0:r.caipNetworkId)?rt.api.post({path:"/v1/profile/account",body:{coin_type:t,address:e,message:s,signature:n},headers:{"Content-Type":"application/json"}}):{success:!1}},async generateOnRampURL({destinationWallets:t,partnerUserId:e,defaultNetwork:s,purchaseAmount:n,paymentAmount:i}){var a;return await te.isNetworkSupported((a=f.state.activeCaipNetwork)==null?void 0:a.caipNetworkId)?(await rt.api.post({path:"/v1/generators/onrampurl",params:{projectId:_.state.projectId},body:{destinationWallets:t,defaultNetwork:s,partnerUserId:e,defaultExperience:"buy",presetCryptoAmount:n,presetFiatAmount:i}})).url:""},async getOnrampOptions(){var e;if(!await te.isNetworkSupported((e=f.state.activeCaipNetwork)==null?void 0:e.caipNetworkId))return{paymentCurrencies:[],purchaseCurrencies:[]};try{return await te.get({path:"/v1/onramp/options"})}catch{return ef}},async getOnrampQuote({purchaseCurrency:t,paymentCurrency:e,amount:s,network:n}){var i;try{return await te.isNetworkSupported((i=f.state.activeCaipNetwork)==null?void 0:i.caipNetworkId)?await rt.api.post({path:"/v1/onramp/quote",params:{projectId:_.state.projectId},body:{purchaseCurrency:t,paymentCurrency:e,amount:s,network:n}}):null}catch{return{networkFee:{amount:s,currency:e.id},paymentSubtotal:{amount:s,currency:e.id},paymentTotal:{amount:s,currency:e.id},purchaseAmount:{amount:s,currency:e.id},quoteId:"mocked-quote-id"}}},async getSmartSessions(t){var s;return await te.isNetworkSupported((s=f.state.activeCaipNetwork)==null?void 0:s.caipNetworkId)?te.get({path:`/v1/sessions/${t}`}):[]},async revokeSmartSession(t,e,s){var i;return await te.isNetworkSupported((i=f.state.activeCaipNetwork)==null?void 0:i.caipNetworkId)?rt.api.post({path:`/v1/sessions/${t}/revoke`,params:{projectId:_.state.projectId},body:{pci:e,signature:s}}):{success:!1}},setClientId(t){rt.clientId=t,rt.api=new zi({baseUrl:th,clientId:t})}},tf=Object.freeze({enabled:!0,events:[]}),sf=new zi({baseUrl:j.getAnalyticsUrl(),clientId:null}),nf=5,rf=60*1e3,Rs=xe({...tf}),of={state:Rs,subscribeKey(t,e){return Ze(Rs,t,e)},async sendError(t,e){if(!Rs.enabled)return;const s=Date.now();if(Rs.events.filter(r=>{const o=new Date(r.properties.timestamp||"").getTime();return s-o<rf}).length>=nf)return;const i={type:"error",event:e,properties:{errorType:t.name,errorMessage:t.message,stackTrace:t.stack,timestamp:new Date().toISOString()}};Rs.events.push(i);try{if(typeof window>"u")return;const{projectId:r,sdkType:o,sdkVersion:a}=_.state;await sf.post({path:"/e",params:{projectId:r,st:o,sv:a||"html-wagmi-4.2.2"},body:{eventId:j.getUUID(),url:window.location.href,domain:window.location.hostname,timestamp:new Date().toISOString(),props:{type:"error",event:e,errorType:t.name,errorMessage:t.message,stackTrace:t.stack}}})}catch{}},enable(){Rs.enabled=!0},disable(){Rs.enabled=!1},clearEvents(){Rs.events=[]}};class An extends Error{constructor(e,s,n){super(e),this.originalName="AppKitError",this.name="AppKitError",this.category=s,this.originalError=n,n&&n instanceof Error&&(this.originalName=n.name),Object.setPrototypeOf(this,An.prototype);let i=!1;if(n instanceof Error&&typeof n.stack=="string"&&n.stack){const r=n.stack,o=r.indexOf(`
`);if(o>-1){const a=r.substring(o+1);this.stack=`${this.name}: ${this.message}
${a}`,i=!0}}i||(Error.captureStackTrace?Error.captureStackTrace(this,An):this.stack||(this.stack=`${this.name}: ${this.message}`))}}function Nc(t,e){let s="";try{t instanceof Error?s=t.message:typeof t=="string"?s=t:typeof t=="object"&&t!==null?Object.keys(t).length===0?s="Unknown error":s=(t==null?void 0:t.message)||JSON.stringify(t):s=String(t)}catch(i){s="Unknown error",console.error("Error parsing error message",i)}const n=t instanceof An?t:new An(s,e,t);throw of.sendError(n,n.category),n}function Wt(t,e="INTERNAL_SDK_ERROR"){const s={};return Object.keys(t).forEach(n=>{const i=t[n];if(typeof i=="function"){let r=i;i.constructor.name==="AsyncFunction"?r=async(...o)=>{try{return await i(...o)}catch(a){return Nc(a,e)}}:r=(...o)=>{try{return i(...o)}catch(a){return Nc(a,e)}},s[n]=r}else s[n]=i}),s}const wt=xe({walletImages:{},networkImages:{},chainImages:{},connectorImages:{},tokenImages:{},currencyImages:{}}),af={state:wt,subscribeNetworkImages(t){return Xe(wt.networkImages,()=>t(wt.networkImages))},subscribeKey(t,e){return Ze(wt,t,e)},subscribe(t){return Xe(wt,()=>t(wt))},setWalletImage(t,e){wt.walletImages[t]=e},setNetworkImage(t,e){wt.networkImages[t]=e},setChainImage(t,e){wt.chainImages[t]=e},setConnectorImage(t,e){wt.connectorImages={...wt.connectorImages,[t]:e}},setTokenImage(t,e){wt.tokenImages[t]=e},setCurrencyImage(t,e){wt.currencyImages[t]=e}},Lt=Wt(af),_c={eip155:"ba0ba0cd-17c6-4806-ad93-f9d174f17900",solana:"a1b58899-f671-4276-6a5e-56ca5bd59700",polkadot:"",bip122:"0b4838db-0161-4ffe-022d-532bf03dba00",cosmos:"",sui:"",stacks:"",ton:"20f673c0-095e-49b2-07cf-eb5049dcf600"},$n=xe({networkImagePromises:{},tokenImagePromises:{}}),Pr={async fetchWalletImage(t){if(t)return await z._fetchWalletImage(t),this.getWalletImageById(t)},async fetchNetworkImage(t){if(!t)return;const e=this.getNetworkImageById(t);return e||($n.networkImagePromises[t]||($n.networkImagePromises[t]=z._fetchNetworkImage(t)),await $n.networkImagePromises[t],this.getNetworkImageById(t))},async fetchTokenImage(t){if(t)return $n.tokenImagePromises[t]||($n.tokenImagePromises[t]=z._fetchTokenImage(t)),await $n.tokenImagePromises[t],this.getTokenImage(t)},getWalletImageById(t){if(t)return Lt.state.walletImages[t]},getWalletImage(t){if(t!=null&&t.image_url)return t==null?void 0:t.image_url;if(t!=null&&t.image_id)return Lt.state.walletImages[t.image_id]},getNetworkImage(t){var e,s,n;if((e=t==null?void 0:t.assets)!=null&&e.imageUrl)return(s=t==null?void 0:t.assets)==null?void 0:s.imageUrl;if((n=t==null?void 0:t.assets)!=null&&n.imageId)return Lt.state.networkImages[t.assets.imageId]},getNetworkImageById(t){if(t)return Lt.state.networkImages[t]},getConnectorImage(t){var e;if(t!=null&&t.imageUrl)return t.imageUrl;if((e=t==null?void 0:t.info)!=null&&e.icon)return t.info.icon;if(t!=null&&t.imageId)return Lt.state.connectorImages[t.imageId]},getChainImage(t){return Lt.state.networkImages[_c[t]]},getTokenImage(t){if(t)return Lt.state.tokenImages[t]},getWalletImageUrl(t){if(!t)return"";const{projectId:e,sdkType:s,sdkVersion:n}=_.state,i=new URL(`${I.W3M_API_URL}/getWalletImage/${t}`);return i.searchParams.set("projectId",e),i.searchParams.set("st",s),i.searchParams.set("sv",n),i.toString()},getAssetImageUrl(t){if(!t)return"";const{projectId:e,sdkType:s,sdkVersion:n}=_.state,i=new URL(`${I.W3M_API_URL}/public/getAssetImage/${t}`);return i.searchParams.set("projectId",e),i.searchParams.set("st",s),i.searchParams.set("sv",n),i.toString()},getChainNamespaceImageUrl(t){return this.getAssetImageUrl(_c[t])},async getImageByToken(t,e){var n,i;if(t==="native"){const r=(n=I.NATIVE_IMAGE_IDS_BY_NAMESPACE[e])!=null?n:null;return r?Pr.fetchNetworkImage(r):void 0}const[,s]=(i=Object.entries(I.TOKEN_SYMBOLS_BY_ADDRESS).find(([r])=>r.toLowerCase()===t.toLowerCase()))!=null?i:[];if(s)return Pr.fetchTokenImage(s)}},Ut={PHANTOM:{id:"a797aa35c0fadbfc1a53e7f675162ed5226968b44a19ee3d24385c64d1d3c393",url:"https://phantom.app"},SOLFLARE:{id:"1ca0bdd4747578705b1939af023d120677c64fe6ca76add81fda36e350605e79",url:"https://solflare.com"},COINBASE:{id:"fd20dc426fb37566d803205b19bbc1d4096b248ac04548e3cfb6b3a38bd033aa",url:"https://go.cb-w.com"},BINANCE:{id:"2fafea35bb471d22889ccb49c08d99dd0a18a37982602c33f696a5723934ba25",appId:"yFK5FCqYprrXDiVFbhyRx7",deeplink:"bnc://app.binance.com/mp/app",url:"https://app.binance.com/en/download"}},cf={handleMobileDeeplinkRedirect(t,e){var i;const s=window.location.href,n=encodeURIComponent(s);if(t===Ut.PHANTOM.id&&!("phantom"in window)){const r=s.startsWith("https")?"https":"http",o=s.split("/")[2],a=encodeURIComponent(`${r}://${o}`);window.location.href=`${Ut.PHANTOM.url}/ul/browse/${n}?ref=${a}`}if(t===Ut.SOLFLARE.id&&!("solflare"in window)&&(window.location.href=`${Ut.SOLFLARE.url}/ul/v1/browse/${n}?ref=${n}`),e===I.CHAIN.SOLANA&&t===Ut.COINBASE.id&&!("coinbaseSolana"in window)&&(window.location.href=`${Ut.COINBASE.url}/dapp?cb_url=${n}`),e===I.CHAIN.BITCOIN&&t===Ut.BINANCE.id&&!("binancew3w"in window)){const r=f.state.activeCaipNetwork,o=window.btoa("/pages/browser/index"),a=window.btoa(`url=${n}&defaultChainId=${(i=r==null?void 0:r.id)!=null?i:1}`),c=new URL(Ut.BINANCE.deeplink);c.searchParams.set("appId",Ut.BINANCE.appId),c.searchParams.set("startPagePath",o),c.searchParams.set("startPageQuery",a);const l=new URL(Ut.BINANCE.url);l.searchParams.set("_dp",window.btoa(c.toString())),window.location.href=l.toString()}}},lf=j.getAnalyticsUrl(),df=new zi({baseUrl:lf,clientId:null}),hf=["MODAL_CREATED"],uf=45,Sc=1e3*10,Ue=xe({timestamp:Date.now(),lastFlush:Date.now(),reportedErrors:{},data:{type:"track",event:"MODAL_CREATED"},pendingEvents:[],subscribedToVisibilityChange:!1,walletImpressions:[]}),oe={state:Ue,subscribe(t){return Xe(Ue,()=>t(Ue))},getSdkProperties(){const{projectId:t,sdkType:e,sdkVersion:s}=_.state;return{projectId:t,st:e,sv:s||"html-wagmi-4.2.2"}},shouldFlushEvents(){const t=JSON.stringify(Ue.pendingEvents).length/1024>uf,e=Ue.lastFlush+Sc<Date.now();return t||e},_setPendingEvent(t){var e,s;try{let n=(e=f.getAccountData())==null?void 0:e.address;if("address"in t.data&&t.data.address&&(n=t.data.address),hf.includes(t.data.event)||typeof window>"u")return;const i=(s=f.getActiveCaipNetwork())==null?void 0:s.caipNetworkId;this.state.pendingEvents.push({eventId:j.getUUID(),url:window.location.href,domain:window.location.hostname,timestamp:t.timestamp,props:{...t.data,address:n,properties:{..."properties"in t.data?t.data.properties:{},caipNetworkId:i}}}),Ue.reportedErrors.FORBIDDEN=!1,oe.shouldFlushEvents()&&oe._submitPendingEvents()}catch(n){console.warn("_setPendingEvent",n)}},sendEvent(t){var s;Ue.timestamp=Date.now(),Ue.data=t;const e=["INITIALIZE","CONNECT_SUCCESS","SOCIAL_LOGIN_SUCCESS"];((s=_.state.features)!=null&&s.analytics||e.includes(t.event))&&oe._setPendingEvent(Ue),this.subscribeToFlushTriggers()},sendWalletImpressionEvent(t){Ue.walletImpressions.push(t)},_transformPendingEventsForBatch(t){try{return t.filter(e=>e.props.event!=="WALLET_IMPRESSION_V2")}catch{return t}},_submitPendingEvents(){if(Ue.lastFlush=Date.now(),!(Ue.pendingEvents.length===0&&Ue.walletImpressions.length===0))try{const t=oe._transformPendingEventsForBatch(Ue.pendingEvents);Ue.walletImpressions.length&&t.push({eventId:j.getUUID(),url:window.location.href,domain:window.location.hostname,timestamp:Date.now(),props:{type:"track",event:"WALLET_IMPRESSION_V2",items:[...Ue.walletImpressions]}}),df.sendBeacon({path:"/batch",params:oe.getSdkProperties(),body:t}),Ue.reportedErrors.FORBIDDEN=!1,Ue.pendingEvents=[],Ue.walletImpressions=[]}catch{Ue.reportedErrors.FORBIDDEN=!0}},subscribeToFlushTriggers(){var t,e,s;Ue.subscribedToVisibilityChange||typeof document>"u"||(Ue.subscribedToVisibilityChange=!0,(t=document==null?void 0:document.addEventListener)==null||t.call(document,"visibilitychange",()=>{document.visibilityState==="hidden"&&oe._submitPendingEvents()}),(e=document==null?void 0:document.addEventListener)==null||e.call(document,"freeze",()=>{oe._submitPendingEvents()}),(s=window==null?void 0:window.addEventListener)==null||s.call(window,"pagehide",()=>{oe._submitPendingEvents()}),setInterval(()=>{oe._submitPendingEvents()},Sc))}},pf=j.getApiUrl(),ot=new zi({baseUrl:pf,clientId:null}),ff=40,Tc=4,gf=20,ie=xe({promises:{},page:1,count:0,featured:[],allFeatured:[],recommended:[],allRecommended:[],wallets:[],filteredWallets:[],search:[],isAnalyticsEnabled:!1,excludedWallets:[],isFetchingRecommendedWallets:!1,explorerWallets:[],explorerFilteredWallets:[],plan:{tier:"none",hasExceededUsageLimit:!1,limits:{isAboveRpcLimit:!1,isAboveMauLimit:!1}}}),z={state:ie,subscribeKey(t,e){return Ze(ie,t,e)},_getSdkProperties(){const{projectId:t,sdkType:e,sdkVersion:s}=_.state;return{projectId:t,st:e||"appkit",sv:s||"html-wagmi-4.2.2"}},_filterOutExtensions(t){return _.state.isUniversalProvider?t.filter(e=>!!(e.mobile_link||e.desktop_link||e.webapp_link)):t},async _fetchWalletImage(t){const e=`${ot.baseUrl}/getWalletImage/${t}`,s=await ot.getBlob({path:e,params:z._getSdkProperties()});Lt.setWalletImage(t,URL.createObjectURL(s))},async _fetchNetworkImage(t){const e=`${ot.baseUrl}/public/getAssetImage/${t}`,s=await ot.getBlob({path:e,params:z._getSdkProperties()});Lt.setNetworkImage(t,URL.createObjectURL(s))},async _fetchConnectorImage(t){const e=`${ot.baseUrl}/public/getAssetImage/${t}`,s=await ot.getBlob({path:e,params:z._getSdkProperties()});Lt.setConnectorImage(t,URL.createObjectURL(s))},async _fetchCurrencyImage(t){const e=`${ot.baseUrl}/public/getCurrencyImage/${t}`,s=await ot.getBlob({path:e,params:z._getSdkProperties()});Lt.setCurrencyImage(t,URL.createObjectURL(s))},async _fetchTokenImage(t){const e=`${ot.baseUrl}/public/getTokenImage/${t}`,s=await ot.getBlob({path:e,params:z._getSdkProperties()});Lt.setTokenImage(t,URL.createObjectURL(s))},_filterWalletsByPlatform(t){const e=t.length,s=j.isMobile()?t==null?void 0:t.filter(i=>i.mobile_link||i.webapp_link?!0:Object.values(Ut).map(o=>o.id).includes(i.id)):t,n=e-s.length;return{filteredWallets:s,mobileFilteredOutWalletsLength:n}},async fetchProjectConfig(){return(await ot.get({path:"/appkit/v1/config",params:z._getSdkProperties()})).features},async fetchUsage(){try{const t=await ot.get({path:"/appkit/v1/project-limits",params:z._getSdkProperties()}),{tier:e,isAboveMauLimit:s,isAboveRpcLimit:n}=t.planLimits,i=e==="starter",r=s||n;z.state.plan={tier:e,hasExceededUsageLimit:i&&r,limits:{isAboveRpcLimit:n,isAboveMauLimit:s}}}catch(t){console.warn("Failed to fetch usage",t)}},async fetchAllowedOrigins(){try{const{allowedOrigins:t}=await ot.get({path:"/projects/v1/origins",params:z._getSdkProperties()});return t}catch(t){if(t instanceof Error&&t.cause instanceof Response){const e=t.cause.status;if(e===I.HTTP_STATUS_CODES.TOO_MANY_REQUESTS)throw new Error("RATE_LIMITED",{cause:t});if(e>=I.HTTP_STATUS_CODES.SERVER_ERROR&&e<600)throw new Error("SERVER_ERROR",{cause:t});return[]}return[]}},async fetchNetworkImages(){const t=f.getAllRequestedCaipNetworks(),e=t==null?void 0:t.map(({assets:s})=>s==null?void 0:s.imageId).filter(Boolean).filter(s=>!Pr.getNetworkImageById(s));e&&await Promise.allSettled(e.map(s=>z._fetchNetworkImage(s)))},async fetchConnectorImages(){const{connectors:t}=U.state,e=t.map(({imageId:s})=>s).filter(Boolean);await Promise.allSettled(e.map(s=>z._fetchConnectorImage(s)))},async fetchCurrencyImages(t=[]){await Promise.allSettled(t.map(e=>z._fetchCurrencyImage(e)))},async fetchTokenImages(t=[]){await Promise.allSettled(t.map(e=>z._fetchTokenImage(e)))},async fetchWallets(t){var o,a;const e=(o=t.exclude)!=null?o:[];z._getSdkProperties().sv.startsWith("html-core-")&&e.push(...Object.values(Ut).map(c=>c.id));const n=await ot.get({path:"/getWallets",params:{...z._getSdkProperties(),...t,page:String(t.page),entries:String(t.entries),include:(a=t.include)==null?void 0:a.join(","),exclude:e.join(",")}}),{filteredWallets:i,mobileFilteredOutWalletsLength:r}=z._filterWalletsByPlatform(n==null?void 0:n.data);return{data:i||[],count:n==null?void 0:n.count,mobileFilteredOutWalletsLength:r}},async prefetchWalletRanks(){const t=U.state.connectors;if(!(t!=null&&t.length))return;const e={page:1,entries:20,badge:"certified"};if(e.names=t.map(i=>i.name).join(","),f.state.activeChain===I.CHAIN.EVM){const i=[...t.flatMap(r=>{var o;return((o=r.connectors)==null?void 0:o.map(a=>{var c;return(c=a.info)==null?void 0:c.rdns}))||[]}),...t.map(r=>{var o;return(o=r.info)==null?void 0:o.rdns})].filter(r=>typeof r=="string"&&r.length>0);i.length&&(e.rdns=i.join(","))}const{data:s}=await z.fetchWallets(e);ie.explorerWallets=s,U.extendConnectorsWithExplorerWallets(s);const n=f.getRequestedCaipNetworkIds().join(",");ie.explorerFilteredWallets=s.filter(i=>{var r;return(r=i.chains)==null?void 0:r.some(o=>n.includes(o))})},async fetchFeaturedWallets(){var e;const{featuredWalletIds:t}=_.state;if(t!=null&&t.length){const s={...z._getSdkProperties(),page:1,entries:(e=t==null?void 0:t.length)!=null?e:Tc,include:t},{data:n}=await z.fetchWallets(s),i=[...n].sort((o,a)=>t.indexOf(o.id)-t.indexOf(a.id)),r=i.map(o=>o.image_id).filter(Boolean);await Promise.allSettled(r.map(o=>z._fetchWalletImage(o))),ie.featured=i,ie.allFeatured=i}},async fetchRecommendedWallets(){try{ie.isFetchingRecommendedWallets=!0;const{includeWalletIds:t,excludeWalletIds:e,featuredWalletIds:s}=_.state,n=[...e!=null?e:[],...s!=null?s:[]].filter(Boolean),i=f.getRequestedCaipNetworkIds().join(","),r={page:1,entries:Tc,include:t,exclude:n,chains:i},{data:o,count:a}=await z.fetchWallets(r),c=k.getRecentWallets(),l=o.map(h=>h.image_id).filter(Boolean),d=c.map(h=>h.image_id).filter(Boolean);await Promise.allSettled([...l,...d].map(h=>z._fetchWalletImage(h))),ie.recommended=o,ie.allRecommended=o,ie.count=a!=null?a:0}catch{}finally{ie.isFetchingRecommendedWallets=!1}},async fetchWalletsByPage({page:t}){var h;const{includeWalletIds:e,excludeWalletIds:s,featuredWalletIds:n}=_.state,i=f.getRequestedCaipNetworkIds().join(","),r=[...ie.recommended.map(({id:u})=>u),...s!=null?s:[],...n!=null?n:[]].filter(Boolean),o={page:t,entries:ff,include:e,exclude:r,chains:i},{data:a,count:c,mobileFilteredOutWalletsLength:l}=await z.fetchWallets(o);ie.mobileFilteredOutWalletsLength=l+((h=ie.mobileFilteredOutWalletsLength)!=null?h:0);const d=a.slice(0,gf).map(u=>u.image_id).filter(Boolean);await Promise.allSettled(d.map(u=>z._fetchWalletImage(u))),ie.wallets=j.uniqueBy([...ie.wallets,...z._filterOutExtensions(a)],"id").filter(u=>{var p;return(p=u.chains)==null?void 0:p.some(m=>i.includes(m))}),ie.count=c>ie.count?c:ie.count,ie.page=t},async initializeExcludedWallets({ids:t}){const e={page:1,entries:t.length,include:t},{data:s}=await z.fetchWallets(e);s&&s.forEach(n=>{ie.excludedWallets.push({rdns:n.rdns,name:n.name})})},async searchWallet({search:t,badge:e}){const{includeWalletIds:s,excludeWalletIds:n}=_.state,i=f.getRequestedCaipNetworkIds().join(",");ie.search=[];const r={page:1,entries:100,search:t==null?void 0:t.trim(),badge_type:e,include:s,exclude:n,chains:i},{data:o}=await z.fetchWallets(r);oe.sendEvent({type:"track",event:"SEARCH_WALLET",properties:{badge:e!=null?e:"",search:t!=null?t:""}});const a=o.map(c=>c.image_id).filter(Boolean);await Promise.allSettled([...a.map(c=>z._fetchWalletImage(c)),j.wait(300)]),ie.search=z._filterOutExtensions(o)},initPromise(t,e){const s=ie.promises[t];return s||(ie.promises[t]=e())},prefetch({fetchConnectorImages:t=!0,fetchFeaturedWallets:e=!0,fetchRecommendedWallets:s=!0,fetchNetworkImages:n=!0,fetchWalletRanks:i=!0}={}){const r=[t&&z.initPromise("connectorImages",z.fetchConnectorImages),e&&z.initPromise("featuredWallets",z.fetchFeaturedWallets),s&&z.initPromise("recommendedWallets",z.fetchRecommendedWallets),n&&z.initPromise("networkImages",z.fetchNetworkImages),i&&z.initPromise("walletRanks",z.prefetchWalletRanks)].filter(Boolean);return Promise.allSettled(r)},prefetchAnalyticsConfig(){var t;(t=_.state.features)!=null&&t.analytics&&z.fetchAnalyticsConfig()},async fetchAnalyticsConfig(){try{const{isAnalyticsEnabled:t}=await ot.get({path:"/getAnalyticsConfig",params:z._getSdkProperties()});_.setFeatures({analytics:t})}catch{_.setFeatures({analytics:!1})}},filterByNamespaces(t){if(!(t!=null&&t.length)){ie.featured=ie.allFeatured,ie.recommended=ie.allRecommended;return}const e=f.getRequestedCaipNetworkIds().join(",");ie.featured=ie.allFeatured.filter(s=>{var n;return(n=s.chains)==null?void 0:n.some(i=>e.includes(i))}),ie.recommended=ie.allRecommended.filter(s=>{var n;return(n=s.chains)==null?void 0:n.some(i=>e.includes(i))}),ie.filteredWallets=ie.wallets.filter(s=>{var n;return(n=s.chains)==null?void 0:n.some(i=>e.includes(i))})},clearFilterByNamespaces(){ie.filteredWallets=[]},setFilterByNamespace(t){if(!t){ie.featured=ie.allFeatured,ie.recommended=ie.allRecommended;return}const e=f.getRequestedCaipNetworkIds().join(",");ie.featured=ie.allFeatured.filter(s=>{var n;return(n=s.chains)==null?void 0:n.some(i=>e.includes(i))}),ie.recommended=ie.allRecommended.filter(s=>{var n;return(n=s.chains)==null?void 0:n.some(i=>e.includes(i))}),ie.filteredWallets=ie.wallets.filter(s=>{var n;return(n=s.chains)==null?void 0:n.some(i=>e.includes(i))})}},zs={filterOutDuplicatesByRDNS(t){const e=_.state.enableEIP6963?U.state.connectors:[],s=k.getRecentWallets(),n=e.map(a=>{var c;return(c=a.info)==null?void 0:c.rdns}).filter(Boolean),i=s.map(a=>a.rdns).filter(Boolean),r=n.concat(i);if(r.includes("io.metamask.mobile")&&j.isMobile()){const a=r.indexOf("io.metamask.mobile");r[a]="io.metamask"}return t.filter(a=>!(a!=null&&a.rdns&&r.includes(String(a.rdns))||!(a!=null&&a.rdns)&&e.some(l=>l.name===a.name)))},filterOutDuplicatesByIds(t){const e=U.state.connectors.filter(a=>a.type==="ANNOUNCED"||a.type==="INJECTED"||a.type==="MULTI_CHAIN"),s=k.getRecentWallets(),n=e.map(a=>{var c;return a.explorerId||((c=a.explorerWallet)==null?void 0:c.id)||a.id}),i=s.map(a=>a.id),r=n.concat(i);return t.filter(a=>!r.includes(a==null?void 0:a.id))},filterOutDuplicateWallets(t){const e=this.filterOutDuplicatesByRDNS(t);return this.filterOutDuplicatesByIds(e)},markWalletsAsInstalled(t){const{connectors:e}=U.state,{featuredWalletIds:s}=_.state,n=e.filter(o=>o.type==="ANNOUNCED").reduce((o,a)=>{var c;return(c=a.info)!=null&&c.rdns&&(o[a.info.rdns]=!0),o},{});return t.map(o=>{var a;return{...o,installed:!!o.rdns&&!!n[(a=o.rdns)!=null?a:""]}}).sort((o,a)=>{const c=Number(a.installed)-Number(o.installed);if(c!==0)return c;if(s!=null&&s.length){const l=s.indexOf(o.id),d=s.indexOf(a.id);if(l!==-1&&d!==-1)return l-d;if(l!==-1)return-1;if(d!==-1)return 1}return 0})},getConnectOrderMethod(t,e){var c;const s=(t==null?void 0:t.connectMethodsOrder)||((c=_.state.features)==null?void 0:c.connectMethodsOrder),n=e||U.state.connectors;if(s)return s;const{injected:i,announced:r}=at.getConnectorsByType(n,z.state.recommended,z.state.featured),o=i.filter(at.showConnector),a=r.filter(at.showConnector);return o.length||a.length?["wallet","email","social"]:le.DEFAULT_CONNECT_METHOD_ORDER},isExcluded(t){const e=!!t.rdns&&z.state.excludedWallets.some(n=>n.rdns===t.rdns),s=!!t.name&&z.state.excludedWallets.some(n=>Vd.isLowerCaseMatch(n.name,t.name));return e||s},markWalletsWithDisplayIndex(t){return t.map((e,s)=>({...e,display_index:s}))},filterWalletsByWcSupport(t){return D.state.wcBasic?t.filter(e=>e.supports_wc):j.isMobile()?t.filter(e=>e.supports_wc||le.MANDATORY_WALLET_IDS_ON_MOBILE.includes(e.id)):t},getWalletConnectWallets(t){var r;const e=[...z.state.featured,...z.state.recommended];((r=z.state.filteredWallets)==null?void 0:r.length)>0?e.push(...z.state.filteredWallets):e.push(...t);const s=j.uniqueBy(e,"id"),n=zs.markWalletsAsInstalled(s),i=zs.filterWalletsByWcSupport(n);return zs.markWalletsWithDisplayIndex(i)}},at={getConnectorsByType(t,e,s){const{customWallets:n}=_.state,i=k.getRecentWallets(),r=zs.filterOutDuplicateWallets(e),o=zs.filterOutDuplicateWallets(s),a=t.filter(h=>h.type==="MULTI_CHAIN"),c=t.filter(h=>h.type==="ANNOUNCED"),l=t.filter(h=>h.type==="INJECTED"),d=t.filter(h=>h.type==="EXTERNAL");return{custom:n,recent:i,external:d,multiChain:a,announced:c,injected:l,recommended:r,featured:o}},showConnector(t){var i;const e=(i=t.info)==null?void 0:i.rdns,s=!!e&&z.state.excludedWallets.some(r=>!!r.rdns&&r.rdns===e),n=!!t.name&&z.state.excludedWallets.some(r=>Vd.isLowerCaseMatch(r.name,t.name));return!(t.type==="INJECTED"&&(t.name==="Browser Wallet"&&(!j.isMobile()||j.isMobile()&&!e&&!D.checkInstalled())||s||n)||(t.type==="ANNOUNCED"||t.type==="EXTERNAL")&&(s||n))},getIsConnectedWithWC(){return Array.from(f.state.chains.values()).some(s=>U.getConnectorId(s.namespace)===I.CONNECTOR_ID.WALLET_CONNECT)},getConnectorTypeOrder({recommended:t,featured:e,custom:s,recent:n,announced:i,injected:r,multiChain:o,external:a,overriddenConnectors:c=(d=>(d=(l=>(l=_.state.features)==null?void 0:l.connectorTypeOrder)())!=null?d:[])()}){const u=[{type:"walletConnect",isEnabled:!0},{type:"recent",isEnabled:n.length>0},{type:"injected",isEnabled:[...r,...i,...o].length>0},{type:"featured",isEnabled:e.length>0},{type:"custom",isEnabled:s&&s.length>0},{type:"external",isEnabled:a.length>0},{type:"recommended",isEnabled:t.length>0}].filter(g=>g.isEnabled),p=new Set(u.map(g=>g.type)),m=c.filter(g=>p.has(g)).map(g=>({type:g,isEnabled:!0})),y=u.filter(({type:g})=>!m.some(({type:b})=>b===g));return Array.from(new Set([...m,...y].map(({type:g})=>g)))},sortConnectorsByExplorerWallet(t){return[...t].sort((e,s)=>{var n,i;return e.explorerWallet&&s.explorerWallet?((n=e.explorerWallet.order)!=null?n:0)-((i=s.explorerWallet.order)!=null?i:0):e.explorerWallet?-1:s.explorerWallet?1:0})},getPriority(t){return t.id===I.CONNECTOR_ID.BASE_ACCOUNT?0:t.id===I.CONNECTOR_ID.COINBASE||t.id===I.CONNECTOR_ID.COINBASE_SDK?1:2},sortConnectorsByPriority(t){return[...t].sort((e,s)=>at.getPriority(e)-at.getPriority(s))},getAuthName({email:t,socialUsername:e,socialProvider:s}){return e?s&&s==="discord"&&e.endsWith("0")?e.slice(0,-1):e:t.length>30?`${t.slice(0,-3)}...`:t},async fetchProviderData(t){var e,s;try{if(t.name==="Browser Wallet"&&!j.isMobile())return{accounts:[],chainId:void 0};if(t.id===I.CONNECTOR_ID.AUTH)return{accounts:[],chainId:void 0};const[n,i]=await Promise.all([(e=t.provider)==null?void 0:e.request({method:"eth_accounts"}),(s=t.provider)==null?void 0:s.request({method:"eth_chainId"}).then(r=>Number(r))]);return{accounts:n,chainId:i}}catch(n){return console.warn(`Failed to fetch provider data for ${t.name}`,n),{accounts:[],chainId:void 0}}},getFilteredCustomWallets(t){const e=k.getRecentWallets(),s=U.state.connectors.map(o=>{var a;return(a=o.info)==null?void 0:a.rdns}).filter(Boolean),n=e.map(o=>o.rdns).filter(Boolean),i=s.concat(n);if(i.includes("io.metamask.mobile")&&j.isMobile()){const o=i.indexOf("io.metamask.mobile");i[o]="io.metamask"}return t.filter(o=>!i.includes(String(o==null?void 0:o.rdns)))},hasWalletConnector(t){return U.state.connectors.some(e=>e.id===t.id||e.name===t.name)},isWalletCompatibleWithCurrentChain(t){const e=f.state.activeChain;return e&&t.chains?t.chains.some(s=>{const n=s.split(":")[0];return e===n}):!0},getFilteredRecentWallets(){return k.getRecentWallets().filter(s=>!zs.isExcluded(s)).filter(s=>!this.hasWalletConnector(s)).filter(s=>this.isWalletCompatibleWithCurrentChain(s))},getCappedRecommendedWallets(t){const{connectors:e}=U.state,{customWallets:s,featuredWalletIds:n}=_.state,i=e.find(b=>b.id==="walletConnect"),r=e.filter(b=>b.type==="INJECTED"||b.type==="ANNOUNCED"||b.type==="MULTI_CHAIN");if(!i&&!r.length&&!(s!=null&&s.length))return[];const o=Jo.isEmailEnabled(),a=Jo.isSocialsEnabled(),c=r.filter(b=>b.name!=="Browser Wallet"&&b.name!=="WalletConnect"),l=(n==null?void 0:n.length)||0,d=(s==null?void 0:s.length)||0,h=c.length||0,u=o?1:0,p=a?1:0,m=l+d+h+u+p,g=Math.max(0,4-m);return g<=0?[]:zs.filterOutDuplicateWallets(t).slice(0,g)},processConnectorsByType(t,e=!0){const s=at.sortConnectorsByExplorerWallet([...t]);return e?s.filter(at.showConnector):s},connectorList(){const t=at.getConnectorsByType(U.state.connectors,z.state.recommended,z.state.featured),e=this.processConnectorsByType(t.announced.filter(p=>p.id!=="walletConnect")),s=this.processConnectorsByType(t.injected),n=this.processConnectorsByType(t.multiChain.filter(p=>p.name!=="WalletConnect"),!1),i=t.custom,r=t.recent,o=this.processConnectorsByType(t.external.filter(p=>p.id!==I.CONNECTOR_ID.COINBASE_SDK&&p.id!==I.CONNECTOR_ID.BASE_ACCOUNT)),a=t.recommended,c=t.featured,l=at.getConnectorTypeOrder({custom:i,recent:r,announced:e,injected:s,multiChain:n,recommended:a,featured:c,external:o}),d=U.state.connectors.find(p=>p.id==="walletConnect"),h=j.isMobile(),u=[];for(const p of l)switch(p){case"walletConnect":{!h&&d&&u.push({kind:"connector",subtype:"walletConnect",connector:d});break}case"recent":{at.getFilteredRecentWallets().forEach(y=>u.push({kind:"wallet",subtype:"recent",wallet:y}));break}case"injected":{n.forEach(m=>u.push({kind:"connector",subtype:"multiChain",connector:m})),e.forEach(m=>u.push({kind:"connector",subtype:"announced",connector:m})),s.forEach(m=>u.push({kind:"connector",subtype:"injected",connector:m}));break}case"featured":{c.forEach(m=>u.push({kind:"wallet",subtype:"featured",wallet:m}));break}case"custom":{at.getFilteredCustomWallets(i!=null?i:[]).forEach(y=>u.push({kind:"wallet",subtype:"custom",wallet:y}));break}case"external":{o.forEach(m=>u.push({kind:"connector",subtype:"external",connector:m}));break}case"recommended":{at.getCappedRecommendedWallets(a).forEach(y=>u.push({kind:"wallet",subtype:"recommended",wallet:y}));break}default:console.warn(`Unknown connector type: ${p}`)}return u},hasInjectedConnectors(){return U.state.connectors.filter(t=>(t.type==="INJECTED"||t.type==="ANNOUNCED"||t.type==="MULTI_CHAIN")&&t.name!=="Browser Wallet"&&t.name!=="WalletConnect").length}},mf=["ConnectingExternal","ConnectingMultiChain","ConnectingSocial","ConnectingFarcaster"],Ae=xe({view:"Connect",history:["Connect"],transactionStack:[]}),yf={state:Ae,subscribeKey(t,e){return Ze(Ae,t,e)},pushTransactionStack(t){Ae.transactionStack.push(t)},popTransactionStack(t){const e=Ae.transactionStack.pop();if(!e)return;const{onSuccess:s,onError:n,onCancel:i}=e;switch(t){case"success":s==null||s();break;case"error":n==null||n(),ee.goBack();break;case"cancel":i==null||i(),ee.goBack();break}},push(t,e){let s=t,n=e;z.state.plan.hasExceededUsageLimit&&mf.includes(t)&&(s="UsageExceeded",n=void 0),s!==Ae.view&&(Ae.view=s,Ae.history.push(s),Ae.data=n)},reset(t,e){Ae.view=t,Ae.history=[t],Ae.data=e},replace(t,e){Ae.history.at(-1)===t||(Ae.view=t,Ae.history[Ae.history.length-1]=t,Ae.data=e)},goBack(){var n,i;const t=f.state.activeCaipAddress,e=ee.state.view==="ConnectingFarcaster",s=!t&&e;if(Ae.history.length>1){Ae.history.pop();const[r]=Ae.history.slice(-1);r&&(t&&r==="Connect"?Ae.view="Account":Ae.view=r)}else de.close();(n=Ae.data)!=null&&n.wallet&&(Ae.data.wallet=void 0),(i=Ae.data)!=null&&i.redirectView&&(Ae.data.redirectView=void 0),setTimeout(()=>{var r,o,a;if(s){f.setAccountProp("farcasterUrl",void 0,f.state.activeChain);const c=U.getAuthConnector();(r=c==null?void 0:c.provider)==null||r.reload();const l=Li(_.state);(a=(o=c==null?void 0:c.provider)==null?void 0:o.syncDappData)==null||a.call(o,{metadata:l.metadata,sdkVersion:l.sdkVersion,projectId:l.projectId,sdkType:l.sdkType})}},100)},goBackToIndex(t){if(Ae.history.length>1){Ae.history=Ae.history.slice(0,t+1);const[e]=Ae.history.slice(-1);e&&(Ae.view=e)}},goBackOrCloseModal(){ee.state.history.length>1?ee.goBack():de.close()}},ee=Wt(yf),fs=xe({themeMode:"dark",themeVariables:{},w3mThemeVariables:void 0}),Xo={state:fs,subscribe(t){return Xe(fs,()=>t(fs))},setThemeMode(t){fs.themeMode=t;try{const e=U.getAuthConnector();if(e){const s=Xo.getSnapshot().themeVariables;e.provider.syncTheme({themeMode:t,themeVariables:s,w3mThemeVariables:kr(s,t)})}}catch{console.info("Unable to sync theme to auth connector")}},setThemeVariables(t){fs.themeVariables={...fs.themeVariables,...t};try{const e=U.getAuthConnector();if(e){const s=Xo.getSnapshot().themeVariables;e.provider.syncTheme({themeVariables:s,w3mThemeVariables:kr(fs.themeVariables,fs.themeMode)})}}catch{console.info("Unable to sync theme to auth connector")}},getSnapshot(){return Li(fs)}},At=Wt(Xo),sh=Object.fromEntries(Gd.map(t=>[t,void 0])),wf=Object.fromEntries(Gd.map(t=>[t,!0])),ye=xe({allConnectors:[],connectors:[],activeConnector:void 0,filterByNamespace:void 0,activeConnectorIds:sh,filterByNamespaceMap:wf}),bf={state:ye,subscribe(t){return Xe(ye,()=>{t(ye)})},subscribeKey(t,e){return Ze(ye,t,e)},initialize(t){t.forEach(e=>{const s=k.getConnectedConnectorId(e);s&&U.setConnectorId(s,e)})},setActiveConnector(t){t&&(ye.activeConnector=Mi(t))},setConnectors(t){t.filter(i=>!ye.allConnectors.some(r=>r.id===i.id&&U.getConnectorName(r.name)===U.getConnectorName(i.name)&&r.chain===i.chain)).forEach(i=>{i.type!=="MULTI_CHAIN"&&ye.allConnectors.push(Mi(i))});const s=U.getEnabledNamespaces(),n=U.getEnabledConnectors(s);ye.connectors=U.mergeMultiChainConnectors(n)},filterByNamespaces(t){Object.keys(ye.filterByNamespaceMap).forEach(e=>{ye.filterByNamespaceMap[e]=!1}),t.forEach(e=>{ye.filterByNamespaceMap[e]=!0}),U.updateConnectorsForEnabledNamespaces()},filterByNamespace(t,e){ye.filterByNamespaceMap[t]=e,U.updateConnectorsForEnabledNamespaces()},updateConnectorsForEnabledNamespaces(){const t=U.getEnabledNamespaces(),e=U.getEnabledConnectors(t),s=U.areAllNamespacesEnabled();ye.connectors=U.mergeMultiChainConnectors(e),s?z.clearFilterByNamespaces():z.filterByNamespaces(t)},getEnabledNamespaces(){return Object.entries(ye.filterByNamespaceMap).filter(([t,e])=>e).map(([t])=>t)},getEnabledConnectors(t){return ye.allConnectors.filter(e=>t.includes(e.chain))},areAllNamespacesEnabled(){return Object.values(ye.filterByNamespaceMap).every(t=>t)},mergeMultiChainConnectors(t){const e=U.generateConnectorMapByName(t),s=[];return e.forEach(n=>{const i=n[0],r=(i==null?void 0:i.id)===I.CONNECTOR_ID.AUTH;n.length>1&&i?s.push({name:i.name,imageUrl:i.imageUrl,imageId:i.imageId,connectors:[...n],type:r?"AUTH":"MULTI_CHAIN",chain:"eip155",id:(i==null?void 0:i.id)||""}):i&&s.push(i)}),s},generateConnectorMapByName(t){const e=new Map;return t.forEach(s=>{const{name:n}=s,i=U.getConnectorName(n);if(!i)return;const r=e.get(i)||[];r.find(a=>a.chain===s.chain)||r.push(s),e.set(i,r)}),e},getConnectorName(t){return t&&({"Trust Wallet":"Trust"}[t]||t)},getUniqueConnectorsByName(t){const e=[];return t.forEach(s=>{e.find(n=>n.chain===s.chain)||e.push(s)}),e},addConnector(t){var e,s,n;if(t.id===I.CONNECTOR_ID.AUTH){const i=t,r=Li(_.state),o=At.getSnapshot().themeMode,a=At.getSnapshot().themeVariables;(s=(e=i==null?void 0:i.provider)==null?void 0:e.syncDappData)==null||s.call(e,{metadata:r.metadata,sdkVersion:r.sdkVersion,projectId:r.projectId,sdkType:r.sdkType}),(n=i==null?void 0:i.provider)==null||n.syncTheme({themeMode:o,themeVariables:a,w3mThemeVariables:kr(a,o)}),U.setConnectors([t])}else U.setConnectors([t])},getAuthConnector(t){var n;const e=t||f.state.activeChain,s=ye.connectors.find(i=>i.id===I.CONNECTOR_ID.AUTH);if(s)return(n=s==null?void 0:s.connectors)!=null&&n.length?s.connectors.find(r=>r.chain===e):s},getAnnouncedConnectorRdns(){return ye.connectors.filter(t=>t.type==="ANNOUNCED").map(t=>{var e;return(e=t.info)==null?void 0:e.rdns})},getConnectorById(t){return at.sortConnectorsByPriority(ye.allConnectors).find(s=>s.id===t)},getConnector({id:t,namespace:e}){const s=e||f.state.activeChain,n=ye.allConnectors.filter(o=>o.chain===s);return at.sortConnectorsByPriority(n).find(o=>o.id===t||o.explorerId===t)},syncIfAuthConnector(t){var r,o;if(t.id!=="AUTH")return;const e=t,s=Li(_.state),n=At.getSnapshot().themeMode,i=At.getSnapshot().themeVariables;(o=(r=e==null?void 0:e.provider)==null?void 0:r.syncDappData)==null||o.call(r,{metadata:s.metadata,sdkVersion:s.sdkVersion,sdkType:s.sdkType,projectId:s.projectId}),e.provider.syncTheme({themeMode:n,themeVariables:i,w3mThemeVariables:kr(i,n)})},getConnectorsByNamespace(t){const e=ye.allConnectors.filter(s=>s.chain===t);return U.mergeMultiChainConnectors(e)},canSwitchToSmartAccount(t){return f.checkIfSmartAccountEnabled()&&Bt(t)===Is.ACCOUNT_TYPES.EOA},selectWalletConnector(t){var i;const e=(i=ee.state.data)==null?void 0:i.redirectView,s=f.state.activeChain,n=s?U.getConnector({id:t.id,namespace:s}):void 0;cf.handleMobileDeeplinkRedirect((n==null?void 0:n.explorerId)||t.id,f.state.activeChain),n?ee.push("ConnectingExternal",{connector:n,wallet:t,redirectView:e}):ee.push("ConnectingWalletConnect",{wallet:t,redirectView:e})},getConnectors(t){return t?U.getConnectorsByNamespace(t):U.mergeMultiChainConnectors(ye.allConnectors)},setFilterByNamespace(t){ye.filterByNamespace=t,ye.connectors=U.getConnectors(t),z.setFilterByNamespace(t)},setConnectorId(t,e){t&&(ye.activeConnectorIds={...ye.activeConnectorIds,[e]:t},k.setConnectedConnectorId(e,t))},removeConnectorId(t){ye.activeConnectorIds={...ye.activeConnectorIds,[t]:void 0},k.deleteConnectedConnectorId(t)},getConnectorId(t){if(t)return ye.activeConnectorIds[t]},isConnected(t){return t?!!ye.activeConnectorIds[t]:Object.values(ye.activeConnectorIds).some(e=>!!e)},resetConnectorIds(){ye.activeConnectorIds={...sh}},extendConnectorsWithExplorerWallets(t){ye.allConnectors.forEach(n=>{const i=t.find(r=>{var o;return r.id===n.id||r.rdns&&r.rdns===((o=n.info)==null?void 0:o.rdns)});i&&(n.explorerWallet=i)});const e=U.getEnabledNamespaces(),s=U.getEnabledConnectors(e);ye.connectors=U.mergeMultiChainConnectors(s)},async connect(t={}){const{namespace:e}=t;return U.setFilterByNamespace(e),ee.push("Connect",{addWalletForNamespace:e}),new Promise((s,n)=>{if(e){const i=f.subscribeChainProp("accountState",o=>{o!=null&&o.caipAddress&&(s({caipAddress:o==null?void 0:o.caipAddress}),i())},e),r=de.subscribeKey("open",o=>{o||(n(new Error("Modal closed")),r())})}else{const i=f.subscribeKey("activeCaipAddress",o=>{o&&(s({caipAddress:o}),i())}),r=de.subscribeKey("open",o=>{o||(n(new Error("Modal closed")),r())})}})}},U=Wt(bf),Ef=1e3,di={checkNamespaceConnectorId(t,e){return U.getConnectorId(t)===e},isSocialProvider(t){return le.DEFAULT_REMOTE_FEATURES.socials.includes(t)},connectWalletConnect({walletConnect:t,connector:e,closeModalOnConnect:s=!0,redirectViewOnModalClose:n="Connect",onOpen:i,onConnect:r}){return new Promise((o,a)=>{if(t&&U.setActiveConnector(e),i==null||i(j.isMobile()&&t),n){const l=de.subscribeKey("open",d=>{d||(ee.state.view!==n&&ee.replace(n),l(),a(new Error("Modal closed")))})}const c=f.subscribeKey("activeCaipAddress",l=>{l&&(r==null||r(),s&&de.close(),c(),o(Je.parseCaipAddress(l)))})})},connectExternal(t){return new Promise((e,s)=>{const n=f.subscribeKey("activeCaipAddress",i=>{i&&(de.close(),n(),e(Je.parseCaipAddress(i)))});D.connectExternal(t,t.chain).catch(()=>{n(),s(new Error("Connection rejected"))})})},connectSocial({social:t,namespace:e,closeModalOnConnect:s=!0,onOpenFarcaster:n,onConnect:i}){let r,o=!1,a=null;const c=e||f.state.activeChain,l=f.subscribeKey("activeCaipAddress",d=>{d&&(s&&de.close(),l())});return new Promise((d,h)=>{async function u(m){var y;if((y=m.data)!=null&&y.resultUri)if(m.origin===I.SECURE_SITE_SDK_ORIGIN){window.removeEventListener("message",u,!1);try{const g=U.getAuthConnector(c);if(g&&!o){r&&r.close(),o=!0;const w=m.data.resultUri;oe.sendEvent({type:"track",event:"SOCIAL_LOGIN_REQUEST_USER_DATA",properties:{provider:t}}),k.setConnectedSocialProvider(t),await D.connectExternal({id:g.id,type:g.type,socialUri:w},g.chain);const b=f.state.activeCaipAddress;if(!b){h(new Error("Failed to connect"));return}d(Je.parseCaipAddress(b)),oe.sendEvent({type:"track",event:"SOCIAL_LOGIN_SUCCESS",properties:{provider:t}})}}catch(g){oe.sendEvent({type:"track",event:"SOCIAL_LOGIN_ERROR",properties:{provider:t,message:j.parseError(g)}}),h(new Error("Failed to connect"))}}else oe.sendEvent({type:"track",event:"SOCIAL_LOGIN_ERROR",properties:{provider:t,message:"Untrusted Origin"}})}async function p(){if(oe.sendEvent({type:"track",event:"SOCIAL_LOGIN_STARTED",properties:{provider:t}}),t==="farcaster"){n==null||n();const m=de.subscribeKey("open",g=>{!g&&t==="farcaster"&&(h(new Error("Popup closed")),i==null||i(),m())}),y=U.getAuthConnector();if(y){const g=f.getAccountData(c);if(!(g!=null&&g.farcasterUrl))try{const{url:w}=await y.provider.getFarcasterUri();f.setAccountProp("farcasterUrl",w,c)}catch{h(new Error("Failed to connect to farcaster"))}}}else{const m=U.getAuthConnector();a=j.returnOpenHref(`${I.SECURE_SITE_SDK_ORIGIN}/loading`,"popupWindow","width=600,height=800,scrollbars=yes");try{if(m){const{uri:y}=await m.provider.getSocialRedirectUri({provider:t});if(a&&y){a.location.href=y,r=a;const g=setInterval(()=>{r!=null&&r.closed&&!o&&(h(new Error("Popup closed")),clearInterval(g))},1e3);window.addEventListener("message",u,!1)}else a==null||a.close(),h(new Error("Failed to initiate social connection"))}}catch{h(new Error("Failed to initiate social connection")),a==null||a.close()}}}p()})},connectEmail({closeModalOnConnect:t=!0,redirectViewOnModalClose:e="Connect",onOpen:s,onConnect:n}){return new Promise((i,r)=>{if(s==null||s(),e){const a=de.subscribeKey("open",c=>{c||(ee.state.view!==e&&ee.replace(e),a(),r(new Error("Modal closed")))})}const o=f.subscribeKey("activeCaipAddress",a=>{a&&(n==null||n(),t&&de.close(),o(),i(Je.parseCaipAddress(a)))})})},async updateEmail(){var n;const t=k.getConnectedConnectorId(f.state.activeChain),e=U.getAuthConnector();if(!e)throw new Error("No auth connector found");if(t!==I.CONNECTOR_ID.AUTH)throw new Error("Not connected to email or social");const s=(n=e.provider.getEmail())!=null?n:"";return await de.open({view:"UpdateEmailWallet",data:{email:s,redirectView:void 0}}),new Promise((i,r)=>{const o=setInterval(()=>{var l;const c=(l=e.provider.getEmail())!=null?l:"";c!==s&&(de.close(),clearInterval(o),a(),i({email:c}))},Ef),a=de.subscribeKey("open",c=>{c||(ee.state.view!=="Connect"&&ee.push("Connect"),clearInterval(o),a(),r(new Error("Modal closed")))})})},canSwitchToSmartAccount(t){return f.checkIfSmartAccountEnabled()&&Bt(t)===Is.ACCOUNT_TYPES.EOA}};function nh(){var n,i;const t=((n=f.state.activeCaipNetwork)==null?void 0:n.chainNamespace)||"eip155",e=((i=f.state.activeCaipNetwork)==null?void 0:i.id)||1,s=le.NATIVE_TOKEN_ADDRESS[t];return`${t}:${e}:${s}`}function $I(t){return le.NATIVE_TOKEN_ADDRESS[t]}function Bt(t){var s;return(s=f.getAccountData(t))==null?void 0:s.preferredAccountType}function ir(t){return f.state.activeCaipNetwork}const Rr={getConnectionStatus(t,e){const s=U.state.activeConnectorIds[e],n=D.getConnections(e);return!!s&&t.connectorId===s?"connected":n.some(o=>o.connectorId.toLowerCase()===t.connectorId.toLowerCase())?"active":"disconnected"},excludeConnectorAddressFromConnections({connections:t,connectorId:e,addresses:s}){return t.map(n=>{if((e?n.connectorId.toLowerCase()===e.toLowerCase():!1)&&s){const r=n.accounts.filter(o=>!s.some(c=>c.toLowerCase()===o.address.toLowerCase()));return{...n,accounts:r}}return n})},excludeExistingConnections(t,e){const s=new Set(t);return e.filter(n=>!s.has(n.connectorId))},getConnectionsByConnectorId(t,e){return t.filter(s=>s.connectorId.toLowerCase()===e.toLowerCase())},getConnectionsData(t){var a,c;const e=!!((a=_.state.remoteFeatures)!=null&&a.multiWallet),s=U.state.activeConnectorIds[t],n=D.getConnections(t),r=((c=D.state.recentConnections.get(t))!=null?c:[]).filter(l=>U.getConnectorById(l.connectorId)),o=Rr.excludeExistingConnections([...n.map(l=>l.connectorId),...s?[s]:[]],r);return e?{connections:n,recentConnections:o}:{connections:n.filter(l=>l.connectorId.toLowerCase()===(s==null?void 0:s.toLowerCase())),recentConnections:[]}},onConnectMobile(t){const e=D.state.wcUri;if(t!=null&&t.mobile_link&&e)try{D.setWcError(!1);const{mobile_link:s,link_mode:n,name:i}=t,{redirect:r,redirectUniversalLink:o,href:a}=j.formatNativeUrl(s,e,n),c=r,l=o,d=j.isIframe()?"_top":"_self";D.setWcLinking({name:i,href:a}),D.setRecentWallet(t),_.state.experimental_preferUniversalLinks&&l?j.openHref(l,d):j.openHref(c,d)}catch(s){oe.sendEvent({type:"track",event:"CONNECT_PROXY_ERROR",properties:{message:s instanceof Error?s.message:"Error parsing the deep link",uri:e,mobile_link:t.mobile_link,name:t.name}}),D.setWcError(!0)}}},Dn=xe({loading:!1,open:!1,selectedNetworkId:void 0,activeChain:void 0,initialized:!1,connectingWallet:void 0}),Jt={state:Dn,subscribe(t){return Xe(Dn,()=>t(Dn))},subscribeOpen(t){return Ze(Dn,"open",t)},set(t){Object.assign(Dn,{...Dn,...t})}},Pe=xe({transactions:[],transactionsByYear:{},lastNetworkInView:void 0,loading:!1,empty:!1,next:void 0}),Cf={state:Pe,subscribe(t){return Xe(Pe,()=>t(Pe))},setLastNetworkInView(t){Pe.lastNetworkInView=t},async fetchTransactions(t){var e;if(!t)throw new Error("Transactions can't be fetched without an accountAddress");Pe.loading=!0;try{const s=await te.fetchTransactions({account:t,cursor:Pe.next,chainId:(e=f.state.activeCaipNetwork)==null?void 0:e.caipNetworkId}),n=vr.filterSpamTransactions(s.data),i=vr.filterByConnectedChain(n),r=[...Pe.transactions,...i];Pe.loading=!1,Pe.transactions=r,Pe.transactionsByYear=vr.groupTransactionsByYearAndMonth(Pe.transactionsByYear,i),Pe.empty=r.length===0,Pe.next=s.next?s.next:void 0}catch{const n=f.state.activeChain;oe.sendEvent({type:"track",event:"ERROR_FETCH_TRANSACTIONS",properties:{address:t,projectId:_.state.projectId,cursor:Pe.next,isSmartAccount:Bt(n)===Is.ACCOUNT_TYPES.SMART_ACCOUNT}}),as.showError("Failed to fetch transactions"),Pe.loading=!1,Pe.empty=!0,Pe.next=void 0}},groupTransactionsByYearAndMonth(t={},e=[]){const s=t;return e.forEach(n=>{var l,d;const i=new Date(n.metadata.minedAt).getFullYear(),r=new Date(n.metadata.minedAt).getMonth(),o=(l=s[i])!=null?l:{},c=((d=o[r])!=null?d:[]).filter(h=>h.id!==n.id);s[i]={...o,[r]:[...c,n].sort((h,u)=>new Date(u.metadata.minedAt).getTime()-new Date(h.metadata.minedAt).getTime())}}),s},filterSpamTransactions(t){return t.filter(e=>{var n;return!((n=e.transfers)==null?void 0:n.every(i=>{var r;return((r=i.nft_info)==null?void 0:r.flags.is_spam)===!0}))})},filterByConnectedChain(t){var n;const e=(n=f.state.activeCaipNetwork)==null?void 0:n.caipNetworkId;return t.filter(i=>i.metadata.chain===e)},clearCursor(){Pe.next=void 0},resetTransactions(){Pe.transactions=[],Pe.transactionsByYear={},Pe.lastNetworkInView=void 0,Pe.loading=!1,Pe.empty=!1,Pe.next=void 0}},vr=Wt(Cf,"API_ERROR"),ce=xe({connections:new Map,recentConnections:new Map,isSwitchingConnection:!1,wcError:!1,wcFetchingUri:!1,buffering:!1,status:"disconnected"});let sn;const vf={state:ce,subscribe(t){return Xe(ce,()=>t(ce))},subscribeKey(t,e){return Ze(ce,t,e)},_getClient(){return ce._client},setClient(t){ce._client=Mi(t)},initialize(t){const e=t.filter(s=>!!s.namespace).map(s=>s.namespace);D.syncStorageConnections(e)},syncStorageConnections(t){var n;const e=k.getConnections(),s=t!=null?t:Array.from(f.state.chains.keys());for(const i of s){const r=(n=e[i])!=null?n:[],o=new Map(ce.recentConnections);o.set(i,r),ce.recentConnections=o}},getConnections(t){var e;return t?(e=ce.connections.get(t))!=null?e:[]:[]},hasAnyConnection(t){const e=D.state.connections;return Array.from(e.values()).flatMap(s=>s).some(({connectorId:s})=>s===t)},async connectWalletConnect({cache:t="auto"}={}){var s,n,i,r;ce.wcFetchingUri=!0;const e=j.isTelegram()||j.isSafari()&&j.isIos();if(t==="always"||t==="auto"&&e){if(sn){await sn,sn=void 0;return}if(!j.isPairingExpired(ce==null?void 0:ce.wcPairingExpiry)){const o=ce.wcUri;ce.wcUri=o;return}sn=(n=(s=D._getClient())==null?void 0:s.connectWalletConnect)==null?void 0:n.call(s).catch(()=>{}),D.state.status="connecting",await sn,sn=void 0,ce.wcPairingExpiry=void 0,D.state.status="connected"}else await((r=(i=D._getClient())==null?void 0:i.connectWalletConnect)==null?void 0:r.call(i))},async connectExternal(t,e,s=!0){var o,a,c;const n=await((a=(o=D._getClient())==null?void 0:o.connectExternal)==null?void 0:a.call(o,t));s&&f.setActiveNamespace(e);const i=U.state.allConnectors.find(l=>l.id===(t==null?void 0:t.id)),r=t.type==="AUTH"?"email":"browser";return oe.sendEvent({type:"track",event:"CONNECT_SUCCESS",properties:{method:r,name:(i==null?void 0:i.name)||"Unknown",view:ee.state.view,walletRank:(c=i==null?void 0:i.explorerWallet)==null?void 0:c.order}}),n},async reconnectExternal(t){var s,n;await((n=(s=D._getClient())==null?void 0:s.reconnectExternal)==null?void 0:n.call(s,t));const e=t.chain||f.state.activeChain;e&&U.setConnectorId(t.id,e)},async setPreferredAccountType(t,e){var n;if(!e)return;de.setLoading(!0,f.state.activeChain);const s=U.getAuthConnector();s&&(f.setAccountProp("preferredAccountType",t,e),await s.provider.setPreferredAccount(t),k.setPreferredAccountTypes(Object.entries(f.state.chains).reduce((i,[r,o])=>{const a=r,c=Bt(a);return c!==void 0&&(i[a]=c),i},{})),await D.reconnectExternal(s),de.setLoading(!1,f.state.activeChain),oe.sendEvent({type:"track",event:"SET_PREFERRED_ACCOUNT_TYPE",properties:{accountType:t,network:((n=f.state.activeCaipNetwork)==null?void 0:n.caipNetworkId)||""}}))},async signMessage(t){var e;return(e=D._getClient())==null?void 0:e.signMessage(t)},parseUnits(t,e){var s;return(s=D._getClient())==null?void 0:s.parseUnits(t,e)},formatUnits(t,e){var s;return(s=D._getClient())==null?void 0:s.formatUnits(t,e)},updateBalance(t){var e;return(e=D._getClient())==null?void 0:e.updateBalance(t)},async sendTransaction(t){var e;return(e=D._getClient())==null?void 0:e.sendTransaction(t)},async getCapabilities(t){var e;return(e=D._getClient())==null?void 0:e.getCapabilities(t)},async grantPermissions(t){var e;return(e=D._getClient())==null?void 0:e.grantPermissions(t)},async walletGetAssets(t){var e,s;return(s=(e=D._getClient())==null?void 0:e.walletGetAssets(t))!=null?s:{}},async estimateGas(t){var e;return(e=D._getClient())==null?void 0:e.estimateGas(t)},async writeContract(t){var e;return(e=D._getClient())==null?void 0:e.writeContract(t)},async writeSolanaTransaction(t){var e;return(e=D._getClient())==null?void 0:e.writeSolanaTransaction(t)},async getEnsAddress(t){var e;return(e=D._getClient())==null?void 0:e.getEnsAddress(t)},async getEnsAvatar(t){var e;return(e=D._getClient())==null?void 0:e.getEnsAvatar(t)},checkInstalled(t){var e,s;return((s=(e=D._getClient())==null?void 0:e.checkInstalled)==null?void 0:s.call(e,t))||!1},resetWcConnection(){ce.wcUri=void 0,ce.wcPairingExpiry=void 0,ce.wcLinking=void 0,ce.recentWallet=void 0,ce.wcFetchingUri=!1,ce.status="disconnected",vr.resetTransactions(),k.deleteWalletConnectDeepLink(),k.deleteRecentWallet(),Jt.set({connectingWallet:void 0})},resetUri(){ce.wcUri=void 0,ce.wcPairingExpiry=void 0,sn=void 0,ce.wcFetchingUri=!1,Jt.set({connectingWallet:void 0})},finalizeWcConnection(t){var n,i;const{wcLinking:e,recentWallet:s}=D.state;e&&k.setWalletConnectDeepLink(e),s&&k.setAppKitRecent(s),t&&oe.sendEvent({type:"track",event:"CONNECT_SUCCESS",address:t,properties:{method:e?"mobile":"qrcode",name:((i=(n=ee.state.data)==null?void 0:n.wallet)==null?void 0:i.name)||"Unknown",view:ee.state.view,walletRank:s==null?void 0:s.order}})},setWcBasic(t){ce.wcBasic=t},setUri(t){ce.wcUri=t,ce.wcFetchingUri=!1,ce.wcPairingExpiry=j.getPairingExpiry()},setWcLinking(t){ce.wcLinking=t},setWcError(t){ce.wcError=t,ce.wcFetchingUri=!1,ce.buffering=!1},setRecentWallet(t){ce.recentWallet=t},setBuffering(t){ce.buffering=t},setStatus(t){ce.status=t},setIsSwitchingConnection(t){ce.isSwitchingConnection=t},async disconnect({id:t,namespace:e,initialDisconnect:s}={}){var n;try{await((n=D._getClient())==null?void 0:n.disconnect({id:t,chainNamespace:e,initialDisconnect:s}))}catch(i){throw new An("Failed to disconnect","INTERNAL_SDK_ERROR",i)}},async disconnectConnector({id:t,namespace:e}){var s;try{await((s=D._getClient())==null?void 0:s.disconnectConnector({id:t,namespace:e}))}catch(n){throw new An("Failed to disconnect connector","INTERNAL_SDK_ERROR",n)}},setConnections(t,e){const s=new Map(ce.connections);s.set(e,t),ce.connections=s},async handleAuthAccountSwitch({address:t,namespace:e}){var r,o;const s=f.getAccountData(e),n=(o=(r=s==null?void 0:s.user)==null?void 0:r.accounts)==null?void 0:o.find(a=>a.type==="smartAccount"),i=n&&n.address.toLowerCase()===t.toLowerCase()&&di.canSwitchToSmartAccount(e)?"smartAccount":"eoa";await D.setPreferredAccountType(i,e)},async handleActiveConnection({connection:t,namespace:e,address:s}){const n=U.getConnectorById(t.connectorId),i=t.connectorId===I.CONNECTOR_ID.AUTH;if(!n)throw new Error(`No connector found for connection: ${t.connectorId}`);if(i)s&&await D.handleAuthAccountSwitch({address:s,namespace:e});else{const r=await D.connectExternal({id:n.id,type:n.type,provider:n.provider,address:s,chain:e},e);return r==null?void 0:r.address}return s},async handleDisconnectedConnection({connection:t,namespace:e,address:s,closeModalOnConnect:n}){var l,d;const i=U.getConnectorById(t.connectorId),r=(d=(l=t.auth)==null?void 0:l.name)==null?void 0:d.toLowerCase(),o=t.connectorId===I.CONNECTOR_ID.AUTH,a=t.connectorId===I.CONNECTOR_ID.WALLET_CONNECT;if(!i)throw new Error(`No connector found for connection: ${t.connectorId}`);let c;if(o)if(r&&di.isSocialProvider(r)){const{address:h}=await di.connectSocial({social:r,closeModalOnConnect:n,onOpenFarcaster(){de.open({view:"ConnectingFarcaster"})},onConnect(){ee.replace("ProfileWallets")}});c=h}else{const{address:h}=await di.connectEmail({closeModalOnConnect:n,onOpen(){de.open({view:"EmailLogin"})},onConnect(){ee.replace("ProfileWallets")}});c=h}else if(a){const{address:h}=await di.connectWalletConnect({walletConnect:!0,connector:i,closeModalOnConnect:n,onOpen(u){const p=u?"AllWallets":"ConnectingWalletConnect";de.state.open?ee.push(p):de.open({view:p})},onConnect(){ee.replace("ProfileWallets")}});c=h}else{const h=await D.connectExternal({id:i.id,type:i.type,provider:i.provider,chain:e},e);h&&(c=h.address)}return o&&s&&await D.handleAuthAccountSwitch({address:s,namespace:e}),c},async switchConnection({connection:t,address:e,namespace:s,closeModalOnConnect:n,onChange:i}){var c;let r;const o=(c=f.getAccountData(s))==null?void 0:c.caipAddress;if(o){const{address:l}=Je.parseCaipAddress(o);r=l}const a=Rr.getConnectionStatus(t,s);switch(a){case"connected":case"active":{const l=await D.handleActiveConnection({connection:t,namespace:s,address:e});if(r&&l){const d=l.toLowerCase()!==r.toLowerCase();i==null||i({address:l,namespace:s,hasSwitchedAccount:d,hasSwitchedWallet:a==="active"})}break}case"disconnected":{const l=await D.handleDisconnectedConnection({connection:t,namespace:s,address:e,closeModalOnConnect:n});l&&(i==null||i({address:l,namespace:s,hasSwitchedAccount:!0,hasSwitchedWallet:!0}));break}default:throw new Error(`Invalid connection status: ${a}`)}}},D=Wt(vf),uo={createBalance(t,e){const s={name:t.metadata.name||"",symbol:t.metadata.symbol||"",decimals:t.metadata.decimals||0,value:t.metadata.value||0,price:t.metadata.price||0,iconUrl:t.metadata.iconUrl||""};return{name:s.name,symbol:s.symbol,chainId:e,address:t.address==="native"?void 0:this.convertAddressToCAIP10Address(t.address,e),value:s.value,price:s.price,quantity:{decimals:s.decimals.toString(),numeric:this.convertHexToBalance({hex:t.balance,decimals:s.decimals})},iconUrl:s.iconUrl}},convertHexToBalance({hex:t,decimals:e}){return jd(BigInt(t),e)},convertAddressToCAIP10Address(t,e){return`${e}:${t}`},createCAIP2ChainId(t,e){return`${e}:${parseInt(t,16)}`},getChainIdHexFromCAIP2ChainId(t){const e=t.split(":");if(e.length<2||!e[1])return"0x0";const s=e[1],n=parseInt(s,10);return isNaN(n)?"0x0":`0x${n.toString(16)}`},isWalletGetAssetsResponse(t){return typeof t!="object"||t===null?!1:Object.values(t).every(e=>Array.isArray(e)&&e.every(s=>this.isValidAsset(s)))},isValidAsset(t){return typeof t=="object"&&t!==null&&typeof t.address=="string"&&typeof t.balance=="string"&&(t.type==="ERC20"||t.type==="NATIVE")&&typeof t.metadata=="object"&&t.metadata!==null&&typeof t.metadata.name=="string"&&typeof t.metadata.symbol=="string"&&typeof t.metadata.decimals=="number"&&typeof t.metadata.price=="number"&&typeof t.metadata.iconUrl=="string"}};let po;async function Oc(){if(!po){const{createPublicClient:t,http:e,defineChain:s}=await Or(async()=>{const{createPublicClient:n,http:i,defineChain:r}=await import("./index-CKx7VMlz.js");return{createPublicClient:n,http:i,defineChain:r}},__vite__mapDeps([0,1,2,3,4]),import.meta.url);po={createPublicClient:t,http:e,defineChain:s}}return po}const Zo={getBlockchainApiRpcUrl(t,e){const s=new URL("https://rpc.walletconnect.org/v1/");return s.searchParams.set("chainId",t),s.searchParams.set("projectId",e),s.toString()},async getViemChain(t){const{defineChain:e}=await Oc(),{chainId:s}=Je.parseCaipNetworkId(t.caipNetworkId);return e({...t,id:Number(s)})},async createViemPublicClient(t){const{createPublicClient:e,http:s}=await Oc(),n=_.state.projectId,i=await Zo.getViemChain(t);if(!i)throw new Error(`Chain ${t.caipNetworkId} not found in viem/chains`);return e({chain:i,transport:s(Zo.getBlockchainApiRpcUrl(t.caipNetworkId,n))})}},Ha={async getMyTokensWithBalance(t={forceUpdate:void 0,caipNetwork:f.state.activeCaipNetwork,address:(e=>(e=f.getAccountData())==null?void 0:e.address)()}){const{forceUpdate:s,caipNetwork:n,address:i}=t,r=U.getConnectorId("eip155")===I.CONNECTOR_ID.AUTH;if(!i)return[];const o=n?`${n.caipNetworkId}:${i}`:i,a=k.getBalanceCacheForCaipAddress(o);if(a)return a.balances;if(n&&n.chainNamespace===I.CHAIN.EVM&&r){const l=await this.getEIP155Balances(i,n);if(l)return this.filterLowQualityTokens(l)}const c=await te.getBalance(i,n==null?void 0:n.caipNetworkId,s);return this.filterLowQualityTokens(c.balances)},async getEIP155Balances(t,e){var s,n;try{const i=uo.getChainIdHexFromCAIP2ChainId(e.caipNetworkId),r=await D.getCapabilities(t);if(!((n=(s=r==null?void 0:r[i])==null?void 0:s.assetDiscovery)!=null&&n.supported))return null;const o=await D.walletGetAssets({account:t,chainFilter:[i]});if(!uo.isWalletGetAssetsResponse(o))return null;const c=(o[i]||[]).map(l=>uo.createBalance(l,e.caipNetworkId));return k.updateBalanceCache({caipAddress:`${e.caipNetworkId}:${t}`,balance:{balances:c},timestamp:Date.now()}),c}catch{return null}},filterLowQualityTokens(t){return t.filter(e=>e.quantity.decimals!=="0")},async fetchERC20Balance({caipAddress:t,assetAddress:e,caipNetwork:s}){const n=await Zo.createViemPublicClient(s),{address:i}=Je.parseCaipAddress(t),[{result:r},{result:o},{result:a},{result:c}]=await n.multicall({contracts:[{address:e,functionName:"name",args:[],abi:tr},{address:e,functionName:"symbol",args:[],abi:tr},{address:e,functionName:"balanceOf",args:[i],abi:tr},{address:e,functionName:"decimals",args:[],abi:tr}]});return{name:r,symbol:o,decimals:c,balance:a&&c?jd(a,c):"0"}}},fo={adapters:{}},ih={state:fo,initialize(t){fo.adapters={...t}},get(t){return fo.adapters[t]}},Ur={eip155:void 0,solana:void 0,polkadot:void 0,bip122:void 0,cosmos:void 0,sui:void 0,stacks:void 0,ton:void 0},dt=xe({providers:{...Ur},providerIds:{...Ur}}),Oe={state:dt,subscribeKey(t,e){return Ze(dt,t,e)},subscribe(t){return Xe(dt,()=>{t(dt)})},subscribeProviders(t){return Xe(dt.providers,()=>t(dt.providers))},setProvider(t,e){t&&e&&(dt.providers[t]=Mi(e))},getProvider(t){if(t)return dt.providers[t]},setProviderId(t,e){e&&(dt.providerIds[t]=e)},getProviderId(t){if(t)return dt.providerIds[t]},reset(){dt.providers={...Ur},dt.providerIds={...Ur}},resetChain(t){dt.providers[t]=void 0,dt.providerIds[t]=void 0}},Af={async getTokenList(t){var n;const e=await te.fetchSwapTokens({chainId:t});return((n=e==null?void 0:e.tokens)==null?void 0:n.map(i=>({...i,eip2612:!1,quantity:{decimals:"0",numeric:"0"},price:0,value:0})))||[]},async fetchGasPrice(){var e;const t=f.state.activeCaipNetwork;if(!t)return null;try{if(t.chainNamespace==="solana"){const s=(e=await(D==null?void 0:D.estimateGas({chainNamespace:"solana"})))==null?void 0:e.toString();return{standard:s,fast:s,instant:s}}else return await te.fetchGasPrice({chainId:t.caipNetworkId})}catch{return null}},async fetchSwapAllowance({tokenAddress:t,userAddress:e,sourceTokenAmount:s,sourceTokenDecimals:n}){const i=await te.fetchSwapAllowance({tokenAddress:t,userAddress:e});if(i!=null&&i.allowance&&s&&n){const r=D.parseUnits(s,n)||0;return BigInt(i.allowance)>=r}return!1},async getMyTokensWithBalance(t){var s;const e=await Ha.getMyTokensWithBalance({forceUpdate:t,caipNetwork:f.state.activeCaipNetwork,address:(s=f.getAccountData())==null?void 0:s.address});return f.setAccountProp("tokenBalance",e,f.state.activeChain),this.mapBalancesToSwapTokens(e)},mapBalancesToSwapTokens(t){return(t==null?void 0:t.map(e=>({...e,address:e!=null&&e.address?e.address:nh(),decimals:parseInt(e.quantity.decimals,10),logoUri:e.iconUrl,eip2612:!1})))||[]},async handleSwapError(t){var e,s;try{const n=t==null?void 0:t.cause;if(!(n!=null&&n.json))return;const i=await n.json(),r=(s=(e=i==null?void 0:i.reasons)==null?void 0:e[0])==null?void 0:s.description;return r!=null&&r.includes("insufficient liquidity")?"Insufficient liquidity":void 0}catch{return}}},we=xe({tokenBalances:[],loading:!1}),If={state:we,subscribe(t){return Xe(we,()=>t(we))},subscribeKey(t,e){return Ze(we,t,e)},setToken(t){t&&(we.token=Mi(t))},setTokenAmount(t){we.sendTokenAmount=t},setReceiverAddress(t){we.receiverAddress=t},setReceiverProfileImageUrl(t){we.receiverProfileImageUrl=t},setReceiverProfileName(t){we.receiverProfileName=t},setNetworkBalanceInUsd(t){we.networkBalanceInUSD=t},setLoading(t){we.loading=t},getSdkEventProperties(t){var e,s,n;return{message:j.parseError(t),isSmartAccount:Bt(f.state.activeChain)===Is.ACCOUNT_TYPES.SMART_ACCOUNT,token:((e=we.token)==null?void 0:e.symbol)||"",amount:(s=we.sendTokenAmount)!=null?s:0,network:((n=f.state.activeCaipNetwork)==null?void 0:n.caipNetworkId)||""}},async sendToken(){var t;try{switch(ae.setLoading(!0),(t=f.state.activeCaipNetwork)==null?void 0:t.chainNamespace){case"eip155":await ae.sendEvmToken();return;case"solana":await ae.sendSolanaToken();return;default:throw new Error("Unsupported chain")}}catch(e){throw As.isUserRejectedRequestError(e)?new Zd(e):e}finally{ae.setLoading(!1)}},async sendEvmToken(){var s,n,i;const t=f.state.activeChain;if(!t)throw new Error("SendController:sendEvmToken - activeChainNamespace is required");const e=Bt(t);if(!ae.state.sendTokenAmount||!ae.state.receiverAddress)throw new Error("An amount and receiver address are required");if(!ae.state.token)throw new Error("A token is required");if((s=ae.state.token)!=null&&s.address){oe.sendEvent({type:"track",event:"SEND_INITIATED",properties:{isSmartAccount:e===Is.ACCOUNT_TYPES.SMART_ACCOUNT,token:ae.state.token.address,amount:ae.state.sendTokenAmount,network:((n=f.state.activeCaipNetwork)==null?void 0:n.caipNetworkId)||""}});const{hash:r}=await ae.sendERC20Token({receiverAddress:ae.state.receiverAddress,tokenAddress:ae.state.token.address,sendTokenAmount:ae.state.sendTokenAmount,decimals:ae.state.token.quantity.decimals});r&&(we.hash=r)}else{oe.sendEvent({type:"track",event:"SEND_INITIATED",properties:{isSmartAccount:e===Is.ACCOUNT_TYPES.SMART_ACCOUNT,token:ae.state.token.symbol||"",amount:ae.state.sendTokenAmount,network:((i=f.state.activeCaipNetwork)==null?void 0:i.caipNetworkId)||""}});const{hash:r}=await ae.sendNativeToken({receiverAddress:ae.state.receiverAddress,sendTokenAmount:ae.state.sendTokenAmount,decimals:ae.state.token.quantity.decimals});r&&(we.hash=r)}},async fetchTokenBalance(t){var o,a,c,l;we.loading=!0;const e=f.state.activeChain,s=(o=f.state.activeCaipNetwork)==null?void 0:o.caipNetworkId,n=(a=f.state.activeCaipNetwork)==null?void 0:a.chainNamespace,i=(l=(c=f.getAccountData(e))==null?void 0:c.caipAddress)!=null?l:f.state.activeCaipAddress,r=i?j.getPlainAddress(i):void 0;if(we.lastRetry&&!j.isAllowedRetry(we.lastRetry,30*le.ONE_SEC_MS))return we.loading=!1,[];try{if(r&&s&&n){const d=await Ha.getMyTokensWithBalance();return we.tokenBalances=d,we.lastRetry=void 0,d}}catch(d){we.lastRetry=Date.now(),t==null||t(d),as.showError("Token Balance Unavailable")}finally{we.loading=!1}return[]},fetchNetworkBalance(){if(we.tokenBalances.length===0)return;const t=Af.mapBalancesToSwapTokens(we.tokenBalances);if(!t)return;const e=t.find(s=>s.address===nh());e&&(we.networkBalanceInUSD=e?Xd.multiply(e.quantity.numeric,e.price).toString():"0")},async sendNativeToken(t){var o,a,c,l;ee.pushTransactionStack({});const e=t.receiverAddress,s=(o=f.getAccountData())==null?void 0:o.address,n=D.parseUnits(t.sendTokenAmount.toString(),Number(t.decimals)),r=await D.sendTransaction({chainNamespace:I.CHAIN.EVM,to:e,address:s,data:"0x",value:n!=null?n:BigInt(0)});return oe.sendEvent({type:"track",event:"SEND_SUCCESS",properties:{isSmartAccount:Bt("eip155")===Is.ACCOUNT_TYPES.SMART_ACCOUNT,token:((a=ae.state.token)==null?void 0:a.symbol)||"",amount:t.sendTokenAmount,network:((c=f.state.activeCaipNetwork)==null?void 0:c.caipNetworkId)||"",hash:r||""}}),(l=D._getClient())==null||l.updateBalance("eip155"),ae.resetSend(),{hash:r}},async sendERC20Token(t){var n,i,r;ee.pushTransactionStack({onSuccess(){ee.replace("Account")}});const e=D.parseUnits(t.sendTokenAmount.toString(),Number(t.decimals)),s=(n=f.getAccountData())==null?void 0:n.address;if(s&&t.sendTokenAmount&&t.receiverAddress&&t.tokenAddress){const o=j.getPlainAddress(t.tokenAddress);if(!o)throw new Error("SendController:sendERC20Token - tokenAddress is required");const a=await D.writeContract({fromAddress:s,tokenAddress:o,args:[t.receiverAddress,e!=null?e:BigInt(0)],method:"transfer",abi:Dp.getERC20Abi(o),chainNamespace:I.CHAIN.EVM});return oe.sendEvent({type:"track",event:"SEND_SUCCESS",properties:{isSmartAccount:Bt("eip155")===Is.ACCOUNT_TYPES.SMART_ACCOUNT,token:((i=ae.state.token)==null?void 0:i.symbol)||"",amount:t.sendTokenAmount,network:((r=f.state.activeCaipNetwork)==null?void 0:r.caipNetworkId)||"",hash:a||""}}),ae.resetSend(),{hash:a}}return{hash:void 0}},async sendSolanaToken(){var s,n,i;if(!ae.state.sendTokenAmount||!ae.state.receiverAddress)throw new Error("An amount and receiver address are required");ee.pushTransactionStack({onSuccess(){ee.replace("Account")}});let t;ae.state.token&&ae.state.token.address!==le.SOLANA_NATIVE_TOKEN_ADDRESS&&(j.isCaipAddress(ae.state.token.address)?t=j.getPlainAddress(ae.state.token.address):t=ae.state.token.address);const e=await D.sendTransaction({chainNamespace:"solana",tokenMint:t,to:ae.state.receiverAddress,value:ae.state.sendTokenAmount});e&&(we.hash=e),(s=D._getClient())==null||s.updateBalance("solana"),oe.sendEvent({type:"track",event:"SEND_SUCCESS",properties:{isSmartAccount:!1,token:((n=ae.state.token)==null?void 0:n.symbol)||"",amount:ae.state.sendTokenAmount,network:((i=f.state.activeCaipNetwork)==null?void 0:i.caipNetworkId)||"",hash:e||""}}),ae.resetSend()},resetSend(){we.token=void 0,we.sendTokenAmount=void 0,we.receiverAddress=void 0,we.receiverProfileImageUrl=void 0,we.receiverProfileName=void 0,we.loading=!1,we.tokenBalances=[]}},ae=Wt(If),go={currentTab:0,tokenBalance:[],smartAccountDeployed:!1,addressLabels:new Map,user:void 0,preferredAccountType:void 0},rr={caipNetwork:void 0,supportsAllNetworks:!0,smartAccountEnabledNetworks:[]},W=xe({chains:Jp(),activeCaipAddress:void 0,activeChain:void 0,activeCaipNetwork:void 0,noAdapters:!1,universalAdapter:{connectionControllerClient:void 0},isSwitchingNamespace:!1}),rh={state:W,subscribe(t){return Xe(W,()=>{t(W)})},subscribeKey(t,e){return Ze(W,t,e)},subscribeAccountStateProp(t,e,s){var i;const n=s||W.activeChain;return n?Ze(((i=W.chains.get(n))==null?void 0:i.accountState)||{},t,e):()=>{}},subscribeChainProp(t,e,s){let n;return Xe(W.chains,()=>{var r;const i=s||W.activeChain;if(i){const o=(r=W.chains.get(i))==null?void 0:r[t];n!==o&&(n=o,e(o))}})},initialize(t,e,s){var d;const{chainId:n,namespace:i}=k.getActiveNetworkProps(),r=e==null?void 0:e.find(h=>h.id.toString()===(n==null?void 0:n.toString())),a=t.find(h=>(h==null?void 0:h.namespace)===i)||(t==null?void 0:t[0]),c=t.map(h=>h.namespace).filter(h=>h!==void 0),l=_.state.enableEmbedded?new Set([...c]):new Set([...(d=e==null?void 0:e.map(h=>h.chainNamespace))!=null?d:[]]);((t==null?void 0:t.length)===0||!a)&&(W.noAdapters=!0),W.noAdapters||(W.activeChain=a==null?void 0:a.namespace,W.activeCaipNetwork=r,f.setChainNetworkData(a==null?void 0:a.namespace,{caipNetwork:r}),W.activeChain&&Jt.set({activeChain:a==null?void 0:a.namespace})),l.forEach(h=>{const u=e==null?void 0:e.filter(y=>y.chainNamespace===h),p=k.getPreferredAccountTypes()||{},m={..._.state.defaultAccountTypes,...p};f.state.chains.set(h,{namespace:h,networkState:xe({...rr,caipNetwork:u==null?void 0:u[0]}),accountState:xe({...go,preferredAccountType:m[h]}),caipNetworks:u!=null?u:[],...s}),f.setRequestedCaipNetworks(u!=null?u:[],h)})},removeAdapter(t){var e,s;if(W.activeChain===t){const n=Array.from(W.chains.entries()).find(([i])=>i!==t);if(n){const i=(s=(e=n[1])==null?void 0:e.caipNetworks)==null?void 0:s[0];i&&f.setActiveCaipNetwork(i)}}W.chains.delete(t)},addAdapter(t,{connectionControllerClient:e},s){var n;if(!t.namespace)throw new Error("ChainController:addAdapter - adapter must have a namespace");W.chains.set(t.namespace,{namespace:t.namespace,networkState:{...rr,caipNetwork:s[0]},accountState:{...go},caipNetworks:s,connectionControllerClient:e}),f.setRequestedCaipNetworks((n=s==null?void 0:s.filter(i=>i.chainNamespace===t.namespace))!=null?n:[],t.namespace)},addNetwork(t){var s;const e=W.chains.get(t.chainNamespace);if(e){const n=[...e.caipNetworks||[]];(s=e.caipNetworks)!=null&&s.find(i=>i.id===t.id)||n.push(t),W.chains.set(t.chainNamespace,{...e,caipNetworks:n}),f.setRequestedCaipNetworks(n,t.chainNamespace),U.filterByNamespace(t.chainNamespace,!0)}},removeNetwork(t,e){var n,i,r;const s=W.chains.get(t);if(s){const o=((n=W.activeCaipNetwork)==null?void 0:n.id)===e,a=[...((i=s.caipNetworks)==null?void 0:i.filter(c=>c.id!==e))||[]];o&&((r=s==null?void 0:s.caipNetworks)!=null&&r[0])&&f.setActiveCaipNetwork(s.caipNetworks[0]),W.chains.set(t,{...s,caipNetworks:a}),f.setRequestedCaipNetworks(a||[],t),a.length===0&&U.filterByNamespace(t,!1)}},setAdapterNetworkState(t,e){const s=W.chains.get(t);s&&(s.networkState={...s.networkState||rr,...e},W.chains.set(t,s))},setChainAccountData(t,e,s=!0){if(!t)throw new Error("Chain is required to update chain account data");const n=W.chains.get(t);if(n){const i={...n.accountState||go,...e};W.chains.set(t,{...n,accountState:i}),(W.chains.size===1||W.activeChain===t)&&e.caipAddress&&(W.activeCaipAddress=e.caipAddress)}},setChainNetworkData(t,e){if(!t)return;const s=W.chains.get(t);if(s){const n={...s.networkState||rr,...e};W.chains.set(t,{...s,networkState:n})}},setAccountProp(t,e,s,n=!0){f.setChainAccountData(s,{[t]:e},n)},setActiveNamespace(t){var n,i;W.activeChain=t;const e=t?W.chains.get(t):void 0,s=(n=e==null?void 0:e.networkState)==null?void 0:n.caipNetwork;s!=null&&s.id&&t&&(W.activeCaipAddress=(i=e==null?void 0:e.accountState)==null?void 0:i.caipAddress,W.activeCaipNetwork=s,f.setChainNetworkData(t,{caipNetwork:s}),k.setActiveCaipNetworkId(s==null?void 0:s.caipNetworkId),Jt.set({activeChain:t,selectedNetworkId:s==null?void 0:s.caipNetworkId}))},setActiveCaipNetwork(t){var r,o;if(!t)return;const e=W.activeChain===t.chainNamespace;e||f.setIsSwitchingNamespace(!0);const s=W.chains.get(t.chainNamespace);W.activeChain=t.chainNamespace,W.activeCaipNetwork=t,f.setChainNetworkData(t.chainNamespace,{caipNetwork:t});let n=(r=s==null?void 0:s.accountState)==null?void 0:r.address;if(n)W.activeCaipAddress=`${t.chainNamespace}:${t.id}:${n}`;else if(e&&W.activeCaipAddress){const{address:a}=Je.parseCaipAddress(W.activeCaipAddress);n=a,W.activeCaipAddress=`${t.caipNetworkId}:${n}`}else W.activeCaipAddress=void 0;f.setChainAccountData(t.chainNamespace,{address:n,caipAddress:W.activeCaipAddress}),ae.resetSend(),Jt.set({activeChain:W.activeChain,selectedNetworkId:(o=W.activeCaipNetwork)==null?void 0:o.caipNetworkId}),k.setActiveCaipNetworkId(t.caipNetworkId),!f.checkIfSupportedNetwork(t.chainNamespace)&&_.state.enableNetworkSwitch&&!_.state.allowUnsupportedChain&&!D.state.wcBasic&&f.showUnsupportedChainUI()},addCaipNetwork(t){var s;if(!t)return;const e=W.chains.get(t.chainNamespace);e&&((s=e==null?void 0:e.caipNetworks)==null||s.push(t))},async switchActiveNamespace(t){var i;if(!t)return;const e=t!==f.state.activeChain,s=(i=f.getNetworkData(t))==null?void 0:i.caipNetwork,n=f.getCaipNetworkByNamespace(t,s==null?void 0:s.id);e&&n&&await f.switchActiveNetwork(n)},async switchActiveNetwork(t,{throwOnFailure:e=!1}={}){var o;const s=f.state.activeChain;if(!s)throw new Error("ChainController:switchActiveNetwork - namespace is required");const n=Oe.getProviderId(W.activeChain)==="AUTH",i=(o=f.getAccountData(s))==null?void 0:o.address,r=I.AUTH_CONNECTOR_SUPPORTED_CHAINS.includes(t.chainNamespace);try{if(i&&t.chainNamespace===s||n&&r){const a=ih.get(t.chainNamespace);if(!a)throw new Error("Adapter not found");await a.switchNetwork({caipNetwork:t})}f.setActiveCaipNetwork(t)}catch(a){if(e)throw a}oe.sendEvent({type:"track",event:"SWITCH_NETWORK",properties:{network:t.caipNetworkId}})},getConnectionControllerClient(t){const e=t||W.activeChain;if(!e)throw new Error("Chain is required to get connection controller client");const s=W.chains.get(e);if(!(s!=null&&s.connectionControllerClient))throw new Error("ConnectionController client not set");return s.connectionControllerClient},getNetworkProp(t,e){var n;const s=(n=W.chains.get(e))==null?void 0:n.networkState;if(s)return s[t]},getRequestedCaipNetworks(t){const e=W.chains.get(t),{approvedCaipNetworkIds:s=[],requestedCaipNetworks:n=[]}=(e==null?void 0:e.networkState)||{};return j.sortRequestedNetworks(s,n).filter(o=>o==null?void 0:o.id)},getAllRequestedCaipNetworks(){const t=[];return W.chains.forEach(e=>{if(!e.namespace)throw new Error("ChainController:getAllRequestedCaipNetworks - chainAdapter must have a namespace");const s=f.getRequestedCaipNetworks(e.namespace);t.push(...s)}),t},setRequestedCaipNetworks(t,e){f.setAdapterNetworkState(e,{requestedCaipNetworks:t});const n=f.getAllRequestedCaipNetworks().map(r=>r.chainNamespace),i=Array.from(new Set(n));U.filterByNamespaces(i)},getAllApprovedCaipNetworkIds(){const t=[];return W.chains.forEach(e=>{if(!e.namespace)throw new Error("ChainController:getAllApprovedCaipNetworkIds - chainAdapter must have a namespace");const s=f.getApprovedCaipNetworkIds(e.namespace);t.push(...s)}),t},getActiveCaipNetwork(t){var e,s;return t?(s=(e=W.chains.get(t))==null?void 0:e.networkState)==null?void 0:s.caipNetwork:W.activeCaipNetwork},getActiveCaipAddress(){return W.activeCaipAddress},getApprovedCaipNetworkIds(t){var n;const e=W.chains.get(t);return((n=e==null?void 0:e.networkState)==null?void 0:n.approvedCaipNetworkIds)||[]},setApprovedCaipNetworksData(t,e){f.setAdapterNetworkState(t,e)},checkIfSupportedNetwork(t,e){var i;const s=e||((i=W.activeCaipNetwork)==null?void 0:i.caipNetworkId),n=f.getRequestedCaipNetworks(t);return n.length?n==null?void 0:n.some(r=>r.caipNetworkId===s):!0},checkIfSupportedChainId(t){if(!W.activeChain)return!0;const e=f.getRequestedCaipNetworks(W.activeChain);return e==null?void 0:e.some(s=>s.id===t)},checkIfSmartAccountEnabled(){var n,i;const t=zd.caipNetworkIdToNumber((n=W.activeCaipNetwork)==null?void 0:n.caipNetworkId);if(!W.activeChain||!t)return!1;const s=((i=Zp.get(Cr.SMART_ACCOUNT_ENABLED_NETWORKS))==null?void 0:i.split(","))||[];return!!(s!=null&&s.includes(t.toString()))},showUnsupportedChainUI(){de.open({view:"UnsupportedChain"})},checkIfNamesSupported(){const t=W.activeCaipNetwork;return!!(t!=null&&t.chainNamespace&&le.NAMES_SUPPORTED_CHAIN_NAMESPACES.includes(t.chainNamespace))},resetNetwork(t){f.setAdapterNetworkState(t,{approvedCaipNetworkIds:void 0,supportsAllNetworks:!0})},resetAccount(t){var i,r;const e=t;if(!e)throw new Error("Chain is required to set account prop");const s=(r=(i=f.state.chains.get(e))==null?void 0:i.accountState)==null?void 0:r.preferredAccountType,n=_.state.defaultAccountTypes[e];W.activeCaipAddress=void 0,f.setChainAccountData(e,{smartAccountDeployed:!1,currentTab:0,caipAddress:void 0,address:void 0,balance:void 0,balanceSymbol:void 0,profileName:void 0,profileImage:void 0,addressExplorerUrl:void 0,tokenBalance:[],connectedWalletInfo:void 0,preferredAccountType:n||s,socialProvider:void 0,socialWindow:void 0,farcasterUrl:void 0,user:void 0,status:"disconnected"}),U.removeConnectorId(e)},setIsSwitchingNamespace(t){W.isSwitchingNamespace=t},getFirstCaipNetworkSupportsAuthConnector(){var s,n;const t=[];let e;if(W.chains.forEach(i=>{I.AUTH_CONNECTOR_SUPPORTED_CHAINS.find(r=>r===i.namespace)&&i.namespace&&t.push(i.namespace)}),t.length>0){const i=t[0];return e=i?(n=(s=W.chains.get(i))==null?void 0:s.caipNetworks)==null?void 0:n[0]:void 0,e}},getAccountData(t){var s;const e=t||W.activeChain;if(e)return(s=f.state.chains.get(e))==null?void 0:s.accountState},getNetworkData(t){var s;const e=t||W.activeChain;if(e)return(s=f.state.chains.get(e))==null?void 0:s.networkState},getCaipNetworkByNamespace(t,e){var i,r,o;if(!t)return;const s=f.state.chains.get(t),n=(i=s==null?void 0:s.caipNetworks)==null?void 0:i.find(a=>a.id.toString()===(e==null?void 0:e.toString()));return n||((r=s==null?void 0:s.networkState)==null?void 0:r.caipNetwork)||((o=s==null?void 0:s.caipNetworks)==null?void 0:o[0])},getRequestedCaipNetworkIds(){const t=U.state.filterByNamespace;return(t?[W.chains.get(t)]:Array.from(W.chains.values())).flatMap(s=>(s==null?void 0:s.caipNetworks)||[]).map(s=>s.caipNetworkId)},getCaipNetworks(t){return t?f.getRequestedCaipNetworks(t):f.getAllRequestedCaipNetworks()},getCaipNetworkById(t,e){return rh.getCaipNetworks(e).find(s=>s.id.toString()===t.toString()||s.caipNetworkId.toString()===t.toString())},setLastConnectedSIWECaipNetwork(t){W.lastConnectedSIWECaipNetwork=t},getLastConnectedSIWECaipNetwork(){return W.lastConnectedSIWECaipNetwork},async fetchTokenBalance(t){var o,a;const e=f.getAccountData();if(!e)return[];const s=(o=f.state.activeCaipNetwork)==null?void 0:o.caipNetworkId,n=(a=f.state.activeCaipNetwork)==null?void 0:a.chainNamespace,i=f.state.activeCaipAddress,r=i?j.getPlainAddress(i):void 0;if(f.setAccountProp("balanceLoading",!0,n),e.lastRetry&&!j.isAllowedRetry(e.lastRetry,30*le.ONE_SEC_MS))return f.setAccountProp("balanceLoading",!1,n),[];try{if(r&&s&&n){const c=await Ha.getMyTokensWithBalance();return f.setAccountProp("tokenBalance",c,n),f.setAccountProp("lastRetry",void 0,n),f.setAccountProp("balanceLoading",!1,n),c}}catch(c){f.setAccountProp("lastRetry",Date.now(),n),t==null||t(c),as.showError("Token Balance Unavailable")}finally{f.setAccountProp("balanceLoading",!1,n)}return[]},isCaipNetworkDisabled(t){var c;const e=t.chainNamespace,s=!!((c=f.getAccountData(e))!=null&&c.caipAddress),n=f.getAllApprovedCaipNetworkIds(),i=f.getNetworkProp("supportsAllNetworks",e)!==!1,r=U.getConnectorId(e),o=U.getAuthConnector(),a=r===I.CONNECTOR_ID.AUTH&&o;return!s||i||a?!1:!(n!=null&&n.includes(t.caipNetworkId))}},f=Wt(rh),Nf={onSwitchNetwork({network:t,ignoreSwitchConfirmation:e=!1}){var u,p;const s=f.state.activeCaipNetwork,n=f.state.activeChain,i=ee.state.data;if(t.id===(s==null?void 0:s.id))return;const o=!!((u=f.getAccountData(n))!=null&&u.address),a=!!((p=f.getAccountData(t.chainNamespace))!=null&&p.address),c=t.chainNamespace!==n,d=U.getConnectorId(n)===I.CONNECTOR_ID.AUTH,h=I.AUTH_CONNECTOR_SUPPORTED_CHAINS.find(m=>m===t.chainNamespace);e||d&&h?ee.push("SwitchNetwork",{...i,network:t}):o&&c&&!a?ee.push("SwitchActiveChain",{switchToChain:t.chainNamespace,navigateTo:"Connect",navigateWithReplace:!0,network:t}):ee.push("SwitchNetwork",{...i,network:t})}},ht=xe({loading:!1,loadingNamespaceMap:new Map,open:!1,shake:!1,namespace:void 0}),_f={state:ht,subscribe(t){return Xe(ht,()=>t(ht))},subscribeKey(t,e){return Ze(ht,t,e)},async open(t){var o,a;const e=t==null?void 0:t.namespace,s=f.state.activeChain,n=e&&e!==s,i=(o=f.getAccountData(t==null?void 0:t.namespace))==null?void 0:o.caipAddress,r=f.state.noAdapters;if(D.state.wcBasic?z.prefetch({fetchNetworkImages:!1,fetchConnectorImages:!1,fetchWalletRanks:!1}):await z.prefetch(),U.setFilterByNamespace(t==null?void 0:t.namespace),de.setLoading(!0,e),e&&n){const c=((a=f.getNetworkData(e))==null?void 0:a.caipNetwork)||f.getRequestedCaipNetworks(e)[0];c&&(r?(await f.switchActiveNetwork(c),ee.push("ConnectingWalletConnectBasic")):Nf.onSwitchNetwork({network:c,ignoreSwitchConfirmation:!0}))}else _.state.manualWCControl||r&&!i?j.isMobile()?ee.reset("AllWallets"):ee.reset("ConnectingWalletConnectBasic"):t!=null&&t.view?ee.reset(t.view,t.data):i?ee.reset("Account"):ee.reset("Connect");ht.open=!0,Jt.set({open:!0}),oe.sendEvent({type:"track",event:"MODAL_OPEN",properties:{connected:!!i}})},close(){const t=_.state.enableEmbedded,e=!!f.state.activeCaipAddress;ht.open&&oe.sendEvent({type:"track",event:"MODAL_CLOSE",properties:{connected:e}}),ht.open=!1,ee.reset("Connect"),de.clearLoading(),t?e?ee.replace("Account"):ee.push("Connect"):Jt.set({open:!1}),D.resetUri()},setLoading(t,e){e&&ht.loadingNamespaceMap.set(e,t),ht.loading=t,Jt.set({loading:t})},clearLoading(){ht.loadingNamespaceMap.clear(),ht.loading=!1,Jt.set({loading:!1})},shake(){ht.shake||(ht.shake=!0,setTimeout(()=>{ht.shake=!1},500))}},de=Wt(_f),Si={id:"2b92315d-eab7-5bef-84fa-089a131333f5",name:"USD Coin",symbol:"USDC",networks:[{name:"ethereum-mainnet",display_name:"Ethereum",chain_id:"1",contract_address:"0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48"},{name:"polygon-mainnet",display_name:"Polygon",chain_id:"137",contract_address:"0x2791Bca1f2de4661ED88A30C99A7a9449Aa84174"}]},Qo={id:"USD",payment_method_limits:[{id:"card",min:"10.00",max:"7500.00"},{id:"ach_bank_account",min:"10.00",max:"25000.00"}]},Sf={providers:eh,selectedProvider:null,error:null,purchaseCurrency:Si,paymentCurrency:Qo,purchaseCurrencies:[Si],paymentCurrencies:[],quotesLoading:!1},be=xe(Sf),Tf={state:be,subscribe(t){return Xe(be,()=>t(be))},subscribeKey(t,e){return Ze(be,t,e)},setSelectedProvider(t){var e,s,n;if(t&&t.name==="meld"){const i=f.state.activeChain,r=i===I.CHAIN.SOLANA?"SOL":"USDC",o=i&&(n=(s=(e=f.state.chains.get(i))==null?void 0:e.accountState)==null?void 0:s.address)!=null?n:"",a=new URL(t.url);a.searchParams.append("publicKey",Xp),a.searchParams.append("destinationCurrencyCode",r),a.searchParams.append("walletAddress",o),a.searchParams.append("externalCustomerId",_.state.projectId),be.selectedProvider={...t,url:a.toString()}}else be.selectedProvider=t},setOnrampProviders(t){if(Array.isArray(t)&&t.every(e=>typeof e=="string")){const e=t,s=eh.filter(n=>e.includes(n.name));be.providers=s}else be.providers=[]},setPurchaseCurrency(t){be.purchaseCurrency=t},setPaymentCurrency(t){be.paymentCurrency=t},setPurchaseAmount(t){ea.state.purchaseAmount=t},setPaymentAmount(t){ea.state.paymentAmount=t},async getAvailableCurrencies(){const t=await te.getOnrampOptions();be.purchaseCurrencies=t.purchaseCurrencies,be.paymentCurrencies=t.paymentCurrencies,be.paymentCurrency=t.paymentCurrencies[0]||Qo,be.purchaseCurrency=t.purchaseCurrencies[0]||Si,await z.fetchCurrencyImages(t.paymentCurrencies.map(e=>e.id)),await z.fetchTokenImages(t.purchaseCurrencies.map(e=>e.symbol))},async getQuote(){var t,e;be.quotesLoading=!0;try{const s=await te.getOnrampQuote({purchaseCurrency:be.purchaseCurrency,paymentCurrency:be.paymentCurrency,amount:((t=be.paymentAmount)==null?void 0:t.toString())||"0",network:(e=be.purchaseCurrency)==null?void 0:e.symbol});return be.quotesLoading=!1,be.purchaseAmount=Number(s==null?void 0:s.purchaseAmount.amount),s}catch(s){return be.error=s.message,be.quotesLoading=!1,null}finally{be.quotesLoading=!1}},resetState(){be.selectedProvider=null,be.error=null,be.purchaseCurrency=Si,be.paymentCurrency=Qo,be.purchaseCurrencies=[Si],be.paymentCurrencies=[],be.paymentAmount=void 0,be.purchaseAmount=void 0,be.quotesLoading=!1}},ea=Wt(Tf);var Of=Object.defineProperty,kf=(t,e,s)=>e in t?Of(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,kc=(t,e,s)=>kf(t,typeof e!="symbol"?e+"":e,s);let xf=class extends ii{constructor(e){super(),this.opts=e,kc(this,"protocol","wc"),kc(this,"version",2)}};var Pf=Object.defineProperty,Rf=(t,e,s)=>e in t?Pf(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,Uf=(t,e,s)=>Rf(t,e+"",s);let $f=class extends ii{constructor(e,s){super(),this.core=e,this.logger=s,Uf(this,"records",new Map)}},Df=class{constructor(e,s){this.logger=e,this.core=s}},Lf=class extends ii{constructor(e,s){super(),this.relayer=e,this.logger=s}},Mf=class extends ii{constructor(e){super()}},Bf=class{constructor(e,s,n,i){this.core=e,this.logger=s,this.name=n}},Ff=class extends ii{constructor(e,s){super(),this.relayer=e,this.logger=s}},Wf=class extends ii{constructor(e,s){super(),this.core=e,this.logger=s}},jf=class{constructor(e,s,n){this.core=e,this.logger=s,this.store=n}};class qf{constructor(e,s){this.projectId=e,this.logger=s}}let Hf=class{constructor(e,s,n){this.core=e,this.logger=s,this.telemetryEnabled=n}};var Kf=Object.defineProperty,Vf=(t,e,s)=>e in t?Kf(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,xc=(t,e,s)=>Vf(t,typeof e!="symbol"?e+"":e,s);let zf=class{constructor(e){this.opts=e,xc(this,"protocol","wc"),xc(this,"version",2)}},Gf=class{constructor(e){this.client=e}};function Yf(t){const e=t.length;let s=0,n=0;for(;n<e;){let i=t.charCodeAt(n++);if((i&4294967168)===0){s++;continue}else if((i&4294965248)===0)s+=2;else{if(i>=55296&&i<=56319&&n<e){const r=t.charCodeAt(n);(r&64512)===56320&&(++n,i=((i&1023)<<10)+(r&1023)+65536)}(i&4294901760)===0?s+=3:s+=4}}return s}function Jf(t,e,s){const n=t.length;let i=s,r=0;for(;r<n;){let o=t.charCodeAt(r++);if((o&4294967168)===0){e[i++]=o;continue}else if((o&4294965248)===0)e[i++]=o>>6&31|192;else{if(o>=55296&&o<=56319&&r<n){const a=t.charCodeAt(r);(a&64512)===56320&&(++r,o=((o&1023)<<10)+(a&1023)+65536)}(o&4294901760)===0?(e[i++]=o>>12&15|224,e[i++]=o>>6&63|128):(e[i++]=o>>18&7|240,e[i++]=o>>12&63|128,e[i++]=o>>6&63|128)}e[i++]=o&63|128}}const Xf=new TextEncoder,Zf=50;function Qf(t,e,s){Xf.encodeInto(t,e.subarray(s))}function eg(t,e,s){t.length>Zf?Qf(t,e,s):Jf(t,e,s)}const tg=4096;function oh(t,e,s){let n=e;const i=n+s,r=[];let o="";for(;n<i;){const a=t[n++];if((a&128)===0)r.push(a);else if((a&224)===192){const c=t[n++]&63;r.push((a&31)<<6|c)}else if((a&240)===224){const c=t[n++]&63,l=t[n++]&63;r.push((a&31)<<12|c<<6|l)}else if((a&248)===240){const c=t[n++]&63,l=t[n++]&63,d=t[n++]&63;let h=(a&7)<<18|c<<12|l<<6|d;h>65535&&(h-=65536,r.push(h>>>10&1023|55296),h=56320|h&1023),r.push(h)}else r.push(a);r.length>=tg&&(o+=String.fromCharCode(...r),r.length=0)}return r.length>0&&(o+=String.fromCharCode(...r)),o}const sg=new TextDecoder,ng=200;function ig(t,e,s){const n=t.subarray(e,e+s);return sg.decode(n)}function rg(t,e,s){return s>ng?ig(t,e,s):oh(t,e,s)}class or{constructor(e,s){this.type=e,this.data=s}}class It extends Error{constructor(e){super(e);const s=Object.create(It.prototype);Object.setPrototypeOf(this,s),Object.defineProperty(this,"name",{configurable:!0,enumerable:!1,value:It.name})}}const hi=4294967295;function og(t,e,s){const n=s/4294967296,i=s;t.setUint32(e,n),t.setUint32(e+4,i)}function ah(t,e,s){const n=Math.floor(s/4294967296),i=s;t.setUint32(e,n),t.setUint32(e+4,i)}function ch(t,e){const s=t.getInt32(e),n=t.getUint32(e+4);return s*4294967296+n}function ag(t,e){const s=t.getUint32(e),n=t.getUint32(e+4);return s*4294967296+n}const cg=-1,lg=4294967296-1,dg=17179869184-1;function hg({sec:t,nsec:e}){if(t>=0&&e>=0&&t<=dg)if(e===0&&t<=lg){const s=new Uint8Array(4);return new DataView(s.buffer).setUint32(0,t),s}else{const s=t/4294967296,n=t&4294967295,i=new Uint8Array(8),r=new DataView(i.buffer);return r.setUint32(0,e<<2|s&3),r.setUint32(4,n),i}else{const s=new Uint8Array(12),n=new DataView(s.buffer);return n.setUint32(0,e),ah(n,4,t),s}}function ug(t){const e=t.getTime(),s=Math.floor(e/1e3),n=(e-s*1e3)*1e6,i=Math.floor(n/1e9);return{sec:s+i,nsec:n-i*1e9}}function pg(t){if(t instanceof Date){const e=ug(t);return hg(e)}else return null}function fg(t){const e=new DataView(t.buffer,t.byteOffset,t.byteLength);switch(t.byteLength){case 4:return{sec:e.getUint32(0),nsec:0};case 8:{const s=e.getUint32(0),n=e.getUint32(4),i=(s&3)*4294967296+n,r=s>>>2;return{sec:i,nsec:r}}case 12:{const s=ch(e,4),n=e.getUint32(0);return{sec:s,nsec:n}}default:throw new It(`Unrecognized data size for timestamp (expected 4, 8, or 12): ${t.length}`)}}function gg(t){const e=fg(t);return new Date(e.sec*1e3+e.nsec/1e6)}const mg={type:cg,encode:pg,decode:gg};class $r{constructor(){this.builtInEncoders=[],this.builtInDecoders=[],this.encoders=[],this.decoders=[],this.register(mg)}register({type:e,encode:s,decode:n}){if(e>=0)this.encoders[e]=s,this.decoders[e]=n;else{const i=-1-e;this.builtInEncoders[i]=s,this.builtInDecoders[i]=n}}tryToEncode(e,s){for(let n=0;n<this.builtInEncoders.length;n++){const i=this.builtInEncoders[n];if(i!=null){const r=i(e,s);if(r!=null){const o=-1-n;return new or(o,r)}}}for(let n=0;n<this.encoders.length;n++){const i=this.encoders[n];if(i!=null){const r=i(e,s);if(r!=null){const o=n;return new or(o,r)}}}return e instanceof or?e:null}decode(e,s,n){const i=s<0?this.builtInDecoders[-1-s]:this.decoders[s];return i?i(e,s,n):new or(s,e)}}$r.defaultCodec=new $r;function yg(t){return t instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer}function ta(t){return t instanceof Uint8Array?t:ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):yg(t)?new Uint8Array(t):Uint8Array.from(t)}const wg=100,bg=2048;class Ka{constructor(e){var s,n,i,r,o,a,c,l;this.entered=!1,this.extensionCodec=(s=e==null?void 0:e.extensionCodec)!=null?s:$r.defaultCodec,this.context=e==null?void 0:e.context,this.useBigInt64=(n=e==null?void 0:e.useBigInt64)!=null?n:!1,this.maxDepth=(i=e==null?void 0:e.maxDepth)!=null?i:wg,this.initialBufferSize=(r=e==null?void 0:e.initialBufferSize)!=null?r:bg,this.sortKeys=(o=e==null?void 0:e.sortKeys)!=null?o:!1,this.forceFloat32=(a=e==null?void 0:e.forceFloat32)!=null?a:!1,this.ignoreUndefined=(c=e==null?void 0:e.ignoreUndefined)!=null?c:!1,this.forceIntegerToFloat=(l=e==null?void 0:e.forceIntegerToFloat)!=null?l:!1,this.pos=0,this.view=new DataView(new ArrayBuffer(this.initialBufferSize)),this.bytes=new Uint8Array(this.view.buffer)}clone(){return new Ka({extensionCodec:this.extensionCodec,context:this.context,useBigInt64:this.useBigInt64,maxDepth:this.maxDepth,initialBufferSize:this.initialBufferSize,sortKeys:this.sortKeys,forceFloat32:this.forceFloat32,ignoreUndefined:this.ignoreUndefined,forceIntegerToFloat:this.forceIntegerToFloat})}reinitializeState(){this.pos=0}encodeSharedRef(e){if(this.entered)return this.clone().encodeSharedRef(e);try{return this.entered=!0,this.reinitializeState(),this.doEncode(e,1),this.bytes.subarray(0,this.pos)}finally{this.entered=!1}}encode(e){if(this.entered)return this.clone().encode(e);try{return this.entered=!0,this.reinitializeState(),this.doEncode(e,1),this.bytes.slice(0,this.pos)}finally{this.entered=!1}}doEncode(e,s){if(s>this.maxDepth)throw new Error(`Too deep objects in depth ${s}`);e==null?this.encodeNil():typeof e=="boolean"?this.encodeBoolean(e):typeof e=="number"?this.forceIntegerToFloat?this.encodeNumberAsFloat(e):this.encodeNumber(e):typeof e=="string"?this.encodeString(e):this.useBigInt64&&typeof e=="bigint"?this.encodeBigInt64(e):this.encodeObject(e,s)}ensureBufferSizeToWrite(e){const s=this.pos+e;this.view.byteLength<s&&this.resizeBuffer(s*2)}resizeBuffer(e){const s=new ArrayBuffer(e),n=new Uint8Array(s),i=new DataView(s);n.set(this.bytes),this.view=i,this.bytes=n}encodeNil(){this.writeU8(192)}encodeBoolean(e){e===!1?this.writeU8(194):this.writeU8(195)}encodeNumber(e){!this.forceIntegerToFloat&&Number.isSafeInteger(e)?e>=0?e<128?this.writeU8(e):e<256?(this.writeU8(204),this.writeU8(e)):e<65536?(this.writeU8(205),this.writeU16(e)):e<4294967296?(this.writeU8(206),this.writeU32(e)):this.useBigInt64?this.encodeNumberAsFloat(e):(this.writeU8(207),this.writeU64(e)):e>=-32?this.writeU8(224|e+32):e>=-128?(this.writeU8(208),this.writeI8(e)):e>=-32768?(this.writeU8(209),this.writeI16(e)):e>=-2147483648?(this.writeU8(210),this.writeI32(e)):this.useBigInt64?this.encodeNumberAsFloat(e):(this.writeU8(211),this.writeI64(e)):this.encodeNumberAsFloat(e)}encodeNumberAsFloat(e){this.forceFloat32?(this.writeU8(202),this.writeF32(e)):(this.writeU8(203),this.writeF64(e))}encodeBigInt64(e){e>=BigInt(0)?(this.writeU8(207),this.writeBigUint64(e)):(this.writeU8(211),this.writeBigInt64(e))}writeStringHeader(e){if(e<32)this.writeU8(160+e);else if(e<256)this.writeU8(217),this.writeU8(e);else if(e<65536)this.writeU8(218),this.writeU16(e);else if(e<4294967296)this.writeU8(219),this.writeU32(e);else throw new Error(`Too long string: ${e} bytes in UTF-8`)}encodeString(e){const n=Yf(e);this.ensureBufferSizeToWrite(5+n),this.writeStringHeader(n),eg(e,this.bytes,this.pos),this.pos+=n}encodeObject(e,s){const n=this.extensionCodec.tryToEncode(e,this.context);if(n!=null)this.encodeExtension(n);else if(Array.isArray(e))this.encodeArray(e,s);else if(ArrayBuffer.isView(e))this.encodeBinary(e);else if(typeof e=="object")this.encodeMap(e,s);else throw new Error(`Unrecognized object: ${Object.prototype.toString.apply(e)}`)}encodeBinary(e){const s=e.byteLength;if(s<256)this.writeU8(196),this.writeU8(s);else if(s<65536)this.writeU8(197),this.writeU16(s);else if(s<4294967296)this.writeU8(198),this.writeU32(s);else throw new Error(`Too large binary: ${s}`);const n=ta(e);this.writeU8a(n)}encodeArray(e,s){const n=e.length;if(n<16)this.writeU8(144+n);else if(n<65536)this.writeU8(220),this.writeU16(n);else if(n<4294967296)this.writeU8(221),this.writeU32(n);else throw new Error(`Too large array: ${n}`);for(const i of e)this.doEncode(i,s+1)}countWithoutUndefined(e,s){let n=0;for(const i of s)e[i]!==void 0&&n++;return n}encodeMap(e,s){const n=Object.keys(e);this.sortKeys&&n.sort();const i=this.ignoreUndefined?this.countWithoutUndefined(e,n):n.length;if(i<16)this.writeU8(128+i);else if(i<65536)this.writeU8(222),this.writeU16(i);else if(i<4294967296)this.writeU8(223),this.writeU32(i);else throw new Error(`Too large map object: ${i}`);for(const r of n){const o=e[r];this.ignoreUndefined&&o===void 0||(this.encodeString(r),this.doEncode(o,s+1))}}encodeExtension(e){if(typeof e.data=="function"){const n=e.data(this.pos+6),i=n.length;if(i>=4294967296)throw new Error(`Too large extension object: ${i}`);this.writeU8(201),this.writeU32(i),this.writeI8(e.type),this.writeU8a(n);return}const s=e.data.length;if(s===1)this.writeU8(212);else if(s===2)this.writeU8(213);else if(s===4)this.writeU8(214);else if(s===8)this.writeU8(215);else if(s===16)this.writeU8(216);else if(s<256)this.writeU8(199),this.writeU8(s);else if(s<65536)this.writeU8(200),this.writeU16(s);else if(s<4294967296)this.writeU8(201),this.writeU32(s);else throw new Error(`Too large extension object: ${s}`);this.writeI8(e.type),this.writeU8a(e.data)}writeU8(e){this.ensureBufferSizeToWrite(1),this.view.setUint8(this.pos,e),this.pos++}writeU8a(e){const s=e.length;this.ensureBufferSizeToWrite(s),this.bytes.set(e,this.pos),this.pos+=s}writeI8(e){this.ensureBufferSizeToWrite(1),this.view.setInt8(this.pos,e),this.pos++}writeU16(e){this.ensureBufferSizeToWrite(2),this.view.setUint16(this.pos,e),this.pos+=2}writeI16(e){this.ensureBufferSizeToWrite(2),this.view.setInt16(this.pos,e),this.pos+=2}writeU32(e){this.ensureBufferSizeToWrite(4),this.view.setUint32(this.pos,e),this.pos+=4}writeI32(e){this.ensureBufferSizeToWrite(4),this.view.setInt32(this.pos,e),this.pos+=4}writeF32(e){this.ensureBufferSizeToWrite(4),this.view.setFloat32(this.pos,e),this.pos+=4}writeF64(e){this.ensureBufferSizeToWrite(8),this.view.setFloat64(this.pos,e),this.pos+=8}writeU64(e){this.ensureBufferSizeToWrite(8),og(this.view,this.pos,e),this.pos+=8}writeI64(e){this.ensureBufferSizeToWrite(8),ah(this.view,this.pos,e),this.pos+=8}writeBigUint64(e){this.ensureBufferSizeToWrite(8),this.view.setBigUint64(this.pos,e),this.pos+=8}writeBigInt64(e){this.ensureBufferSizeToWrite(8),this.view.setBigInt64(this.pos,e),this.pos+=8}}function Eg(t,e){return new Ka(e).encodeSharedRef(t)}function mo(t){return`${t<0?"-":""}0x${Math.abs(t).toString(16).padStart(2,"0")}`}const Cg=16,vg=16;class Ag{constructor(e=Cg,s=vg){this.hit=0,this.miss=0,this.maxKeyLength=e,this.maxLengthPerKey=s,this.caches=[];for(let n=0;n<this.maxKeyLength;n++)this.caches.push([])}canBeCached(e){return e>0&&e<=this.maxKeyLength}find(e,s,n){const i=this.caches[n-1];e:for(const r of i){const o=r.bytes;for(let a=0;a<n;a++)if(o[a]!==e[s+a])continue e;return r.str}return null}store(e,s){const n=this.caches[e.length-1],i={bytes:e,str:s};n.length>=this.maxLengthPerKey?n[Math.random()*n.length|0]=i:n.push(i)}decode(e,s,n){const i=this.find(e,s,n);if(i!=null)return this.hit++,i;this.miss++;const r=oh(e,s,n),o=Uint8Array.prototype.slice.call(e,s,s+n);return this.store(o,r),r}}const sa="array",Ti="map_key",lh="map_value",Ig=t=>{if(typeof t=="string"||typeof t=="number")return t;throw new It("The type of key must be string or number but "+typeof t)};class Ng{constructor(){this.stack=[],this.stackHeadPosition=-1}get length(){return this.stackHeadPosition+1}top(){return this.stack[this.stackHeadPosition]}pushArrayState(e){const s=this.getUninitializedStateFromPool();s.type=sa,s.position=0,s.size=e,s.array=new Array(e)}pushMapState(e){const s=this.getUninitializedStateFromPool();s.type=Ti,s.readCount=0,s.size=e,s.map={}}getUninitializedStateFromPool(){if(this.stackHeadPosition++,this.stackHeadPosition===this.stack.length){const e={type:void 0,size:0,array:void 0,position:0,readCount:0,map:void 0,key:null};this.stack.push(e)}return this.stack[this.stackHeadPosition]}release(e){if(this.stack[this.stackHeadPosition]!==e)throw new Error("Invalid stack state. Released state is not on top of the stack.");if(e.type===sa){const n=e;n.size=0,n.array=void 0,n.position=0,n.type=void 0}if(e.type===Ti||e.type===lh){const n=e;n.size=0,n.map=void 0,n.readCount=0,n.type=void 0}this.stackHeadPosition--}reset(){this.stack.length=0,this.stackHeadPosition=-1}}const ui=-1,Va=new DataView(new ArrayBuffer(0)),_g=new Uint8Array(Va.buffer);try{Va.getInt8(0)}catch(t){if(!(t instanceof RangeError))throw new Error("This module is not supported in the current JavaScript engine because DataView does not throw RangeError on out-of-bounds access")}const Pc=new RangeError("Insufficient data"),Sg=new Ag;class za{constructor(e){var s,n,i,r,o,a,c,l,d;this.totalPos=0,this.pos=0,this.view=Va,this.bytes=_g,this.headByte=ui,this.stack=new Ng,this.entered=!1,this.extensionCodec=(s=e==null?void 0:e.extensionCodec)!=null?s:$r.defaultCodec,this.context=e==null?void 0:e.context,this.useBigInt64=(n=e==null?void 0:e.useBigInt64)!=null?n:!1,this.rawStrings=(i=e==null?void 0:e.rawStrings)!=null?i:!1,this.maxStrLength=(r=e==null?void 0:e.maxStrLength)!=null?r:hi,this.maxBinLength=(o=e==null?void 0:e.maxBinLength)!=null?o:hi,this.maxArrayLength=(a=e==null?void 0:e.maxArrayLength)!=null?a:hi,this.maxMapLength=(c=e==null?void 0:e.maxMapLength)!=null?c:hi,this.maxExtLength=(l=e==null?void 0:e.maxExtLength)!=null?l:hi,this.keyDecoder=(e==null?void 0:e.keyDecoder)!==void 0?e.keyDecoder:Sg,this.mapKeyConverter=(d=e==null?void 0:e.mapKeyConverter)!=null?d:Ig}clone(){return new za({extensionCodec:this.extensionCodec,context:this.context,useBigInt64:this.useBigInt64,rawStrings:this.rawStrings,maxStrLength:this.maxStrLength,maxBinLength:this.maxBinLength,maxArrayLength:this.maxArrayLength,maxMapLength:this.maxMapLength,maxExtLength:this.maxExtLength,keyDecoder:this.keyDecoder})}reinitializeState(){this.totalPos=0,this.headByte=ui,this.stack.reset()}setBuffer(e){const s=ta(e);this.bytes=s,this.view=new DataView(s.buffer,s.byteOffset,s.byteLength),this.pos=0}appendBuffer(e){if(this.headByte===ui&&!this.hasRemaining(1))this.setBuffer(e);else{const s=this.bytes.subarray(this.pos),n=ta(e),i=new Uint8Array(s.length+n.length);i.set(s),i.set(n,s.length),this.setBuffer(i)}}hasRemaining(e){return this.view.byteLength-this.pos>=e}createExtraByteError(e){const{view:s,pos:n}=this;return new RangeError(`Extra ${s.byteLength-n} of ${s.byteLength} byte(s) found at buffer[${e}]`)}decode(e){if(this.entered)return this.clone().decode(e);try{this.entered=!0,this.reinitializeState(),this.setBuffer(e);const s=this.doDecodeSync();if(this.hasRemaining(1))throw this.createExtraByteError(this.pos);return s}finally{this.entered=!1}}*decodeMulti(e){if(this.entered){yield*this.clone().decodeMulti(e);return}try{for(this.entered=!0,this.reinitializeState(),this.setBuffer(e);this.hasRemaining(1);)yield this.doDecodeSync()}finally{this.entered=!1}}async decodeAsync(e){if(this.entered)return this.clone().decodeAsync(e);try{this.entered=!0;let s=!1,n;for await(const a of e){if(s)throw this.entered=!1,this.createExtraByteError(this.totalPos);this.appendBuffer(a);try{n=this.doDecodeSync(),s=!0}catch(c){if(!(c instanceof RangeError))throw c}this.totalPos+=this.pos}if(s){if(this.hasRemaining(1))throw this.createExtraByteError(this.totalPos);return n}const{headByte:i,pos:r,totalPos:o}=this;throw new RangeError(`Insufficient data in parsing ${mo(i)} at ${o} (${r} in the current buffer)`)}finally{this.entered=!1}}decodeArrayStream(e){return this.decodeMultiAsync(e,!0)}decodeStream(e){return this.decodeMultiAsync(e,!1)}async*decodeMultiAsync(e,s){if(this.entered){yield*this.clone().decodeMultiAsync(e,s);return}try{this.entered=!0;let n=s,i=-1;for await(const r of e){if(s&&i===0)throw this.createExtraByteError(this.totalPos);this.appendBuffer(r),n&&(i=this.readArraySize(),n=!1,this.complete());try{for(;yield this.doDecodeSync(),--i!==0;);}catch(o){if(!(o instanceof RangeError))throw o}this.totalPos+=this.pos}}finally{this.entered=!1}}doDecodeSync(){e:for(;;){const e=this.readHeadByte();let s;if(e>=224)s=e-256;else if(e<192)if(e<128)s=e;else if(e<144){const i=e-128;if(i!==0){this.pushMapState(i),this.complete();continue e}else s={}}else if(e<160){const i=e-144;if(i!==0){this.pushArrayState(i),this.complete();continue e}else s=[]}else{const i=e-160;s=this.decodeString(i,0)}else if(e===192)s=null;else if(e===194)s=!1;else if(e===195)s=!0;else if(e===202)s=this.readF32();else if(e===203)s=this.readF64();else if(e===204)s=this.readU8();else if(e===205)s=this.readU16();else if(e===206)s=this.readU32();else if(e===207)this.useBigInt64?s=this.readU64AsBigInt():s=this.readU64();else if(e===208)s=this.readI8();else if(e===209)s=this.readI16();else if(e===210)s=this.readI32();else if(e===211)this.useBigInt64?s=this.readI64AsBigInt():s=this.readI64();else if(e===217){const i=this.lookU8();s=this.decodeString(i,1)}else if(e===218){const i=this.lookU16();s=this.decodeString(i,2)}else if(e===219){const i=this.lookU32();s=this.decodeString(i,4)}else if(e===220){const i=this.readU16();if(i!==0){this.pushArrayState(i),this.complete();continue e}else s=[]}else if(e===221){const i=this.readU32();if(i!==0){this.pushArrayState(i),this.complete();continue e}else s=[]}else if(e===222){const i=this.readU16();if(i!==0){this.pushMapState(i),this.complete();continue e}else s={}}else if(e===223){const i=this.readU32();if(i!==0){this.pushMapState(i),this.complete();continue e}else s={}}else if(e===196){const i=this.lookU8();s=this.decodeBinary(i,1)}else if(e===197){const i=this.lookU16();s=this.decodeBinary(i,2)}else if(e===198){const i=this.lookU32();s=this.decodeBinary(i,4)}else if(e===212)s=this.decodeExtension(1,0);else if(e===213)s=this.decodeExtension(2,0);else if(e===214)s=this.decodeExtension(4,0);else if(e===215)s=this.decodeExtension(8,0);else if(e===216)s=this.decodeExtension(16,0);else if(e===199){const i=this.lookU8();s=this.decodeExtension(i,1)}else if(e===200){const i=this.lookU16();s=this.decodeExtension(i,2)}else if(e===201){const i=this.lookU32();s=this.decodeExtension(i,4)}else throw new It(`Unrecognized type byte: ${mo(e)}`);this.complete();const n=this.stack;for(;n.length>0;){const i=n.top();if(i.type===sa)if(i.array[i.position]=s,i.position++,i.position===i.size)s=i.array,n.release(i);else continue e;else if(i.type===Ti){if(s==="__proto__")throw new It("The key __proto__ is not allowed");i.key=this.mapKeyConverter(s),i.type=lh;continue e}else if(i.map[i.key]=s,i.readCount++,i.readCount===i.size)s=i.map,n.release(i);else{i.key=null,i.type=Ti;continue e}}return s}}readHeadByte(){return this.headByte===ui&&(this.headByte=this.readU8()),this.headByte}complete(){this.headByte=ui}readArraySize(){const e=this.readHeadByte();switch(e){case 220:return this.readU16();case 221:return this.readU32();default:{if(e<160)return e-144;throw new It(`Unrecognized array type byte: ${mo(e)}`)}}}pushMapState(e){if(e>this.maxMapLength)throw new It(`Max length exceeded: map length (${e}) > maxMapLengthLength (${this.maxMapLength})`);this.stack.pushMapState(e)}pushArrayState(e){if(e>this.maxArrayLength)throw new It(`Max length exceeded: array length (${e}) > maxArrayLength (${this.maxArrayLength})`);this.stack.pushArrayState(e)}decodeString(e,s){return!this.rawStrings||this.stateIsMapKey()?this.decodeUtf8String(e,s):this.decodeBinary(e,s)}decodeUtf8String(e,s){var r;if(e>this.maxStrLength)throw new It(`Max length exceeded: UTF-8 byte length (${e}) > maxStrLength (${this.maxStrLength})`);if(this.bytes.byteLength<this.pos+s+e)throw Pc;const n=this.pos+s;let i;return this.stateIsMapKey()&&((r=this.keyDecoder)!=null&&r.canBeCached(e))?i=this.keyDecoder.decode(this.bytes,n,e):i=rg(this.bytes,n,e),this.pos+=s+e,i}stateIsMapKey(){return this.stack.length>0?this.stack.top().type===Ti:!1}decodeBinary(e,s){if(e>this.maxBinLength)throw new It(`Max length exceeded: bin length (${e}) > maxBinLength (${this.maxBinLength})`);if(!this.hasRemaining(e+s))throw Pc;const n=this.pos+s,i=this.bytes.subarray(n,n+e);return this.pos+=s+e,i}decodeExtension(e,s){if(e>this.maxExtLength)throw new It(`Max length exceeded: ext length (${e}) > maxExtLength (${this.maxExtLength})`);const n=this.view.getInt8(this.pos+s),i=this.decodeBinary(e,s+1);return this.extensionCodec.decode(i,n,this.context)}lookU8(){return this.view.getUint8(this.pos)}lookU16(){return this.view.getUint16(this.pos)}lookU32(){return this.view.getUint32(this.pos)}readU8(){const e=this.view.getUint8(this.pos);return this.pos++,e}readI8(){const e=this.view.getInt8(this.pos);return this.pos++,e}readU16(){const e=this.view.getUint16(this.pos);return this.pos+=2,e}readI16(){const e=this.view.getInt16(this.pos);return this.pos+=2,e}readU32(){const e=this.view.getUint32(this.pos);return this.pos+=4,e}readI32(){const e=this.view.getInt32(this.pos);return this.pos+=4,e}readU64(){const e=ag(this.view,this.pos);return this.pos+=8,e}readI64(){const e=ch(this.view,this.pos);return this.pos+=8,e}readU64AsBigInt(){const e=this.view.getBigUint64(this.pos);return this.pos+=8,e}readI64AsBigInt(){const e=this.view.getBigInt64(this.pos);return this.pos+=8,e}readF32(){const e=this.view.getFloat32(this.pos);return this.pos+=4,e}readF64(){const e=this.view.getFloat64(this.pos);return this.pos+=8,e}}function Tg(t,e){return new za(e).decode(t)}var Og={};const kg=":";function _s(t){const[e,s]=t.split(kg);return{namespace:e,reference:s}}function dh(t,e){return t.includes(":")?[t]:e.chains||[]}var xg=Object.defineProperty,Pg=Object.defineProperties,Rg=Object.getOwnPropertyDescriptors,Rc=Object.getOwnPropertySymbols,Ug=Object.prototype.hasOwnProperty,$g=Object.prototype.propertyIsEnumerable,na=(t,e,s)=>e in t?xg(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,Uc=(t,e)=>{for(var s in e||(e={}))Ug.call(e,s)&&na(t,s,e[s]);if(Rc)for(var s of Rc(e))$g.call(e,s)&&na(t,s,e[s]);return t},Dg=(t,e)=>Pg(t,Rg(e)),$c=(t,e,s)=>na(t,typeof e!="symbol"?e+"":e,s);const Lg="ReactNative",St={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},Mg="js";function Dr(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}function Qs(){return!Os.getDocument()&&!!Os.getNavigator()&&navigator.product===Lg}function Bg(){return Qs()&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"&&(global==null?void 0:global.Platform.OS)==="android"}function Fg(){return Qs()&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"&&(global==null?void 0:global.Platform.OS)==="ios"}function ai(){return!Dr()&&!!Os.getNavigator()&&!!Os.getDocument()}function Gi(){return Qs()?St.reactNative:Dr()?St.node:ai()?St.browser:St.unknown}function Dc(){var t;try{return Qs()&&typeof global<"u"&&typeof(global==null?void 0:global.Application)<"u"?(t=global.Application)==null?void 0:t.applicationId:void 0}catch{return}}function Wg(t,e){const s=new URLSearchParams(t);return Object.entries(e).sort(([n],[i])=>n.localeCompare(i)).forEach(([n,i])=>{i!=null&&s.set(n,String(i))}),s.toString()}function jg(t){var e,s;const n=hh();try{return t!=null&&t.url&&n.url&&new URL(t.url).host!==new URL(n.url).host&&(console.warn(`The configured WalletConnect 'metadata.url':${t.url} differs from the actual page url:${n.url}. This is probably unintended and can lead to issues.`),t.url=n.url),(e=t==null?void 0:t.icons)!=null&&e.length&&t.icons.length>0&&(t.icons=t.icons.filter(i=>i!=="")),Dg(Uc(Uc({},n),t),{url:(t==null?void 0:t.url)||n.url,name:(t==null?void 0:t.name)||n.name,description:(t==null?void 0:t.description)||n.description,icons:(s=t==null?void 0:t.icons)!=null&&s.length&&t.icons.length>0?t.icons:n.icons})}catch(i){return console.warn("Error populating app metadata",i),t||n}}function hh(){return dp.getWindowMetadata()||{name:"",description:"",url:"",icons:[""]}}function qg(){if(Gi()===St.reactNative&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"){const{OS:s,Version:n}=global.Platform;return[s,n].join("-")}const t=up();if(t===null)return"unknown";const e=t.os?t.os.replace(" ","").toLowerCase():"unknown";return t.type==="browser"?[e,t.name,t.version].join("-"):[e,t.version].join("-")}function Hg(){var t;const e=Gi();return e===St.browser?[e,((t=Os.getLocation())==null?void 0:t.host)||"unknown"].join(":"):e}function uh(t,e,s){const n=qg(),i=Hg();return[[t,e].join("-"),[Mg,s].join("-"),n,i].join("/")}function Kg({protocol:t,version:e,relayUrl:s,sdkVersion:n,auth:i,projectId:r,useOnCloseEvent:o,bundleId:a,packageName:c}){const l=s.split("?"),d=uh(t,e,n),h={auth:i,ua:d,projectId:r,useOnCloseEvent:o,packageName:c||void 0,bundleId:a||void 0},u=Wg(l[1]||"",h);return l[0]+"?"+u}function gn(t,e){return t.filter(s=>e.includes(s)).length===t.length}function ia(t){return Object.fromEntries(t.entries())}function ra(t){return new Map(Object.entries(t))}function dn(t=F.FIVE_MINUTES,e){const s=F.toMiliseconds(t||F.FIVE_MINUTES);let n,i,r,o;return{resolve:a=>{r&&n&&(clearTimeout(r),n(a),o=Promise.resolve(a))},reject:a=>{r&&i&&(clearTimeout(r),i(a))},done:()=>new Promise((a,c)=>{if(o)return a(o);r=setTimeout(()=>{const l=new Error(e);o=Promise.reject(l),c(l)},s),n=a,i=c})}}function cs(t,e,s){return new Promise(async(n,i)=>{const r=setTimeout(()=>i(new Error(s)),e);try{const o=await t;n(o)}catch(o){i(o)}clearTimeout(r)})}function ph(t,e){if(typeof e=="string"&&e.startsWith(`${t}:`))return e;if(t.toLowerCase()==="topic"){if(typeof e!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${e}`}else if(t.toLowerCase()==="id"){if(typeof e!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${e}`}throw new Error(`Unknown expirer target type: ${t}`)}function Vg(t){return ph("topic",t)}function zg(t){return ph("id",t)}function fh(t){const[e,s]=t.split(":"),n={id:void 0,topic:void 0};if(e==="topic"&&typeof s=="string")n.topic=s;else if(e==="id"&&Number.isInteger(Number(s)))n.id=Number(s);else throw new Error(`Invalid target, expected id:number or topic:string, got ${e}:${s}`);return n}function Le(t,e){return F.fromMiliseconds(Date.now()+F.toMiliseconds(t))}function os(t){return Date.now()>=F.toMiliseconds(t)}function Ie(t,e){return`${t}${e?`:${e}`:""}`}function hs(t=[],e=[]){return[...new Set([...t,...e])]}async function Gg({id:t,topic:e,wcDeepLink:s}){var n;try{if(!s)return;const i=typeof s=="string"?JSON.parse(s):s,r=i==null?void 0:i.href;if(typeof r!="string")return;const o=Yg(r,t,e),a=Gi();if(a===St.browser){if(!((n=Os.getDocument())!=null&&n.hasFocus())){console.warn("Document does not have focus, skipping deeplink.");return}Jg(o)}else a===St.reactNative&&typeof(global==null?void 0:global.Linking)<"u"&&await global.Linking.openURL(o)}catch(i){console.error(i)}}function Yg(t,e,s){const n=`requestId=${e}&sessionTopic=${s}`;t.endsWith("/")&&(t=t.slice(0,-1));let i=`${t}`;if(t.startsWith("https://t.me")){const r=t.includes("?")?"&startapp=":"?startapp=";i=`${i}${r}${em(n,!0)}`}else i=`${i}/wc?${n}`;return i}function Jg(t){let e="_self";Qg()?e="_top":(Zg()||t.startsWith("https://")||t.startsWith("http://"))&&(e="_blank"),window.open(t,e,"noreferrer noopener")}async function Xg(t,e){let s="";try{if(ai()&&(s=localStorage.getItem(e),s))return s;s=await t.getItem(e)}catch(n){console.error(n)}return s}function Lc(t,e){if(!t.includes(e))return null;const s=t.split(/([&,?,=])/),n=s.indexOf(e);return s[n+2]}function Mc(){return typeof crypto<"u"&&crypto!=null&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/gu,t=>{const e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)})}function Ga(){return typeof process<"u"&&Og.IS_VITEST==="true"}function Zg(){return typeof window<"u"&&(!!window.TelegramWebviewProxy||!!window.Telegram||!!window.TelegramWebviewProxyProto)}function Qg(){try{return window.self!==window.top}catch{return!1}}function em(t,e=!1){const s=Buffer.from(t).toString("base64");return e?s.replace(/[=]/g,""):s}function gh(t){return Buffer.from(t,"base64").toString("utf-8")}function tm(t){return new Promise(e=>setTimeout(e,t))}let sm=class{constructor({limit:e}){$c(this,"limit"),$c(this,"set"),this.limit=e,this.set=new Set}add(e){if(!this.set.has(e)){if(this.set.size>=this.limit){const s=this.set.values().next().value;s&&this.set.delete(s)}this.set.add(e)}}has(e){return this.set.has(e)}};const ar=BigInt(2**32-1),Bc=BigInt(32);function mh(t,e=!1){return e?{h:Number(t&ar),l:Number(t>>Bc&ar)}:{h:Number(t>>Bc&ar)|0,l:Number(t&ar)|0}}function yh(t,e=!1){const s=t.length;let n=new Uint32Array(s),i=new Uint32Array(s);for(let r=0;r<s;r++){const{h:o,l:a}=mh(t[r],e);[n[r],i[r]]=[o,a]}return[n,i]}const Fc=(t,e,s)=>t>>>s,Wc=(t,e,s)=>t<<32-s|e>>>s,Fs=(t,e,s)=>t>>>s|e<<32-s,Ws=(t,e,s)=>t<<32-s|e>>>s,Ai=(t,e,s)=>t<<64-s|e>>>s-32,Ii=(t,e,s)=>t>>>s-32|e<<64-s,nm=(t,e)=>e,im=(t,e)=>t,rm=(t,e,s)=>t<<s|e>>>32-s,om=(t,e,s)=>e<<s|t>>>32-s,am=(t,e,s)=>e<<s-32|t>>>64-s,cm=(t,e,s)=>t<<s-32|e>>>64-s;function zt(t,e,s,n){const i=(e>>>0)+(n>>>0);return{h:t+s+(i/2**32|0)|0,l:i|0}}const Ya=(t,e,s)=>(t>>>0)+(e>>>0)+(s>>>0),Ja=(t,e,s,n)=>e+s+n+(t/2**32|0)|0,lm=(t,e,s,n)=>(t>>>0)+(e>>>0)+(s>>>0)+(n>>>0),dm=(t,e,s,n,i)=>e+s+n+i+(t/2**32|0)|0,hm=(t,e,s,n,i)=>(t>>>0)+(e>>>0)+(s>>>0)+(n>>>0)+(i>>>0),um=(t,e,s,n,i,r)=>e+s+n+i+r+(t/2**32|0)|0,Ln=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function Yr(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function ks(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function Zt(t,...e){if(!Yr(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function Jr(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");ks(t.outputLen),ks(t.blockLen)}function Zs(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function Xa(t,e){Zt(t);const s=e.outputLen;if(t.length<s)throw new Error("digestInto() expects output buffer of length at least "+s)}function Bi(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function Ft(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function yo(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function es(t,e){return t<<32-e|t>>>e}const wh=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function bh(t){return t<<24&4278190080|t<<8&16711680|t>>>8&65280|t>>>24&255}const ys=wh?t=>t:t=>bh(t);function pm(t){for(let e=0;e<t.length;e++)t[e]=bh(t[e]);return t}const js=wh?t=>t:pm,Eh=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",fm=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function Yn(t){if(Zt(t),Eh)return t.toHex();let e="";for(let s=0;s<t.length;s++)e+=fm[t[s]];return e}const gs={_0:48,_9:57,A:65,F:70,a:97,f:102};function jc(t){if(t>=gs._0&&t<=gs._9)return t-gs._0;if(t>=gs.A&&t<=gs.F)return t-(gs.A-10);if(t>=gs.a&&t<=gs.f)return t-(gs.a-10)}function Lr(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);if(Eh)return Uint8Array.fromHex(t);const e=t.length,s=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(s);for(let i=0,r=0;i<s;i++,r+=2){const o=jc(t.charCodeAt(r)),a=jc(t.charCodeAt(r+1));if(o===void 0||a===void 0){const c=t[r]+t[r+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+r)}n[i]=o*16+a}return n}function Ch(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function Xt(t){return typeof t=="string"&&(t=Ch(t)),Zt(t),t}function qs(...t){let e=0;for(let n=0;n<t.length;n++){const i=t[n];Zt(i),e+=i.length}const s=new Uint8Array(e);for(let n=0,i=0;n<t.length;n++){const r=t[n];s.set(r,i),i+=r.length}return s}let Xr=class{};function Yi(t){const e=n=>t().update(Xt(n)).digest(),s=t();return e.outputLen=s.outputLen,e.blockLen=s.blockLen,e.create=()=>t(),e}function gm(t){const e=(n,i)=>t(i).update(Xt(n)).digest(),s=t({});return e.outputLen=s.outputLen,e.blockLen=s.blockLen,e.create=n=>t(n),e}function xn(t=32){if(Ln&&typeof Ln.getRandomValues=="function")return Ln.getRandomValues(new Uint8Array(t));if(Ln&&typeof Ln.randomBytes=="function")return Uint8Array.from(Ln.randomBytes(t));throw new Error("crypto.getRandomValues must be defined")}const mm=BigInt(0),pi=BigInt(1),ym=BigInt(2),wm=BigInt(7),bm=BigInt(256),Em=BigInt(113),vh=[],Ah=[],Ih=[];for(let t=0,e=pi,s=1,n=0;t<24;t++){[s,n]=[n,(2*s+3*n)%5],vh.push(2*(5*n+s)),Ah.push((t+1)*(t+2)/2%64);let i=mm;for(let r=0;r<7;r++)e=(e<<pi^(e>>wm)*Em)%bm,e&ym&&(i^=pi<<(pi<<BigInt(r))-pi);Ih.push(i)}const Nh=yh(Ih,!0),Cm=Nh[0],vm=Nh[1],qc=(t,e,s)=>s>32?am(t,e,s):rm(t,e,s),Hc=(t,e,s)=>s>32?cm(t,e,s):om(t,e,s);function Am(t,e=24){const s=new Uint32Array(10);for(let n=24-e;n<24;n++){for(let o=0;o<10;o++)s[o]=t[o]^t[o+10]^t[o+20]^t[o+30]^t[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,c=(o+2)%10,l=s[c],d=s[c+1],h=qc(l,d,1)^s[a],u=Hc(l,d,1)^s[a+1];for(let p=0;p<50;p+=10)t[o+p]^=h,t[o+p+1]^=u}let i=t[2],r=t[3];for(let o=0;o<24;o++){const a=Ah[o],c=qc(i,r,a),l=Hc(i,r,a),d=vh[o];i=t[d],r=t[d+1],t[d]=c,t[d+1]=l}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)s[a]=t[o+a];for(let a=0;a<10;a++)t[o+a]^=~s[(a+2)%10]&s[(a+4)%10]}t[0]^=Cm[n],t[1]^=vm[n]}Ft(s)}let Im=class _h extends Xr{constructor(e,s,n,i=!1,r=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=e,this.suffix=s,this.outputLen=n,this.enableXOF=i,this.rounds=r,ks(n),!(0<e&&e<200))throw new Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=Bi(this.state)}clone(){return this._cloneInto()}keccak(){js(this.state32),Am(this.state32,this.rounds),js(this.state32),this.posOut=0,this.pos=0}update(e){Zs(this),e=Xt(e),Zt(e);const{blockLen:s,state:n}=this,i=e.length;for(let r=0;r<i;){const o=Math.min(s-this.pos,i-r);for(let a=0;a<o;a++)n[this.pos++]^=e[r++];this.pos===s&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:s,pos:n,blockLen:i}=this;e[n]^=s,(s&128)!==0&&n===i-1&&this.keccak(),e[i-1]^=128,this.keccak()}writeInto(e){Zs(this,!1),Zt(e),this.finish();const s=this.state,{blockLen:n}=this;for(let i=0,r=e.length;i<r;){this.posOut>=n&&this.keccak();const o=Math.min(n-this.posOut,r-i);e.set(s.subarray(this.posOut,this.posOut+o),i),this.posOut+=o,i+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return ks(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(Xa(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,Ft(this.state)}_cloneInto(e){const{blockLen:s,suffix:n,outputLen:i,rounds:r,enableXOF:o}=this;return e||(e=new _h(s,n,i,o,r)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=r,e.suffix=n,e.outputLen=i,e.enableXOF=o,e.destroyed=this.destroyed,e}};const Nm=(t,e,s)=>Yi(()=>new Im(e,t,s)),_m=Nm(1,136,256/8);function Sm(t,e,s,n){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,s,n);const i=BigInt(32),r=BigInt(4294967295),o=Number(s>>i&r),a=Number(s&r),c=n?4:0,l=n?0:4;t.setUint32(e+c,o,n),t.setUint32(e+l,a,n)}function Tm(t,e,s){return t&e^~t&s}function Om(t,e,s){return t&e^t&s^e&s}let Sh=class extends Xr{constructor(e,s,n,i){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=s,this.padOffset=n,this.isLE=i,this.buffer=new Uint8Array(e),this.view=yo(this.buffer)}update(e){Zs(this),e=Xt(e),Zt(e);const{view:s,buffer:n,blockLen:i}=this,r=e.length;for(let o=0;o<r;){const a=Math.min(i-this.pos,r-o);if(a===i){const c=yo(e);for(;i<=r-o;o+=i)this.process(c,o);continue}n.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(s,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Zs(this),Xa(e,this),this.finished=!0;const{buffer:s,view:n,blockLen:i,isLE:r}=this;let{pos:o}=this;s[o++]=128,Ft(this.buffer.subarray(o)),this.padOffset>i-o&&(this.process(n,0),o=0);for(let h=o;h<i;h++)s[h]=0;Sm(n,i-8,BigInt(this.length*8),r),this.process(n,0);const a=yo(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const l=c/4,d=this.get();if(l>d.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<l;h++)a.setUint32(4*h,d[h],r)}digest(){const{buffer:e,outputLen:s}=this;this.digestInto(e);const n=e.slice(0,s);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:s,buffer:n,length:i,finished:r,destroyed:o,pos:a}=this;return e.destroyed=o,e.finished=r,e.length=i,e.pos=a,i%s&&e.buffer.set(n),e}clone(){return this._cloneInto()}};const Us=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),et=Uint32Array.from([3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]),tt=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]),km=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),$s=new Uint32Array(64);class xm extends Sh{constructor(e=32){super(64,e,8,!1),this.A=Us[0]|0,this.B=Us[1]|0,this.C=Us[2]|0,this.D=Us[3]|0,this.E=Us[4]|0,this.F=Us[5]|0,this.G=Us[6]|0,this.H=Us[7]|0}get(){const{A:e,B:s,C:n,D:i,E:r,F:o,G:a,H:c}=this;return[e,s,n,i,r,o,a,c]}set(e,s,n,i,r,o,a,c){this.A=e|0,this.B=s|0,this.C=n|0,this.D=i|0,this.E=r|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,s){for(let h=0;h<16;h++,s+=4)$s[h]=e.getUint32(s,!1);for(let h=16;h<64;h++){const u=$s[h-15],p=$s[h-2],m=es(u,7)^es(u,18)^u>>>3,y=es(p,17)^es(p,19)^p>>>10;$s[h]=y+$s[h-7]+m+$s[h-16]|0}let{A:n,B:i,C:r,D:o,E:a,F:c,G:l,H:d}=this;for(let h=0;h<64;h++){const u=es(a,6)^es(a,11)^es(a,25),p=d+u+Tm(a,c,l)+km[h]+$s[h]|0,m=(es(n,2)^es(n,13)^es(n,22))+Om(n,i,r)|0;d=l,l=c,c=a,a=o+p|0,o=r,r=i,i=n,n=p+m|0}n=n+this.A|0,i=i+this.B|0,r=r+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,l=l+this.G|0,d=d+this.H|0,this.set(n,i,r,o,a,c,l,d)}roundClean(){Ft($s)}destroy(){this.set(0,0,0,0,0,0,0,0),Ft(this.buffer)}}const Th=yh(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(t=>BigInt(t))),Pm=Th[0],Rm=Th[1],Ds=new Uint32Array(80),Ls=new Uint32Array(80);let Za=class extends Sh{constructor(e=64){super(128,e,16,!1),this.Ah=tt[0]|0,this.Al=tt[1]|0,this.Bh=tt[2]|0,this.Bl=tt[3]|0,this.Ch=tt[4]|0,this.Cl=tt[5]|0,this.Dh=tt[6]|0,this.Dl=tt[7]|0,this.Eh=tt[8]|0,this.El=tt[9]|0,this.Fh=tt[10]|0,this.Fl=tt[11]|0,this.Gh=tt[12]|0,this.Gl=tt[13]|0,this.Hh=tt[14]|0,this.Hl=tt[15]|0}get(){const{Ah:e,Al:s,Bh:n,Bl:i,Ch:r,Cl:o,Dh:a,Dl:c,Eh:l,El:d,Fh:h,Fl:u,Gh:p,Gl:m,Hh:y,Hl:g}=this;return[e,s,n,i,r,o,a,c,l,d,h,u,p,m,y,g]}set(e,s,n,i,r,o,a,c,l,d,h,u,p,m,y,g){this.Ah=e|0,this.Al=s|0,this.Bh=n|0,this.Bl=i|0,this.Ch=r|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=l|0,this.El=d|0,this.Fh=h|0,this.Fl=u|0,this.Gh=p|0,this.Gl=m|0,this.Hh=y|0,this.Hl=g|0}process(e,s){for(let A=0;A<16;A++,s+=4)Ds[A]=e.getUint32(s),Ls[A]=e.getUint32(s+=4);for(let A=16;A<80;A++){const x=Ds[A-15]|0,H=Ls[A-15]|0,L=Fs(x,H,1)^Fs(x,H,8)^Fc(x,H,7),J=Ws(x,H,1)^Ws(x,H,8)^Wc(x,H,7),Y=Ds[A-2]|0,T=Ls[A-2]|0,G=Fs(Y,T,19)^Ai(Y,T,61)^Fc(Y,T,6),se=Ws(Y,T,19)^Ii(Y,T,61)^Wc(Y,T,6),P=lm(J,se,Ls[A-7],Ls[A-16]),E=dm(P,L,G,Ds[A-7],Ds[A-16]);Ds[A]=E|0,Ls[A]=P|0}let{Ah:n,Al:i,Bh:r,Bl:o,Ch:a,Cl:c,Dh:l,Dl:d,Eh:h,El:u,Fh:p,Fl:m,Gh:y,Gl:g,Hh:w,Hl:b}=this;for(let A=0;A<80;A++){const x=Fs(h,u,14)^Fs(h,u,18)^Ai(h,u,41),H=Ws(h,u,14)^Ws(h,u,18)^Ii(h,u,41),L=h&p^~h&y,J=u&m^~u&g,Y=hm(b,H,J,Rm[A],Ls[A]),T=um(Y,w,x,L,Pm[A],Ds[A]),G=Y|0,se=Fs(n,i,28)^Ai(n,i,34)^Ai(n,i,39),P=Ws(n,i,28)^Ii(n,i,34)^Ii(n,i,39),E=n&r^n&a^r&a,C=i&o^i&c^o&c;w=y|0,b=g|0,y=p|0,g=m|0,p=h|0,m=u|0,{h,l:u}=zt(l|0,d|0,T|0,G|0),l=a|0,d=c|0,a=r|0,c=o|0,r=n|0,o=i|0;const v=Ya(G,P,C);n=Ja(v,T,se,E),i=v|0}({h:n,l:i}=zt(this.Ah|0,this.Al|0,n|0,i|0)),{h:r,l:o}=zt(this.Bh|0,this.Bl|0,r|0,o|0),{h:a,l:c}=zt(this.Ch|0,this.Cl|0,a|0,c|0),{h:l,l:d}=zt(this.Dh|0,this.Dl|0,l|0,d|0),{h,l:u}=zt(this.Eh|0,this.El|0,h|0,u|0),{h:p,l:m}=zt(this.Fh|0,this.Fl|0,p|0,m|0),{h:y,l:g}=zt(this.Gh|0,this.Gl|0,y|0,g|0),{h:w,l:b}=zt(this.Hh|0,this.Hl|0,w|0,b|0),this.set(n,i,r,o,a,c,l,d,h,u,p,m,y,g,w,b)}roundClean(){Ft(Ds,Ls)}destroy(){Ft(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}};class Um extends Za{constructor(){super(48),this.Ah=et[0]|0,this.Al=et[1]|0,this.Bh=et[2]|0,this.Bl=et[3]|0,this.Ch=et[4]|0,this.Cl=et[5]|0,this.Dh=et[6]|0,this.Dl=et[7]|0,this.Eh=et[8]|0,this.El=et[9]|0,this.Fh=et[10]|0,this.Fl=et[11]|0,this.Gh=et[12]|0,this.Gl=et[13]|0,this.Hh=et[14]|0,this.Hl=et[15]|0}}const st=Uint32Array.from([573645204,4230739756,2673172387,3360449730,596883563,1867755857,2520282905,1497426621,2519219938,2827943907,3193839141,1401305490,721525244,746961066,246885852,2177182882]);class $m extends Za{constructor(){super(32),this.Ah=st[0]|0,this.Al=st[1]|0,this.Bh=st[2]|0,this.Bl=st[3]|0,this.Ch=st[4]|0,this.Cl=st[5]|0,this.Dh=st[6]|0,this.Dl=st[7]|0,this.Eh=st[8]|0,this.El=st[9]|0,this.Fh=st[10]|0,this.Fl=st[11]|0,this.Gh=st[12]|0,this.Gl=st[13]|0,this.Hh=st[14]|0,this.Hl=st[15]|0}}const Zr=Yi(()=>new xm),Dm=Yi(()=>new Za),Lm=Yi(()=>new Um),Mm=Yi(()=>new $m),Bm=Uint8Array.from([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9]),We=Uint32Array.from([4089235720,1779033703,2227873595,3144134277,4271175723,1013904242,1595750129,2773480762,2917565137,1359893119,725511199,2600822924,4215389547,528734635,327033209,1541459225]),q=new Uint32Array(32);function Ms(t,e,s,n,i,r){const o=i[r],a=i[r+1];let c=q[2*t],l=q[2*t+1],d=q[2*e],h=q[2*e+1],u=q[2*s],p=q[2*s+1],m=q[2*n],y=q[2*n+1],g=Ya(c,d,o);l=Ja(g,l,h,a),c=g|0,{Dh:y,Dl:m}={Dh:y^l,Dl:m^c},{Dh:y,Dl:m}={Dh:nm(y,m),Dl:im(y)},{h:p,l:u}=zt(p,u,y,m),{Bh:h,Bl:d}={Bh:h^p,Bl:d^u},{Bh:h,Bl:d}={Bh:Fs(h,d,24),Bl:Ws(h,d,24)},q[2*t]=c,q[2*t+1]=l,q[2*e]=d,q[2*e+1]=h,q[2*s]=u,q[2*s+1]=p,q[2*n]=m,q[2*n+1]=y}function Bs(t,e,s,n,i,r){const o=i[r],a=i[r+1];let c=q[2*t],l=q[2*t+1],d=q[2*e],h=q[2*e+1],u=q[2*s],p=q[2*s+1],m=q[2*n],y=q[2*n+1],g=Ya(c,d,o);l=Ja(g,l,h,a),c=g|0,{Dh:y,Dl:m}={Dh:y^l,Dl:m^c},{Dh:y,Dl:m}={Dh:Fs(y,m,16),Dl:Ws(y,m,16)},{h:p,l:u}=zt(p,u,y,m),{Bh:h,Bl:d}={Bh:h^p,Bl:d^u},{Bh:h,Bl:d}={Bh:Ai(h,d,63),Bl:Ii(h,d,63)},q[2*t]=c,q[2*t+1]=l,q[2*e]=d,q[2*e+1]=h,q[2*s]=u,q[2*s+1]=p,q[2*n]=m,q[2*n+1]=y}function Fm(t,e={},s,n,i){if(ks(s),t<0||t>s)throw new Error("outputLen bigger than keyLen");const{key:r,salt:o,personalization:a}=e;if(r!==void 0&&(r.length<1||r.length>s))throw new Error("key length must be undefined or 1.."+s);if(o!==void 0&&o.length!==n)throw new Error("salt must be undefined or "+n);if(a!==void 0&&a.length!==i)throw new Error("personalization must be undefined or "+i)}class Wm extends Xr{constructor(e,s){super(),this.finished=!1,this.destroyed=!1,this.length=0,this.pos=0,ks(e),ks(s),this.blockLen=e,this.outputLen=s,this.buffer=new Uint8Array(e),this.buffer32=Bi(this.buffer)}update(e){Zs(this),e=Xt(e),Zt(e);const{blockLen:s,buffer:n,buffer32:i}=this,r=e.length,o=e.byteOffset,a=e.buffer;for(let c=0;c<r;){this.pos===s&&(js(i),this.compress(i,0,!1),js(i),this.pos=0);const l=Math.min(s-this.pos,r-c),d=o+c;if(l===s&&!(d%4)&&c+l<r){const h=new Uint32Array(a,d,Math.floor((r-c)/4));js(h);for(let u=0;c+s<r;u+=i.length,c+=s)this.length+=s,this.compress(h,u,!1);js(h);continue}n.set(e.subarray(c,c+l),this.pos),this.pos+=l,this.length+=l,c+=l}return this}digestInto(e){Zs(this),Xa(e,this);const{pos:s,buffer32:n}=this;this.finished=!0,Ft(this.buffer.subarray(s)),js(n),this.compress(n,0,!0),js(n);const i=Bi(e);this.get().forEach((r,o)=>i[o]=ys(r))}digest(){const{buffer:e,outputLen:s}=this;this.digestInto(e);const n=e.slice(0,s);return this.destroy(),n}_cloneInto(e){const{buffer:s,length:n,finished:i,destroyed:r,outputLen:o,pos:a}=this;return e||(e=new this.constructor({dkLen:o})),e.set(...this.get()),e.buffer.set(s),e.destroyed=r,e.finished=i,e.length=n,e.pos=a,e.outputLen=o,e}clone(){return this._cloneInto()}}class jm extends Wm{constructor(e={}){const s=e.dkLen===void 0?64:e.dkLen;super(128,s),this.v0l=We[0]|0,this.v0h=We[1]|0,this.v1l=We[2]|0,this.v1h=We[3]|0,this.v2l=We[4]|0,this.v2h=We[5]|0,this.v3l=We[6]|0,this.v3h=We[7]|0,this.v4l=We[8]|0,this.v4h=We[9]|0,this.v5l=We[10]|0,this.v5h=We[11]|0,this.v6l=We[12]|0,this.v6h=We[13]|0,this.v7l=We[14]|0,this.v7h=We[15]|0,Fm(s,e,64,16,16);let{key:n,personalization:i,salt:r}=e,o=0;if(n!==void 0&&(n=Xt(n),o=n.length),this.v0l^=this.outputLen|o<<8|65536|1<<24,r!==void 0){r=Xt(r);const a=Bi(r);this.v4l^=ys(a[0]),this.v4h^=ys(a[1]),this.v5l^=ys(a[2]),this.v5h^=ys(a[3])}if(i!==void 0){i=Xt(i);const a=Bi(i);this.v6l^=ys(a[0]),this.v6h^=ys(a[1]),this.v7l^=ys(a[2]),this.v7h^=ys(a[3])}if(n!==void 0){const a=new Uint8Array(this.blockLen);a.set(n),this.update(a)}}get(){let{v0l:e,v0h:s,v1l:n,v1h:i,v2l:r,v2h:o,v3l:a,v3h:c,v4l:l,v4h:d,v5l:h,v5h:u,v6l:p,v6h:m,v7l:y,v7h:g}=this;return[e,s,n,i,r,o,a,c,l,d,h,u,p,m,y,g]}set(e,s,n,i,r,o,a,c,l,d,h,u,p,m,y,g){this.v0l=e|0,this.v0h=s|0,this.v1l=n|0,this.v1h=i|0,this.v2l=r|0,this.v2h=o|0,this.v3l=a|0,this.v3h=c|0,this.v4l=l|0,this.v4h=d|0,this.v5l=h|0,this.v5h=u|0,this.v6l=p|0,this.v6h=m|0,this.v7l=y|0,this.v7h=g|0}compress(e,s,n){this.get().forEach((c,l)=>q[l]=c),q.set(We,16);let{h:i,l:r}=mh(BigInt(this.length));q[24]=We[8]^r,q[25]=We[9]^i,n&&(q[28]=~q[28],q[29]=~q[29]);let o=0;const a=Bm;for(let c=0;c<12;c++)Ms(0,4,8,12,e,s+2*a[o++]),Bs(0,4,8,12,e,s+2*a[o++]),Ms(1,5,9,13,e,s+2*a[o++]),Bs(1,5,9,13,e,s+2*a[o++]),Ms(2,6,10,14,e,s+2*a[o++]),Bs(2,6,10,14,e,s+2*a[o++]),Ms(3,7,11,15,e,s+2*a[o++]),Bs(3,7,11,15,e,s+2*a[o++]),Ms(0,5,10,15,e,s+2*a[o++]),Bs(0,5,10,15,e,s+2*a[o++]),Ms(1,6,11,12,e,s+2*a[o++]),Bs(1,6,11,12,e,s+2*a[o++]),Ms(2,7,8,13,e,s+2*a[o++]),Bs(2,7,8,13,e,s+2*a[o++]),Ms(3,4,9,14,e,s+2*a[o++]),Bs(3,4,9,14,e,s+2*a[o++]);this.v0l^=q[0]^q[16],this.v0h^=q[1]^q[17],this.v1l^=q[2]^q[18],this.v1h^=q[3]^q[19],this.v2l^=q[4]^q[20],this.v2h^=q[5]^q[21],this.v3l^=q[6]^q[22],this.v3h^=q[7]^q[23],this.v4l^=q[8]^q[24],this.v4h^=q[9]^q[25],this.v5l^=q[10]^q[26],this.v5h^=q[11]^q[27],this.v6l^=q[12]^q[28],this.v6h^=q[13]^q[29],this.v7l^=q[14]^q[30],this.v7h^=q[15]^q[31],Ft(q)}destroy(){this.destroyed=!0,Ft(this.buffer32),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}const qm=gm(t=>new jm(t)),Hm="https://rpc.walletconnect.org/v1";function Oh(t){const e=`Ethereum Signed Message:
${t.length}`,s=new TextEncoder().encode(e+t);return"0x"+Buffer.from(_m(s)).toString("hex")}async function Km(t,e,s,n,i,r){switch(s.t){case"eip191":return await Vm(t,e,s.s);case"eip1271":return await zm(t,e,s.s,n,i,r);default:throw new Error(`verifySignature failed: Attempted to verify CacaoSignature with unknown type: ${s.t}`)}}function Vm(t,e,s){const n=gp(s);return mp({payload:Oh(e),signature:n}).toLowerCase()===t.toLowerCase()}async function zm(t,e,s,n,i,r){const o=_s(n);if(!o.namespace||!o.reference)throw new Error(`isValidEip1271Signature failed: chainId must be in CAIP-2 format, received: ${n}`);try{const a="0x1626ba7e",c="0000000000000000000000000000000000000000000000000000000000000040",l=s.substring(2),d=(l.length/2).toString(16).padStart(64,"0"),h=(e.startsWith("0x")?e:Oh(e)).substring(2),u=a+h+c+d+l,p=await fetch(`${r||Hm}/?chainId=${n}&projectId=${i}`,{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify({id:Gm(),jsonrpc:"2.0",method:"eth_call",params:[{to:t,data:u},"latest"]})}),{result:m}=await p.json();return m?m.slice(0,a.length).toLowerCase()===a.toLowerCase():!1}catch(a){return console.error("isValidEip1271Signature: ",a),!1}}function Gm(){return Date.now()+Math.floor(Math.random()*1e3)}function Ym(t){const e=atob(t),s=new Uint8Array(e.length);for(let o=0;o<e.length;o++)s[o]=e.charCodeAt(o);const n=s[0];if(n===0)throw new Error("No signatures found");const i=1+n*64;if(s.length<i)throw new Error("Transaction data too short for claimed signature count");if(s.length<100)throw new Error("Transaction too short");const r=Buffer.from(t,"base64").slice(1,65);return ri.encode(r)}function Jm(t){const e=new Uint8Array(Buffer.from(t,"base64")),s=Array.from("TransactionData::").map(r=>r.charCodeAt(0)),n=new Uint8Array(s.length+e.length);n.set(s),n.set(e,s.length);const i=qm(n,{dkLen:32});return ri.encode(i)}function Kc(t){const e=new Uint8Array(Zr(Xm(t)));return ri.encode(e)}function Xm(t){if(t instanceof Uint8Array)return t;if(Array.isArray(t))return new Uint8Array(t);if(typeof t=="object"&&t!=null&&t.data)return new Uint8Array(Object.values(t.data));if(typeof t=="object"&&t)return new Uint8Array(Object.values(t));throw new Error("getNearUint8ArrayFromBytes: Unexpected result type from bytes array")}function Vc(t){const e=Buffer.from(t,"base64"),s=Tg(e).txn;if(!s)throw new Error("Invalid signed transaction: missing 'txn' field");const n=Eg(s),i=Buffer.from("TX"),r=Buffer.concat([i,Buffer.from(n)]),o=Mm(r);return pp.encode(o).replace(/=+$/,"")}function wo(t){const e=[];let s=BigInt(t);for(;s>=BigInt(128);)e.push(Number(s&BigInt(127)|BigInt(128))),s>>=BigInt(7);return e.push(Number(s)),Buffer.from(e)}function Zm(t){const e=Buffer.from(t.signed.bodyBytes,"base64"),s=Buffer.from(t.signed.authInfoBytes,"base64"),n=Buffer.from(t.signature.signature,"base64"),i=[];i.push(Buffer.from([10])),i.push(wo(e.length)),i.push(e),i.push(Buffer.from([18])),i.push(wo(s.length)),i.push(s),i.push(Buffer.from([26])),i.push(wo(n.length)),i.push(n);const r=Buffer.concat(i),o=Zr(r);return Buffer.from(o).toString("hex").toUpperCase()}function Qm(t){var e,s;const n=[];try{if(typeof t=="string")return n.push(t),n;if(typeof t!="object")return n;t!=null&&t.id&&n.push(t.id);const i=(s=(e=t==null?void 0:t.capabilities)==null?void 0:e.caip345)==null?void 0:s.transactionHashes;i&&n.push(...i)}catch(i){console.warn("getWalletSendCallsHashes failed: ",i)}return n}var ey=Object.defineProperty,ty=Object.defineProperties,sy=Object.getOwnPropertyDescriptors,zc=Object.getOwnPropertySymbols,ny=Object.prototype.hasOwnProperty,iy=Object.prototype.propertyIsEnumerable,Gc=(t,e,s)=>e in t?ey(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,ry=(t,e)=>{for(var s in e||(e={}))ny.call(e,s)&&Gc(t,s,e[s]);if(zc)for(var s of zc(e))iy.call(e,s)&&Gc(t,s,e[s]);return t},oy=(t,e)=>ty(t,sy(e));const kh="did:pkh:",ay={eip155:"Ethereum",solana:"Solana",bip122:"Bitcoin"},cy=t=>t?ay[t]||t:"",Qr=t=>t==null?void 0:t.split(":"),ly=t=>{const e=t&&Qr(t);if(e)return t.includes(kh)?e[3]:e[1]},dy=t=>{const e=t&&Qr(t);if(e)return t.includes(kh)?e[2]:e[0]},oa=t=>{const e=t&&Qr(t);if(e)return e[2]+":"+e[3]},Mr=t=>{const e=t&&Qr(t);if(e)return e.pop()};async function Yc(t){const{cacao:e,projectId:s}=t,{s:n,p:i}=e,r=xh(i,i.iss),o=Mr(i.iss);return await Km(o,r,n,oa(i.iss),s)}const xh=(t,e)=>{const s=dy(e);if(!s)throw new Error("Invalid issuer: "+e);const n=`${t.domain} wants you to sign in with your ${cy(s)} account:`,i=Mr(e);if(!t.aud&&!t.uri)throw new Error("Either `aud` or `uri` is required to construct the message");let r=t.statement||void 0;const o=`URI: ${t.aud||t.uri}`,a=`Version: ${t.version}`,c=`Chain ID: ${ly(e)}`,l=`Nonce: ${t.nonce}`,d=`Issued At: ${t.iat}`,h=t.exp?`Expiration Time: ${t.exp}`:void 0,u=t.nbf?`Not Before: ${t.nbf}`:void 0,p=t.requestId?`Request ID: ${t.requestId}`:void 0,m=t.resources?`Resources:${t.resources.map(g=>`
- ${g}`).join("")}`:void 0,y=Ar(t.resources);if(y){const g=Fi(y);r=by(r,g)}return[n,i,"",r,"",o,a,c,l,d,h,u,p,m].filter(g=>g!=null).join(`
`)};function hy(t){return Buffer.from(JSON.stringify(t)).toString("base64")}function uy(t){return JSON.parse(Buffer.from(t,"base64").toString("utf-8"))}function In(t){if(!t)throw new Error("No recap provided, value is undefined");if(!t.att)throw new Error("No `att` property found");const e=Object.keys(t.att);if(!(e!=null&&e.length))throw new Error("No resources found in `att` property");e.forEach(s=>{const n=t.att[s];if(Array.isArray(n))throw new Error(`Resource must be an object: ${s}`);if(typeof n!="object")throw new Error(`Resource must be an object: ${s}`);if(!Object.keys(n).length)throw new Error(`Resource object is empty: ${s}`);Object.keys(n).forEach(i=>{const r=n[i];if(!Array.isArray(r))throw new Error(`Ability limits ${i} must be an array of objects, found: ${r}`);if(!r.length)throw new Error(`Value of ${i} is empty array, must be an array with objects`);r.forEach(o=>{if(typeof o!="object")throw new Error(`Ability limits (${i}) must be an array of objects, found: ${o}`)})})})}function py(t,e,s,n={}){return s==null||s.sort((i,r)=>i.localeCompare(r)),{att:{[t]:fy(e,s,n)}}}function fy(t,e,s={}){e=e==null?void 0:e.sort((i,r)=>i.localeCompare(r));const n=e.map(i=>({[`${t}/${i}`]:[s]}));return Object.assign({},...n)}function Ph(t){return In(t),`urn:recap:${hy(t).replace(/=/g,"")}`}function Fi(t){const e=uy(t.replace("urn:recap:",""));return In(e),e}function gy(t,e,s){const n=py(t,e,s);return Ph(n)}function my(t){return t&&t.includes("urn:recap:")}function yy(t,e){const s=Fi(t),n=Fi(e),i=wy(s,n);return Ph(i)}function wy(t,e){In(t),In(e);const s=Object.keys(t.att).concat(Object.keys(e.att)).sort((i,r)=>i.localeCompare(r)),n={att:{}};return s.forEach(i=>{var r,o;Object.keys(((r=t.att)==null?void 0:r[i])||{}).concat(Object.keys(((o=e.att)==null?void 0:o[i])||{})).sort((a,c)=>a.localeCompare(c)).forEach(a=>{var c,l;n.att[i]=oy(ry({},n.att[i]),{[a]:((c=t.att[i])==null?void 0:c[a])||((l=e.att[i])==null?void 0:l[a])})})}),n}function by(t="",e){In(e);const s="I further authorize the stated URI to perform the following actions on my behalf: ";if(t.includes(s))return t;const n=[];let i=0;Object.keys(e.att).forEach(a=>{const c=Object.keys(e.att[a]).map(h=>({ability:h.split("/")[0],action:h.split("/")[1]}));c.sort((h,u)=>h.action.localeCompare(u.action));const l={};c.forEach(h=>{l[h.ability]||(l[h.ability]=[]),l[h.ability].push(h.action)});const d=Object.keys(l).map(h=>(i++,`(${i}) '${h}': '${l[h].join("', '")}' for '${a}'.`));n.push(d.join(", ").replace(".,","."))});const r=n.join(" "),o=`${s}${r}`;return`${t?t+" ":""}${o}`}function Jc(t){var e;const s=Fi(t);In(s);const n=(e=s.att)==null?void 0:e.eip155;return n?Object.keys(n).map(i=>i.split("/")[1]):[]}function Xc(t){const e=Fi(t);In(e);const s=[];return Object.values(e.att).forEach(n=>{Object.values(n).forEach(i=>{var r;(r=i==null?void 0:i[0])!=null&&r.chains&&s.push(i[0].chains)})}),[...new Set(s.flat())]}function Ar(t){if(!t)return;const e=t==null?void 0:t[t.length-1];return my(e)?e:void 0}function Rh(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function aa(t){if(typeof t!="boolean")throw new Error(`boolean expected, not ${t}`)}function bo(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function ft(t,...e){if(!Rh(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function Zc(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function Ey(t,e){ft(t);const s=e.outputLen;if(t.length<s)throw new Error("digestInto() expects output buffer of length at least "+s)}function Gs(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function ei(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function Cy(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}const vy=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function Ay(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function ca(t){if(typeof t=="string")t=Ay(t);else if(Rh(t))t=la(t);else throw new Error("Uint8Array expected, got "+typeof t);return t}function Iy(t,e){if(e==null||typeof e!="object")throw new Error("options must be defined");return Object.assign(t,e)}function Ny(t,e){if(t.length!==e.length)return!1;let s=0;for(let n=0;n<t.length;n++)s|=t[n]^e[n];return s===0}const _y=(t,e)=>{function s(n,...i){if(ft(n),!vy)throw new Error("Non little-endian hardware is not yet supported");if(t.nonceLength!==void 0){const l=i[0];if(!l)throw new Error("nonce / iv required");t.varSizeNonce?ft(l):ft(l,t.nonceLength)}const r=t.tagLength;r&&i[1]!==void 0&&ft(i[1]);const o=e(n,...i),a=(l,d)=>{if(d!==void 0){if(l!==2)throw new Error("cipher output not supported");ft(d)}};let c=!1;return{encrypt(l,d){if(c)throw new Error("cannot encrypt() twice with same key + nonce");return c=!0,ft(l),a(o.encrypt.length,d),o.encrypt(l,d)},decrypt(l,d){if(ft(l),r&&l.length<r)throw new Error("invalid ciphertext length: smaller than tagLength="+r);return a(o.decrypt.length,d),o.decrypt(l,d)}}}return Object.assign(s,t),s};function Qc(t,e,s=!0){if(e===void 0)return new Uint8Array(t);if(e.length!==t)throw new Error("invalid output length, expected "+t+", got: "+e.length);if(s&&!Ty(e))throw new Error("invalid output, must be aligned");return e}function el(t,e,s,n){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,s,n);const i=BigInt(32),r=BigInt(4294967295),o=Number(s>>i&r),a=Number(s&r);t.setUint32(e+4,o,n),t.setUint32(e+0,a,n)}function Sy(t,e,s){aa(s);const n=new Uint8Array(16),i=Cy(n);return el(i,0,BigInt(e),s),el(i,8,BigInt(t),s),n}function Ty(t){return t.byteOffset%4===0}function la(t){return Uint8Array.from(t)}const Uh=t=>Uint8Array.from(t.split("").map(e=>e.charCodeAt(0))),Oy=Uh("expand 16-byte k"),ky=Uh("expand 32-byte k"),xy=Gs(Oy),Py=Gs(ky);function Ee(t,e){return t<<e|t>>>32-e}function da(t){return t.byteOffset%4===0}const cr=64,Ry=16,$h=2**32-1,tl=new Uint32Array;function Uy(t,e,s,n,i,r,o,a){const c=i.length,l=new Uint8Array(cr),d=Gs(l),h=da(i)&&da(r),u=h?Gs(i):tl,p=h?Gs(r):tl;for(let m=0;m<c;o++){if(t(e,s,n,d,o,a),o>=$h)throw new Error("arx: counter overflow");const y=Math.min(cr,c-m);if(h&&y===cr){const g=m/4;if(m%4!==0)throw new Error("arx: invalid block position");for(let w=0,b;w<Ry;w++)b=g+w,p[b]=u[b]^d[w];m+=cr;continue}for(let g=0,w;g<y;g++)w=m+g,r[w]=i[w]^l[g];m+=y}}function $y(t,e){const{allowShortKeys:s,extendNonceFn:n,counterLength:i,counterRight:r,rounds:o}=Iy({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof t!="function")throw new Error("core must be a function");return bo(i),bo(o),aa(r),aa(s),(a,c,l,d,h=0)=>{ft(a),ft(c),ft(l);const u=l.length;if(d===void 0&&(d=new Uint8Array(u)),ft(d),bo(h),h<0||h>=$h)throw new Error("arx: counter overflow");if(d.length<u)throw new Error(`arx: output (${d.length}) is shorter than data (${u})`);const p=[];let m=a.length,y,g;if(m===32)p.push(y=la(a)),g=Py;else if(m===16&&s)y=new Uint8Array(32),y.set(a),y.set(a,16),g=xy,p.push(y);else throw new Error(`arx: invalid 32-byte key, got length=${m}`);da(c)||p.push(c=la(c));const w=Gs(y);if(n){if(c.length!==24)throw new Error("arx: extended nonce must be 24 bytes");n(g,w,Gs(c.subarray(0,16)),w),c=c.subarray(16)}const b=16-i;if(b!==c.length)throw new Error(`arx: nonce must be ${b} or 16 bytes`);if(b!==12){const x=new Uint8Array(12);x.set(c,r?0:12-c.length),c=x,p.push(c)}const A=Gs(c);return Uy(t,g,w,A,l,d,h,o),ei(...p),d}}const Ve=(t,e)=>t[e++]&255|(t[e++]&255)<<8;class Dy{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,e=ca(e),ft(e,32);const s=Ve(e,0),n=Ve(e,2),i=Ve(e,4),r=Ve(e,6),o=Ve(e,8),a=Ve(e,10),c=Ve(e,12),l=Ve(e,14);this.r[0]=s&8191,this.r[1]=(s>>>13|n<<3)&8191,this.r[2]=(n>>>10|i<<6)&7939,this.r[3]=(i>>>7|r<<9)&8191,this.r[4]=(r>>>4|o<<12)&255,this.r[5]=o>>>1&8190,this.r[6]=(o>>>14|a<<2)&8191,this.r[7]=(a>>>11|c<<5)&8065,this.r[8]=(c>>>8|l<<8)&8191,this.r[9]=l>>>5&127;for(let d=0;d<8;d++)this.pad[d]=Ve(e,16+2*d)}process(e,s,n=!1){const i=n?0:2048,{h:r,r:o}=this,a=o[0],c=o[1],l=o[2],d=o[3],h=o[4],u=o[5],p=o[6],m=o[7],y=o[8],g=o[9],w=Ve(e,s+0),b=Ve(e,s+2),A=Ve(e,s+4),x=Ve(e,s+6),H=Ve(e,s+8),L=Ve(e,s+10),J=Ve(e,s+12),Y=Ve(e,s+14);let T=r[0]+(w&8191),G=r[1]+((w>>>13|b<<3)&8191),se=r[2]+((b>>>10|A<<6)&8191),P=r[3]+((A>>>7|x<<9)&8191),E=r[4]+((x>>>4|H<<12)&8191),C=r[5]+(H>>>1&8191),v=r[6]+((H>>>14|L<<2)&8191),S=r[7]+((L>>>11|J<<5)&8191),$=r[8]+((J>>>8|Y<<8)&8191),M=r[9]+(Y>>>5|i),N=0,R=N+T*a+G*(5*g)+se*(5*y)+P*(5*m)+E*(5*p);N=R>>>13,R&=8191,R+=C*(5*u)+v*(5*h)+S*(5*d)+$*(5*l)+M*(5*c),N+=R>>>13,R&=8191;let V=N+T*c+G*a+se*(5*g)+P*(5*y)+E*(5*m);N=V>>>13,V&=8191,V+=C*(5*p)+v*(5*u)+S*(5*h)+$*(5*d)+M*(5*l),N+=V>>>13,V&=8191;let K=N+T*l+G*c+se*a+P*(5*g)+E*(5*y);N=K>>>13,K&=8191,K+=C*(5*m)+v*(5*p)+S*(5*u)+$*(5*h)+M*(5*d),N+=K>>>13,K&=8191;let fe=N+T*d+G*l+se*c+P*a+E*(5*g);N=fe>>>13,fe&=8191,fe+=C*(5*y)+v*(5*m)+S*(5*p)+$*(5*u)+M*(5*h),N+=fe>>>13,fe&=8191;let re=N+T*h+G*d+se*l+P*c+E*a;N=re>>>13,re&=8191,re+=C*(5*g)+v*(5*y)+S*(5*m)+$*(5*p)+M*(5*u),N+=re>>>13,re&=8191;let ne=N+T*u+G*h+se*d+P*l+E*c;N=ne>>>13,ne&=8191,ne+=C*a+v*(5*g)+S*(5*y)+$*(5*m)+M*(5*p),N+=ne>>>13,ne&=8191;let pe=N+T*p+G*u+se*h+P*d+E*l;N=pe>>>13,pe&=8191,pe+=C*c+v*a+S*(5*g)+$*(5*y)+M*(5*m),N+=pe>>>13,pe&=8191;let he=N+T*m+G*p+se*u+P*h+E*d;N=he>>>13,he&=8191,he+=C*l+v*c+S*a+$*(5*g)+M*(5*y),N+=he>>>13,he&=8191;let Te=N+T*y+G*m+se*p+P*u+E*h;N=Te>>>13,Te&=8191,Te+=C*d+v*l+S*c+$*a+M*(5*g),N+=Te>>>13,Te&=8191;let ue=N+T*g+G*y+se*m+P*p+E*u;N=ue>>>13,ue&=8191,ue+=C*h+v*d+S*l+$*c+M*a,N+=ue>>>13,ue&=8191,N=(N<<2)+N|0,N=N+R|0,R=N&8191,N=N>>>13,V+=N,r[0]=R,r[1]=V,r[2]=K,r[3]=fe,r[4]=re,r[5]=ne,r[6]=pe,r[7]=he,r[8]=Te,r[9]=ue}finalize(){const{h:e,pad:s}=this,n=new Uint16Array(10);let i=e[1]>>>13;e[1]&=8191;for(let a=2;a<10;a++)e[a]+=i,i=e[a]>>>13,e[a]&=8191;e[0]+=i*5,i=e[0]>>>13,e[0]&=8191,e[1]+=i,i=e[1]>>>13,e[1]&=8191,e[2]+=i,n[0]=e[0]+5,i=n[0]>>>13,n[0]&=8191;for(let a=1;a<10;a++)n[a]=e[a]+i,i=n[a]>>>13,n[a]&=8191;n[9]-=8192;let r=(i^1)-1;for(let a=0;a<10;a++)n[a]&=r;r=~r;for(let a=0;a<10;a++)e[a]=e[a]&r|n[a];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let o=e[0]+s[0];e[0]=o&65535;for(let a=1;a<8;a++)o=(e[a]+s[a]|0)+(o>>>16)|0,e[a]=o&65535;ei(n)}update(e){Zc(this),e=ca(e),ft(e);const{buffer:s,blockLen:n}=this,i=e.length;for(let r=0;r<i;){const o=Math.min(n-this.pos,i-r);if(o===n){for(;n<=i-r;r+=n)this.process(e,r);continue}s.set(e.subarray(r,r+o),this.pos),this.pos+=o,r+=o,this.pos===n&&(this.process(s,0,!1),this.pos=0)}return this}destroy(){ei(this.h,this.r,this.buffer,this.pad)}digestInto(e){Zc(this),Ey(e,this),this.finished=!0;const{buffer:s,h:n}=this;let{pos:i}=this;if(i){for(s[i++]=1;i<16;i++)s[i]=0;this.process(s,0,!0)}this.finalize();let r=0;for(let o=0;o<8;o++)e[r++]=n[o]>>>0,e[r++]=n[o]>>>8;return e}digest(){const{buffer:e,outputLen:s}=this;this.digestInto(e);const n=e.slice(0,s);return this.destroy(),n}}function Ly(t){const e=(n,i)=>t(i).update(ca(n)).digest(),s=t(new Uint8Array(32));return e.outputLen=s.outputLen,e.blockLen=s.blockLen,e.create=n=>t(n),e}const My=Ly(t=>new Dy(t));function By(t,e,s,n,i,r=20){let o=t[0],a=t[1],c=t[2],l=t[3],d=e[0],h=e[1],u=e[2],p=e[3],m=e[4],y=e[5],g=e[6],w=e[7],b=i,A=s[0],x=s[1],H=s[2],L=o,J=a,Y=c,T=l,G=d,se=h,P=u,E=p,C=m,v=y,S=g,$=w,M=b,N=A,R=x,V=H;for(let fe=0;fe<r;fe+=2)L=L+G|0,M=Ee(M^L,16),C=C+M|0,G=Ee(G^C,12),L=L+G|0,M=Ee(M^L,8),C=C+M|0,G=Ee(G^C,7),J=J+se|0,N=Ee(N^J,16),v=v+N|0,se=Ee(se^v,12),J=J+se|0,N=Ee(N^J,8),v=v+N|0,se=Ee(se^v,7),Y=Y+P|0,R=Ee(R^Y,16),S=S+R|0,P=Ee(P^S,12),Y=Y+P|0,R=Ee(R^Y,8),S=S+R|0,P=Ee(P^S,7),T=T+E|0,V=Ee(V^T,16),$=$+V|0,E=Ee(E^$,12),T=T+E|0,V=Ee(V^T,8),$=$+V|0,E=Ee(E^$,7),L=L+se|0,V=Ee(V^L,16),S=S+V|0,se=Ee(se^S,12),L=L+se|0,V=Ee(V^L,8),S=S+V|0,se=Ee(se^S,7),J=J+P|0,M=Ee(M^J,16),$=$+M|0,P=Ee(P^$,12),J=J+P|0,M=Ee(M^J,8),$=$+M|0,P=Ee(P^$,7),Y=Y+E|0,N=Ee(N^Y,16),C=C+N|0,E=Ee(E^C,12),Y=Y+E|0,N=Ee(N^Y,8),C=C+N|0,E=Ee(E^C,7),T=T+G|0,R=Ee(R^T,16),v=v+R|0,G=Ee(G^v,12),T=T+G|0,R=Ee(R^T,8),v=v+R|0,G=Ee(G^v,7);let K=0;n[K++]=o+L|0,n[K++]=a+J|0,n[K++]=c+Y|0,n[K++]=l+T|0,n[K++]=d+G|0,n[K++]=h+se|0,n[K++]=u+P|0,n[K++]=p+E|0,n[K++]=m+C|0,n[K++]=y+v|0,n[K++]=g+S|0,n[K++]=w+$|0,n[K++]=b+M|0,n[K++]=A+N|0,n[K++]=x+R|0,n[K++]=H+V|0}const Fy=$y(By,{counterRight:!1,counterLength:4,allowShortKeys:!1}),Wy=new Uint8Array(16),sl=(t,e)=>{t.update(e);const s=e.length%16;s&&t.update(Wy.subarray(s))},jy=new Uint8Array(32);function nl(t,e,s,n,i){const r=t(e,s,jy),o=My.create(r);i&&sl(o,i),sl(o,n);const a=Sy(n.length,i?i.length:0,!0);o.update(a);const c=o.digest();return ei(r,a),c}const qy=t=>(e,s,n)=>({encrypt(i,r){const o=i.length;r=Qc(o+16,r,!1),r.set(i);const a=r.subarray(0,-16);t(e,s,a,a,1);const c=nl(t,e,s,a,n);return r.set(c,o),ei(c),r},decrypt(i,r){r=Qc(i.length-16,r,!1);const o=i.subarray(0,-16),a=i.subarray(-16),c=nl(t,e,s,o,n);if(!Ny(a,c))throw new Error("invalid tag");return r.set(i.subarray(0,-16)),t(e,s,r,r,1),ei(c),r}}),Dh=_y({blockSize:64,nonceLength:12,tagLength:16},qy(Fy));let Lh=class extends Xr{constructor(e,s){super(),this.finished=!1,this.destroyed=!1,Jr(e);const n=Xt(s);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,r=new Uint8Array(i);r.set(n.length>i?e.create().update(n).digest():n);for(let o=0;o<r.length;o++)r[o]^=54;this.iHash.update(r),this.oHash=e.create();for(let o=0;o<r.length;o++)r[o]^=106;this.oHash.update(r),Ft(r)}update(e){return Zs(this),this.iHash.update(e),this}digestInto(e){Zs(this),Zt(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:s,iHash:n,finished:i,destroyed:r,blockLen:o,outputLen:a}=this;return e=e,e.finished=i,e.destroyed=r,e.blockLen=o,e.outputLen=a,e.oHash=s._cloneInto(e.oHash),e.iHash=n._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const eo=(t,e,s)=>new Lh(t,e).update(s).digest();eo.create=(t,e)=>new Lh(t,e);function Hy(t,e,s){return Jr(t),s===void 0&&(s=new Uint8Array(t.outputLen)),eo(t,Xt(s),Xt(e))}const Eo=Uint8Array.from([0]),il=Uint8Array.of();function Ky(t,e,s,n=32){Jr(t),ks(n);const i=t.outputLen;if(n>255*i)throw new Error("Length should be <= 255*HashLen");const r=Math.ceil(n/i);s===void 0&&(s=il);const o=new Uint8Array(r*i),a=eo.create(t,e),c=a._cloneInto(),l=new Uint8Array(a.outputLen);for(let d=0;d<r;d++)Eo[0]=d+1,c.update(d===0?il:l).update(s).update(Eo).digestInto(l),o.set(l,i*d),a._cloneInto(c);return a.destroy(),c.destroy(),Ft(l,Eo),o.slice(0,n)}const Vy=(t,e,s,n,i)=>Ky(t,Hy(t,e,s),n,i),to=Zr,Qa=BigInt(0),ha=BigInt(1);function Br(t,e=""){if(typeof t!="boolean"){const s=e&&`"${e}"`;throw new Error(s+"expected boolean, got type="+typeof t)}return t}function mn(t,e,s=""){const n=Yr(t),i=t==null?void 0:t.length,r=e!==void 0;if(!n||r&&i!==e){const o=s&&`"${s}" `,a=r?` of length ${e}`:"",c=n?`length=${i}`:`type=${typeof t}`;throw new Error(o+"expected Uint8Array"+a+", got "+c)}return t}function lr(t){const e=t.toString(16);return e.length&1?"0"+e:e}function Mh(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?Qa:BigInt("0x"+t)}function so(t){return Mh(Yn(t))}function Fr(t){return Zt(t),Mh(Yn(Uint8Array.from(t).reverse()))}function ec(t,e){return Lr(t.toString(16).padStart(e*2,"0"))}function tc(t,e){return ec(t,e).reverse()}function it(t,e,s){let n;if(typeof e=="string")try{n=Lr(e)}catch(r){throw new Error(t+" must be hex string or Uint8Array, cause: "+r)}else if(Yr(e))n=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");const i=n.length;if(typeof s=="number"&&i!==s)throw new Error(t+" of length "+s+" expected, got "+i);return n}const Co=t=>typeof t=="bigint"&&Qa<=t;function zy(t,e,s){return Co(t)&&Co(e)&&Co(s)&&e<=t&&t<s}function ua(t,e,s,n){if(!zy(e,s,n))throw new Error("expected valid "+t+": "+s+" <= n < "+n+", got "+e)}function Bh(t){let e;for(e=0;t>Qa;t>>=ha,e+=1);return e}const Ji=t=>(ha<<BigInt(t))-ha;function Gy(t,e,s){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof s!="function")throw new Error("hmacFn must be a function");const n=u=>new Uint8Array(u),i=u=>Uint8Array.of(u);let r=n(t),o=n(t),a=0;const c=()=>{r.fill(1),o.fill(0),a=0},l=(...u)=>s(o,r,...u),d=(u=n(0))=>{o=l(i(0),u),r=l(),u.length!==0&&(o=l(i(1),u),r=l())},h=()=>{if(a++>=1e3)throw new Error("drbg: tried 1000 values");let u=0;const p=[];for(;u<e;){r=l();const m=r.slice();p.push(m),u+=r.length}return qs(...p)};return(u,p)=>{c(),d(u);let m;for(;!(m=p(h()));)d();return c(),m}}function no(t,e,s={}){if(!t||typeof t!="object")throw new Error("expected valid options object");function n(i,r,o){const a=t[i];if(o&&a===void 0)return;const c=typeof a;if(c!==r||a===null)throw new Error(`param "${i}" is invalid: expected ${r}, got ${c}`)}Object.entries(e).forEach(([i,r])=>n(i,r,!1)),Object.entries(s).forEach(([i,r])=>n(i,r,!0))}function rl(t){const e=new WeakMap;return(s,...n)=>{const i=e.get(s);if(i!==void 0)return i;const r=t(s,...n);return e.set(s,r),r}}const mt=BigInt(0),ct=BigInt(1),yn=BigInt(2),Fh=BigInt(3),Wh=BigInt(4),jh=BigInt(5),Yy=BigInt(7),qh=BigInt(8),Jy=BigInt(9),Hh=BigInt(16);function Nt(t,e){const s=t%e;return s>=mt?s:e+s}function Vt(t,e,s){let n=t;for(;e-- >mt;)n*=n,n%=s;return n}function ol(t,e){if(t===mt)throw new Error("invert: expected non-zero number");if(e<=mt)throw new Error("invert: expected positive modulus, got "+e);let s=Nt(t,e),n=e,i=mt,r=ct;for(;s!==mt;){const o=n/s,a=n%s,c=i-r*o;n=s,s=a,i=r,r=c}if(n!==ct)throw new Error("invert: does not exist");return Nt(i,e)}function sc(t,e,s){if(!t.eql(t.sqr(e),s))throw new Error("Cannot find square root")}function Kh(t,e){const s=(t.ORDER+ct)/Wh,n=t.pow(e,s);return sc(t,n,e),n}function Xy(t,e){const s=(t.ORDER-jh)/qh,n=t.mul(e,yn),i=t.pow(n,s),r=t.mul(e,i),o=t.mul(t.mul(r,yn),i),a=t.mul(r,t.sub(o,t.ONE));return sc(t,a,e),a}function Zy(t){const e=en(t),s=Vh(t),n=s(e,e.neg(e.ONE)),i=s(e,n),r=s(e,e.neg(n)),o=(t+Yy)/Hh;return(a,c)=>{let l=a.pow(c,o),d=a.mul(l,n);const h=a.mul(l,i),u=a.mul(l,r),p=a.eql(a.sqr(d),c),m=a.eql(a.sqr(h),c);l=a.cmov(l,d,p),d=a.cmov(u,h,m);const y=a.eql(a.sqr(d),c),g=a.cmov(l,d,y);return sc(a,g,c),g}}function Vh(t){if(t<Fh)throw new Error("sqrt is not defined for small field");let e=t-ct,s=0;for(;e%yn===mt;)e/=yn,s++;let n=yn;const i=en(t);for(;al(i,n)===1;)if(n++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(s===1)return Kh;let r=i.pow(n,e);const o=(e+ct)/yn;return function(a,c){if(a.is0(c))return c;if(al(a,c)!==1)throw new Error("Cannot find square root");let l=s,d=a.mul(a.ONE,r),h=a.pow(c,e),u=a.pow(c,o);for(;!a.eql(h,a.ONE);){if(a.is0(h))return a.ZERO;let p=1,m=a.sqr(h);for(;!a.eql(m,a.ONE);)if(p++,m=a.sqr(m),p===l)throw new Error("Cannot find square root");const y=ct<<BigInt(l-p-1),g=a.pow(d,y);l=p,d=a.sqr(g),h=a.mul(h,d),u=a.mul(u,g)}return u}}function Qy(t){return t%Wh===Fh?Kh:t%qh===jh?Xy:t%Hh===Jy?Zy(t):Vh(t)}const ew=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function tw(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"number",BITS:"number"},s=ew.reduce((n,i)=>(n[i]="function",n),e);return no(t,s),t}function sw(t,e,s){if(s<mt)throw new Error("invalid exponent, negatives unsupported");if(s===mt)return t.ONE;if(s===ct)return e;let n=t.ONE,i=e;for(;s>mt;)s&ct&&(n=t.mul(n,i)),i=t.sqr(i),s>>=ct;return n}function zh(t,e,s=!1){const n=new Array(e.length).fill(s?t.ZERO:void 0),i=e.reduce((o,a,c)=>t.is0(a)?o:(n[c]=o,t.mul(o,a)),t.ONE),r=t.inv(i);return e.reduceRight((o,a,c)=>t.is0(a)?o:(n[c]=t.mul(o,n[c]),t.mul(o,a)),r),n}function al(t,e){const s=(t.ORDER-ct)/yn,n=t.pow(e,s),i=t.eql(n,t.ONE),r=t.eql(n,t.ZERO),o=t.eql(n,t.neg(t.ONE));if(!i&&!r&&!o)throw new Error("invalid Legendre symbol result");return i?1:r?0:-1}function Gh(t,e){e!==void 0&&ks(e);const s=e!==void 0?e:t.toString(2).length,n=Math.ceil(s/8);return{nBitLength:s,nByteLength:n}}function en(t,e,s=!1,n={}){if(t<=mt)throw new Error("invalid field: expected ORDER > 0, got "+t);let i,r,o=!1,a;if(typeof e=="object"&&e!=null){if(n.sqrt||s)throw new Error("cannot specify opts in two arguments");const u=e;u.BITS&&(i=u.BITS),u.sqrt&&(r=u.sqrt),typeof u.isLE=="boolean"&&(s=u.isLE),typeof u.modFromBytes=="boolean"&&(o=u.modFromBytes),a=u.allowedLengths}else typeof e=="number"&&(i=e),n.sqrt&&(r=n.sqrt);const{nBitLength:c,nByteLength:l}=Gh(t,i);if(l>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let d;const h=Object.freeze({ORDER:t,isLE:s,BITS:c,BYTES:l,MASK:Ji(c),ZERO:mt,ONE:ct,allowedLengths:a,create:u=>Nt(u,t),isValid:u=>{if(typeof u!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof u);return mt<=u&&u<t},is0:u=>u===mt,isValidNot0:u=>!h.is0(u)&&h.isValid(u),isOdd:u=>(u&ct)===ct,neg:u=>Nt(-u,t),eql:(u,p)=>u===p,sqr:u=>Nt(u*u,t),add:(u,p)=>Nt(u+p,t),sub:(u,p)=>Nt(u-p,t),mul:(u,p)=>Nt(u*p,t),pow:(u,p)=>sw(h,u,p),div:(u,p)=>Nt(u*ol(p,t),t),sqrN:u=>u*u,addN:(u,p)=>u+p,subN:(u,p)=>u-p,mulN:(u,p)=>u*p,inv:u=>ol(u,t),sqrt:r||(u=>(d||(d=Qy(t)),d(h,u))),toBytes:u=>s?tc(u,l):ec(u,l),fromBytes:(u,p=!0)=>{if(a){if(!a.includes(u.length)||u.length>l)throw new Error("Field.fromBytes: expected "+a+" bytes, got "+u.length);const y=new Uint8Array(l);y.set(u,s?0:y.length-u.length),u=y}if(u.length!==l)throw new Error("Field.fromBytes: expected "+l+" bytes, got "+u.length);let m=s?Fr(u):so(u);if(o&&(m=Nt(m,t)),!p&&!h.isValid(m))throw new Error("invalid field element: outside of range 0..ORDER");return m},invertBatch:u=>zh(h,u),cmov:(u,p,m)=>m?p:u});return Object.freeze(h)}function Yh(t){if(typeof t!="bigint")throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function Jh(t){const e=Yh(t);return e+Math.ceil(e/2)}function nw(t,e,s=!1){const n=t.length,i=Yh(e),r=Jh(e);if(n<16||n<r||n>1024)throw new Error("expected "+r+"-1024 bytes of input, got "+n);const o=s?Fr(t):so(t),a=Nt(o,e-ct)+ct;return s?tc(a,i):ec(a,i)}const ti=BigInt(0),wn=BigInt(1);function Wr(t,e){const s=e.negate();return t?s:e}function vo(t,e){const s=zh(t.Fp,e.map(n=>n.Z));return e.map((n,i)=>t.fromAffine(n.toAffine(s[i])))}function Xh(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function Ao(t,e){Xh(t,e);const s=Math.ceil(e/t)+1,n=2**(t-1),i=2**t,r=Ji(t),o=BigInt(t);return{windows:s,windowSize:n,mask:r,maxNumber:i,shiftBy:o}}function cl(t,e,s){const{windowSize:n,mask:i,maxNumber:r,shiftBy:o}=s;let a=Number(t&i),c=t>>o;a>n&&(a-=r,c+=wn);const l=e*n,d=l+Math.abs(a)-1,h=a===0,u=a<0,p=e%2!==0;return{nextN:c,offset:d,isZero:h,isNeg:u,isNegF:p,offsetF:l}}function iw(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((s,n)=>{if(!(s instanceof e))throw new Error("invalid point at index "+n)})}function rw(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((s,n)=>{if(!e.isValid(s))throw new Error("invalid scalar at index "+n)})}const Io=new WeakMap,Zh=new WeakMap;function No(t){return Zh.get(t)||1}function ll(t){if(t!==ti)throw new Error("invalid wNAF")}class ow{constructor(e,s){this.BASE=e.BASE,this.ZERO=e.ZERO,this.Fn=e.Fn,this.bits=s}_unsafeLadder(e,s,n=this.ZERO){let i=e;for(;s>ti;)s&wn&&(n=n.add(i)),i=i.double(),s>>=wn;return n}precomputeWindow(e,s){const{windows:n,windowSize:i}=Ao(s,this.bits),r=[];let o=e,a=o;for(let c=0;c<n;c++){a=o,r.push(a);for(let l=1;l<i;l++)a=a.add(o),r.push(a);o=a.double()}return r}wNAF(e,s,n){if(!this.Fn.isValid(n))throw new Error("invalid scalar");let i=this.ZERO,r=this.BASE;const o=Ao(e,this.bits);for(let a=0;a<o.windows;a++){const{nextN:c,offset:l,isZero:d,isNeg:h,isNegF:u,offsetF:p}=cl(n,a,o);n=c,d?r=r.add(Wr(u,s[p])):i=i.add(Wr(h,s[l]))}return ll(n),{p:i,f:r}}wNAFUnsafe(e,s,n,i=this.ZERO){const r=Ao(e,this.bits);for(let o=0;o<r.windows&&n!==ti;o++){const{nextN:a,offset:c,isZero:l,isNeg:d}=cl(n,o,r);if(n=a,!l){const h=s[c];i=i.add(d?h.negate():h)}}return ll(n),i}getPrecomputes(e,s,n){let i=Io.get(s);return i||(i=this.precomputeWindow(s,e),e!==1&&(typeof n=="function"&&(i=n(i)),Io.set(s,i))),i}cached(e,s,n){const i=No(e);return this.wNAF(i,this.getPrecomputes(i,e,n),s)}unsafe(e,s,n,i){const r=No(e);return r===1?this._unsafeLadder(e,s,i):this.wNAFUnsafe(r,this.getPrecomputes(r,e,n),s,i)}createCache(e,s){Xh(s,this.bits),Zh.set(e,s),Io.delete(e)}hasCache(e){return No(e)!==1}}function aw(t,e,s,n){let i=e,r=t.ZERO,o=t.ZERO;for(;s>ti||n>ti;)s&wn&&(r=r.add(i)),n&wn&&(o=o.add(i)),i=i.double(),s>>=wn,n>>=wn;return{p1:r,p2:o}}function cw(t,e,s,n){iw(s,t),rw(n,e);const i=s.length,r=n.length;if(i!==r)throw new Error("arrays of points and scalars must have equal length");const o=t.ZERO,a=Bh(BigInt(i));let c=1;a>12?c=a-3:a>4?c=a-2:a>0&&(c=2);const l=Ji(c),d=new Array(Number(l)+1).fill(o),h=Math.floor((e.BITS-1)/c)*c;let u=o;for(let p=h;p>=0;p-=c){d.fill(o);for(let y=0;y<r;y++){const g=n[y],w=Number(g>>BigInt(p)&l);d[w]=d[w].add(s[y])}let m=o;for(let y=d.length-1,g=o;y>0;y--)g=g.add(d[y]),m=m.add(g);if(u=u.add(m),p!==0)for(let y=0;y<c;y++)u=u.double()}return u}function dl(t,e,s){if(e){if(e.ORDER!==t)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return tw(e),e}else return en(t,{isLE:s})}function lw(t,e,s={},n){if(n===void 0&&(n=t==="edwards"),!e||typeof e!="object")throw new Error(`expected valid ${t} CURVE object`);for(const a of["p","n","h"]){const c=e[a];if(!(typeof c=="bigint"&&c>ti))throw new Error(`CURVE.${a} must be positive bigint`)}const i=dl(e.p,s.Fp,n),r=dl(e.n,s.Fn,n),o=["Gx","Gy","a","b"];for(const a of o)if(!i.isValid(e[a]))throw new Error(`CURVE.${a} must be valid field element of CURVE.Fp`);return e=Object.freeze(Object.assign({},e)),{CURVE:e,Fp:i,Fn:r}}BigInt(0),BigInt(1),BigInt(2),BigInt(8),Ch("HashToScalar-");const fi=BigInt(0),Mn=BigInt(1),dr=BigInt(2);function dw(t){return no(t,{adjustScalarBytes:"function",powPminus2:"function"}),Object.freeze({...t})}function hw(t){const e=dw(t),{P:s,type:n,adjustScalarBytes:i,powPminus2:r,randomBytes:o}=e,a=n==="x25519";if(!a&&n!=="x448")throw new Error("invalid type");const c=o||xn,l=a?255:448,d=a?32:56,h=BigInt(a?9:5),u=BigInt(a?121665:39081),p=a?dr**BigInt(254):dr**BigInt(447),m=a?BigInt(8)*dr**BigInt(251)-Mn:BigInt(4)*dr**BigInt(445)-Mn,y=p+m+Mn,g=P=>Nt(P,s),w=b(h);function b(P){return tc(g(P),d)}function A(P){const E=it("u coordinate",P,d);return a&&(E[31]&=127),g(Fr(E))}function x(P){return Fr(i(it("scalar",P,d)))}function H(P,E){const C=Y(A(E),x(P));if(C===fi)throw new Error("invalid private or public key received");return b(C)}function L(P){return H(P,w)}function J(P,E,C){const v=g(P*(E-C));return E=g(E-v),C=g(C+v),{x_2:E,x_3:C}}function Y(P,E){ua("u",P,fi,s),ua("scalar",E,p,y);const C=E,v=P;let S=Mn,$=fi,M=P,N=Mn,R=fi;for(let K=BigInt(l-1);K>=fi;K--){const fe=C>>K&Mn;R^=fe,{x_2:S,x_3:M}=J(R,S,M),{x_2:$,x_3:N}=J(R,$,N),R=fe;const re=S+$,ne=g(re*re),pe=S-$,he=g(pe*pe),Te=ne-he,ue=M+N,$e=M-N,jt=g($e*re),xs=g(ue*pe),tn=jt+xs,Rn=jt-xs;M=g(tn*tn),N=g(v*g(Rn*Rn)),S=g(ne*he),$=g(Te*(ne+g(u*Te)))}({x_2:S,x_3:M}=J(R,S,M)),{x_2:$,x_3:N}=J(R,$,N);const V=r($);return g(S*V)}const T={secretKey:d,publicKey:d,seed:d},G=(P=c(d))=>(Zt(P,T.seed),P);function se(P){const E=G(P);return{secretKey:E,publicKey:L(E)}}return{keygen:se,getSharedSecret:(P,E)=>H(P,E),getPublicKey:P=>L(P),scalarMult:H,scalarMultBase:L,utils:{randomSecretKey:G,randomPrivateKey:G},GuBytes:w.slice(),lengths:T}}const uw=BigInt(1),hl=BigInt(2),pw=BigInt(3),fw=BigInt(5);BigInt(8);const Qh=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),gw={p:Qh,n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")};function mw(t){const e=BigInt(10),s=BigInt(20),n=BigInt(40),i=BigInt(80),r=Qh,o=t*t%r*t%r,a=Vt(o,hl,r)*o%r,c=Vt(a,uw,r)*t%r,l=Vt(c,fw,r)*c%r,d=Vt(l,e,r)*l%r,h=Vt(d,s,r)*d%r,u=Vt(h,n,r)*h%r,p=Vt(u,i,r)*u%r,m=Vt(p,i,r)*u%r,y=Vt(m,e,r)*l%r;return{pow_p_5_8:Vt(y,hl,r)*t%r,b2:o}}function yw(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}const ww=en(gw.p,{isLE:!0}),pa=(()=>{const t=ww.ORDER;return hw({P:t,type:"x25519",powPminus2:e=>{const{pow_p_5_8:s,b2:n}=mw(e);return Nt(Vt(s,pw,t)*n,t)},adjustScalarBytes:yw})})(),ul=(t,e)=>(t+(t>=0?e:-e)/eu)/e;function bw(t,e,s){const[[n,i],[r,o]]=e,a=ul(o*t,s),c=ul(-i*t,s);let l=t-a*n-c*r,d=-a*i-c*o;const h=l<Ns,u=d<Ns;h&&(l=-l),u&&(d=-d);const p=Ji(Math.ceil(Bh(s)/2))+Jn;if(l<Ns||l>=p||d<Ns||d>=p)throw new Error("splitScalar (endomorphism): failed, k="+t);return{k1neg:h,k1:l,k2neg:u,k2:d}}function fa(t){if(!["compact","recovered","der"].includes(t))throw new Error('Signature format must be "compact", "recovered", or "der"');return t}function _o(t,e){const s={};for(let n of Object.keys(e))s[n]=t[n]===void 0?e[n]:t[n];return Br(s.lowS,"lowS"),Br(s.prehash,"prehash"),s.format!==void 0&&fa(s.format),s}class Ew extends Error{constructor(e=""){super(e)}}const vs={Err:Ew,_tlv:{encode:(t,e)=>{const{Err:s}=vs;if(t<0||t>256)throw new s("tlv.encode: wrong tag");if(e.length&1)throw new s("tlv.encode: unpadded data");const n=e.length/2,i=lr(n);if(i.length/2&128)throw new s("tlv.encode: long form length too big");const r=n>127?lr(i.length/2|128):"";return lr(t)+r+i+e},decode(t,e){const{Err:s}=vs;let n=0;if(t<0||t>256)throw new s("tlv.encode: wrong tag");if(e.length<2||e[n++]!==t)throw new s("tlv.decode: wrong tlv");const i=e[n++],r=!!(i&128);let o=0;if(!r)o=i;else{const c=i&127;if(!c)throw new s("tlv.decode(long): indefinite length not supported");if(c>4)throw new s("tlv.decode(long): byte length is too big");const l=e.subarray(n,n+c);if(l.length!==c)throw new s("tlv.decode: length bytes not complete");if(l[0]===0)throw new s("tlv.decode(long): zero leftmost byte");for(const d of l)o=o<<8|d;if(n+=c,o<128)throw new s("tlv.decode(long): not minimal encoding")}const a=e.subarray(n,n+o);if(a.length!==o)throw new s("tlv.decode: wrong value length");return{v:a,l:e.subarray(n+o)}}},_int:{encode(t){const{Err:e}=vs;if(t<Ns)throw new e("integer: negative integers are not allowed");let s=lr(t);if(Number.parseInt(s[0],16)&8&&(s="00"+s),s.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return s},decode(t){const{Err:e}=vs;if(t[0]&128)throw new e("invalid signature integer: negative");if(t[0]===0&&!(t[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return so(t)}},toSig(t){const{Err:e,_int:s,_tlv:n}=vs,i=it("signature",t),{v:r,l:o}=n.decode(48,i);if(o.length)throw new e("invalid signature: left bytes after parsing");const{v:a,l:c}=n.decode(2,r),{v:l,l:d}=n.decode(2,c);if(d.length)throw new e("invalid signature: left bytes after parsing");return{r:s.decode(a),s:s.decode(l)}},hexFromSig(t){const{_tlv:e,_int:s}=vs,n=e.encode(2,s.encode(t.r)),i=e.encode(2,s.encode(t.s)),r=n+i;return e.encode(48,r)}},Ns=BigInt(0),Jn=BigInt(1),eu=BigInt(2),hr=BigInt(3),Cw=BigInt(4);function Kn(t,e){const{BYTES:s}=t;let n;if(typeof e=="bigint")n=e;else{let i=it("private key",e);try{n=t.fromBytes(i)}catch{throw new Error(`invalid private key: expected ui8a of size ${s}, got ${typeof e}`)}}if(!t.isValidNot0(n))throw new Error("invalid private key: out of range [1..N-1]");return n}function vw(t,e={}){const s=lw("weierstrass",t,e),{Fp:n,Fn:i}=s;let r=s.CURVE;const{h:o,n:a}=r;no(e,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object",wrapPrivateKey:"boolean"});const{endo:c}=e;if(c&&(!n.is0(r.a)||typeof c.beta!="bigint"||!Array.isArray(c.basises)))throw new Error('invalid endo: expected "beta": bigint and "basises": array');const l=su(n,i);function d(){if(!n.isOdd)throw new Error("compression is not supported: Field does not have .isOdd()")}function h(P,E,C){const{x:v,y:S}=E.toAffine(),$=n.toBytes(v);if(Br(C,"isCompressed"),C){d();const M=!n.isOdd(S);return qs(tu(M),$)}else return qs(Uint8Array.of(4),$,n.toBytes(S))}function u(P){mn(P,void 0,"Point");const{publicKey:E,publicKeyUncompressed:C}=l,v=P.length,S=P[0],$=P.subarray(1);if(v===E&&(S===2||S===3)){const M=n.fromBytes($);if(!n.isValid(M))throw new Error("bad point: is not on curve, wrong x");const N=y(M);let R;try{R=n.sqrt(N)}catch(K){const fe=K instanceof Error?": "+K.message:"";throw new Error("bad point: is not on curve, sqrt error"+fe)}d();const V=n.isOdd(R);return(S&1)===1!==V&&(R=n.neg(R)),{x:M,y:R}}else if(v===C&&S===4){const M=n.BYTES,N=n.fromBytes($.subarray(0,M)),R=n.fromBytes($.subarray(M,M*2));if(!g(N,R))throw new Error("bad point: is not on curve");return{x:N,y:R}}else throw new Error(`bad point: got length ${v}, expected compressed=${E} or uncompressed=${C}`)}const p=e.toBytes||h,m=e.fromBytes||u;function y(P){const E=n.sqr(P),C=n.mul(E,P);return n.add(n.add(C,n.mul(P,r.a)),r.b)}function g(P,E){const C=n.sqr(E),v=y(P);return n.eql(C,v)}if(!g(r.Gx,r.Gy))throw new Error("bad curve params: generator point");const w=n.mul(n.pow(r.a,hr),Cw),b=n.mul(n.sqr(r.b),BigInt(27));if(n.is0(n.add(w,b)))throw new Error("bad curve params: a or b");function A(P,E,C=!1){if(!n.isValid(E)||C&&n.is0(E))throw new Error(`bad point coordinate ${P}`);return E}function x(P){if(!(P instanceof T))throw new Error("ProjectivePoint expected")}function H(P){if(!c||!c.basises)throw new Error("no endo");return bw(P,c.basises,i.ORDER)}const L=rl((P,E)=>{const{X:C,Y:v,Z:S}=P;if(n.eql(S,n.ONE))return{x:C,y:v};const $=P.is0();E==null&&(E=$?n.ONE:n.inv(S));const M=n.mul(C,E),N=n.mul(v,E),R=n.mul(S,E);if($)return{x:n.ZERO,y:n.ZERO};if(!n.eql(R,n.ONE))throw new Error("invZ was invalid");return{x:M,y:N}}),J=rl(P=>{if(P.is0()){if(e.allowInfinityPoint&&!n.is0(P.Y))return;throw new Error("bad point: ZERO")}const{x:E,y:C}=P.toAffine();if(!n.isValid(E)||!n.isValid(C))throw new Error("bad point: x or y not field elements");if(!g(E,C))throw new Error("bad point: equation left != right");if(!P.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});function Y(P,E,C,v,S){return C=new T(n.mul(C.X,P),C.Y,C.Z),E=Wr(v,E),C=Wr(S,C),E.add(C)}class T{constructor(E,C,v){this.X=A("x",E),this.Y=A("y",C,!0),this.Z=A("z",v),Object.freeze(this)}static CURVE(){return r}static fromAffine(E){const{x:C,y:v}=E||{};if(!E||!n.isValid(C)||!n.isValid(v))throw new Error("invalid affine point");if(E instanceof T)throw new Error("projective point not allowed");return n.is0(C)&&n.is0(v)?T.ZERO:new T(C,v,n.ONE)}static fromBytes(E){const C=T.fromAffine(m(mn(E,void 0,"point")));return C.assertValidity(),C}static fromHex(E){return T.fromBytes(it("pointHex",E))}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(E=8,C=!0){return se.createCache(this,E),C||this.multiply(hr),this}assertValidity(){J(this)}hasEvenY(){const{y:E}=this.toAffine();if(!n.isOdd)throw new Error("Field doesn't support isOdd");return!n.isOdd(E)}equals(E){x(E);const{X:C,Y:v,Z:S}=this,{X:$,Y:M,Z:N}=E,R=n.eql(n.mul(C,N),n.mul($,S)),V=n.eql(n.mul(v,N),n.mul(M,S));return R&&V}negate(){return new T(this.X,n.neg(this.Y),this.Z)}double(){const{a:E,b:C}=r,v=n.mul(C,hr),{X:S,Y:$,Z:M}=this;let N=n.ZERO,R=n.ZERO,V=n.ZERO,K=n.mul(S,S),fe=n.mul($,$),re=n.mul(M,M),ne=n.mul(S,$);return ne=n.add(ne,ne),V=n.mul(S,M),V=n.add(V,V),N=n.mul(E,V),R=n.mul(v,re),R=n.add(N,R),N=n.sub(fe,R),R=n.add(fe,R),R=n.mul(N,R),N=n.mul(ne,N),V=n.mul(v,V),re=n.mul(E,re),ne=n.sub(K,re),ne=n.mul(E,ne),ne=n.add(ne,V),V=n.add(K,K),K=n.add(V,K),K=n.add(K,re),K=n.mul(K,ne),R=n.add(R,K),re=n.mul($,M),re=n.add(re,re),K=n.mul(re,ne),N=n.sub(N,K),V=n.mul(re,fe),V=n.add(V,V),V=n.add(V,V),new T(N,R,V)}add(E){x(E);const{X:C,Y:v,Z:S}=this,{X:$,Y:M,Z:N}=E;let R=n.ZERO,V=n.ZERO,K=n.ZERO;const fe=r.a,re=n.mul(r.b,hr);let ne=n.mul(C,$),pe=n.mul(v,M),he=n.mul(S,N),Te=n.add(C,v),ue=n.add($,M);Te=n.mul(Te,ue),ue=n.add(ne,pe),Te=n.sub(Te,ue),ue=n.add(C,S);let $e=n.add($,N);return ue=n.mul(ue,$e),$e=n.add(ne,he),ue=n.sub(ue,$e),$e=n.add(v,S),R=n.add(M,N),$e=n.mul($e,R),R=n.add(pe,he),$e=n.sub($e,R),K=n.mul(fe,ue),R=n.mul(re,he),K=n.add(R,K),R=n.sub(pe,K),K=n.add(pe,K),V=n.mul(R,K),pe=n.add(ne,ne),pe=n.add(pe,ne),he=n.mul(fe,he),ue=n.mul(re,ue),pe=n.add(pe,he),he=n.sub(ne,he),he=n.mul(fe,he),ue=n.add(ue,he),ne=n.mul(pe,ue),V=n.add(V,ne),ne=n.mul($e,ue),R=n.mul(Te,R),R=n.sub(R,ne),ne=n.mul(Te,pe),K=n.mul($e,K),K=n.add(K,ne),new T(R,V,K)}subtract(E){return this.add(E.negate())}is0(){return this.equals(T.ZERO)}multiply(E){const{endo:C}=e;if(!i.isValidNot0(E))throw new Error("invalid scalar: out of range");let v,S;const $=M=>se.cached(this,M,N=>vo(T,N));if(C){const{k1neg:M,k1:N,k2neg:R,k2:V}=H(E),{p:K,f:fe}=$(N),{p:re,f:ne}=$(V);S=fe.add(ne),v=Y(C.beta,K,re,M,R)}else{const{p:M,f:N}=$(E);v=M,S=N}return vo(T,[v,S])[0]}multiplyUnsafe(E){const{endo:C}=e,v=this;if(!i.isValid(E))throw new Error("invalid scalar: out of range");if(E===Ns||v.is0())return T.ZERO;if(E===Jn)return v;if(se.hasCache(this))return this.multiply(E);if(C){const{k1neg:S,k1:$,k2neg:M,k2:N}=H(E),{p1:R,p2:V}=aw(T,v,$,N);return Y(C.beta,R,V,S,M)}else return se.unsafe(v,E)}multiplyAndAddUnsafe(E,C,v){const S=this.multiplyUnsafe(C).add(E.multiplyUnsafe(v));return S.is0()?void 0:S}toAffine(E){return L(this,E)}isTorsionFree(){const{isTorsionFree:E}=e;return o===Jn?!0:E?E(T,this):se.unsafe(this,a).is0()}clearCofactor(){const{clearCofactor:E}=e;return o===Jn?this:E?E(T,this):this.multiplyUnsafe(o)}isSmallOrder(){return this.multiplyUnsafe(o).is0()}toBytes(E=!0){return Br(E,"isCompressed"),this.assertValidity(),p(T,this,E)}toHex(E=!0){return Yn(this.toBytes(E))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}get px(){return this.X}get py(){return this.X}get pz(){return this.Z}toRawBytes(E=!0){return this.toBytes(E)}_setWindowSize(E){this.precompute(E)}static normalizeZ(E){return vo(T,E)}static msm(E,C){return cw(T,i,E,C)}static fromPrivateKey(E){return T.BASE.multiply(Kn(i,E))}}T.BASE=new T(r.Gx,r.Gy,n.ONE),T.ZERO=new T(n.ZERO,n.ONE,n.ZERO),T.Fp=n,T.Fn=i;const G=i.BITS,se=new ow(T,e.endo?Math.ceil(G/2):G);return T.BASE.precompute(8),T}function tu(t){return Uint8Array.of(t?2:3)}function su(t,e){return{secretKey:e.BYTES,publicKey:1+t.BYTES,publicKeyUncompressed:1+2*t.BYTES,publicKeyHasPrefix:!0,signature:2*e.BYTES}}function Aw(t,e={}){const{Fn:s}=t,n=e.randomBytes||xn,i=Object.assign(su(t.Fp,s),{seed:Jh(s.ORDER)});function r(u){try{return!!Kn(s,u)}catch{return!1}}function o(u,p){const{publicKey:m,publicKeyUncompressed:y}=i;try{const g=u.length;return p===!0&&g!==m||p===!1&&g!==y?!1:!!t.fromBytes(u)}catch{return!1}}function a(u=n(i.seed)){return nw(mn(u,i.seed,"seed"),s.ORDER)}function c(u,p=!0){return t.BASE.multiply(Kn(s,u)).toBytes(p)}function l(u){const p=a(u);return{secretKey:p,publicKey:c(p)}}function d(u){if(typeof u=="bigint")return!1;if(u instanceof t)return!0;const{secretKey:p,publicKey:m,publicKeyUncompressed:y}=i;if(s.allowedLengths||p===m)return;const g=it("key",u).length;return g===m||g===y}function h(u,p,m=!0){if(d(u)===!0)throw new Error("first arg must be private key");if(d(p)===!1)throw new Error("second arg must be public key");const y=Kn(s,u);return t.fromHex(p).multiply(y).toBytes(m)}return Object.freeze({getPublicKey:c,getSharedSecret:h,keygen:l,Point:t,utils:{isValidSecretKey:r,isValidPublicKey:o,randomSecretKey:a,isValidPrivateKey:r,randomPrivateKey:a,normPrivateKeyToScalar:u=>Kn(s,u),precompute(u=8,p=t.BASE){return p.precompute(u,!1)}},lengths:i})}function Iw(t,e,s={}){Jr(e),no(s,{},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"});const n=s.randomBytes||xn,i=s.hmac||((C,...v)=>eo(e,C,qs(...v))),{Fp:r,Fn:o}=t,{ORDER:a,BITS:c}=o,{keygen:l,getPublicKey:d,getSharedSecret:h,utils:u,lengths:p}=Aw(t,s),m={prehash:!1,lowS:typeof s.lowS=="boolean"?s.lowS:!1,format:void 0,extraEntropy:!1},y="compact";function g(C){const v=a>>Jn;return C>v}function w(C,v){if(!o.isValidNot0(v))throw new Error(`invalid signature ${C}: out of range 1..Point.Fn.ORDER`);return v}function b(C,v){fa(v);const S=p.signature,$=v==="compact"?S:v==="recovered"?S+1:void 0;return mn(C,$,`${v} signature`)}class A{constructor(v,S,$){this.r=w("r",v),this.s=w("s",S),$!=null&&(this.recovery=$),Object.freeze(this)}static fromBytes(v,S=y){b(v,S);let $;if(S==="der"){const{r:V,s:K}=vs.toSig(mn(v));return new A(V,K)}S==="recovered"&&($=v[0],S="compact",v=v.subarray(1));const M=o.BYTES,N=v.subarray(0,M),R=v.subarray(M,M*2);return new A(o.fromBytes(N),o.fromBytes(R),$)}static fromHex(v,S){return this.fromBytes(Lr(v),S)}addRecoveryBit(v){return new A(this.r,this.s,v)}recoverPublicKey(v){const S=r.ORDER,{r:$,s:M,recovery:N}=this;if(N==null||![0,1,2,3].includes(N))throw new Error("recovery id invalid");if(a*eu<S&&N>1)throw new Error("recovery id is ambiguous for h>1 curve");const R=N===2||N===3?$+a:$;if(!r.isValid(R))throw new Error("recovery id 2 or 3 invalid");const V=r.toBytes(R),K=t.fromBytes(qs(tu((N&1)===0),V)),fe=o.inv(R),re=H(it("msgHash",v)),ne=o.create(-re*fe),pe=o.create(M*fe),he=t.BASE.multiplyUnsafe(ne).add(K.multiplyUnsafe(pe));if(he.is0())throw new Error("point at infinify");return he.assertValidity(),he}hasHighS(){return g(this.s)}toBytes(v=y){if(fa(v),v==="der")return Lr(vs.hexFromSig(this));const S=o.toBytes(this.r),$=o.toBytes(this.s);if(v==="recovered"){if(this.recovery==null)throw new Error("recovery bit must be present");return qs(Uint8Array.of(this.recovery),S,$)}return qs(S,$)}toHex(v){return Yn(this.toBytes(v))}assertValidity(){}static fromCompact(v){return A.fromBytes(it("sig",v),"compact")}static fromDER(v){return A.fromBytes(it("sig",v),"der")}normalizeS(){return this.hasHighS()?new A(this.r,o.neg(this.s),this.recovery):this}toDERRawBytes(){return this.toBytes("der")}toDERHex(){return Yn(this.toBytes("der"))}toCompactRawBytes(){return this.toBytes("compact")}toCompactHex(){return Yn(this.toBytes("compact"))}}const x=s.bits2int||function(C){if(C.length>8192)throw new Error("input is too large");const v=so(C),S=C.length*8-c;return S>0?v>>BigInt(S):v},H=s.bits2int_modN||function(C){return o.create(x(C))},L=Ji(c);function J(C){return ua("num < 2^"+c,C,Ns,L),o.toBytes(C)}function Y(C,v){return mn(C,void 0,"message"),v?mn(e(C),void 0,"prehashed message"):C}function T(C,v,S){if(["recovered","canonical"].some(pe=>pe in S))throw new Error("sign() legacy options not supported");const{lowS:$,prehash:M,extraEntropy:N}=_o(S,m);C=Y(C,M);const R=H(C),V=Kn(o,v),K=[J(V),J(R)];if(N!=null&&N!==!1){const pe=N===!0?n(p.secretKey):N;K.push(it("extraEntropy",pe))}const fe=qs(...K),re=R;function ne(pe){const he=x(pe);if(!o.isValidNot0(he))return;const Te=o.inv(he),ue=t.BASE.multiply(he).toAffine(),$e=o.create(ue.x);if($e===Ns)return;const jt=o.create(Te*o.create(re+$e*V));if(jt===Ns)return;let xs=(ue.x===$e?0:2)|Number(ue.y&Jn),tn=jt;return $&&g(jt)&&(tn=o.neg(jt),xs^=1),new A($e,tn,xs)}return{seed:fe,k2sig:ne}}function G(C,v,S={}){C=it("message",C);const{seed:$,k2sig:M}=T(C,v,S);return Gy(e.outputLen,o.BYTES,i)($,M)}function se(C){let v;const S=typeof C=="string"||Yr(C),$=!S&&C!==null&&typeof C=="object"&&typeof C.r=="bigint"&&typeof C.s=="bigint";if(!S&&!$)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");if($)v=new A(C.r,C.s);else if(S){try{v=A.fromBytes(it("sig",C),"der")}catch(M){if(!(M instanceof vs.Err))throw M}if(!v)try{v=A.fromBytes(it("sig",C),"compact")}catch{return!1}}return v||!1}function P(C,v,S,$={}){const{lowS:M,prehash:N,format:R}=_o($,m);if(S=it("publicKey",S),v=Y(it("message",v),N),"strict"in $)throw new Error("options.strict was renamed to lowS");const V=R===void 0?se(C):A.fromBytes(it("sig",C),R);if(V===!1)return!1;try{const K=t.fromBytes(S);if(M&&V.hasHighS())return!1;const{r:fe,s:re}=V,ne=H(v),pe=o.inv(re),he=o.create(ne*pe),Te=o.create(fe*pe),ue=t.BASE.multiplyUnsafe(he).add(K.multiplyUnsafe(Te));return ue.is0()?!1:o.create(ue.x)===fe}catch{return!1}}function E(C,v,S={}){const{prehash:$}=_o(S,m);return v=Y(v,$),A.fromBytes(C,"recovered").recoverPublicKey(v).toBytes()}return Object.freeze({keygen:l,getPublicKey:d,getSharedSecret:h,utils:u,lengths:p,Point:t,sign:G,verify:P,recoverPublicKey:E,Signature:A,hash:e})}function Nw(t){const e={a:t.a,b:t.b,p:t.Fp.ORDER,n:t.n,h:t.h,Gx:t.Gx,Gy:t.Gy},s=t.Fp;let n=t.allowedPrivateKeyLengths?Array.from(new Set(t.allowedPrivateKeyLengths.map(o=>Math.ceil(o/2)))):void 0;const i=en(e.n,{BITS:t.nBitLength,allowedLengths:n,modFromBytes:t.wrapPrivateKey}),r={Fp:s,Fn:i,allowInfinityPoint:t.allowInfinityPoint,endo:t.endo,isTorsionFree:t.isTorsionFree,clearCofactor:t.clearCofactor,fromBytes:t.fromBytes,toBytes:t.toBytes};return{CURVE:e,curveOpts:r}}function _w(t){const{CURVE:e,curveOpts:s}=Nw(t),n={hmac:t.hmac,randomBytes:t.randomBytes,lowS:t.lowS,bits2int:t.bits2int,bits2int_modN:t.bits2int_modN};return{CURVE:e,curveOpts:s,hash:t.hash,ecdsaOpts:n}}function Sw(t,e){const s=e.Point;return Object.assign({},e,{ProjectivePoint:s,CURVE:Object.assign({},t,Gh(s.Fn.ORDER,s.Fn.BITS))})}function Tw(t){const{CURVE:e,curveOpts:s,hash:n,ecdsaOpts:i}=_w(t),r=vw(e,s),o=Iw(r,n,i);return Sw(t,o)}function ga(t,e){const s=n=>Tw({...t,hash:n});return{...s(e),create:s}}const nu={p:BigInt("0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff"),n:BigInt("0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551"),h:BigInt(1),a:BigInt("0xffffffff00000001000000000000000000000000fffffffffffffffffffffffc"),b:BigInt("0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b"),Gx:BigInt("0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296"),Gy:BigInt("0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5")},iu={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000ffffffff"),n:BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffc7634d81f4372ddf581a0db248b0a77aecec196accc52973"),h:BigInt(1),a:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000fffffffc"),b:BigInt("0xb3312fa7e23ee7e4988e056be3f82d19181d9c6efe8141120314088f5013875ac656398d8a2ed19d2a85c8edd3ec2aef"),Gx:BigInt("0xaa87ca22be8b05378eb1c71ef320ad746e1d3b628ba79b9859f741e082542a385502f25dbf55296c3a545e3872760ab7"),Gy:BigInt("0x3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f")},ru={p:BigInt("0x1ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),n:BigInt("0x01fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffa51868783bf2f966b7fcc0148f709a5d03bb5c9b8899c47aebb6fb71e91386409"),h:BigInt(1),a:BigInt("0x1fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc"),b:BigInt("0x0051953eb9618e1c9a1f929a21a0b68540eea2da725b99b315f3b8b489918ef109e156193951ec7e937b1652c0bd3bb1bf073573df883d2c34f1ef451fd46b503f00"),Gx:BigInt("0x00c6858e06b70404e9cd9e3ecb662395b4429c648139053fb521f828af606b4d3dbaa14b5e77efe75928fe1dc127a2ffa8de3348b3c1856a429bf97e7e31c2e5bd66"),Gy:BigInt("0x011839296a789a3bc0045c8a5fb42c7d1bd998f54449579b446817afbd17273e662c97ee72995ef42640c550b9013fad0761353c7086a272c24088be94769fd16650")},Ow=en(nu.p),kw=en(iu.p),xw=en(ru.p),Pw=ga({...nu,Fp:Ow,lowS:!1},Zr);ga({...iu,Fp:kw,lowS:!1},Lm),ga({...ru,Fp:xw,lowS:!1,allowedPrivateKeyLengths:[130,131,132]},Dm);const Rw=Pw,ou="base10",lt="base16",gt="base64pad",Hs="base64url",Xi="utf8",au=0,Ss=1,Zi=2,Uw=0,pl=1,Oi=12,nc=32;function $w(){const t=pa.utils.randomPrivateKey(),e=pa.getPublicKey(t);return{privateKey:yt(t,lt),publicKey:yt(e,lt)}}function ma(){const t=xn(nc);return yt(t,lt)}function Dw(t,e){const s=pa.getSharedSecret(Mt(t,lt),Mt(e,lt)),n=Vy(to,s,void 0,void 0,nc);return yt(n,lt)}function Ir(t){const e=to(Mt(t,lt));return yt(e,lt)}function Dt(t){const e=to(Mt(t,Xi));return yt(e,lt)}function cu(t){return Mt(`${t}`,ou)}function Nn(t){return Number(yt(t,ou))}function lu(t){return t.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function du(t){const e=t.replace(/-/g,"+").replace(/_/g,"/"),s=(4-e.length%4)%4;return e+"=".repeat(s)}function Lw(t){const e=cu(typeof t.type<"u"?t.type:au);if(Nn(e)===Ss&&typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const s=typeof t.senderPublicKey<"u"?Mt(t.senderPublicKey,lt):void 0,n=typeof t.iv<"u"?Mt(t.iv,lt):xn(Oi),i=Mt(t.symKey,lt),r=Dh(i,n).encrypt(Mt(t.message,Xi)),o=hu({type:e,sealed:r,iv:n,senderPublicKey:s});return t.encoding===Hs?lu(o):o}function Mw(t){const e=Mt(t.symKey,lt),{sealed:s,iv:n}=Wi({encoded:t.encoded,encoding:t.encoding}),i=Dh(e,n).decrypt(s);if(i===null)throw new Error("Failed to decrypt");return yt(i,Xi)}function Bw(t,e){const s=cu(Zi),n=xn(Oi),i=Mt(t,Xi),r=hu({type:s,sealed:i,iv:n});return e===Hs?lu(r):r}function Fw(t,e){const{sealed:s}=Wi({encoded:t,encoding:e});return yt(s,Xi)}function hu(t){if(Nn(t.type)===Zi)return yt(_i([t.type,t.sealed]),gt);if(Nn(t.type)===Ss){if(typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return yt(_i([t.type,t.senderPublicKey,t.iv,t.sealed]),gt)}return yt(_i([t.type,t.iv,t.sealed]),gt)}function Wi(t){const e=(t.encoding||gt)===Hs?du(t.encoded):t.encoded,s=Mt(e,gt),n=s.slice(Uw,pl),i=pl;if(Nn(n)===Ss){const c=i+nc,l=c+Oi,d=s.slice(i,c),h=s.slice(c,l),u=s.slice(l);return{type:n,sealed:u,iv:h,senderPublicKey:d}}if(Nn(n)===Zi){const c=s.slice(i),l=xn(Oi);return{type:n,sealed:c,iv:l}}const r=i+Oi,o=s.slice(i,r),a=s.slice(r);return{type:n,sealed:a,iv:o}}function Ww(t,e){const s=Wi({encoded:t,encoding:e==null?void 0:e.encoding});return uu({type:Nn(s.type),senderPublicKey:typeof s.senderPublicKey<"u"?yt(s.senderPublicKey,lt):void 0,receiverPublicKey:e==null?void 0:e.receiverPublicKey})}function uu(t){const e=(t==null?void 0:t.type)||au;if(e===Ss){if(typeof(t==null?void 0:t.senderPublicKey)>"u")throw new Error("missing sender public key");if(typeof(t==null?void 0:t.receiverPublicKey)>"u")throw new Error("missing receiver public key")}return{type:e,senderPublicKey:t==null?void 0:t.senderPublicKey,receiverPublicKey:t==null?void 0:t.receiverPublicKey}}function fl(t){return t.type===Ss&&typeof t.senderPublicKey=="string"&&typeof t.receiverPublicKey=="string"}function gl(t){return t.type===Zi}function jw(t){const e=Buffer.from(t.x,"base64"),s=Buffer.from(t.y,"base64");return _i([new Uint8Array([4]),e,s])}function qw(t,e){const[s,n,i]=t.split("."),r=Buffer.from(du(i),"base64");if(r.length!==64)throw new Error("Invalid signature length");const o=r.slice(0,32),a=r.slice(32,64),c=`${s}.${n}`,l=to(c),d=jw(e);if(!Rw.verify(_i([o,a]),l,d))throw new Error("Invalid signature");return zo(t).payload}const Hw="irn";function jr(t){return(t==null?void 0:t.relay)||{protocol:Hw}}function Vn(t){const e=hp[t];if(typeof e>"u")throw new Error(`Relay Protocol not supported: ${t}`);return e}var Kw=Object.defineProperty,Vw=Object.defineProperties,zw=Object.getOwnPropertyDescriptors,ml=Object.getOwnPropertySymbols,Gw=Object.prototype.hasOwnProperty,Yw=Object.prototype.propertyIsEnumerable,yl=(t,e,s)=>e in t?Kw(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,So=(t,e)=>{for(var s in e||(e={}))Gw.call(e,s)&&yl(t,s,e[s]);if(ml)for(var s of ml(e))Yw.call(e,s)&&yl(t,s,e[s]);return t},Jw=(t,e)=>Vw(t,zw(e));function Xw(t,e="-"){const s={},n="relay"+e;return Object.keys(t).forEach(i=>{if(i.startsWith(n)){const r=i.replace(n,""),o=t[i];s[r]=o}}),s}function wl(t){if(!t.includes("wc:")){const l=gh(t);l!=null&&l.includes("wc:")&&(t=l)}t=t.includes("wc://")?t.replace("wc://",""):t,t=t.includes("wc:")?t.replace("wc:",""):t;const e=t.indexOf(":"),s=t.indexOf("?")!==-1?t.indexOf("?"):void 0,n=t.substring(0,e),i=t.substring(e+1,s).split("@"),r=typeof s<"u"?t.substring(s):"",o=new URLSearchParams(r),a=Object.fromEntries(o.entries()),c=typeof a.methods=="string"?a.methods.split(","):void 0;return{protocol:n,topic:Zw(i[0]),version:parseInt(i[1],10),symKey:a.symKey,relay:Xw(a),methods:c,expiryTimestamp:a.expiryTimestamp?parseInt(a.expiryTimestamp,10):void 0}}function Zw(t){return t.startsWith("//")?t.substring(2):t}function Qw(t,e="-"){const s="relay",n={};return Object.keys(t).forEach(i=>{const r=i,o=s+e+r;t[r]&&(n[o]=t[r])}),n}function bl(t){const e=new URLSearchParams,s=So(So(Jw(So({},Qw(t.relay)),{symKey:t.symKey}),t.expiryTimestamp&&{expiryTimestamp:t.expiryTimestamp.toString()}),t.methods&&{methods:t.methods.join(",")});return Object.entries(s).sort(([n],[i])=>n.localeCompare(i)).forEach(([n,i])=>{i!==void 0&&e.append(n,String(i))}),`${t.protocol}:${t.topic}@${t.version}?${e}`}function ur(t,e,s){return`${t}?wc_ev=${s}&topic=${e}`}var e0=Object.defineProperty,t0=Object.defineProperties,s0=Object.getOwnPropertyDescriptors,El=Object.getOwnPropertySymbols,n0=Object.prototype.hasOwnProperty,i0=Object.prototype.propertyIsEnumerable,Cl=(t,e,s)=>e in t?e0(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,r0=(t,e)=>{for(var s in e||(e={}))n0.call(e,s)&&Cl(t,s,e[s]);if(El)for(var s of El(e))i0.call(e,s)&&Cl(t,s,e[s]);return t},o0=(t,e)=>t0(t,s0(e));function ci(t){const e=[];return t.forEach(s=>{const[n,i]=s.split(":");e.push(`${n}:${i}`)}),e}function pu(t){const e=[];return Object.values(t).forEach(s=>{e.push(...ci(s.accounts))}),[...new Set(e)]}function a0(t){const e=[];return Object.values(t).forEach(s=>{e.push(...s.methods)}),[...new Set(e)]}function c0(t){const e=[];return Object.values(t).forEach(s=>{e.push(...s.events)}),[...new Set(e)]}function l0(t,e){const s=[];return Object.values(t).forEach(n=>{ci(n.accounts).includes(e)&&s.push(...n.methods)}),s}function d0(t,e){const s=[];return Object.values(t).forEach(n=>{ci(n.accounts).includes(e)&&s.push(...n.events)}),s}function io(t){return t.includes(":")}function zn(t){return io(t)?t.split(":")[0]:t}function vl(t){var e,s,n;const i={};if(!us(t))return i;for(const[r,o]of Object.entries(t)){const a=io(r)?[r]:o.chains,c=o.methods||[],l=o.events||[],d=zn(r);i[d]=o0(r0({},i[d]),{chains:hs(a,(e=i[d])==null?void 0:e.chains),methods:hs(c,(s=i[d])==null?void 0:s.methods),events:hs(l,(n=i[d])==null?void 0:n.events)})}return i}function h0(t){const e={};return t==null||t.forEach(s=>{var n;const[i,r]=s.split(":");e[i]||(e[i]={accounts:[],chains:[],events:[],methods:[]}),e[i].accounts.push(s),(n=e[i].chains)==null||n.push(`${i}:${r}`)}),e}function Al(t,e){e=e.map(n=>n.replace("did:pkh:",""));const s=h0(e);for(const[n,i]of Object.entries(s))i.methods?i.methods=hs(i.methods,t):i.methods=t,i.events=["chainChanged","accountsChanged"];return s}function u0(t,e){var s,n,i,r,o,a;const c=vl(t),l=vl(e),d={},h=Object.keys(c).concat(Object.keys(l));for(const u of h)d[u]={chains:hs((s=c[u])==null?void 0:s.chains,(n=l[u])==null?void 0:n.chains),methods:hs((i=c[u])==null?void 0:i.methods,(r=l[u])==null?void 0:r.methods),events:hs((o=c[u])==null?void 0:o.events,(a=l[u])==null?void 0:a.events)};return d}const p0={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},f0={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function B(t,e){const{message:s,code:n}=f0[t];return{message:e?`${s} ${e}`:s,code:n}}function Re(t,e){const{message:s,code:n}=p0[t];return{message:e?`${s} ${e}`:s,code:n}}function Ts(t,e){return!!Array.isArray(t)}function us(t){return Object.getPrototypeOf(t)===Object.prototype&&Object.keys(t).length}function He(t){return typeof t>"u"}function Be(t,e){return e&&He(t)?!0:typeof t=="string"&&!!t.trim().length}function ic(t,e){return typeof t=="number"&&!isNaN(t)}function g0(t,e){const{requiredNamespaces:s}=e,n=Object.keys(t.namespaces),i=Object.keys(s);let r=!0;return gn(i,n)?(n.forEach(o=>{const{accounts:a,methods:c,events:l}=t.namespaces[o],d=ci(a),h=s[o];(!gn(dh(o,h),d)||!gn(h.methods,c)||!gn(h.events,l))&&(r=!1)}),r):!1}function qr(t){return Be(t,!1)&&t.includes(":")?t.split(":").length===2:!1}function m0(t){if(Be(t,!1)&&t.includes(":")){const e=t.split(":");if(e.length===3){const s=e[0]+":"+e[1];return!!e[2]&&qr(s)}}return!1}function y0(t){function e(s){try{return typeof new URL(s)<"u"}catch{return!1}}try{if(Be(t,!1)){if(e(t))return!0;const s=gh(t);return e(s)}}catch{}return!1}function w0(t){var e;return(e=t==null?void 0:t.proposer)==null?void 0:e.publicKey}function b0(t){return t==null?void 0:t.topic}function E0(t,e){let s=null;return Be(t==null?void 0:t.publicKey,!1)||(s=B("MISSING_OR_INVALID",`${e} controller public key should be a string`)),s}function Il(t){let e=!0;return Ts(t)?t.length&&(e=t.every(s=>Be(s,!1))):e=!1,e}function C0(t,e,s){let n=null;return Ts(e)&&e.length?e.forEach(i=>{n||qr(i)||(n=Re("UNSUPPORTED_CHAINS",`${s}, chain ${i} should be a string and conform to "namespace:chainId" format`))}):qr(t)||(n=Re("UNSUPPORTED_CHAINS",`${s}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),n}function v0(t,e,s){let n=null;return Object.entries(t).forEach(([i,r])=>{if(n)return;const o=C0(i,dh(i,r),`${e} ${s}`);o&&(n=o)}),n}function A0(t,e){let s=null;return Ts(t)?t.forEach(n=>{s||m0(n)||(s=Re("UNSUPPORTED_ACCOUNTS",`${e}, account ${n} should be a string and conform to "namespace:chainId:address" format`))}):s=Re("UNSUPPORTED_ACCOUNTS",`${e}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),s}function I0(t,e){let s=null;return Object.values(t).forEach(n=>{if(s)return;const i=A0(n==null?void 0:n.accounts,`${e} namespace`);i&&(s=i)}),s}function N0(t,e){let s=null;return Il(t==null?void 0:t.methods)?Il(t==null?void 0:t.events)||(s=Re("UNSUPPORTED_EVENTS",`${e}, events should be an array of strings or empty array for no events`)):s=Re("UNSUPPORTED_METHODS",`${e}, methods should be an array of strings or empty array for no methods`),s}function fu(t,e){let s=null;return Object.values(t).forEach(n=>{if(s)return;const i=N0(n,`${e}, namespace`);i&&(s=i)}),s}function _0(t,e,s){let n=null;if(t&&us(t)){const i=fu(t,e);i&&(n=i);const r=v0(t,e,s);r&&(n=r)}else n=B("MISSING_OR_INVALID",`${e}, ${s} should be an object with data`);return n}function To(t,e){let s=null;if(t&&us(t)){const n=fu(t,e);n&&(s=n);const i=I0(t,e);i&&(s=i)}else s=B("MISSING_OR_INVALID",`${e}, namespaces should be an object with data`);return s}function gu(t){return Be(t.protocol,!0)}function S0(t,e){let s=!1;return t?t&&Ts(t)&&t.length&&t.forEach(n=>{s=gu(n)}):s=!0,s}function T0(t){return typeof t=="number"}function pt(t){return typeof t<"u"&&typeof t!==null}function O0(t){return!(!t||typeof t!="object"||!t.code||!ic(t.code)||!t.message||!Be(t.message,!1))}function k0(t){return!(He(t)||!Be(t.method,!1))}function x0(t){return!(He(t)||He(t.result)&&He(t.error)||!ic(t.id)||!Be(t.jsonrpc,!1))}function P0(t){return!(He(t)||!Be(t.name,!1))}function Nl(t,e){return!(!qr(e)||!pu(t).includes(e))}function R0(t,e,s){return Be(s,!1)?l0(t,e).includes(s):!1}function U0(t,e,s){return Be(s,!1)?d0(t,e).includes(s):!1}function _l(t,e,s){let n=null;const i=$0(t),r=D0(e),o=Object.keys(i),a=Object.keys(r),c=Sl(Object.keys(t)),l=Sl(Object.keys(e)),d=c.filter(h=>!l.includes(h));return d.length&&(n=B("NON_CONFORMING_NAMESPACES",`${s} namespaces keys don't satisfy requiredNamespaces.
      Required: ${d.toString()}
      Received: ${Object.keys(e).toString()}`)),gn(o,a)||(n=B("NON_CONFORMING_NAMESPACES",`${s} namespaces chains don't satisfy required namespaces.
      Required: ${o.toString()}
      Approved: ${a.toString()}`)),Object.keys(e).forEach(h=>{if(!h.includes(":")||n)return;const u=ci(e[h].accounts);u.includes(h)||(n=B("NON_CONFORMING_NAMESPACES",`${s} namespaces accounts don't satisfy namespace accounts for ${h}
        Required: ${h}
        Approved: ${u.toString()}`))}),o.forEach(h=>{n||(gn(i[h].methods,r[h].methods)?gn(i[h].events,r[h].events)||(n=B("NON_CONFORMING_NAMESPACES",`${s} namespaces events don't satisfy namespace events for ${h}`)):n=B("NON_CONFORMING_NAMESPACES",`${s} namespaces methods don't satisfy namespace methods for ${h}`))}),n}function $0(t){const e={};return Object.keys(t).forEach(s=>{var n;s.includes(":")?e[s]=t[s]:(n=t[s].chains)==null||n.forEach(i=>{e[i]={methods:t[s].methods,events:t[s].events}})}),e}function Sl(t){return[...new Set(t.map(e=>e.includes(":")?e.split(":")[0]:e))]}function D0(t){const e={};return Object.keys(t).forEach(s=>{if(s.includes(":"))e[s]=t[s];else{const n=ci(t[s].accounts);n==null||n.forEach(i=>{e[i]={accounts:t[s].accounts.filter(r=>r.includes(`${i}:`)),methods:t[s].methods,events:t[s].events}})}}),e}function L0(t,e){return ic(t)&&t<=e.max&&t>=e.min}function Tl(){const t=Gi();return new Promise(e=>{switch(t){case St.browser:e(M0());break;case St.reactNative:e(B0());break;case St.node:e(F0());break;default:e(!0)}})}function M0(){return ai()&&(navigator==null?void 0:navigator.onLine)}async function B0(){if(Qs()&&typeof global<"u"&&global!=null&&global.NetInfo){const t=await(global==null?void 0:global.NetInfo.fetch());return t==null?void 0:t.isConnected}return!0}function F0(){return!0}function W0(t){switch(Gi()){case St.browser:j0(t);break;case St.reactNative:q0(t);break}}function j0(t){!Qs()&&ai()&&(window.addEventListener("online",()=>t(!0)),window.addEventListener("offline",()=>t(!1)))}function q0(t){Qs()&&typeof global<"u"&&global!=null&&global.NetInfo&&(global==null||global.NetInfo.addEventListener(e=>t(e==null?void 0:e.isConnected)))}function H0(){var t;return ai()&&Os.getDocument()?((t=Os.getDocument())==null?void 0:t.visibilityState)==="visible":!0}const Oo={};class gi{static get(e){return Oo[e]}static set(e,s){Oo[e]=s}static delete(e){delete Oo[e]}}function K0(t){const e=ri.decode(t);if(e.length<33)throw new Error("Too short to contain a public key");return e.slice(1,33)}function V0({publicKey:t,signature:e,payload:s}){var n;const i=ya(s.method),r=128|parseInt(((n=s.version)==null?void 0:n.toString())||"4"),o=Y0(s.address),a=s.era==="00"?new Uint8Array([0]):ya(s.era);if(a.length!==1&&a.length!==2)throw new Error("Invalid era length");const c=parseInt(s.nonce,16),l=new Uint8Array([c&255,c>>8&255]),d=BigInt(`0x${G0(s.tip)}`),h=X0(d),u=new Uint8Array([0,...t,o,...e,...a,...l,...h,...i]),p=J0(u.length+1);return new Uint8Array([...p,r,...u])}function z0(t){const e=ya(t),s=fp.blake2b(e,void 0,32);return"0x"+Buffer.from(s).toString("hex")}function ya(t){return new Uint8Array(t.replace(/^0x/,"").match(/.{1,2}/g).map(e=>parseInt(e,16)))}function G0(t){return t.startsWith("0x")?t.slice(2):t}function Y0(t){const e=ri.decode(t)[0];return e===42?0:e===60?2:1}function J0(t){if(t<64)return new Uint8Array([t<<2]);if(t<16384){const e=t<<2|1;return new Uint8Array([e&255,e>>8&255])}else if(t<1<<30){const e=t<<2|2;return new Uint8Array([e&255,e>>8&255,e>>16&255,e>>24&255])}else throw new Error("Compact encoding > 2^30 not supported")}function X0(t){if(t<BigInt(1)<<BigInt(6))return new Uint8Array([Number(t<<BigInt(2))]);if(t<BigInt(1)<<BigInt(14)){const e=t<<BigInt(2)|BigInt(1);return new Uint8Array([Number(e&BigInt(255)),Number(e>>BigInt(8)&BigInt(255))])}else if(t<BigInt(1)<<BigInt(30)){const e=t<<BigInt(2)|BigInt(2);return new Uint8Array([Number(e&BigInt(255)),Number(e>>BigInt(8)&BigInt(255)),Number(e>>BigInt(16)&BigInt(255)),Number(e>>BigInt(24)&BigInt(255))])}else throw new Error("BigInt compact encoding not supported > 2^30")}function Z0(t){const e=Uint8Array.from(Buffer.from(t.signature,"hex")),s=K0(t.transaction.address),n=V0({publicKey:s,signature:e,payload:t.transaction}),i=Buffer.from(n).toString("hex");return z0(i)}function rc({logger:t,name:e}){const s=typeof t=="string"?Ma({opts:{level:t,name:e}}).logger:t;return s.level=typeof t=="string"?t:t.level,s}var Q0={};const mu="wc",yu=2,wa="core",ps=`${mu}@2:${wa}:`,eb={logger:"error"},tb={database:":memory:"},sb="crypto",Ol="client_ed25519_seed",nb=F.ONE_DAY,ib="keychain",rb="0.3",ob="messages",ab="0.3",cb=F.SIX_HOURS,lb="publisher",wu="irn",db="error",bu="wss://relay.walletconnect.org",hb="relayer",Me={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},ub="_subscription",kt={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},pb=.1,ba="2.23.2",ke={link_mode:"link_mode",relay:"relay"},Nr={inbound:"inbound",outbound:"outbound"},fb="0.3",gb="WALLETCONNECT_CLIENT_ID",kl="WALLETCONNECT_LINK_MODE_APPS",vt={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},mb="subscription",yb="0.3",wb="pairing",bb="0.3",mi={wc_pairingDelete:{req:{ttl:F.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:F.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:F.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:F.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:F.ONE_DAY,prompt:!1,tag:0},res:{ttl:F.ONE_DAY,prompt:!1,tag:0}}},hn={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},qt={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},Eb="history",Cb="0.3",vb="expirer",$t={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},Ab="0.3",Ib="verify-api",Nb="https://verify.walletconnect.com",Eu="https://verify.walletconnect.org",ki=Eu,_b=`${ki}/v3`,Sb=[Nb,Eu],Tb="echo",Ob="https://echo.walletconnect.com",ns={pairing_started:"pairing_started",pairing_uri_validation_success:"pairing_uri_validation_success",pairing_uri_not_expired:"pairing_uri_not_expired",store_new_pairing:"store_new_pairing",subscribing_pairing_topic:"subscribing_pairing_topic",subscribe_pairing_topic_success:"subscribe_pairing_topic_success",existing_pairing:"existing_pairing",pairing_not_expired:"pairing_not_expired",emit_inactive_pairing:"emit_inactive_pairing",emit_session_proposal:"emit_session_proposal",subscribing_to_pairing_topic:"subscribing_to_pairing_topic"},ws={no_wss_connection:"no_wss_connection",no_internet_connection:"no_internet_connection",malformed_pairing_uri:"malformed_pairing_uri",active_pairing_already_exists:"active_pairing_already_exists",subscribe_pairing_topic_failure:"subscribe_pairing_topic_failure",pairing_expired:"pairing_expired",proposal_expired:"proposal_expired",proposal_listener_not_found:"proposal_listener_not_found"},Ht={session_approve_started:"session_approve_started",proposal_not_expired:"proposal_not_expired",session_namespaces_validation_success:"session_namespaces_validation_success",create_session_topic:"create_session_topic",subscribing_session_topic:"subscribing_session_topic",subscribe_session_topic_success:"subscribe_session_topic_success",publishing_session_approve:"publishing_session_approve",session_approve_publish_success:"session_approve_publish_success",store_session:"store_session",publishing_session_settle:"publishing_session_settle",session_settle_publish_success:"session_settle_publish_success",session_request_response_started:"session_request_response_started",session_request_response_validation_success:"session_request_response_validation_success",session_request_response_publish_started:"session_request_response_publish_started"},nn={no_internet_connection:"no_internet_connection",no_wss_connection:"no_wss_connection",proposal_expired:"proposal_expired",subscribe_session_topic_failure:"subscribe_session_topic_failure",session_approve_publish_failure:"session_approve_publish_failure",session_settle_publish_failure:"session_settle_publish_failure",session_approve_namespace_validation_failure:"session_approve_namespace_validation_failure",proposal_not_found:"proposal_not_found",session_request_response_validation_failure:"session_request_response_validation_failure",session_request_response_publish_failure:"session_request_response_publish_failure"},rn={authenticated_session_approve_started:"authenticated_session_approve_started",create_authenticated_session_topic:"create_authenticated_session_topic",cacaos_verified:"cacaos_verified",store_authenticated_session:"store_authenticated_session",subscribing_authenticated_session_topic:"subscribing_authenticated_session_topic",subscribe_authenticated_session_topic_success:"subscribe_authenticated_session_topic_success",publishing_authenticated_session_approve:"publishing_authenticated_session_approve"},yi={no_internet_connection:"no_internet_connection",invalid_cacao:"invalid_cacao",subscribe_authenticated_session_topic_failure:"subscribe_authenticated_session_topic_failure",authenticated_session_approve_publish_failure:"authenticated_session_approve_publish_failure",authenticated_session_pending_request_not_found:"authenticated_session_pending_request_not_found"},kb=.1,xb="event-client",Pb=86400,Rb="https://pulse.walletconnect.org/batch";function Ub(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var s=new Uint8Array(256),n=0;n<s.length;n++)s[n]=255;for(var i=0;i<t.length;i++){var r=t.charAt(i),o=r.charCodeAt(0);if(s[o]!==255)throw new TypeError(r+" is ambiguous");s[o]=i}var a=t.length,c=t.charAt(0),l=Math.log(a)/Math.log(256),d=Math.log(256)/Math.log(a);function h(m){if(m instanceof Uint8Array||(ArrayBuffer.isView(m)?m=new Uint8Array(m.buffer,m.byteOffset,m.byteLength):Array.isArray(m)&&(m=Uint8Array.from(m))),!(m instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(m.length===0)return"";for(var y=0,g=0,w=0,b=m.length;w!==b&&m[w]===0;)w++,y++;for(var A=(b-w)*d+1>>>0,x=new Uint8Array(A);w!==b;){for(var H=m[w],L=0,J=A-1;(H!==0||L<g)&&J!==-1;J--,L++)H+=256*x[J]>>>0,x[J]=H%a>>>0,H=H/a>>>0;if(H!==0)throw new Error("Non-zero carry");g=L,w++}for(var Y=A-g;Y!==A&&x[Y]===0;)Y++;for(var T=c.repeat(y);Y<A;++Y)T+=t.charAt(x[Y]);return T}function u(m){if(typeof m!="string")throw new TypeError("Expected String");if(m.length===0)return new Uint8Array;var y=0;if(m[y]!==" "){for(var g=0,w=0;m[y]===c;)g++,y++;for(var b=(m.length-y)*l+1>>>0,A=new Uint8Array(b);m[y];){var x=s[m.charCodeAt(y)];if(x===255)return;for(var H=0,L=b-1;(x!==0||H<w)&&L!==-1;L--,H++)x+=a*A[L]>>>0,A[L]=x%256>>>0,x=x/256>>>0;if(x!==0)throw new Error("Non-zero carry");w=H,y++}if(m[y]!==" "){for(var J=b-w;J!==b&&A[J]===0;)J++;for(var Y=new Uint8Array(g+(b-J)),T=g;J!==b;)Y[T++]=A[J++];return Y}}}function p(m){var y=u(m);if(y)return y;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:u,decode:p}}var $b=Ub,Db=$b;const Cu=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},Lb=t=>new TextEncoder().encode(t),Mb=t=>new TextDecoder().decode(t);class Bb{constructor(e,s,n){this.name=e,this.prefix=s,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class Fb{constructor(e,s,n){if(this.name=e,this.prefix=s,s.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=s.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return vu(this,e)}}class Wb{constructor(e){this.decoders=e}or(e){return vu(this,e)}decode(e){const s=e[0],n=this.decoders[s];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const vu=(t,e)=>new Wb({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});class jb{constructor(e,s,n,i){this.name=e,this.prefix=s,this.baseEncode=n,this.baseDecode=i,this.encoder=new Bb(e,s,n),this.decoder=new Fb(e,s,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const ro=({name:t,prefix:e,encode:s,decode:n})=>new jb(t,e,s,n),Qi=({prefix:t,name:e,alphabet:s})=>{const{encode:n,decode:i}=Db(s,e);return ro({prefix:t,name:e,encode:n,decode:r=>Cu(i(r))})},qb=(t,e,s,n)=>{const i={};for(let d=0;d<e.length;++d)i[e[d]]=d;let r=t.length;for(;t[r-1]==="=";)--r;const o=new Uint8Array(r*s/8|0);let a=0,c=0,l=0;for(let d=0;d<r;++d){const h=i[t[d]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<s|h,a+=s,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=s||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},Hb=(t,e,s)=>{const n=e[e.length-1]==="=",i=(1<<s)-1;let r="",o=0,a=0;for(let c=0;c<t.length;++c)for(a=a<<8|t[c],o+=8;o>s;)o-=s,r+=e[i&a>>o];if(o&&(r+=e[i&a<<s-o]),n)for(;r.length*s&7;)r+="=";return r},Qe=({name:t,prefix:e,bitsPerChar:s,alphabet:n})=>ro({prefix:e,name:t,encode(i){return Hb(i,n,s)},decode(i){return qb(i,n,s,t)}}),Kb=ro({prefix:"\0",name:"identity",encode:t=>Mb(t),decode:t=>Lb(t)});var Vb=Object.freeze({__proto__:null,identity:Kb});const zb=Qe({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var Gb=Object.freeze({__proto__:null,base2:zb});const Yb=Qe({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var Jb=Object.freeze({__proto__:null,base8:Yb});const Xb=Qi({prefix:"9",name:"base10",alphabet:"0123456789"});var Zb=Object.freeze({__proto__:null,base10:Xb});const Qb=Qe({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),eE=Qe({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var tE=Object.freeze({__proto__:null,base16:Qb,base16upper:eE});const sE=Qe({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),nE=Qe({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),iE=Qe({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),rE=Qe({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),oE=Qe({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),aE=Qe({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),cE=Qe({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),lE=Qe({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),dE=Qe({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var hE=Object.freeze({__proto__:null,base32:sE,base32upper:nE,base32pad:iE,base32padupper:rE,base32hex:oE,base32hexupper:aE,base32hexpad:cE,base32hexpadupper:lE,base32z:dE});const uE=Qi({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),pE=Qi({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var fE=Object.freeze({__proto__:null,base36:uE,base36upper:pE});const gE=Qi({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),mE=Qi({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var yE=Object.freeze({__proto__:null,base58btc:gE,base58flickr:mE});const wE=Qe({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),bE=Qe({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),EE=Qe({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),CE=Qe({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var vE=Object.freeze({__proto__:null,base64:wE,base64pad:bE,base64url:EE,base64urlpad:CE});const Au=Array.from("ðŸš€ðŸªâ˜„ðŸ›°ðŸŒŒðŸŒ‘ðŸŒ’ðŸŒ“ðŸŒ”ðŸŒ•ðŸŒ–ðŸŒ—ðŸŒ˜ðŸŒðŸŒðŸŒŽðŸ‰â˜€ðŸ’»ðŸ–¥ðŸ’¾ðŸ’¿ðŸ˜‚â¤ðŸ˜ðŸ¤£ðŸ˜ŠðŸ™ðŸ’•ðŸ˜­ðŸ˜˜ðŸ‘ðŸ˜…ðŸ‘ðŸ˜ðŸ”¥ðŸ¥°ðŸ’”ðŸ’–ðŸ’™ðŸ˜¢ðŸ¤”ðŸ˜†ðŸ™„ðŸ’ªðŸ˜‰â˜ºðŸ‘ŒðŸ¤—ðŸ’œðŸ˜”ðŸ˜ŽðŸ˜‡ðŸŒ¹ðŸ¤¦ðŸŽ‰ðŸ’žâœŒâœ¨ðŸ¤·ðŸ˜±ðŸ˜ŒðŸŒ¸ðŸ™ŒðŸ˜‹ðŸ’—ðŸ’šðŸ˜ðŸ’›ðŸ™‚ðŸ’“ðŸ¤©ðŸ˜„ðŸ˜€ðŸ–¤ðŸ˜ƒðŸ’¯ðŸ™ˆðŸ‘‡ðŸŽ¶ðŸ˜’ðŸ¤­â£ðŸ˜œðŸ’‹ðŸ‘€ðŸ˜ªðŸ˜‘ðŸ’¥ðŸ™‹ðŸ˜žðŸ˜©ðŸ˜¡ðŸ¤ªðŸ‘ŠðŸ¥³ðŸ˜¥ðŸ¤¤ðŸ‘‰ðŸ’ƒðŸ˜³âœ‹ðŸ˜šðŸ˜ðŸ˜´ðŸŒŸðŸ˜¬ðŸ™ƒðŸ€ðŸŒ·ðŸ˜»ðŸ˜“â­âœ…ðŸ¥ºðŸŒˆðŸ˜ˆðŸ¤˜ðŸ’¦âœ”ðŸ˜£ðŸƒðŸ’â˜¹ðŸŽŠðŸ’˜ðŸ˜ â˜ðŸ˜•ðŸŒºðŸŽ‚ðŸŒ»ðŸ˜ðŸ–•ðŸ’ðŸ™ŠðŸ˜¹ðŸ—£ðŸ’«ðŸ’€ðŸ‘‘ðŸŽµðŸ¤žðŸ˜›ðŸ”´ðŸ˜¤ðŸŒ¼ðŸ˜«âš½ðŸ¤™â˜•ðŸ†ðŸ¤«ðŸ‘ˆðŸ˜®ðŸ™†ðŸ»ðŸƒðŸ¶ðŸ’ðŸ˜²ðŸŒ¿ðŸ§¡ðŸŽâš¡ðŸŒžðŸŽˆâŒâœŠðŸ‘‹ðŸ˜°ðŸ¤¨ðŸ˜¶ðŸ¤ðŸš¶ðŸ’°ðŸ“ðŸ’¢ðŸ¤ŸðŸ™ðŸš¨ðŸ’¨ðŸ¤¬âœˆðŸŽ€ðŸºðŸ¤“ðŸ˜™ðŸ’ŸðŸŒ±ðŸ˜–ðŸ‘¶ðŸ¥´â–¶âž¡â“ðŸ’ŽðŸ’¸â¬‡ðŸ˜¨ðŸŒšðŸ¦‹ðŸ˜·ðŸ•ºâš ðŸ™…ðŸ˜ŸðŸ˜µðŸ‘ŽðŸ¤²ðŸ¤ ðŸ¤§ðŸ“ŒðŸ”µðŸ’…ðŸ§ðŸ¾ðŸ’ðŸ˜—ðŸ¤‘ðŸŒŠðŸ¤¯ðŸ·â˜ŽðŸ’§ðŸ˜¯ðŸ’†ðŸ‘†ðŸŽ¤ðŸ™‡ðŸ‘â„ðŸŒ´ðŸ’£ðŸ¸ðŸ’ŒðŸ“ðŸ¥€ðŸ¤¢ðŸ‘…ðŸ’¡ðŸ’©ðŸ‘ðŸ“¸ðŸ‘»ðŸ¤ðŸ¤®ðŸŽ¼ðŸ¥µðŸš©ðŸŽðŸŠðŸ‘¼ðŸ’ðŸ“£ðŸ¥‚"),AE=Au.reduce((t,e,s)=>(t[s]=e,t),[]),IE=Au.reduce((t,e,s)=>(t[e.codePointAt(0)]=s,t),[]);function NE(t){return t.reduce((e,s)=>(e+=AE[s],e),"")}function _E(t){const e=[];for(const s of t){const n=IE[s.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${s}`);e.push(n)}return new Uint8Array(e)}const SE=ro({prefix:"ðŸš€",name:"base256emoji",encode:NE,decode:_E});var TE=Object.freeze({__proto__:null,base256emoji:SE}),OE=Iu,xl=128,kE=-128,xE=Math.pow(2,31);function Iu(t,e,s){e=e||[],s=s||0;for(var n=s;t>=xE;)e[s++]=t&255|xl,t/=128;for(;t&kE;)e[s++]=t&255|xl,t>>>=7;return e[s]=t|0,Iu.bytes=s-n+1,e}var PE=Ea,RE=128,Pl=127;function Ea(t,n){var s=0,n=n||0,i=0,r=n,o,a=t.length;do{if(r>=a)throw Ea.bytes=0,new RangeError("Could not decode varint");o=t[r++],s+=i<28?(o&Pl)<<i:(o&Pl)*Math.pow(2,i),i+=7}while(o>=RE);return Ea.bytes=r-n,s}var UE=Math.pow(2,7),$E=Math.pow(2,14),DE=Math.pow(2,21),LE=Math.pow(2,28),ME=Math.pow(2,35),BE=Math.pow(2,42),FE=Math.pow(2,49),WE=Math.pow(2,56),jE=Math.pow(2,63),qE=function(t){return t<UE?1:t<$E?2:t<DE?3:t<LE?4:t<ME?5:t<BE?6:t<FE?7:t<WE?8:t<jE?9:10},HE={encode:OE,decode:PE,encodingLength:qE},Nu=HE;const Rl=(t,e,s=0)=>(Nu.encode(t,e,s),e),Ul=t=>Nu.encodingLength(t),Ca=(t,e)=>{const s=e.byteLength,n=Ul(t),i=n+Ul(s),r=new Uint8Array(i+s);return Rl(t,r,0),Rl(s,r,n),r.set(e,i),new KE(t,s,e,r)};class KE{constructor(e,s,n,i){this.code=e,this.size=s,this.digest=n,this.bytes=i}}const _u=({name:t,code:e,encode:s})=>new VE(t,e,s);class VE{constructor(e,s,n){this.name=e,this.code=s,this.encode=n}digest(e){if(e instanceof Uint8Array){const s=this.encode(e);return s instanceof Uint8Array?Ca(this.code,s):s.then(n=>Ca(this.code,n))}else throw Error("Unknown type, must be binary type")}}const Su=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),zE=_u({name:"sha2-256",code:18,encode:Su("SHA-256")}),GE=_u({name:"sha2-512",code:19,encode:Su("SHA-512")});var YE=Object.freeze({__proto__:null,sha256:zE,sha512:GE});const Tu=0,JE="identity",Ou=Cu,XE=t=>Ca(Tu,Ou(t)),ZE={code:Tu,name:JE,encode:Ou,digest:XE};var QE=Object.freeze({__proto__:null,identity:ZE});new TextEncoder,new TextDecoder;const $l={...Vb,...Gb,...Jb,...Zb,...tE,...hE,...fE,...yE,...vE,...TE};({...YE,...QE});function ku(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function eC(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?ku(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function xu(t,e,s,n){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:s},decoder:{decode:n}}}const Dl=xu("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),ko=xu("ascii","a",t=>{let e="a";for(let s=0;s<t.length;s++)e+=String.fromCharCode(t[s]);return e},t=>{t=t.substring(1);const e=eC(t.length);for(let s=0;s<t.length;s++)e[s]=t.charCodeAt(s);return e}),tC={utf8:Dl,"utf-8":Dl,hex:$l.base16,latin1:ko,ascii:ko,binary:ko,...$l};function sC(t,e="utf8"){const s=tC[e];if(!s)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?ku(globalThis.Buffer.from(t,"utf-8")):s.decoder.decode(`${s.prefix}${t}`)}var nC=Object.defineProperty,iC=(t,e,s)=>e in t?nC(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,ts=(t,e,s)=>iC(t,typeof e!="symbol"?e+"":e,s);class rC{constructor(e,s){this.core=e,this.logger=s,ts(this,"keychain",new Map),ts(this,"name",ib),ts(this,"version",rb),ts(this,"initialized",!1),ts(this,"storagePrefix",ps),ts(this,"init",async()=>{if(!this.initialized){const n=await this.getKeyChain();typeof n<"u"&&(this.keychain=n),this.initialized=!0}}),ts(this,"has",n=>(this.isInitialized(),this.keychain.has(n))),ts(this,"set",async(n,i)=>{this.isInitialized(),this.keychain.set(n,i),await this.persist()}),ts(this,"get",n=>{this.isInitialized();const i=this.keychain.get(n);if(typeof i>"u"){const{message:r}=B("NO_MATCHING_KEY",`${this.name}: ${n}`);throw new Error(r)}return i}),ts(this,"del",async n=>{this.isInitialized(),this.keychain.delete(n),await this.persist()}),this.core=e,this.logger=Tt(s,this.name)}get context(){return Ot(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(e){await this.core.storage.setItem(this.storageKey,ia(e))}async getKeyChain(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?ra(e):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:e}=B("NOT_INITIALIZED",this.name);throw new Error(e)}}}var oC=Object.defineProperty,aC=(t,e,s)=>e in t?oC(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,je=(t,e,s)=>aC(t,typeof e!="symbol"?e+"":e,s);class cC{constructor(e,s,n){this.core=e,this.logger=s,je(this,"name",sb),je(this,"keychain"),je(this,"randomSessionIdentifier",ma()),je(this,"initialized",!1),je(this,"clientId"),je(this,"init",async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)}),je(this,"hasKeys",i=>(this.isInitialized(),this.keychain.has(i))),je(this,"getClientId",async()=>{if(this.isInitialized(),this.clientId)return this.clientId;const i=await this.getClientSeed(),r=mc(i),o=Ep(r.publicKey);return this.clientId=o,o}),je(this,"generateKeyPair",()=>{this.isInitialized();const i=$w();return this.setPrivateKey(i.publicKey,i.privateKey)}),je(this,"signJWT",async i=>{this.isInitialized();const r=await this.getClientSeed(),o=mc(r),a=this.randomSessionIdentifier;return await Cp(a,i,nb,o)}),je(this,"generateSharedKey",(i,r,o)=>{this.isInitialized();const a=this.getPrivateKey(i),c=Dw(a,r);return this.setSymKey(c,o)}),je(this,"setSymKey",async(i,r)=>{this.isInitialized();const o=r||Ir(i);return await this.keychain.set(o,i),o}),je(this,"deleteKeyPair",async i=>{this.isInitialized(),await this.keychain.del(i)}),je(this,"deleteSymKey",async i=>{this.isInitialized(),await this.keychain.del(i)}),je(this,"encode",async(i,r,o)=>{this.isInitialized();const a=uu(o),c=vp(r);if(gl(a))return Bw(c,o==null?void 0:o.encoding);if(fl(a)){const u=a.senderPublicKey,p=a.receiverPublicKey;i=await this.generateSharedKey(u,p)}const l=this.getSymKey(i),{type:d,senderPublicKey:h}=a;return Lw({type:d,symKey:l,message:c,senderPublicKey:h,encoding:o==null?void 0:o.encoding})}),je(this,"decode",async(i,r,o)=>{this.isInitialized();const a=Ww(r,o);if(gl(a)){const c=Fw(r,o==null?void 0:o.encoding);return yc(c)}if(fl(a)){const c=a.receiverPublicKey,l=a.senderPublicKey;i=await this.generateSharedKey(c,l)}try{const c=this.getSymKey(i),l=Mw({symKey:c,encoded:r,encoding:o==null?void 0:o.encoding});return yc(l)}catch(c){this.logger.error(`Failed to decode message from topic: '${i}', clientId: '${await this.getClientId()}'`),this.logger.error(c)}}),je(this,"getPayloadType",(i,r=gt)=>{const o=Wi({encoded:i,encoding:r});return Nn(o.type)}),je(this,"getPayloadSenderPublicKey",(i,r=gt)=>{const o=Wi({encoded:i,encoding:r});return o.senderPublicKey?yt(o.senderPublicKey,lt):void 0}),this.core=e,this.logger=Tt(s,this.name),this.keychain=n||new rC(this.core,this.logger)}get context(){return Ot(this.logger)}async setPrivateKey(e,s){return await this.keychain.set(e,s),e}getPrivateKey(e){return this.keychain.get(e)}async getClientSeed(){let e="";try{e=this.keychain.get(Ol)}catch{e=ma(),await this.keychain.set(Ol,e)}return sC(e,"base16")}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){const{message:e}=B("NOT_INITIALIZED",this.name);throw new Error(e)}}}var lC=Object.defineProperty,dC=Object.defineProperties,hC=Object.getOwnPropertyDescriptors,Ll=Object.getOwnPropertySymbols,uC=Object.prototype.hasOwnProperty,pC=Object.prototype.propertyIsEnumerable,va=(t,e,s)=>e in t?lC(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,fC=(t,e)=>{for(var s in e||(e={}))uC.call(e,s)&&va(t,s,e[s]);if(Ll)for(var s of Ll(e))pC.call(e,s)&&va(t,s,e[s]);return t},gC=(t,e)=>dC(t,hC(e)),bt=(t,e,s)=>va(t,typeof e!="symbol"?e+"":e,s);class mC extends Df{constructor(e,s){super(e,s),this.logger=e,this.core=s,bt(this,"messages",new Map),bt(this,"messagesWithoutClientAck",new Map),bt(this,"name",ob),bt(this,"version",ab),bt(this,"initialized",!1),bt(this,"storagePrefix",ps),bt(this,"init",async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const n=await this.getRelayerMessages();typeof n<"u"&&(this.messages=n);const i=await this.getRelayerMessagesWithoutClientAck();typeof i<"u"&&(this.messagesWithoutClientAck=i),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(n){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(n)}finally{this.initialized=!0}}}),bt(this,"set",async(n,i,r)=>{this.isInitialized();const o=Dt(i);let a=this.messages.get(n);if(typeof a>"u"&&(a={}),typeof a[o]<"u")return o;if(a[o]=i,this.messages.set(n,a),r===Nr.inbound){const c=this.messagesWithoutClientAck.get(n)||{};this.messagesWithoutClientAck.set(n,gC(fC({},c),{[o]:i}))}return await this.persist(),o}),bt(this,"get",n=>{this.isInitialized();let i=this.messages.get(n);return typeof i>"u"&&(i={}),i}),bt(this,"getWithoutAck",n=>{this.isInitialized();const i={};for(const r of n){const o=this.messagesWithoutClientAck.get(r)||{};i[r]=Object.values(o)}return i}),bt(this,"has",(n,i)=>{this.isInitialized();const r=this.get(n),o=Dt(i);return typeof r[o]<"u"}),bt(this,"ack",async(n,i)=>{this.isInitialized();const r=this.messagesWithoutClientAck.get(n);if(typeof r>"u")return;const o=Dt(i);delete r[o],Object.keys(r).length===0?this.messagesWithoutClientAck.delete(n):this.messagesWithoutClientAck.set(n,r),await this.persist()}),bt(this,"del",async n=>{this.isInitialized(),this.messages.delete(n),this.messagesWithoutClientAck.delete(n),await this.persist()}),this.logger=Tt(e,this.name),this.core=s}get context(){return Ot(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get storageKeyWithoutClientAck(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name+"_withoutClientAck"}async setRelayerMessages(e){await this.core.storage.setItem(this.storageKey,ia(e))}async setRelayerMessagesWithoutClientAck(e){await this.core.storage.setItem(this.storageKeyWithoutClientAck,ia(e))}async getRelayerMessages(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?ra(e):void 0}async getRelayerMessagesWithoutClientAck(){const e=await this.core.storage.getItem(this.storageKeyWithoutClientAck);return typeof e<"u"?ra(e):void 0}async persist(){await this.setRelayerMessages(this.messages),await this.setRelayerMessagesWithoutClientAck(this.messagesWithoutClientAck)}isInitialized(){if(!this.initialized){const{message:e}=B("NOT_INITIALIZED",this.name);throw new Error(e)}}}var yC=Object.defineProperty,wC=Object.defineProperties,bC=Object.getOwnPropertyDescriptors,Ml=Object.getOwnPropertySymbols,EC=Object.prototype.hasOwnProperty,CC=Object.prototype.propertyIsEnumerable,Aa=(t,e,s)=>e in t?yC(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,Bn=(t,e)=>{for(var s in e||(e={}))EC.call(e,s)&&Aa(t,s,e[s]);if(Ml)for(var s of Ml(e))CC.call(e,s)&&Aa(t,s,e[s]);return t},Bl=(t,e)=>wC(t,bC(e)),xt=(t,e,s)=>Aa(t,typeof e!="symbol"?e+"":e,s);class vC extends Lf{constructor(e,s){super(e,s),this.relayer=e,this.logger=s,xt(this,"events",new Sn.EventEmitter),xt(this,"name",lb),xt(this,"queue",new Map),xt(this,"publishTimeout",F.toMiliseconds(F.ONE_MINUTE)),xt(this,"initialPublishTimeout",F.toMiliseconds(F.ONE_SECOND*15)),xt(this,"needsTransportRestart",!1),xt(this,"publish",async(n,i,r)=>{var o,a,c,l,d;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:n,message:i,opts:r}});const h=(r==null?void 0:r.ttl)||cb,u=(r==null?void 0:r.prompt)||!1,p=(r==null?void 0:r.tag)||0,m=(r==null?void 0:r.id)||fn().toString(),y=Vn(jr().protocol),g={id:m,method:(r==null?void 0:r.publishMethod)||y.publish,params:Bn({topic:n,message:i,ttl:h,prompt:u,tag:p,attestation:r==null?void 0:r.attestation},r==null?void 0:r.tvf)},w=`Failed to publish payload, please try again. id:${m} tag:${p}`;try{He((o=g.params)==null?void 0:o.prompt)&&((a=g.params)==null||delete a.prompt),He((c=g.params)==null?void 0:c.tag)&&((l=g.params)==null||delete l.tag);const b=new Promise(async A=>{const x=({id:L})=>{var J;((J=g.id)==null?void 0:J.toString())===L.toString()&&(this.removeRequestFromQueue(L),this.relayer.events.removeListener(Me.publish,x),A())};this.relayer.events.on(Me.publish,x);const H=cs(new Promise((L,J)=>{this.rpcPublish(g,r).then(L).catch(Y=>{this.logger.warn(Y,Y==null?void 0:Y.message),J(Y)})}),this.initialPublishTimeout,`Failed initial publish, retrying.... id:${m} tag:${p}`);try{await H,this.events.removeListener(Me.publish,x)}catch(L){this.queue.set(m,{request:g,opts:r,attempt:1}),this.logger.warn(L,L==null?void 0:L.message)}});this.logger.trace({type:"method",method:"publish",params:{id:m,topic:n,message:i,opts:r}}),await cs(b,this.publishTimeout,w)}catch(b){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(b),(d=r==null?void 0:r.internal)!=null&&d.throwOnFailedPublish)throw b}finally{this.queue.delete(m)}}),xt(this,"publishCustom",async n=>{var i,r,o,a,c;this.logger.debug("Publishing custom payload"),this.logger.trace({type:"method",method:"publishCustom",params:n});const{payload:l,opts:d={}}=n,{attestation:h,tvf:u,publishMethod:p,prompt:m,tag:y,ttl:g=F.FIVE_MINUTES}=d,w=d.id||fn().toString(),b=Vn(jr().protocol),A=p||b.publish,x={id:w,method:A,params:Bn(Bl(Bn({},l),{ttl:g,prompt:m,tag:y,attestation:h}),u)},H=`Failed to publish custom payload, please try again. id:${w} tag:${y}`;try{He((i=x.params)==null?void 0:i.prompt)&&((r=x.params)==null||delete r.prompt),He((o=x.params)==null?void 0:o.tag)&&((a=x.params)==null||delete a.tag);const L=new Promise(async J=>{const Y=({id:G})=>{var se;((se=x.id)==null?void 0:se.toString())===G.toString()&&(this.removeRequestFromQueue(G),this.relayer.events.removeListener(Me.publish,Y),J())};this.relayer.events.on(Me.publish,Y);const T=cs(new Promise((G,se)=>{this.rpcPublish(x,d).then(G).catch(P=>{this.logger.warn(P,P==null?void 0:P.message),se(P)})}),this.initialPublishTimeout,`Failed initial custom payload publish, retrying.... method:${A} id:${w} tag:${y}`);try{await T,this.events.removeListener(Me.publish,Y)}catch(G){this.queue.set(w,{request:x,opts:d,attempt:1}),this.logger.warn(G,G==null?void 0:G.message)}});this.logger.trace({type:"method",method:"publish",params:{id:w,payload:l,opts:d}}),await cs(L,this.publishTimeout,H)}catch(L){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(L),(c=d==null?void 0:d.internal)!=null&&c.throwOnFailedPublish)throw L}finally{this.queue.delete(w)}}),xt(this,"on",(n,i)=>{this.events.on(n,i)}),xt(this,"once",(n,i)=>{this.events.once(n,i)}),xt(this,"off",(n,i)=>{this.events.off(n,i)}),xt(this,"removeListener",(n,i)=>{this.events.removeListener(n,i)}),this.relayer=e,this.logger=Tt(s,this.name),this.registerEventListeners()}get context(){return Ot(this.logger)}async rpcPublish(e,s){this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:e});const n=await this.relayer.request(e);return this.relayer.events.emit(Me.publish,Bn(Bn({},e),s)),this.logger.debug("Successfully Published Payload"),n}removeRequestFromQueue(e){this.queue.delete(e)}checkQueue(){this.queue.forEach(async(e,s)=>{var n;const i=e.attempt+1;this.queue.set(s,Bl(Bn({},e),{attempt:i})),this.logger.warn({},`Publisher: queue->publishing: ${e.request.id}, tag: ${(n=e.request.params)==null?void 0:n.tag}, attempt: ${i}`),await this.rpcPublish(e.request,e.opts),this.logger.warn({},`Publisher: queue->published: ${e.request.id}`)})}registerEventListeners(){this.relayer.core.heartbeat.on(oi.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(Me.connection_stalled);return}this.checkQueue()}),this.relayer.on(Me.message_ack,e=>{this.removeRequestFromQueue(e.id.toString())})}}var AC=Object.defineProperty,IC=(t,e,s)=>e in t?AC(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,Fn=(t,e,s)=>IC(t,typeof e!="symbol"?e+"":e,s);class NC{constructor(){Fn(this,"map",new Map),Fn(this,"set",(e,s)=>{const n=this.get(e);this.exists(e,s)||this.map.set(e,[...n,s])}),Fn(this,"get",e=>this.map.get(e)||[]),Fn(this,"exists",(e,s)=>this.get(e).includes(s)),Fn(this,"delete",(e,s)=>{if(typeof s>"u"){this.map.delete(e);return}if(!this.map.has(e))return;const n=this.get(e);if(!this.exists(e,s))return;const i=n.filter(r=>r!==s);if(!i.length){this.map.delete(e);return}this.map.set(e,i)}),Fn(this,"clear",()=>{this.map.clear()})}get topics(){return Array.from(this.map.keys())}}var _C=Object.defineProperty,SC=Object.defineProperties,TC=Object.getOwnPropertyDescriptors,Fl=Object.getOwnPropertySymbols,OC=Object.prototype.hasOwnProperty,kC=Object.prototype.propertyIsEnumerable,Ia=(t,e,s)=>e in t?_C(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,wi=(t,e)=>{for(var s in e||(e={}))OC.call(e,s)&&Ia(t,s,e[s]);if(Fl)for(var s of Fl(e))kC.call(e,s)&&Ia(t,s,e[s]);return t},xo=(t,e)=>SC(t,TC(e)),_e=(t,e,s)=>Ia(t,typeof e!="symbol"?e+"":e,s);class xC extends Ff{constructor(e,s){super(e,s),this.relayer=e,this.logger=s,_e(this,"subscriptions",new Map),_e(this,"topicMap",new NC),_e(this,"events",new Sn.EventEmitter),_e(this,"name",mb),_e(this,"version",yb),_e(this,"pending",new Map),_e(this,"cached",[]),_e(this,"initialized",!1),_e(this,"storagePrefix",ps),_e(this,"subscribeTimeout",F.toMiliseconds(F.ONE_MINUTE)),_e(this,"initialSubscribeTimeout",F.toMiliseconds(F.ONE_SECOND*15)),_e(this,"clientId"),_e(this,"batchSubscribeTopicsLimit",500),_e(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),await this.restore()),this.initialized=!0}),_e(this,"subscribe",async(n,i)=>{var r;this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:n,opts:i}});try{const o=jr(i),a={topic:n,relay:o,transportType:i==null?void 0:i.transportType};(r=i==null?void 0:i.internal)!=null&&r.skipSubscribe||this.pending.set(n,a);const c=await this.rpcSubscribe(n,o,i);return typeof c=="string"&&(this.onSubscribe(c,a),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:n,opts:i}})),c}catch(o){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(o),o}}),_e(this,"unsubscribe",async(n,i)=>{this.isInitialized(),typeof(i==null?void 0:i.id)<"u"?await this.unsubscribeById(n,i.id,i):await this.unsubscribeByTopic(n,i)}),_e(this,"isSubscribed",n=>new Promise(i=>{i(this.topicMap.topics.includes(n))})),_e(this,"isKnownTopic",n=>new Promise(i=>{i(this.topicMap.topics.includes(n)||this.pending.has(n)||this.cached.some(r=>r.topic===n))})),_e(this,"on",(n,i)=>{this.events.on(n,i)}),_e(this,"once",(n,i)=>{this.events.once(n,i)}),_e(this,"off",(n,i)=>{this.events.off(n,i)}),_e(this,"removeListener",(n,i)=>{this.events.removeListener(n,i)}),_e(this,"start",async()=>{await this.onConnect()}),_e(this,"stop",async()=>{await this.onDisconnect()}),_e(this,"restart",async()=>{await this.restore(),await this.onRestart()}),_e(this,"checkPending",async()=>{if(this.pending.size===0&&(!this.initialized||!this.relayer.connected))return;const n=[];this.pending.forEach(i=>{n.push(i)}),await this.batchSubscribe(n)}),_e(this,"registerEventListeners",()=>{this.relayer.core.heartbeat.on(oi.pulse,async()=>{await this.checkPending()}),this.events.on(vt.created,async n=>{const i=vt.created;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,data:n}),await this.persist()}),this.events.on(vt.deleted,async n=>{const i=vt.deleted;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,data:n}),await this.persist()})}),this.relayer=e,this.logger=Tt(s,this.name),this.clientId=""}get context(){return Ot(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}get hasAnyTopics(){return this.topicMap.topics.length>0||this.pending.size>0||this.cached.length>0||this.subscriptions.size>0}hasSubscription(e,s){let n=!1;try{n=this.getSubscription(e).topic===s}catch{}return n}reset(){this.cached=[],this.initialized=!0}onDisable(){this.values.length>0&&(this.cached=this.values),this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(e,s){const n=this.topicMap.get(e);await Promise.all(n.map(async i=>await this.unsubscribeById(e,i,s)))}async unsubscribeById(e,s,n){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:s,opts:n}});try{const i=jr(n);await this.restartToComplete({topic:e,id:s,relay:i}),await this.rpcUnsubscribe(e,s,i);const r=Re("USER_DISCONNECTED",`${this.name}, ${e}`);await this.onUnsubscribe(e,s,r),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:s,opts:n}})}catch(i){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(i),i}}async rpcSubscribe(e,s,n){var i,r;const o=await this.getSubscriptionId(e);if((i=n==null?void 0:n.internal)!=null&&i.skipSubscribe)return o;(!n||(n==null?void 0:n.transportType)===ke.relay)&&await this.restartToComplete({topic:e,id:e,relay:s});const a={method:Vn(s.protocol).subscribe,params:{topic:e}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:a});const c=(r=n==null?void 0:n.internal)==null?void 0:r.throwOnFailedPublish;try{if((n==null?void 0:n.transportType)===ke.link_mode)return setTimeout(()=>{(this.relayer.connected||this.relayer.connecting)&&this.relayer.request(a).catch(h=>this.logger.warn(h))},F.toMiliseconds(F.ONE_SECOND)),o;const l=new Promise(async h=>{const u=p=>{p.topic===e&&(this.events.removeListener(vt.created,u),h(p.id))};this.events.on(vt.created,u);try{const p=await cs(new Promise((m,y)=>{this.relayer.request(a).catch(g=>{this.logger.warn(g,g==null?void 0:g.message),y(g)}).then(m)}),this.initialSubscribeTimeout,`Subscribing to ${e} failed, please try again`);this.events.removeListener(vt.created,u),h(p)}catch{}}),d=await cs(l,this.subscribeTimeout,`Subscribing to ${e} failed, please try again`);if(!d&&c)throw new Error(`Subscribing to ${e} failed, please try again`);return d?o:null}catch(l){if(this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(Me.connection_stalled),c)throw l}return null}async rpcBatchSubscribe(e){if(!e.length)return;const s=e[0].relay,n={method:Vn(s.protocol).batchSubscribe,params:{topics:e.map(i=>i.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});try{await await cs(new Promise(i=>{this.relayer.request(n).catch(r=>this.logger.warn(r)).then(i)}),this.subscribeTimeout,"rpcBatchSubscribe failed, please try again")}catch{this.relayer.events.emit(Me.connection_stalled)}}async rpcBatchFetchMessages(e){if(!e.length)return;const s=e[0].relay,n={method:Vn(s.protocol).batchFetchMessages,params:{topics:e.map(r=>r.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});let i;try{i=await await cs(new Promise((r,o)=>{this.relayer.request(n).catch(a=>{this.logger.warn(a),o(a)}).then(r)}),this.subscribeTimeout,"rpcBatchFetchMessages failed, please try again")}catch{this.relayer.events.emit(Me.connection_stalled)}return i}rpcUnsubscribe(e,s,n){const i={method:Vn(n.protocol).unsubscribe,params:{topic:e,id:s}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i}),this.relayer.request(i)}onSubscribe(e,s){this.setSubscription(e,xo(wi({},s),{id:e})),this.pending.delete(s.topic)}onBatchSubscribe(e){e.length&&e.forEach(s=>{this.setSubscription(s.id,wi({},s)),this.pending.delete(s.topic)})}async onUnsubscribe(e,s,n){this.events.removeAllListeners(s),this.hasSubscription(s,e)&&this.deleteSubscription(s,n),await this.relayer.messages.del(e)}async setRelayerSubscriptions(e){await this.relayer.core.storage.setItem(this.storageKey,e)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(e,s){this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:s}),this.addSubscription(e,s)}addSubscription(e,s){this.subscriptions.set(e,wi({},s)),this.topicMap.set(s.topic,e),this.events.emit(vt.created,s)}getSubscription(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});const s=this.subscriptions.get(e);if(!s){const{message:n}=B("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(n)}return s}deleteSubscription(e,s){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:s});const n=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(n.topic,e),this.events.emit(vt.deleted,xo(wi({},n),{reason:s}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(vt.sync)}async onRestart(){if(this.cached.length){const e=[...this.cached],s=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let n=0;n<s;n++){const i=e.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(i)}}this.events.emit(vt.resubscribed)}async restore(){try{const e=await this.getRelayerSubscriptions();if(typeof e>"u"||!e.length)return;if(this.subscriptions.size&&!e.every(s=>{var n;return s.topic===((n=this.subscriptions.get(s.id))==null?void 0:n.topic)})){const{message:s}=B("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(s),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(s)}this.cached=e,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(e){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(e)}}async batchSubscribe(e){e.length&&(await this.rpcBatchSubscribe(e),this.onBatchSubscribe(await Promise.all(e.map(async s=>xo(wi({},s),{id:await this.getSubscriptionId(s.topic)})))))}async batchFetchMessages(e){if(!e.length)return;this.logger.trace(`Fetching batch messages for ${e.length} subscriptions`);const s=await this.rpcBatchFetchMessages(e);s&&s.messages&&(await tm(F.toMiliseconds(F.ONE_SECOND)),await this.relayer.handleBatchMessageEvents(s.messages))}async onConnect(){await this.restart(),this.reset()}onDisconnect(){this.onDisable()}isInitialized(){if(!this.initialized){const{message:e}=B("NOT_INITIALIZED",this.name);throw new Error(e)}}async restartToComplete(e){!this.relayer.connected&&!this.relayer.connecting&&(this.cached.push(e),await this.relayer.transportOpen())}async getClientId(){return this.clientId||(this.clientId=await this.relayer.core.crypto.getClientId()),this.clientId}async getSubscriptionId(e){return Dt(e+await this.getClientId())}}var PC=Object.defineProperty,Wl=Object.getOwnPropertySymbols,RC=Object.prototype.hasOwnProperty,UC=Object.prototype.propertyIsEnumerable,Na=(t,e,s)=>e in t?PC(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,jl=(t,e)=>{for(var s in e||(e={}))RC.call(e,s)&&Na(t,s,e[s]);if(Wl)for(var s of Wl(e))UC.call(e,s)&&Na(t,s,e[s]);return t},Ce=(t,e,s)=>Na(t,typeof e!="symbol"?e+"":e,s);class $C extends Mf{constructor(e){var s;super(e),Ce(this,"protocol","wc"),Ce(this,"version",2),Ce(this,"core"),Ce(this,"logger"),Ce(this,"events",new Sn.EventEmitter),Ce(this,"provider"),Ce(this,"messages"),Ce(this,"subscriber"),Ce(this,"publisher"),Ce(this,"name",hb),Ce(this,"transportExplicitlyClosed",!1),Ce(this,"initialized",!1),Ce(this,"connectionAttemptInProgress",!1),Ce(this,"relayUrl"),Ce(this,"projectId"),Ce(this,"packageName"),Ce(this,"bundleId"),Ce(this,"hasExperiencedNetworkDisruption",!1),Ce(this,"pingTimeout"),Ce(this,"heartBeatTimeout",F.toMiliseconds(F.THIRTY_SECONDS+F.FIVE_SECONDS)),Ce(this,"reconnectTimeout"),Ce(this,"connectPromise"),Ce(this,"reconnectInProgress",!1),Ce(this,"requestsInFlight",[]),Ce(this,"connectTimeout",F.toMiliseconds(F.ONE_SECOND*15)),Ce(this,"request",async n=>{var i,r;this.logger.debug("Publishing Request Payload");const o=n.id||fn().toString();await this.toEstablishConnection();try{this.logger.trace({id:o,method:n.method,topic:(i=n.params)==null?void 0:i.topic},"relayer.request - publishing...");const a=`${o}:${((r=n.params)==null?void 0:r.tag)||""}`;this.requestsInFlight.push(a);const c=await this.provider.request(n);return this.requestsInFlight=this.requestsInFlight.filter(l=>l!==a),c}catch(a){throw this.logger.debug(`Failed to Publish Request: ${o}`),a}}),Ce(this,"resetPingTimeout",()=>{Dr()&&(clearTimeout(this.pingTimeout),this.pingTimeout=setTimeout(()=>{var n,i,r,o;try{this.logger.debug({},"pingTimeout: Connection stalled, terminating..."),(o=(r=(i=(n=this.provider)==null?void 0:n.connection)==null?void 0:i.socket)==null?void 0:r.terminate)==null||o.call(r)}catch(a){this.logger.warn(a,a==null?void 0:a.message)}},this.heartBeatTimeout))}),Ce(this,"onPayloadHandler",n=>{this.onProviderPayload(n),this.resetPingTimeout()}),Ce(this,"onConnectHandler",()=>{this.logger.warn({},"Relayer connected ðŸ›œ"),this.startPingTimeout(),this.events.emit(Me.connect)}),Ce(this,"onDisconnectHandler",()=>{this.logger.warn({},"Relayer disconnected ðŸ›‘"),this.requestsInFlight=[],this.onProviderDisconnect()}),Ce(this,"onProviderErrorHandler",n=>{this.logger.fatal(`Fatal socket error: ${n.message}`),this.events.emit(Me.error,n),this.logger.fatal("Fatal socket error received, closing transport"),this.transportClose()}),Ce(this,"registerProviderListeners",()=>{this.provider.on(kt.payload,this.onPayloadHandler),this.provider.on(kt.connect,this.onConnectHandler),this.provider.on(kt.disconnect,this.onDisconnectHandler),this.provider.on(kt.error,this.onProviderErrorHandler)}),this.core=e.core,this.logger=rc({logger:(s=e.logger)!=null?s:db,name:this.name}),this.messages=new mC(this.logger,e.core),this.subscriber=new xC(this,this.logger),this.publisher=new vC(this,this.logger),this.projectId=e==null?void 0:e.projectId,this.relayUrl=(e==null?void 0:e.relayUrl)||bu,Bg()?this.packageName=Dc():Fg()&&(this.bundleId=Dc()),this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await Promise.all([this.messages.init(),this.subscriber.init()]),this.initialized=!0,this.transportOpen().catch(e=>this.logger.warn(e,e==null?void 0:e.message))}get context(){return Ot(this.logger)}get connected(){var e,s,n;return((n=(s=(e=this.provider)==null?void 0:e.connection)==null?void 0:s.socket)==null?void 0:n.readyState)===1||!1}get connecting(){var e,s,n;return((n=(s=(e=this.provider)==null?void 0:e.connection)==null?void 0:s.socket)==null?void 0:n.readyState)===0||this.connectPromise!==void 0||!1}async publish(e,s,n){this.isInitialized(),await this.publisher.publish(e,s,n),await this.recordMessageEvent({topic:e,message:s,publishedAt:Date.now(),transportType:ke.relay},Nr.outbound)}async publishCustom(e){this.isInitialized(),await this.publisher.publishCustom(e)}async subscribe(e,s){var n,i,r;this.isInitialized(),(!(s!=null&&s.transportType)||(s==null?void 0:s.transportType)==="relay")&&await this.toEstablishConnection();const o=typeof((n=s==null?void 0:s.internal)==null?void 0:n.throwOnFailedPublish)>"u"?!0:(i=s==null?void 0:s.internal)==null?void 0:i.throwOnFailedPublish;let a=((r=this.subscriber.topicMap.get(e))==null?void 0:r[0])||"",c;const l=d=>{d.topic===e&&(this.subscriber.off(vt.created,l),c())};return await Promise.all([new Promise(d=>{c=d,this.subscriber.on(vt.created,l)}),new Promise(async(d,h)=>{a=await this.subscriber.subscribe(e,jl({internal:{throwOnFailedPublish:o}},s)).catch(u=>{o&&h(u)})||a,d()})]),a}async unsubscribe(e,s){this.isInitialized(),await this.subscriber.unsubscribe(e,s)}on(e,s){this.events.on(e,s)}once(e,s){this.events.once(e,s)}off(e,s){this.events.off(e,s)}removeListener(e,s){this.events.removeListener(e,s)}async transportDisconnect(){this.provider.disconnect&&(this.hasExperiencedNetworkDisruption||this.connected)?await cs(this.provider.disconnect(),2e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.onProviderDisconnect()}async transportClose(){this.transportExplicitlyClosed=!0,await this.transportDisconnect()}async transportOpen(e){if(!this.subscriber.hasAnyTopics){this.logger.info("Starting WS connection skipped because the client has no topics to work with.");return}if(this.connectPromise?(this.logger.debug({},"Waiting for existing connection attempt to resolve..."),await this.connectPromise,this.logger.debug({},"Existing connection attempt resolved")):(this.connectPromise=new Promise(async(s,n)=>{await this.connect(e).then(s).catch(n).finally(()=>{this.connectPromise=void 0})}),await this.connectPromise),!this.connected)throw new Error(`Couldn't establish socket connection to the relay server: ${this.relayUrl}`)}async restartTransport(e){this.logger.debug({},"Restarting transport..."),!this.connectionAttemptInProgress&&(this.relayUrl=e||this.relayUrl,await this.confirmOnlineStateOrThrow(),await this.transportClose(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await Tl())throw new Error("No internet connection detected. Please restart your network and try again.")}async handleBatchMessageEvents(e){if((e==null?void 0:e.length)===0){this.logger.trace("Batch message events is empty. Ignoring...");return}const s=e.sort((n,i)=>n.publishedAt-i.publishedAt);this.logger.debug(`Batch of ${s.length} message events sorted`);for(const n of s)try{await this.onMessageEvent(n)}catch(i){this.logger.warn(i,"Error while processing batch message event: "+(i==null?void 0:i.message))}this.logger.trace(`Batch of ${s.length} message events processed`)}async onLinkMessageEvent(e,s){const{topic:n}=e;if(!s.sessionExists){const i=Le(F.FIVE_MINUTES),r={topic:n,expiry:i,relay:{protocol:"irn"},active:!1};await this.core.pairing.pairings.set(n,r)}this.events.emit(Me.message,e),await this.recordMessageEvent(e,Nr.inbound)}async connect(e){await this.confirmOnlineStateOrThrow(),e&&e!==this.relayUrl&&(this.relayUrl=e,await this.transportDisconnect()),this.connectionAttemptInProgress=!0,this.transportExplicitlyClosed=!1;let s=1;for(;s<6;){try{if(this.transportExplicitlyClosed)break;this.logger.debug({},`Connecting to ${this.relayUrl}, attempt: ${s}...`),await this.createProvider(),await new Promise(async(n,i)=>{const r=()=>{i(new Error("Connection interrupted while trying to connect"))};this.provider.once(kt.disconnect,r),await cs(new Promise((o,a)=>{this.provider.connect().then(o).catch(a)}),this.connectTimeout,`Socket stalled when trying to connect to ${this.relayUrl}`).catch(o=>{i(o)}).finally(()=>{this.provider.off(kt.disconnect,r),clearTimeout(this.reconnectTimeout)}),await new Promise(async(o,a)=>{const c=()=>{i(new Error("Connection interrupted while trying to subscribe"))};this.provider.once(kt.disconnect,c),await this.subscriber.start().then(o).catch(a).finally(()=>{this.provider.off(kt.disconnect,c)})}),this.hasExperiencedNetworkDisruption=!1,n()})}catch(n){await this.subscriber.stop();const i=n;this.logger.warn({},i.message),this.hasExperiencedNetworkDisruption=!0}finally{this.connectionAttemptInProgress=!1}if(this.connected){this.logger.debug({},`Connected to ${this.relayUrl} successfully on attempt: ${s}`);break}await new Promise(n=>setTimeout(n,F.toMiliseconds(s*1))),s++}}startPingTimeout(){var e,s,n,i,r;if(Dr())try{(s=(e=this.provider)==null?void 0:e.connection)!=null&&s.socket&&((r=(i=(n=this.provider)==null?void 0:n.connection)==null?void 0:i.socket)==null||r.on("ping",()=>{this.resetPingTimeout()})),this.resetPingTimeout()}catch(o){this.logger.warn(o,o==null?void 0:o.message)}}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const e=await this.core.crypto.signJWT(this.relayUrl);this.provider=new Ba(new bp(Kg({sdkVersion:ba,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:e,useOnCloseEvent:!0,bundleId:this.bundleId,packageName:this.packageName}))),this.registerProviderListeners()}async recordMessageEvent(e,s){const{topic:n,message:i}=e;await this.messages.set(n,i,s)}async shouldIgnoreMessageEvent(e){const{topic:s,message:n}=e;if(!n||n.length===0)return this.logger.warn(`Ignoring invalid/empty message: ${n}`),!0;if(!await this.subscriber.isKnownTopic(s))return this.logger.warn(`Ignoring message for unknown topic ${s}`),!0;const i=this.messages.has(s,n);return i&&this.logger.warn(`Ignoring duplicate message: ${n}`),i}async onProviderPayload(e){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:e}),Fa(e)){if(!e.method.endsWith(ub))return;const s=e.params,{topic:n,message:i,publishedAt:r,attestation:o}=s.data,a={topic:n,message:i,publishedAt:r,transportType:ke.relay,attestation:o};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(jl({type:"event",event:s.id},a)),this.events.emit(s.id,a),await this.acknowledgePayload(e),await this.onMessageEvent(a)}else Wa(e)&&this.events.emit(Me.message_ack,e)}async onMessageEvent(e){await this.shouldIgnoreMessageEvent(e)||(await this.recordMessageEvent(e,Nr.inbound),this.events.emit(Me.message,e))}async acknowledgePayload(e){const s=$i(e.id,!0);await this.provider.connection.send(s)}unregisterProviderListeners(){this.provider.off(kt.payload,this.onPayloadHandler),this.provider.off(kt.connect,this.onConnectHandler),this.provider.off(kt.disconnect,this.onDisconnectHandler),this.provider.off(kt.error,this.onProviderErrorHandler),clearTimeout(this.pingTimeout)}async registerEventListeners(){let e=await Tl();W0(async s=>{e!==s&&(e=s,s?await this.transportOpen().catch(n=>this.logger.error(n,n==null?void 0:n.message)):(this.hasExperiencedNetworkDisruption=!0,await this.transportDisconnect(),this.transportExplicitlyClosed=!1))}),this.core.heartbeat.on(oi.pulse,async()=>{if(!this.transportExplicitlyClosed&&!this.connected&&H0())try{await this.confirmOnlineStateOrThrow(),await this.transportOpen()}catch(s){this.logger.warn(s,s==null?void 0:s.message)}})}async onProviderDisconnect(){clearTimeout(this.pingTimeout),this.events.emit(Me.disconnect),this.connectionAttemptInProgress=!1,!this.reconnectInProgress&&(this.reconnectInProgress=!0,await this.subscriber.stop(),this.subscriber.hasAnyTopics&&(this.transportExplicitlyClosed||(this.reconnectTimeout=setTimeout(async()=>{await this.transportOpen().catch(e=>this.logger.error(e,e==null?void 0:e.message)),this.reconnectTimeout=void 0,this.reconnectInProgress=!1},F.toMiliseconds(pb)))))}isInitialized(){if(!this.initialized){const{message:e}=B("NOT_INITIALIZED",this.name);throw new Error(e)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectPromise){await this.connectPromise;return}await this.connect()}}}function DC(t,e){return t===e||Number.isNaN(t)&&Number.isNaN(e)}function ql(t){return Object.getOwnPropertySymbols(t).filter(e=>Object.prototype.propertyIsEnumerable.call(t,e))}function Hl(t){return t==null?t===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(t)}const LC="[object RegExp]",MC="[object String]",BC="[object Number]",FC="[object Boolean]",Kl="[object Arguments]",WC="[object Symbol]",jC="[object Date]",qC="[object Map]",HC="[object Set]",KC="[object Array]",VC="[object Function]",zC="[object ArrayBuffer]",Po="[object Object]",GC="[object Error]",YC="[object DataView]",JC="[object Uint8Array]",XC="[object Uint8ClampedArray]",ZC="[object Uint16Array]",QC="[object Uint32Array]",ev="[object BigUint64Array]",tv="[object Int8Array]",sv="[object Int16Array]",nv="[object Int32Array]",iv="[object BigInt64Array]",rv="[object Float32Array]",ov="[object Float64Array]";function av(){}function Vl(t){if(!t||typeof t!="object")return!1;const e=Object.getPrototypeOf(t);return e===null||e===Object.prototype||Object.getPrototypeOf(e)===null?Object.prototype.toString.call(t)==="[object Object]":!1}function cv(t,e,s){return Ni(t,e,void 0,void 0,void 0,void 0,s)}function Ni(t,e,s,n,i,r,o){const a=o(t,e,s,n,i,r);if(a!==void 0)return a;if(typeof t==typeof e)switch(typeof t){case"bigint":case"string":case"boolean":case"symbol":case"undefined":return t===e;case"number":return t===e||Object.is(t,e);case"function":return t===e;case"object":return xi(t,e,r,o)}return xi(t,e,r,o)}function xi(t,e,s,n){if(Object.is(t,e))return!0;let i=Hl(t),r=Hl(e);if(i===Kl&&(i=Po),r===Kl&&(r=Po),i!==r)return!1;switch(i){case MC:return t.toString()===e.toString();case BC:{const c=t.valueOf(),l=e.valueOf();return DC(c,l)}case FC:case jC:case WC:return Object.is(t.valueOf(),e.valueOf());case LC:return t.source===e.source&&t.flags===e.flags;case VC:return t===e}s=s!=null?s:new Map;const o=s.get(t),a=s.get(e);if(o!=null&&a!=null)return o===e;s.set(t,e),s.set(e,t);try{switch(i){case qC:{if(t.size!==e.size)return!1;for(const[c,l]of t.entries())if(!e.has(c)||!Ni(l,e.get(c),c,t,e,s,n))return!1;return!0}case HC:{if(t.size!==e.size)return!1;const c=Array.from(t.values()),l=Array.from(e.values());for(let d=0;d<c.length;d++){const h=c[d],u=l.findIndex(p=>Ni(h,p,void 0,t,e,s,n));if(u===-1)return!1;l.splice(u,1)}return!0}case KC:case JC:case XC:case ZC:case QC:case ev:case tv:case sv:case nv:case iv:case rv:case ov:{if(typeof Buffer<"u"&&Buffer.isBuffer(t)!==Buffer.isBuffer(e)||t.length!==e.length)return!1;for(let c=0;c<t.length;c++)if(!Ni(t[c],e[c],c,t,e,s,n))return!1;return!0}case zC:return t.byteLength!==e.byteLength?!1:xi(new Uint8Array(t),new Uint8Array(e),s,n);case YC:return t.byteLength!==e.byteLength||t.byteOffset!==e.byteOffset?!1:xi(new Uint8Array(t),new Uint8Array(e),s,n);case GC:return t.name===e.name&&t.message===e.message;case Po:{if(!(xi(t.constructor,e.constructor,s,n)||Vl(t)&&Vl(e)))return!1;const c=[...Object.keys(t),...ql(t)],l=[...Object.keys(e),...ql(e)];if(c.length!==l.length)return!1;for(let d=0;d<c.length;d++){const h=c[d],u=t[h];if(!Object.hasOwn(e,h))return!1;const p=e[h];if(!Ni(u,p,h,t,e,s,n))return!1}return!0}default:return!1}}finally{s.delete(t),s.delete(e)}}function lv(t,e){return cv(t,e,av)}var dv=Object.defineProperty,zl=Object.getOwnPropertySymbols,hv=Object.prototype.hasOwnProperty,uv=Object.prototype.propertyIsEnumerable,_a=(t,e,s)=>e in t?dv(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,Gl=(t,e)=>{for(var s in e||(e={}))hv.call(e,s)&&_a(t,s,e[s]);if(zl)for(var s of zl(e))uv.call(e,s)&&_a(t,s,e[s]);return t},ut=(t,e,s)=>_a(t,typeof e!="symbol"?e+"":e,s);class Pn extends Bf{constructor(e,s,n,i=ps,r=void 0){super(e,s,n,i),this.core=e,this.logger=s,this.name=n,ut(this,"map",new Map),ut(this,"version",fb),ut(this,"cached",[]),ut(this,"initialized",!1),ut(this,"getKey"),ut(this,"storagePrefix",ps),ut(this,"recentlyDeleted",[]),ut(this,"recentlyDeletedLimit",200),ut(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(o=>{this.getKey&&o!==null&&!He(o)?this.map.set(this.getKey(o),o):w0(o)?this.map.set(o.id,o):b0(o)&&this.map.set(o.topic,o)}),this.cached=[],this.initialized=!0)}),ut(this,"set",async(o,a)=>{this.isInitialized(),this.map.has(o)?await this.update(o,a):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:o,value:a}),this.map.set(o,a),await this.persist())}),ut(this,"get",o=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:o}),this.getData(o))),ut(this,"getAll",o=>(this.isInitialized(),o?this.values.filter(a=>Object.keys(o).every(c=>lv(a[c],o[c]))):this.values)),ut(this,"update",async(o,a)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:o,update:a});const c=Gl(Gl({},this.getData(o)),a);this.map.set(o,c),await this.persist()}),ut(this,"delete",async(o,a)=>{this.isInitialized(),this.map.has(o)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:o,reason:a}),this.map.delete(o),this.addToRecentlyDeleted(o),await this.persist())}),this.logger=Tt(s,this.name),this.storagePrefix=i,this.getKey=r}get context(){return Ot(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}addToRecentlyDeleted(e){this.recentlyDeleted.push(e),this.recentlyDeleted.length>=this.recentlyDeletedLimit&&this.recentlyDeleted.splice(0,this.recentlyDeletedLimit/2)}async setDataStore(e){await this.core.storage.setItem(this.storageKey,e)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(e){const s=this.map.get(e);if(!s){if(this.recentlyDeleted.includes(e)){const{message:i}=B("MISSING_OR_INVALID",`Record was recently deleted - ${this.name}: ${e}`);throw this.logger.error(i),new Error(i)}const{message:n}=B("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(n),new Error(n)}return s}async persist(){await this.setDataStore(this.values)}async restore(){try{const e=await this.getDataStore();if(typeof e>"u"||!e.length)return;if(this.map.size){const{message:s}=B("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(s),new Error(s)}this.cached=e,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(e){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(e)}}isInitialized(){if(!this.initialized){const{message:e}=B("NOT_INITIALIZED",this.name);throw new Error(e)}}}var pv=Object.defineProperty,fv=(t,e,s)=>e in t?pv(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,ge=(t,e,s)=>fv(t,typeof e!="symbol"?e+"":e,s);class gv{constructor(e,s){this.core=e,this.logger=s,ge(this,"name",wb),ge(this,"version",bb),ge(this,"events",new ja),ge(this,"pairings"),ge(this,"initialized",!1),ge(this,"storagePrefix",ps),ge(this,"ignoredPayloadTypes",[Ss]),ge(this,"registeredMethods",[]),ge(this,"init",async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))}),ge(this,"register",({methods:n})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...n])]}),ge(this,"create",async n=>{this.isInitialized();const i=ma(),r=await this.core.crypto.setSymKey(i),o=Le(F.FIVE_MINUTES),a={protocol:wu},c={topic:r,expiry:o,relay:a,active:!1,methods:n==null?void 0:n.methods},l=bl({protocol:this.core.protocol,version:this.core.version,topic:r,symKey:i,relay:a,expiryTimestamp:o,methods:n==null?void 0:n.methods});return this.events.emit(hn.create,c),this.core.expirer.set(r,o),await this.pairings.set(r,c),await this.core.relayer.subscribe(r,{transportType:n==null?void 0:n.transportType,internal:n==null?void 0:n.internal}),{topic:r,uri:l}}),ge(this,"pair",async n=>{this.isInitialized();const i=this.core.eventClient.createEvent({properties:{topic:n==null?void 0:n.uri,trace:[ns.pairing_started]}});this.isValidPair(n,i);const{topic:r,symKey:o,relay:a,expiryTimestamp:c,methods:l}=wl(n.uri);i.props.properties.topic=r,i.addTrace(ns.pairing_uri_validation_success),i.addTrace(ns.pairing_uri_not_expired);let d;if(this.pairings.keys.includes(r)){if(d=this.pairings.get(r),i.addTrace(ns.existing_pairing),d.active)throw i.setError(ws.active_pairing_already_exists),new Error(`Pairing already exists: ${r}. Please try again with a new connection URI.`);i.addTrace(ns.pairing_not_expired)}const h=c||Le(F.FIVE_MINUTES),u={topic:r,relay:a,expiry:h,active:!1,methods:l};this.core.expirer.set(r,h),await this.pairings.set(r,u),i.addTrace(ns.store_new_pairing),n.activatePairing&&await this.activate({topic:r}),this.events.emit(hn.create,u),i.addTrace(ns.emit_inactive_pairing),this.core.crypto.keychain.has(r)||await this.core.crypto.setSymKey(o,r),i.addTrace(ns.subscribing_pairing_topic);try{await this.core.relayer.confirmOnlineStateOrThrow()}catch{i.setError(ws.no_internet_connection)}try{await this.core.relayer.subscribe(r,{relay:a})}catch(p){throw i.setError(ws.subscribe_pairing_topic_failure),p}return i.addTrace(ns.subscribe_pairing_topic_success),u}),ge(this,"activate",async({topic:n})=>{this.isInitialized();const i=Le(F.FIVE_MINUTES);this.core.expirer.set(n,i),await this.pairings.update(n,{active:!0,expiry:i})}),ge(this,"ping",async n=>{this.isInitialized(),await this.isValidPing(n),this.logger.warn("ping() is deprecated and will be removed in the next major release.");const{topic:i}=n;if(this.pairings.keys.includes(i)){const r=await this.sendRequest(i,"wc_pairingPing",{}),{done:o,resolve:a,reject:c}=dn();this.events.once(Ie("pairing_ping",r),({error:l})=>{l?c(l):a()}),await o()}}),ge(this,"updateExpiry",async({topic:n,expiry:i})=>{this.isInitialized(),await this.pairings.update(n,{expiry:i})}),ge(this,"updateMetadata",async({topic:n,metadata:i})=>{this.isInitialized(),await this.pairings.update(n,{peerMetadata:i})}),ge(this,"getPairings",()=>(this.isInitialized(),this.pairings.values)),ge(this,"disconnect",async n=>{this.isInitialized(),await this.isValidDisconnect(n);const{topic:i}=n;this.pairings.keys.includes(i)&&(await this.sendRequest(i,"wc_pairingDelete",Re("USER_DISCONNECTED")),await this.deletePairing(i))}),ge(this,"formatUriFromPairing",n=>{this.isInitialized();const{topic:i,relay:r,expiry:o,methods:a}=n,c=this.core.crypto.keychain.get(i);return bl({protocol:this.core.protocol,version:this.core.version,topic:i,symKey:c,relay:r,expiryTimestamp:o,methods:a})}),ge(this,"sendRequest",async(n,i,r)=>{const o=rs(i,r),a=await this.core.crypto.encode(n,o),c=mi[i].req;return this.core.history.set(n,o),this.core.relayer.publish(n,a,c),o.id}),ge(this,"sendResult",async(n,i,r)=>{const o=$i(n,r),a=await this.core.crypto.encode(i,o),c=(await this.core.history.get(i,n)).request.method,l=mi[c].res;await this.core.relayer.publish(i,a,l),await this.core.history.resolve(o)}),ge(this,"sendError",async(n,i,r)=>{const o=Hd(n,r),a=await this.core.crypto.encode(i,o),c=(await this.core.history.get(i,n)).request.method,l=mi[c]?mi[c].res:mi.unregistered_method.res;await this.core.relayer.publish(i,a,l),await this.core.history.resolve(o)}),ge(this,"deletePairing",async(n,i)=>{await this.core.relayer.unsubscribe(n),await Promise.all([this.pairings.delete(n,Re("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(n),i?Promise.resolve():this.core.expirer.del(n)])}),ge(this,"cleanup",async()=>{const n=this.pairings.getAll().filter(i=>os(i.expiry));await Promise.all(n.map(i=>this.deletePairing(i.topic)))}),ge(this,"onRelayEventRequest",async n=>{const{topic:i,payload:r}=n;switch(r.method){case"wc_pairingPing":return await this.onPairingPingRequest(i,r);case"wc_pairingDelete":return await this.onPairingDeleteRequest(i,r);default:return await this.onUnknownRpcMethodRequest(i,r)}}),ge(this,"onRelayEventResponse",async n=>{const{topic:i,payload:r}=n,o=(await this.core.history.get(i,r.id)).request.method;return o==="wc_pairingPing"?this.onPairingPingResponse(i,r):this.onUnknownRpcMethodResponse(o)}),ge(this,"onPairingPingRequest",async(n,i)=>{const{id:r}=i;try{this.isValidPing({topic:n}),await this.sendResult(r,n,!0),this.events.emit(hn.ping,{id:r,topic:n})}catch(o){await this.sendError(r,n,o),this.logger.error(o)}}),ge(this,"onPairingPingResponse",(n,i)=>{const{id:r}=i;setTimeout(()=>{ms(i)?this.events.emit(Ie("pairing_ping",r),{}):is(i)&&this.events.emit(Ie("pairing_ping",r),{error:i.error})},500)}),ge(this,"onPairingDeleteRequest",async(n,i)=>{const{id:r}=i;try{this.isValidDisconnect({topic:n}),await this.deletePairing(n),this.events.emit(hn.delete,{id:r,topic:n})}catch(o){await this.sendError(r,n,o),this.logger.error(o)}}),ge(this,"onUnknownRpcMethodRequest",async(n,i)=>{const{id:r,method:o}=i;try{if(this.registeredMethods.includes(o))return;const a=Re("WC_METHOD_UNSUPPORTED",o);await this.sendError(r,n,a),this.logger.error(a)}catch(a){await this.sendError(r,n,a),this.logger.error(a)}}),ge(this,"onUnknownRpcMethodResponse",n=>{this.registeredMethods.includes(n)||this.logger.error(Re("WC_METHOD_UNSUPPORTED",n))}),ge(this,"isValidPair",(n,i)=>{var r;if(!pt(n)){const{message:a}=B("MISSING_OR_INVALID",`pair() params: ${n}`);throw i.setError(ws.malformed_pairing_uri),new Error(a)}if(!y0(n.uri)){const{message:a}=B("MISSING_OR_INVALID",`pair() uri: ${n.uri}`);throw i.setError(ws.malformed_pairing_uri),new Error(a)}const o=wl(n==null?void 0:n.uri);if(!((r=o==null?void 0:o.relay)!=null&&r.protocol)){const{message:a}=B("MISSING_OR_INVALID","pair() uri#relay-protocol");throw i.setError(ws.malformed_pairing_uri),new Error(a)}if(!(o!=null&&o.symKey)){const{message:a}=B("MISSING_OR_INVALID","pair() uri#symKey");throw i.setError(ws.malformed_pairing_uri),new Error(a)}if(o!=null&&o.expiryTimestamp&&F.toMiliseconds(o==null?void 0:o.expiryTimestamp)<Date.now()){i.setError(ws.pairing_expired);const{message:a}=B("EXPIRED","pair() URI has expired. Please try again with a new connection URI.");throw new Error(a)}}),ge(this,"isValidPing",async n=>{if(!pt(n)){const{message:r}=B("MISSING_OR_INVALID",`ping() params: ${n}`);throw new Error(r)}const{topic:i}=n;await this.isValidPairingTopic(i)}),ge(this,"isValidDisconnect",async n=>{if(!pt(n)){const{message:r}=B("MISSING_OR_INVALID",`disconnect() params: ${n}`);throw new Error(r)}const{topic:i}=n;await this.isValidPairingTopic(i)}),ge(this,"isValidPairingTopic",async n=>{if(!Be(n,!1)){const{message:i}=B("MISSING_OR_INVALID",`pairing topic should be a string: ${n}`);throw new Error(i)}if(!this.pairings.keys.includes(n)){const{message:i}=B("NO_MATCHING_KEY",`pairing topic doesn't exist: ${n}`);throw new Error(i)}if(os(this.pairings.get(n).expiry)){await this.deletePairing(n);const{message:i}=B("EXPIRED",`pairing topic: ${n}`);throw new Error(i)}}),this.core=e,this.logger=Tt(s,this.name),this.pairings=new Pn(this.core,this.logger,this.name,this.storagePrefix)}get context(){return Ot(this.logger)}isInitialized(){if(!this.initialized){const{message:e}=B("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.core.relayer.on(Me.message,async e=>{const{topic:s,message:n,transportType:i}=e;if(this.pairings.keys.includes(s)&&i!==ke.link_mode&&!this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(n)))try{const r=await this.core.crypto.decode(s,n);Fa(r)?(this.core.history.set(s,r),await this.onRelayEventRequest({topic:s,payload:r})):Wa(r)&&(await this.core.history.resolve(r),await this.onRelayEventResponse({topic:s,payload:r}),this.core.history.delete(s,r.id)),await this.core.relayer.messages.ack(s,n)}catch(r){this.logger.error(r)}})}registerExpirerEvents(){this.core.expirer.on($t.expired,async e=>{const{topic:s}=fh(e.target);s&&this.pairings.keys.includes(s)&&(await this.deletePairing(s,!0),this.events.emit(hn.expire,{topic:s}))})}}var mv=Object.defineProperty,yv=(t,e,s)=>e in t?mv(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,ze=(t,e,s)=>yv(t,typeof e!="symbol"?e+"":e,s);class wv extends $f{constructor(e,s){super(e,s),this.core=e,this.logger=s,ze(this,"records",new Map),ze(this,"events",new Sn.EventEmitter),ze(this,"name",Eb),ze(this,"version",Cb),ze(this,"cached",[]),ze(this,"initialized",!1),ze(this,"storagePrefix",ps),ze(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(n=>this.records.set(n.id,n)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),ze(this,"set",(n,i,r)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:n,request:i,chainId:r}),this.records.has(i.id))return;const o={id:i.id,topic:n,request:{method:i.method,params:i.params||null},chainId:r,expiry:Le(F.THIRTY_DAYS)};this.records.set(o.id,o),this.persist(),this.events.emit(qt.created,o)}),ze(this,"resolve",async n=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:n}),!this.records.has(n.id))return;const i=await this.getRecord(n.id);typeof i.response>"u"&&(i.response=is(n)?{error:n.error}:{result:n.result},this.records.set(i.id,i),this.persist(),this.events.emit(qt.updated,i))}),ze(this,"get",async(n,i)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:n,id:i}),await this.getRecord(i))),ze(this,"delete",(n,i)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:i}),this.values.forEach(r=>{if(r.topic===n){if(typeof i<"u"&&r.id!==i)return;this.records.delete(r.id),this.events.emit(qt.deleted,r)}}),this.persist()}),ze(this,"exists",async(n,i)=>(this.isInitialized(),this.records.has(i)?(await this.getRecord(i)).topic===n:!1)),ze(this,"on",(n,i)=>{this.events.on(n,i)}),ze(this,"once",(n,i)=>{this.events.once(n,i)}),ze(this,"off",(n,i)=>{this.events.off(n,i)}),ze(this,"removeListener",(n,i)=>{this.events.removeListener(n,i)}),this.logger=Tt(s,this.name)}get context(){return Ot(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const e=[];return this.values.forEach(s=>{if(typeof s.response<"u")return;const n={topic:s.topic,request:rs(s.request.method,s.request.params,s.id),chainId:s.chainId};return e.push(n)}),e}async setJsonRpcRecords(e){await this.core.storage.setItem(this.storageKey,e)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(e){this.isInitialized();const s=this.records.get(e);if(!s){const{message:n}=B("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(n)}return s}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(qt.sync)}async restore(){try{const e=await this.getJsonRpcRecords();if(typeof e>"u"||!e.length)return;if(this.records.size){const{message:s}=B("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(s),new Error(s)}this.cached=e,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}}registerEventListeners(){this.events.on(qt.created,e=>{const s=qt.created;this.logger.info(`Emitting ${s}`),this.logger.debug({type:"event",event:s,record:e})}),this.events.on(qt.updated,e=>{const s=qt.updated;this.logger.info(`Emitting ${s}`),this.logger.debug({type:"event",event:s,record:e})}),this.events.on(qt.deleted,e=>{const s=qt.deleted;this.logger.info(`Emitting ${s}`),this.logger.debug({type:"event",event:s,record:e})}),this.core.heartbeat.on(oi.pulse,()=>{this.cleanup()})}cleanup(){try{this.isInitialized();let e=!1;this.records.forEach(s=>{F.toMiliseconds(s.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${s.id}`),this.records.delete(s.id),this.events.emit(qt.deleted,s,!1),e=!0)}),e&&this.persist()}catch(e){this.logger.warn(e)}}isInitialized(){if(!this.initialized){const{message:e}=B("NOT_INITIALIZED",this.name);throw new Error(e)}}}var bv=Object.defineProperty,Ev=(t,e,s)=>e in t?bv(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,nt=(t,e,s)=>Ev(t,typeof e!="symbol"?e+"":e,s);class Cv extends Wf{constructor(e,s){super(e,s),this.core=e,this.logger=s,nt(this,"expirations",new Map),nt(this,"events",new Sn.EventEmitter),nt(this,"name",vb),nt(this,"version",Ab),nt(this,"cached",[]),nt(this,"initialized",!1),nt(this,"storagePrefix",ps),nt(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(n=>this.expirations.set(n.target,n)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),nt(this,"has",n=>{try{const i=this.formatTarget(n);return typeof this.getExpiration(i)<"u"}catch{return!1}}),nt(this,"set",(n,i)=>{this.isInitialized();const r=this.formatTarget(n),o={target:r,expiry:i};this.expirations.set(r,o),this.checkExpiry(r,o),this.events.emit($t.created,{target:r,expiration:o})}),nt(this,"get",n=>{this.isInitialized();const i=this.formatTarget(n);return this.getExpiration(i)}),nt(this,"del",n=>{if(this.isInitialized(),this.has(n)){const i=this.formatTarget(n),r=this.getExpiration(i);this.expirations.delete(i),this.events.emit($t.deleted,{target:i,expiration:r})}}),nt(this,"on",(n,i)=>{this.events.on(n,i)}),nt(this,"once",(n,i)=>{this.events.once(n,i)}),nt(this,"off",(n,i)=>{this.events.off(n,i)}),nt(this,"removeListener",(n,i)=>{this.events.removeListener(n,i)}),this.logger=Tt(s,this.name)}get context(){return Ot(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if(typeof e=="string")return Vg(e);if(typeof e=="number")return zg(e);const{message:s}=B("UNKNOWN_TYPE",`Target type: ${typeof e}`);throw new Error(s)}async setExpirations(e){await this.core.storage.setItem(this.storageKey,e)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit($t.sync)}async restore(){try{const e=await this.getExpirations();if(typeof e>"u"||!e.length)return;if(this.expirations.size){const{message:s}=B("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(s),new Error(s)}this.cached=e,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(e){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(e)}}getExpiration(e){const s=this.expirations.get(e);if(!s){const{message:n}=B("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.warn(n),new Error(n)}return s}checkExpiry(e,s){const{expiry:n}=s;F.toMiliseconds(n)-Date.now()<=0&&this.expire(e,s)}expire(e,s){this.expirations.delete(e),this.events.emit($t.expired,{target:e,expiration:s})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((e,s)=>this.checkExpiry(s,e))}registerEventListeners(){this.core.heartbeat.on(oi.pulse,()=>this.checkExpirations()),this.events.on($t.created,e=>{const s=$t.created;this.logger.info(`Emitting ${s}`),this.logger.debug({type:"event",event:s,data:e}),this.persist()}),this.events.on($t.expired,e=>{const s=$t.expired;this.logger.info(`Emitting ${s}`),this.logger.debug({type:"event",event:s,data:e}),this.persist()}),this.events.on($t.deleted,e=>{const s=$t.deleted;this.logger.info(`Emitting ${s}`),this.logger.debug({type:"event",event:s,data:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=B("NOT_INITIALIZED",this.name);throw new Error(e)}}}var vv=Object.defineProperty,Av=(t,e,s)=>e in t?vv(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,De=(t,e,s)=>Av(t,typeof e!="symbol"?e+"":e,s);class Iv extends jf{constructor(e,s,n){super(e,s,n),this.core=e,this.logger=s,this.store=n,De(this,"name",Ib),De(this,"abortController"),De(this,"isDevEnv"),De(this,"verifyUrlV3",_b),De(this,"storagePrefix",ps),De(this,"version",yu),De(this,"publicKey"),De(this,"fetchPromise"),De(this,"init",async()=>{var i;this.isDevEnv||(this.publicKey=await this.store.getItem(this.storeKey),this.publicKey&&F.toMiliseconds((i=this.publicKey)==null?void 0:i.expiresAt)<Date.now()&&(this.logger.debug("verify v2 public key expired"),await this.removePublicKey()))}),De(this,"register",async i=>{if(!ai()||this.isDevEnv)return;const r=window.location.origin,{id:o,decryptedId:a}=i,c=`${this.verifyUrlV3}/attestation?projectId=${this.core.projectId}&origin=${r}&id=${o}&decryptedId=${a}`;try{const l=Os.getDocument(),d=this.startAbortTimer(F.ONE_SECOND*5),h=await new Promise((u,p)=>{const m=()=>{window.removeEventListener("message",g),l.body.removeChild(y),p("attestation aborted")};this.abortController.signal.addEventListener("abort",m);const y=l.createElement("iframe");y.src=c,y.style.display="none",y.addEventListener("error",m,{signal:this.abortController.signal});const g=w=>{if(w.data&&typeof w.data=="string")try{const b=JSON.parse(w.data);if(b.type==="verify_attestation"){if(zo(b.attestation).payload.id!==o)return;clearInterval(d),l.body.removeChild(y),this.abortController.signal.removeEventListener("abort",m),window.removeEventListener("message",g),u(b.attestation===null?"":b.attestation)}}catch(b){this.logger.warn(b)}};l.body.appendChild(y),window.addEventListener("message",g,{signal:this.abortController.signal})});return this.logger.debug(h,"jwt attestation"),h}catch(l){this.logger.warn(l)}return""}),De(this,"resolve",async i=>{if(this.isDevEnv)return"";const{attestationId:r,hash:o,encryptedId:a}=i;if(r===""){this.logger.debug("resolve: attestationId is empty, skipping");return}if(r){if(zo(r).payload.id!==a)return;const l=await this.isValidJwtAttestation(r);if(l){if(!l.isVerified){this.logger.warn("resolve: jwt attestation: origin url not verified");return}return l}}if(!o)return;const c=this.getVerifyUrl(i==null?void 0:i.verifyUrl);return this.fetchAttestation(o,c)}),De(this,"fetchAttestation",async(i,r)=>{this.logger.debug(`resolving attestation: ${i} from url: ${r}`);const o=this.startAbortTimer(F.ONE_SECOND*5),a=await fetch(`${r}/attestation/${i}?v2Supported=true`,{signal:this.abortController.signal});return clearTimeout(o),a.status===200?await a.json():void 0}),De(this,"getVerifyUrl",i=>{let r=i||ki;return Sb.includes(r)||(this.logger.info(`verify url: ${r}, not included in trusted list, assigning default: ${ki}`),r=ki),r}),De(this,"fetchPublicKey",async()=>{try{this.logger.debug(`fetching public key from: ${this.verifyUrlV3}`);const i=this.startAbortTimer(F.FIVE_SECONDS),r=await fetch(`${this.verifyUrlV3}/public-key`,{signal:this.abortController.signal});return clearTimeout(i),await r.json()}catch(i){this.logger.warn(i)}}),De(this,"persistPublicKey",async i=>{this.logger.debug(i,"persisting public key to local storage"),await this.store.setItem(this.storeKey,i),this.publicKey=i}),De(this,"removePublicKey",async()=>{this.logger.debug("removing verify v2 public key from storage"),await this.store.removeItem(this.storeKey),this.publicKey=void 0}),De(this,"isValidJwtAttestation",async i=>{const r=await this.getPublicKey();try{if(r)return this.validateAttestation(i,r)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}const o=await this.fetchAndPersistPublicKey();try{if(o)return this.validateAttestation(i,o)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}}),De(this,"getPublicKey",async()=>this.publicKey?this.publicKey:await this.fetchAndPersistPublicKey()),De(this,"fetchAndPersistPublicKey",async()=>{if(this.fetchPromise)return await this.fetchPromise,this.publicKey;this.fetchPromise=new Promise(async r=>{const o=await this.fetchPublicKey();o&&(await this.persistPublicKey(o),r(o))});const i=await this.fetchPromise;return this.fetchPromise=void 0,i}),De(this,"validateAttestation",(i,r)=>{const o=qw(i,r.publicKey),a={hasExpired:F.toMiliseconds(o.exp)<Date.now(),payload:o};if(a.hasExpired)throw this.logger.warn("resolve: jwt attestation expired"),new Error("JWT attestation expired");return{origin:a.payload.origin,isScam:a.payload.isScam,isVerified:a.payload.isVerified}}),this.logger=Tt(s,this.name),this.abortController=new AbortController,this.isDevEnv=Ga(),this.init()}get storeKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//verify:public:key"}get context(){return Ot(this.logger)}startAbortTimer(e){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),F.toMiliseconds(e))}}var Nv=Object.defineProperty,_v=(t,e,s)=>e in t?Nv(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,Yl=(t,e,s)=>_v(t,typeof e!="symbol"?e+"":e,s);class Sv extends qf{constructor(e,s){super(e,s),this.projectId=e,this.logger=s,Yl(this,"context",Tb),Yl(this,"registerDeviceToken",async n=>{const{clientId:i,token:r,notificationType:o,enableEncrypted:a=!1}=n,c=`${Ob}/${this.projectId}/clients`;await fetch(c,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:i,type:o,token:r,always_raw:a})})}),this.logger=Tt(s,this.context)}}var Tv=Object.defineProperty,Jl=Object.getOwnPropertySymbols,Ov=Object.prototype.hasOwnProperty,kv=Object.prototype.propertyIsEnumerable,Sa=(t,e,s)=>e in t?Tv(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,bi=(t,e)=>{for(var s in e||(e={}))Ov.call(e,s)&&Sa(t,s,e[s]);if(Jl)for(var s of Jl(e))kv.call(e,s)&&Sa(t,s,e[s]);return t},qe=(t,e,s)=>Sa(t,typeof e!="symbol"?e+"":e,s);class xv extends Hf{constructor(e,s,n=!0){super(e,s,n),this.core=e,this.logger=s,qe(this,"context",xb),qe(this,"storagePrefix",ps),qe(this,"storageVersion",kb),qe(this,"events",new Map),qe(this,"shouldPersist",!1),qe(this,"init",async()=>{if(!Ga())try{const i={eventId:Mc(),timestamp:Date.now(),domain:this.getAppDomain(),props:{event:"INIT",type:"",properties:{client_id:await this.core.crypto.getClientId(),user_agent:uh(this.core.relayer.protocol,this.core.relayer.version,ba)}}};await this.sendEvent([i])}catch(i){this.logger.warn(i)}}),qe(this,"createEvent",i=>{const{event:r="ERROR",type:o="",properties:{topic:a,trace:c}}=i,l=Mc(),d=this.core.projectId||"",h=Date.now(),u=bi({eventId:l,timestamp:h,props:{event:r,type:o,properties:{topic:a,trace:c}},bundleId:d,domain:this.getAppDomain()},this.setMethods(l));return this.telemetryEnabled&&(this.events.set(l,u),this.shouldPersist=!0),u}),qe(this,"getEvent",i=>{const{eventId:r,topic:o}=i;if(r)return this.events.get(r);const a=Array.from(this.events.values()).find(c=>c.props.properties.topic===o);if(a)return bi(bi({},a),this.setMethods(a.eventId))}),qe(this,"deleteEvent",i=>{const{eventId:r}=i;this.events.delete(r),this.shouldPersist=!0}),qe(this,"setEventListeners",()=>{this.core.heartbeat.on(oi.pulse,async()=>{this.shouldPersist&&await this.persist(),this.events.forEach(i=>{F.fromMiliseconds(Date.now())-F.fromMiliseconds(i.timestamp)>Pb&&(this.events.delete(i.eventId),this.shouldPersist=!0)})})}),qe(this,"setMethods",i=>({addTrace:r=>this.addTrace(i,r),setError:r=>this.setError(i,r)})),qe(this,"addTrace",(i,r)=>{const o=this.events.get(i);o&&(o.props.properties.trace.push(r),this.events.set(i,o),this.shouldPersist=!0)}),qe(this,"setError",(i,r)=>{const o=this.events.get(i);o&&(o.props.type=r,o.timestamp=Date.now(),this.events.set(i,o),this.shouldPersist=!0)}),qe(this,"persist",async()=>{await this.core.storage.setItem(this.storageKey,Array.from(this.events.values())),this.shouldPersist=!1}),qe(this,"restore",async()=>{try{const i=await this.core.storage.getItem(this.storageKey)||[];if(!i.length)return;i.forEach(r=>{this.events.set(r.eventId,bi(bi({},r),this.setMethods(r.eventId)))})}catch(i){this.logger.warn(i)}}),qe(this,"submit",async()=>{if(!this.telemetryEnabled||this.events.size===0)return;const i=[];for(const[r,o]of this.events)o.props.type&&i.push(o);if(i.length!==0)try{if((await this.sendEvent(i)).ok)for(const r of i)this.events.delete(r.eventId),this.shouldPersist=!0}catch(r){this.logger.warn(r)}}),qe(this,"sendEvent",async i=>{const r=this.getAppDomain()?"":"&sp=desktop";return await fetch(`${Rb}?projectId=${this.core.projectId}&st=events_sdk&sv=js-${ba}${r}`,{method:"POST",body:JSON.stringify(i)})}),qe(this,"getAppDomain",()=>hh().url),this.logger=Tt(s,this.context),this.telemetryEnabled=n,n?this.restore().then(async()=>{await this.submit(),this.setEventListeners()}):this.persist()}get storageKey(){return this.storagePrefix+this.storageVersion+this.core.customStoragePrefix+"//"+this.context}}var Pv=Object.defineProperty,Xl=Object.getOwnPropertySymbols,Rv=Object.prototype.hasOwnProperty,Uv=Object.prototype.propertyIsEnumerable,Ta=(t,e,s)=>e in t?Pv(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,Zl=(t,e)=>{for(var s in e||(e={}))Rv.call(e,s)&&Ta(t,s,e[s]);if(Xl)for(var s of Xl(e))Uv.call(e,s)&&Ta(t,s,e[s]);return t},Se=(t,e,s)=>Ta(t,typeof e!="symbol"?e+"":e,s);let $v=class Pu extends xf{constructor(e){var s;super(e),Se(this,"protocol",mu),Se(this,"version",yu),Se(this,"name",wa),Se(this,"relayUrl"),Se(this,"projectId"),Se(this,"customStoragePrefix"),Se(this,"events",new Sn.EventEmitter),Se(this,"logger"),Se(this,"heartbeat"),Se(this,"relayer"),Se(this,"crypto"),Se(this,"storage"),Se(this,"history"),Se(this,"expirer"),Se(this,"pairing"),Se(this,"verify"),Se(this,"echoClient"),Se(this,"linkModeSupportedApps"),Se(this,"eventClient"),Se(this,"initialized",!1),Se(this,"logChunkController"),Se(this,"on",(a,c)=>this.events.on(a,c)),Se(this,"once",(a,c)=>this.events.once(a,c)),Se(this,"off",(a,c)=>this.events.off(a,c)),Se(this,"removeListener",(a,c)=>this.events.removeListener(a,c)),Se(this,"dispatchEnvelope",({topic:a,message:c,sessionExists:l})=>{if(!a||!c)return;const d={topic:a,message:c,publishedAt:Date.now(),transportType:ke.link_mode};this.relayer.onLinkMessageEvent(d,{sessionExists:l})});const n=this.getGlobalCore(e==null?void 0:e.customStoragePrefix);if(n)try{return this.customStoragePrefix=n.customStoragePrefix,this.logger=n.logger,this.heartbeat=n.heartbeat,this.crypto=n.crypto,this.history=n.history,this.expirer=n.expirer,this.storage=n.storage,this.relayer=n.relayer,this.pairing=n.pairing,this.verify=n.verify,this.echoClient=n.echoClient,this.linkModeSupportedApps=n.linkModeSupportedApps,this.eventClient=n.eventClient,this.initialized=n.initialized,this.logChunkController=n.logChunkController,n}catch(a){console.warn("Failed to copy global core",a)}this.projectId=e==null?void 0:e.projectId,this.relayUrl=(e==null?void 0:e.relayUrl)||bu,this.customStoragePrefix=e!=null&&e.customStoragePrefix?`:${e.customStoragePrefix}`:"";const i=qd({level:typeof(e==null?void 0:e.logger)=="string"&&e.logger?e.logger:eb.logger,name:wa}),{logger:r,chunkLoggerController:o}=Ma({opts:i,maxSizeInBytes:e==null?void 0:e.maxLogBlobSizeInBytes,loggerOverride:e==null?void 0:e.logger});this.logChunkController=o,(s=this.logChunkController)!=null&&s.downloadLogsBlobInBrowser&&(window.downloadLogsBlobInBrowser=async()=>{var a,c;(a=this.logChunkController)!=null&&a.downloadLogsBlobInBrowser&&((c=this.logChunkController)==null||c.downloadLogsBlobInBrowser({clientId:await this.crypto.getClientId()}))}),this.logger=Tt(r,this.name),this.heartbeat=new yp,this.crypto=new cC(this,this.logger,e==null?void 0:e.keychain),this.history=new wv(this,this.logger),this.expirer=new Cv(this,this.logger),this.storage=e!=null&&e.storage?e.storage:new wp(Zl(Zl({},tb),e==null?void 0:e.storageOptions)),this.relayer=new $C({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new gv(this,this.logger),this.verify=new Iv(this,this.logger,this.storage),this.echoClient=new Sv(this.projectId||"",this.logger),this.linkModeSupportedApps=[],this.eventClient=new xv(this,this.logger,e==null?void 0:e.telemetryEnabled),this.setGlobalCore(this)}static async init(e){const s=new Pu(e);await s.initialize();const n=await s.crypto.getClientId();return await s.storage.setItem(gb,n),s}get context(){return Ot(this.logger)}async start(){this.initialized||await this.initialize()}async getLogsBlob(){var e;return(e=this.logChunkController)==null?void 0:e.logsToBlob({clientId:await this.crypto.getClientId()})}async addLinkModeSupportedApp(e){this.linkModeSupportedApps.includes(e)||(this.linkModeSupportedApps.push(e),await this.storage.setItem(kl,this.linkModeSupportedApps))}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.linkModeSupportedApps=await this.storage.getItem(kl)||[],this.initialized=!0,this.logger.info("Core Initialization Success")}catch(e){throw this.logger.warn(e,`Core Initialization Failure at epoch ${Date.now()}`),this.logger.error(e.message),e}}getGlobalCore(e=""){try{if(this.isGlobalCoreDisabled())return;const s=`_walletConnectCore_${e}`,n=`${s}_count`;return globalThis[n]=(globalThis[n]||0)+1,globalThis[n]>1&&console.warn(`WalletConnect Core is already initialized. This is probably a mistake and can lead to unexpected behavior. Init() was called ${globalThis[n]} times.`),globalThis[s]}catch(s){console.warn("Failed to get global WalletConnect core",s);return}}setGlobalCore(e){var s;try{if(this.isGlobalCoreDisabled())return;const n=`_walletConnectCore_${((s=e.opts)==null?void 0:s.customStoragePrefix)||""}`;globalThis[n]=e}catch(n){console.warn("Failed to set global WalletConnect core",n)}}isGlobalCoreDisabled(){try{return typeof process<"u"&&Q0.DISABLE_GLOBAL_CORE==="true"}catch{return!0}}};const Dv=$v,Ru="wc",Uu=2,$u="client",oc=`${Ru}@${Uu}:${$u}:`,Ro={name:$u,logger:"error"},Ql="WALLETCONNECT_DEEPLINK_CHOICE",Lv="proposal",ed="Proposal expired",Mv="session",Wn=F.SEVEN_DAYS,Bv="engine",Ge={wc_sessionPropose:{req:{ttl:F.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:F.FIVE_MINUTES,prompt:!1,tag:1101},reject:{ttl:F.FIVE_MINUTES,prompt:!1,tag:1120},autoReject:{ttl:F.FIVE_MINUTES,prompt:!1,tag:1121}},wc_sessionSettle:{req:{ttl:F.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:F.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:F.ONE_DAY,prompt:!1,tag:1104},res:{ttl:F.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:F.ONE_DAY,prompt:!1,tag:1106},res:{ttl:F.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:F.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:F.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:F.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:F.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:F.ONE_DAY,prompt:!1,tag:1112},res:{ttl:F.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:F.ONE_DAY,prompt:!1,tag:1114},res:{ttl:F.ONE_DAY,prompt:!1,tag:1115}},wc_sessionAuthenticate:{req:{ttl:F.ONE_HOUR,prompt:!0,tag:1116},res:{ttl:F.ONE_HOUR,prompt:!1,tag:1117},reject:{ttl:F.FIVE_MINUTES,prompt:!1,tag:1118},autoReject:{ttl:F.FIVE_MINUTES,prompt:!1,tag:1119}}},Uo={min:F.FIVE_MINUTES,max:F.SEVEN_DAYS},ss={idle:"IDLE",active:"ACTIVE"},Fv={eth_sendTransaction:{key:""},eth_sendRawTransaction:{key:""},wallet_sendCalls:{key:""},solana_signTransaction:{key:"signature"},solana_signAllTransactions:{key:"transactions"},solana_signAndSendTransaction:{key:"signature"},sui_signAndExecuteTransaction:{key:"digest"},sui_signTransaction:{key:""},hedera_signAndExecuteTransaction:{key:"transactionId"},hedera_executeTransaction:{key:"transactionId"},near_signTransaction:{key:""},near_signTransactions:{key:""},tron_signTransaction:{key:"txID"},xrpl_signTransaction:{key:""},xrpl_signTransactionFor:{key:""},algo_signTxn:{key:""},sendTransfer:{key:"txid"},stacks_stxTransfer:{key:"txId"},polkadot_signTransaction:{key:""},cosmos_signDirect:{key:""}},Wv="request",jv=["wc_sessionPropose","wc_sessionRequest","wc_authRequest","wc_sessionAuthenticate"],qv="wc",Hv="auth",Kv="authKeys",Vv="pairingTopics",zv="requests",oo=`${qv}@${1.5}:${Hv}:`,_r=`${oo}:PUB_KEY`;var Gv=Object.defineProperty,Yv=Object.defineProperties,Jv=Object.getOwnPropertyDescriptors,td=Object.getOwnPropertySymbols,Xv=Object.prototype.hasOwnProperty,Zv=Object.prototype.propertyIsEnumerable,Oa=(t,e,s)=>e in t?Gv(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,ve=(t,e)=>{for(var s in e||(e={}))Xv.call(e,s)&&Oa(t,s,e[s]);if(td)for(var s of td(e))Zv.call(e,s)&&Oa(t,s,e[s]);return t},Ye=(t,e)=>Yv(t,Jv(e)),O=(t,e,s)=>Oa(t,typeof e!="symbol"?e+"":e,s);class Qv extends Gf{constructor(e){super(e),O(this,"name",Bv),O(this,"events",new ja),O(this,"initialized",!1),O(this,"requestQueue",{state:ss.idle,queue:[]}),O(this,"sessionRequestQueue",{state:ss.idle,queue:[]}),O(this,"emittedSessionRequests",new sm({limit:500})),O(this,"requestQueueDelay",F.ONE_SECOND),O(this,"expectedPairingMethodMap",new Map),O(this,"recentlyDeletedMap",new Map),O(this,"recentlyDeletedLimit",200),O(this,"relayMessageCache",[]),O(this,"pendingSessions",new Map),O(this,"init",async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),await this.registerLinkModeListeners(),this.client.core.pairing.register({methods:Object.keys(Ge)}),this.initialized=!0,setTimeout(async()=>{await this.processPendingMessageEvents(),this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},F.toMiliseconds(this.requestQueueDelay)))}),O(this,"connect",async s=>{var n;this.isInitialized(),await this.confirmOnlineStateOrThrow();const i=Ye(ve({},s),{requiredNamespaces:s.requiredNamespaces||{},optionalNamespaces:s.optionalNamespaces||{}});await this.isValidConnect(i),i.optionalNamespaces=u0(i.requiredNamespaces,i.optionalNamespaces),i.requiredNamespaces={};const{pairingTopic:r,requiredNamespaces:o,optionalNamespaces:a,sessionProperties:c,scopedProperties:l,relays:d,authentication:h,walletPay:u}=i,p=((n=h==null?void 0:h[0])==null?void 0:n.ttl)||Ge.wc_sessionPropose.req.ttl||F.FIVE_MINUTES;this.validateRequestExpiry(p);let m=r,y,g=!1;try{if(m){const T=this.client.core.pairing.pairings.get(m);this.client.logger.warn("connect() with existing pairing topic is deprecated and will be removed in the next major release."),g=T.active}}catch(T){throw this.client.logger.error(`connect() -> pairing.get(${m}) failed`),T}if(!m||!g){const{topic:T,uri:G}=await this.client.core.pairing.create({internal:{skipSubscribe:!0}});m=T,y=G}if(!m){const{message:T}=B("NO_MATCHING_KEY",`connect() pairing topic: ${m}`);throw new Error(T)}const w=await this.client.core.crypto.generateKeyPair(),b=Le(p),A=ve(Ye(ve(ve({requiredNamespaces:o,optionalNamespaces:a,relays:d!=null?d:[{protocol:wu}],proposer:{publicKey:w,metadata:this.client.metadata},expiryTimestamp:b,pairingTopic:m},c&&{sessionProperties:c}),l&&{scopedProperties:l}),{id:Ps()}),(h||u)&&{requests:{authentication:h==null?void 0:h.map(T=>{const{domain:G,chains:se,nonce:P,uri:E,exp:C,nbf:v,type:S,statement:$,requestId:M,resources:N,signatureTypes:R}=T;return{domain:G,chains:se,nonce:P,type:S!=null?S:"caip122",aud:E,version:"1",iat:new Date().toISOString(),exp:C,nbf:v,statement:$,requestId:M,resources:N,signatureTypes:R}}),walletPay:u}}),x=Ie("session_connect",A.id),{reject:H,resolve:L,done:J}=dn(p,ed),Y=({id:T})=>{T===A.id&&(this.client.events.off("proposal_expire",Y),this.pendingSessions.delete(A.id),this.events.emit(x,{error:{message:ed,code:0}}))};return this.client.events.on("proposal_expire",Y),this.events.once(x,({error:T,session:G})=>{this.client.events.off("proposal_expire",Y),T?H(T):G&&L(G)}),await this.setProposal(A.id,A),await this.sendProposeSession({proposal:A,publishOpts:{internal:{throwOnFailedPublish:!0},tvf:{correlationId:A.id}}}).catch(T=>{throw this.deleteProposal(A.id),T}),{uri:y,approval:J}}),O(this,"pair",async s=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{return await this.client.core.pairing.pair(s)}catch(n){throw this.client.logger.error("pair() failed"),n}}),O(this,"approve",async s=>{var n,i,r;const o=this.client.core.eventClient.createEvent({properties:{topic:(n=s==null?void 0:s.id)==null?void 0:n.toString(),trace:[Ht.session_approve_started]}});try{this.isInitialized(),await this.confirmOnlineStateOrThrow()}catch(G){throw o.setError(nn.no_internet_connection),G}try{await this.isValidProposalId(s==null?void 0:s.id)}catch(G){throw this.client.logger.error(`approve() -> proposal.get(${s==null?void 0:s.id}) failed`),o.setError(nn.proposal_not_found),G}try{await this.isValidApprove(s)}catch(G){throw this.client.logger.error("approve() -> isValidApprove() failed"),o.setError(nn.session_approve_namespace_validation_failure),G}const{id:a,relayProtocol:c,namespaces:l,sessionProperties:d,scopedProperties:h,sessionConfig:u,proposalRequestsResponses:p}=s,m=this.client.proposal.get(a);this.client.core.eventClient.deleteEvent({eventId:o.eventId});const{pairingTopic:y,proposer:g,requiredNamespaces:w,optionalNamespaces:b}=m;let A=(i=this.client.core.eventClient)==null?void 0:i.getEvent({topic:y});A||(A=(r=this.client.core.eventClient)==null?void 0:r.createEvent({type:Ht.session_approve_started,properties:{topic:y,trace:[Ht.session_approve_started,Ht.session_namespaces_validation_success]}}));const x=await this.client.core.crypto.generateKeyPair(),H=g.publicKey,L=await this.client.core.crypto.generateSharedKey(x,H),J=Ye(ve(ve(ve({relay:{protocol:c!=null?c:"irn"},namespaces:l,controller:{publicKey:x,metadata:this.client.metadata},expiry:Le(Wn)},d&&{sessionProperties:d}),h&&{scopedProperties:h}),u&&{sessionConfig:u}),{proposalRequestsResponses:p}),Y=ke.relay;A.addTrace(Ht.subscribing_session_topic);try{await this.client.core.relayer.subscribe(L,{transportType:Y,internal:{skipSubscribe:!0}})}catch(G){throw A.setError(nn.subscribe_session_topic_failure),G}A.addTrace(Ht.subscribe_session_topic_success);const T=Ye(ve({},J),{topic:L,requiredNamespaces:w,optionalNamespaces:b,pairingTopic:y,acknowledged:!1,self:J.controller,peer:{publicKey:g.publicKey,metadata:g.metadata},controller:x,transportType:ke.relay,authentication:p==null?void 0:p.authentication,walletPayResult:p==null?void 0:p.walletPay});await this.client.session.set(L,T),A.addTrace(Ht.store_session);try{await this.sendApproveSession({sessionTopic:L,proposal:m,pairingProposalResponse:{relay:{protocol:c!=null?c:"irn"},responderPublicKey:x},sessionSettleRequest:J,publishOpts:{internal:{throwOnFailedPublish:!0},tvf:ve({correlationId:a},this.getTVFApproveParams(T))}}),A.addTrace(Ht.session_approve_publish_success)}catch(G){throw this.client.logger.error(G),this.client.session.delete(L,Re("USER_DISCONNECTED")),await this.client.core.relayer.unsubscribe(L),G}return this.client.core.eventClient.deleteEvent({eventId:A.eventId}),await this.client.core.pairing.updateMetadata({topic:y,metadata:g.metadata}),await this.deleteProposal(a),await this.client.core.pairing.activate({topic:y}),await this.setExpiry(L,Le(Wn)),{topic:L,acknowledged:()=>Promise.resolve(this.client.session.get(L))}}),O(this,"reject",async s=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidReject(s)}catch(o){throw this.client.logger.error("reject() -> isValidReject() failed"),o}const{id:n,reason:i}=s;let r;try{r=this.client.proposal.get(n).pairingTopic}catch(o){throw this.client.logger.error(`reject() -> proposal.get(${n}) failed`),o}r&&await this.sendError({id:n,topic:r,error:i,rpcOpts:Ge.wc_sessionPropose.reject}),await this.deleteProposal(n)}),O(this,"update",async s=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidUpdate(s)}catch(h){throw this.client.logger.error("update() -> isValidUpdate() failed"),h}const{topic:n,namespaces:i}=s,{done:r,resolve:o,reject:a}=dn(F.FIVE_MINUTES,"Session update request expired without receiving any acknowledgement"),c=Ps(),l=fn().toString(),d=this.client.session.get(n).namespaces;return this.events.once(Ie("session_update",c),({error:h})=>{h?a(h):o()}),await this.client.session.update(n,{namespaces:i}),await this.sendRequest({topic:n,method:"wc_sessionUpdate",params:{namespaces:i},throwOnFailedPublish:!0,clientRpcId:c,relayRpcId:l}).catch(h=>{this.client.logger.error(h),this.client.session.update(n,{namespaces:d}),a(h)}),{acknowledged:r}}),O(this,"extend",async s=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidExtend(s)}catch(c){throw this.client.logger.error("extend() -> isValidExtend() failed"),c}const{topic:n}=s,i=Ps(),{done:r,resolve:o,reject:a}=dn(F.FIVE_MINUTES,"Session extend request expired without receiving any acknowledgement");return this.events.once(Ie("session_extend",i),({error:c})=>{c?a(c):o()}),await this.setExpiry(n,Le(Wn)),this.sendRequest({topic:n,method:"wc_sessionExtend",params:{},clientRpcId:i,throwOnFailedPublish:!0}).catch(c=>{a(c)}),{acknowledged:r}}),O(this,"request",async s=>{this.isInitialized();try{await this.isValidRequest(s)}catch(g){throw this.client.logger.error("request() -> isValidRequest() failed"),g}const{chainId:n,request:i,topic:r,expiry:o=Ge.wc_sessionRequest.req.ttl}=s,a=this.client.session.get(r);(a==null?void 0:a.transportType)===ke.relay&&await this.confirmOnlineStateOrThrow();const c=Ps(),l=fn().toString(),{done:d,resolve:h,reject:u}=dn(o,"Request expired. Please try again.");this.events.once(Ie("session_request",c),({error:g,result:w})=>{g?u(g):h(w)});const p="wc_sessionRequest",m=this.getAppLinkIfEnabled(a.peer.metadata,a.transportType);if(m)return await this.sendRequest({clientRpcId:c,relayRpcId:l,topic:r,method:p,params:{request:Ye(ve({},i),{expiryTimestamp:Le(o)}),chainId:n},expiry:o,throwOnFailedPublish:!0,appLink:m}).catch(g=>u(g)),this.client.events.emit("session_request_sent",{topic:r,request:i,chainId:n,id:c}),await d();const y={request:Ye(ve({},i),{expiryTimestamp:Le(o)}),chainId:n};return await Promise.all([new Promise(async g=>{await this.sendRequest({clientRpcId:c,relayRpcId:l,topic:r,method:p,params:y,expiry:o,throwOnFailedPublish:!0,tvf:this.getTVFParams(c,y)}).catch(w=>u(w)),this.client.events.emit("session_request_sent",{topic:r,request:i,chainId:n,id:c}),g()}),new Promise(async g=>{var w;if(!((w=a.sessionConfig)!=null&&w.disableDeepLink)){const b=await Xg(this.client.core.storage,Ql);await Gg({id:c,topic:r,wcDeepLink:b})}g()}),d()]).then(g=>g[2])}),O(this,"respond",async s=>{var n,i;this.isInitialized();const r=this.client.core.eventClient.createEvent({properties:{topic:(s==null?void 0:s.topic)||((i=(n=s==null?void 0:s.response)==null?void 0:n.id)==null?void 0:i.toString()),trace:[Ht.session_request_response_started]}});try{await this.isValidRespond(s)}catch(h){throw r.addTrace(h==null?void 0:h.message),r.setError(nn.session_request_response_validation_failure),h}r.addTrace(Ht.session_request_response_validation_success);const{topic:o,response:a}=s,{id:c}=a,l=this.client.session.get(o);l.transportType===ke.relay&&await this.confirmOnlineStateOrThrow();const d=this.getAppLinkIfEnabled(l.peer.metadata,l.transportType);try{r.addTrace(Ht.session_request_response_publish_started),ms(a)?await this.sendResult({id:c,topic:o,result:a.result,throwOnFailedPublish:!0,appLink:d}):is(a)&&await this.sendError({id:c,topic:o,error:a.error,appLink:d}),this.cleanupAfterResponse(s)}catch(h){throw r.addTrace(h==null?void 0:h.message),r.setError(nn.session_request_response_publish_failure),h}}),O(this,"ping",async s=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidPing(s)}catch(i){throw this.client.logger.error("ping() -> isValidPing() failed"),i}const{topic:n}=s;if(this.client.session.keys.includes(n)){const i=Ps(),r=fn().toString(),{done:o,resolve:a,reject:c}=dn(F.FIVE_MINUTES,"Ping request expired without receiving any acknowledgement");this.events.once(Ie("session_ping",i),({error:l})=>{l?c(l):a()}),await Promise.all([this.sendRequest({topic:n,method:"wc_sessionPing",params:{},throwOnFailedPublish:!0,clientRpcId:i,relayRpcId:r}),o()])}else this.client.core.pairing.pairings.keys.includes(n)&&(this.client.logger.warn("ping() on pairing topic is deprecated and will be removed in the next major release."),await this.client.core.pairing.ping({topic:n}))}),O(this,"emit",async s=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidEmit(s);const{topic:n,event:i,chainId:r}=s,o=fn().toString(),a=Ps();await this.sendRequest({topic:n,method:"wc_sessionEvent",params:{event:i,chainId:r},throwOnFailedPublish:!0,relayRpcId:o,clientRpcId:a})}),O(this,"disconnect",async s=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidDisconnect(s);const{topic:n}=s;if(this.client.session.keys.includes(n))await this.sendRequest({topic:n,method:"wc_sessionDelete",params:Re("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession({topic:n,emitEvent:!1});else if(this.client.core.pairing.pairings.keys.includes(n))await this.client.core.pairing.disconnect({topic:n});else{const{message:i}=B("MISMATCHED_TOPIC",`Session or pairing topic not found: ${n}`);throw new Error(i)}}),O(this,"find",s=>(this.isInitialized(),this.client.session.getAll().filter(n=>g0(n,s)))),O(this,"getPendingSessionRequests",()=>this.client.pendingRequest.getAll()),O(this,"authenticate",async(s,n)=>{var i;this.isInitialized(),this.isValidAuthenticate(s);const r=n&&this.client.core.linkModeSupportedApps.includes(n)&&((i=this.client.metadata.redirect)==null?void 0:i.linkMode),o=r?ke.link_mode:ke.relay;o===ke.relay&&await this.confirmOnlineStateOrThrow();const{chains:a,statement:c="",uri:l,domain:d,nonce:h,type:u,exp:p,nbf:m,methods:y=[],expiry:g}=s,w=[...s.resources||[]],{topic:b,uri:A}=await this.client.core.pairing.create({methods:["wc_sessionAuthenticate"],transportType:o});this.client.logger.info({message:"Generated new pairing",pairing:{topic:b,uri:A}});const x=await this.client.core.crypto.generateKeyPair(),H=Ir(x);if(await Promise.all([this.client.auth.authKeys.set(_r,{responseTopic:H,publicKey:x}),this.client.auth.pairingTopics.set(H,{topic:H,pairingTopic:b})]),await this.client.core.relayer.subscribe(H,{transportType:o}),this.client.logger.info(`sending request to new pairing topic: ${b}`),y.length>0){const{namespace:N}=_s(a[0]);let R=gy(N,"request",y);Ar(w)&&(R=yy(R,w.pop())),w.push(R)}const L=g&&g>Ge.wc_sessionAuthenticate.req.ttl?g:Ge.wc_sessionAuthenticate.req.ttl,J={authPayload:{type:u!=null?u:"caip122",chains:a,statement:c,aud:l,domain:d,version:"1",nonce:h,iat:new Date().toISOString(),exp:p,nbf:m,resources:w},requester:{publicKey:x,metadata:this.client.metadata},expiryTimestamp:Le(L)},Y={eip155:{chains:a,methods:[...new Set(["personal_sign",...y])],events:["chainChanged","accountsChanged"]}},T={requiredNamespaces:{},optionalNamespaces:Y,relays:[{protocol:"irn"}],pairingTopic:b,proposer:{publicKey:x,metadata:this.client.metadata},expiryTimestamp:Le(Ge.wc_sessionPropose.req.ttl),id:Ps()},{done:G,resolve:se,reject:P}=dn(L,"Request expired"),E=Ps(),C=Ie("session_connect",T.id),v=Ie("session_request",E),S=async({error:N,session:R})=>{this.events.off(v,$),N?P(N):R&&se({session:R})},$=async N=>{var R,V,K;if(await this.deletePendingAuthRequest(E,{message:"fulfilled",code:0}),N.error){const ue=Re("WC_METHOD_UNSUPPORTED","wc_sessionAuthenticate");return N.error.code===ue.code?void 0:(this.events.off(C,S),P(N.error.message))}await this.deleteProposal(T.id),this.events.off(C,S);const{cacaos:fe,responder:re}=N.result,ne=[],pe=[];for(const ue of fe){await Yc({cacao:ue,projectId:this.client.core.projectId})||(this.client.logger.error(ue,"Signature verification failed"),P(Re("SESSION_SETTLEMENT_FAILED","Signature verification failed")));const{p:$e}=ue,jt=Ar($e.resources),xs=[oa($e.iss)],tn=Mr($e.iss);if(jt){const Rn=Jc(jt),ip=Xc(jt);ne.push(...Rn),xs.push(...ip)}for(const Rn of xs)pe.push(`${Rn}:${tn}`)}const he=await this.client.core.crypto.generateSharedKey(x,re.publicKey);let Te;ne.length>0&&(Te={topic:he,acknowledged:!0,self:{publicKey:x,metadata:this.client.metadata},peer:re,controller:re.publicKey,expiry:Le(Wn),requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:b,namespaces:Al([...new Set(ne)],[...new Set(pe)]),transportType:o},await this.client.core.relayer.subscribe(he,{transportType:o}),await this.client.session.set(he,Te),b&&await this.client.core.pairing.updateMetadata({topic:b,metadata:re.metadata}),Te=this.client.session.get(he)),(R=this.client.metadata.redirect)!=null&&R.linkMode&&(V=re.metadata.redirect)!=null&&V.linkMode&&(K=re.metadata.redirect)!=null&&K.universal&&n&&(this.client.core.addLinkModeSupportedApp(re.metadata.redirect.universal),this.client.session.update(he,{transportType:ke.link_mode})),se({auths:fe,session:Te})};this.events.once(C,S),this.events.once(v,$);let M;try{if(r){const N=rs("wc_sessionAuthenticate",J,E);this.client.core.history.set(b,N);const R=await this.client.core.crypto.encode("",N,{type:Zi,encoding:Hs});M=ur(n,b,R)}else await Promise.all([this.sendRequest({topic:b,method:"wc_sessionAuthenticate",params:J,expiry:s.expiry,throwOnFailedPublish:!0,clientRpcId:E}),this.sendRequest({topic:b,method:"wc_sessionPropose",params:T,expiry:Ge.wc_sessionPropose.req.ttl,throwOnFailedPublish:!0,clientRpcId:T.id})])}catch(N){throw this.events.off(C,S),this.events.off(v,$),N}return await this.setProposal(T.id,T),await this.setAuthRequest(E,{request:Ye(ve({},J),{verifyContext:{}}),pairingTopic:b,transportType:o}),{uri:M!=null?M:A,response:G}}),O(this,"approveSessionAuthenticate",async s=>{const{id:n,auths:i}=s,r=this.client.core.eventClient.createEvent({properties:{topic:n.toString(),trace:[rn.authenticated_session_approve_started]}});try{this.isInitialized()}catch(g){throw r.setError(yi.no_internet_connection),g}const o=this.getPendingAuthRequest(n);if(!o)throw r.setError(yi.authenticated_session_pending_request_not_found),new Error(`Could not find pending auth request with id ${n}`);const a=o.transportType||ke.relay;a===ke.relay&&await this.confirmOnlineStateOrThrow();const c=o.requester.publicKey,l=await this.client.core.crypto.generateKeyPair(),d=Ir(c),h={type:Ss,receiverPublicKey:c,senderPublicKey:l},u=[],p=[];for(const g of i){if(!await Yc({cacao:g,projectId:this.client.core.projectId})){r.setError(yi.invalid_cacao);const H=Re("SESSION_SETTLEMENT_FAILED","Signature verification failed");throw await this.sendError({id:n,topic:d,error:H,encodeOpts:h}),new Error(H.message)}r.addTrace(rn.cacaos_verified);const{p:w}=g,b=Ar(w.resources),A=[oa(w.iss)],x=Mr(w.iss);if(b){const H=Jc(b),L=Xc(b);u.push(...H),A.push(...L)}for(const H of A)p.push(`${H}:${x}`)}const m=await this.client.core.crypto.generateSharedKey(l,c);r.addTrace(rn.create_authenticated_session_topic);let y;if((u==null?void 0:u.length)>0){y={topic:m,acknowledged:!0,self:{publicKey:l,metadata:this.client.metadata},peer:{publicKey:c,metadata:o.requester.metadata},controller:c,expiry:Le(Wn),authentication:i,requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:o.pairingTopic,namespaces:Al([...new Set(u)],[...new Set(p)]),transportType:a},r.addTrace(rn.subscribing_authenticated_session_topic);try{await this.client.core.relayer.subscribe(m,{transportType:a})}catch(g){throw r.setError(yi.subscribe_authenticated_session_topic_failure),g}r.addTrace(rn.subscribe_authenticated_session_topic_success),await this.client.session.set(m,y),r.addTrace(rn.store_authenticated_session),await this.client.core.pairing.updateMetadata({topic:o.pairingTopic,metadata:o.requester.metadata})}r.addTrace(rn.publishing_authenticated_session_approve);try{await this.sendResult({topic:d,id:n,result:{cacaos:i,responder:{publicKey:l,metadata:this.client.metadata}},encodeOpts:h,throwOnFailedPublish:!0,appLink:this.getAppLinkIfEnabled(o.requester.metadata,a)})}catch(g){throw r.setError(yi.authenticated_session_approve_publish_failure),g}return await this.client.auth.requests.delete(n,{message:"fulfilled",code:0}),await this.client.core.pairing.activate({topic:o.pairingTopic}),this.client.core.eventClient.deleteEvent({eventId:r.eventId}),{session:y}}),O(this,"rejectSessionAuthenticate",async s=>{this.isInitialized();const{id:n,reason:i}=s,r=this.getPendingAuthRequest(n);if(!r)throw new Error(`Could not find pending auth request with id ${n}`);r.transportType===ke.relay&&await this.confirmOnlineStateOrThrow();const o=r.requester.publicKey,a=await this.client.core.crypto.generateKeyPair(),c=Ir(o),l={type:Ss,receiverPublicKey:o,senderPublicKey:a};await this.sendError({id:n,topic:c,error:i,encodeOpts:l,rpcOpts:Ge.wc_sessionAuthenticate.reject,appLink:this.getAppLinkIfEnabled(r.requester.metadata,r.transportType)}),await this.client.auth.requests.delete(n,{message:"rejected",code:0}),await this.deleteProposal(n)}),O(this,"formatAuthMessage",s=>{this.isInitialized();const{request:n,iss:i}=s;return xh(n,i)}),O(this,"processRelayMessageCache",()=>{setTimeout(async()=>{if(this.relayMessageCache.length!==0)for(;this.relayMessageCache.length>0;)try{const s=this.relayMessageCache.shift();s&&await this.onRelayMessage(s)}catch(s){this.client.logger.error(s)}},50)}),O(this,"cleanupDuplicatePairings",async s=>{if(s.pairingTopic)try{const n=this.client.core.pairing.pairings.get(s.pairingTopic),i=this.client.core.pairing.pairings.getAll().filter(r=>{var o,a;return((o=r.peerMetadata)==null?void 0:o.url)&&((a=r.peerMetadata)==null?void 0:a.url)===s.peer.metadata.url&&r.topic&&r.topic!==n.topic});if(i.length===0)return;this.client.logger.info(`Cleaning up ${i.length} duplicate pairing(s)`),await Promise.all(i.map(r=>this.client.core.pairing.disconnect({topic:r.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(n){this.client.logger.error(n)}}),O(this,"deleteSession",async s=>{var n;const{topic:i,expirerHasDeleted:r=!1,emitEvent:o=!0,id:a=0}=s,{self:c}=this.client.session.get(i);await this.client.core.relayer.unsubscribe(i),await this.client.session.delete(i,Re("USER_DISCONNECTED")),this.addToRecentlyDeleted(i,"session"),this.client.core.crypto.keychain.has(c.publicKey)&&await this.client.core.crypto.deleteKeyPair(c.publicKey),this.client.core.crypto.keychain.has(i)&&await this.client.core.crypto.deleteSymKey(i),r||this.client.core.expirer.del(i),this.client.core.storage.removeItem(Ql).catch(l=>this.client.logger.warn(l)),i===((n=this.sessionRequestQueue.queue[0])==null?void 0:n.topic)&&(this.sessionRequestQueue.state=ss.idle),await Promise.all(this.getPendingSessionRequests().filter(l=>l.topic===i).map(l=>this.deletePendingSessionRequest(l.id,Re("USER_DISCONNECTED")))),o&&this.client.events.emit("session_delete",{id:a,topic:i})}),O(this,"deleteProposal",async(s,n)=>{if(n)try{const i=this.client.proposal.get(s),r=this.client.core.eventClient.getEvent({topic:i.pairingTopic});r==null||r.setError(nn.proposal_expired)}catch{}await Promise.all([this.client.proposal.delete(s,Re("USER_DISCONNECTED")),n?Promise.resolve():this.client.core.expirer.del(s)]),this.addToRecentlyDeleted(s,"proposal")}),O(this,"deletePendingSessionRequest",async(s,n,i=!1)=>{await Promise.all([this.client.pendingRequest.delete(s,n),i?Promise.resolve():this.client.core.expirer.del(s)]),this.addToRecentlyDeleted(s,"request"),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(r=>r.id!==s),i&&(this.sessionRequestQueue.state=ss.idle,this.client.events.emit("session_request_expire",{id:s}))}),O(this,"deletePendingAuthRequest",async(s,n,i=!1)=>{await Promise.all([this.client.auth.requests.delete(s,n),i?Promise.resolve():this.client.core.expirer.del(s)])}),O(this,"setExpiry",async(s,n)=>{this.client.session.keys.includes(s)&&(this.client.core.expirer.set(s,n),await this.client.session.update(s,{expiry:n}))}),O(this,"setProposal",async(s,n)=>{this.client.core.expirer.set(s,Le(Ge.wc_sessionPropose.req.ttl)),await this.client.proposal.set(s,n)}),O(this,"setAuthRequest",async(s,n)=>{const{request:i,pairingTopic:r,transportType:o=ke.relay}=n;this.client.core.expirer.set(s,i.expiryTimestamp),await this.client.auth.requests.set(s,{authPayload:i.authPayload,requester:i.requester,expiryTimestamp:i.expiryTimestamp,id:s,pairingTopic:r,verifyContext:i.verifyContext,transportType:o})}),O(this,"setPendingSessionRequest",async s=>{const{id:n,topic:i,params:r,verifyContext:o}=s,a=r.request.expiryTimestamp||Le(Ge.wc_sessionRequest.req.ttl);this.client.core.expirer.set(n,a),await this.client.pendingRequest.set(n,{id:n,topic:i,params:r,verifyContext:o})}),O(this,"sendRequest",async s=>{const{topic:n,method:i,params:r,expiry:o,relayRpcId:a,clientRpcId:c,throwOnFailedPublish:l,appLink:d,tvf:h,publishOpts:u={}}=s,p=rs(i,r,c);let m;const y=!!d;try{const b=y?Hs:gt;m=await this.client.core.crypto.encode(n,p,{encoding:b})}catch(b){throw await this.cleanup(),this.client.logger.error(`sendRequest() -> core.crypto.encode() for topic ${n} failed`),b}let g;if(jv.includes(i)){const b=Dt(JSON.stringify(p)),A=Dt(m);g=await this.client.core.verify.register({id:A,decryptedId:b})}const w=ve(ve({},Ge[i].req),u);if(w.attestation=g,o&&(w.ttl=o),a&&(w.id=a),this.client.core.history.set(n,p),y){const b=ur(d,n,m);await global.Linking.openURL(b,this.client.name)}else w.tvf=Ye(ve({},h),{correlationId:p.id}),l?(w.internal=Ye(ve({},w.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(n,m,w)):this.client.core.relayer.publish(n,m,w).catch(b=>this.client.logger.error(b));return p.id}),O(this,"sendProposeSession",async s=>{const{proposal:n,publishOpts:i}=s,r=rs("wc_sessionPropose",n,n.id);this.client.core.history.set(n.pairingTopic,r);const o=await this.client.core.crypto.encode(n.pairingTopic,r,{encoding:gt}),a=Dt(JSON.stringify(r)),c=Dt(o),l=await this.client.core.verify.register({id:c,decryptedId:a});await this.client.core.relayer.publishCustom({payload:{pairingTopic:n.pairingTopic,sessionProposal:o},opts:Ye(ve({},i),{publishMethod:"wc_proposeSession",attestation:l})})}),O(this,"sendApproveSession",async s=>{const{sessionTopic:n,pairingProposalResponse:i,proposal:r,sessionSettleRequest:o,publishOpts:a}=s,c=$i(r.id,i),l=await this.client.core.crypto.encode(r.pairingTopic,c,{encoding:gt}),d=rs("wc_sessionSettle",o,a==null?void 0:a.id),h=await this.client.core.crypto.encode(n,d,{encoding:gt});this.client.core.history.set(n,d),await this.client.core.relayer.publishCustom({payload:{sessionTopic:n,pairingTopic:r.pairingTopic,sessionProposalResponse:l,sessionSettlementRequest:h},opts:Ye(ve({},a),{publishMethod:"wc_approveSession"})})}),O(this,"sendResult",async s=>{const{id:n,topic:i,result:r,throwOnFailedPublish:o,encodeOpts:a,appLink:c}=s,l=$i(n,r);let d;const h=c&&typeof(global==null?void 0:global.Linking)<"u";try{const m=h?Hs:gt;d=await this.client.core.crypto.encode(i,l,Ye(ve({},a||{}),{encoding:m}))}catch(m){throw await this.cleanup(),this.client.logger.error(`sendResult() -> core.crypto.encode() for topic ${i} failed`),m}let u,p;try{u=await this.client.core.history.get(i,n);const m=u.request;try{p=this.getTVFParams(n,m.params,r)}catch(y){this.client.logger.warn(`sendResult() -> getTVFParams() failed: ${y==null?void 0:y.message}`)}}catch(m){throw this.client.logger.error(`sendResult() -> history.get(${i}, ${n}) failed`),m}if(h){const m=ur(c,i,d);await global.Linking.openURL(m,this.client.name)}else{const m=u.request.method,y=Ge[m].res;y.tvf=Ye(ve({},p),{correlationId:n}),o?(y.internal=Ye(ve({},y.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(i,d,y)):this.client.core.relayer.publish(i,d,y).catch(g=>this.client.logger.error(g))}await this.client.core.history.resolve(l)}),O(this,"sendError",async s=>{const{id:n,topic:i,error:r,encodeOpts:o,rpcOpts:a,appLink:c}=s,l=Hd(n,r);let d;const h=c&&typeof(global==null?void 0:global.Linking)<"u";try{const p=h?Hs:gt;d=await this.client.core.crypto.encode(i,l,Ye(ve({},o||{}),{encoding:p}))}catch(p){throw await this.cleanup(),this.client.logger.error(`sendError() -> core.crypto.encode() for topic ${i} failed`),p}let u;try{u=await this.client.core.history.get(i,n)}catch(p){throw this.client.logger.error(`sendError() -> history.get(${i}, ${n}) failed`),p}if(h){const p=ur(c,i,d);await global.Linking.openURL(p,this.client.name)}else{const p=u.request.method,m=a||Ge[p].res;this.client.core.relayer.publish(i,d,m)}await this.client.core.history.resolve(l)}),O(this,"cleanup",async()=>{const s=[],n=[];this.client.session.getAll().forEach(i=>{let r=!1;os(i.expiry)&&(r=!0),this.client.core.crypto.keychain.has(i.topic)||(r=!0),r&&s.push(i.topic)}),this.client.proposal.getAll().forEach(i=>{os(i.expiryTimestamp)&&n.push(i.id)}),await Promise.all([...s.map(i=>this.deleteSession({topic:i})),...n.map(i=>this.deleteProposal(i))])}),O(this,"onProviderMessageEvent",async s=>{!this.initialized||this.relayMessageCache.length>0?this.relayMessageCache.push(s):await this.onRelayMessage(s)}),O(this,"onRelayEventRequest",async s=>{this.requestQueue.queue.push(s),await this.processRequestsQueue()}),O(this,"processRequestsQueue",async()=>{if(this.requestQueue.state===ss.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=ss.active;const s=this.requestQueue.queue.shift();if(s)try{await this.processRequest(s)}catch(n){this.client.logger.warn(n)}}this.requestQueue.state=ss.idle}),O(this,"processRequest",async s=>{const{topic:n,payload:i,attestation:r,transportType:o,encryptedId:a}=s,c=i.method;if(!this.shouldIgnorePairingRequest({topic:n,requestMethod:c}))switch(c){case"wc_sessionPropose":return await this.onSessionProposeRequest({topic:n,payload:i,attestation:r,encryptedId:a});case"wc_sessionSettle":return await this.onSessionSettleRequest(n,i);case"wc_sessionUpdate":return await this.onSessionUpdateRequest(n,i);case"wc_sessionExtend":return await this.onSessionExtendRequest(n,i);case"wc_sessionPing":return await this.onSessionPingRequest(n,i);case"wc_sessionDelete":return await this.onSessionDeleteRequest(n,i);case"wc_sessionRequest":return await this.onSessionRequest({topic:n,payload:i,attestation:r,encryptedId:a,transportType:o});case"wc_sessionEvent":return await this.onSessionEventRequest(n,i);case"wc_sessionAuthenticate":return await this.onSessionAuthenticateRequest({topic:n,payload:i,attestation:r,encryptedId:a,transportType:o});default:return this.client.logger.info(`Unsupported request method ${c}`)}}),O(this,"onRelayEventResponse",async s=>{const{topic:n,payload:i,transportType:r}=s,o=(await this.client.core.history.get(n,i.id)).request.method;switch(o){case"wc_sessionPropose":return this.onSessionProposeResponse(n,i,r);case"wc_sessionSettle":return this.onSessionSettleResponse(n,i);case"wc_sessionUpdate":return this.onSessionUpdateResponse(n,i);case"wc_sessionExtend":return this.onSessionExtendResponse(n,i);case"wc_sessionPing":return this.onSessionPingResponse(n,i);case"wc_sessionRequest":return this.onSessionRequestResponse(n,i);case"wc_sessionAuthenticate":return this.onSessionAuthenticateResponse(n,i);default:return this.client.logger.info(`Unsupported response method ${o}`)}}),O(this,"onRelayEventUnknownPayload",s=>{const{topic:n}=s,{message:i}=B("MISSING_OR_INVALID",`Decoded payload on topic ${n} is not identifiable as a JSON-RPC request or a response.`);throw new Error(i)}),O(this,"shouldIgnorePairingRequest",s=>{const{topic:n,requestMethod:i}=s,r=this.expectedPairingMethodMap.get(n);return!r||r.includes(i)?!1:!!(r.includes("wc_sessionAuthenticate")&&this.client.events.listenerCount("session_authenticate")>0)}),O(this,"onSessionProposeRequest",async s=>{const{topic:n,payload:i,attestation:r,encryptedId:o}=s,{params:a,id:c}=i;try{const l=this.client.core.eventClient.getEvent({topic:n});this.client.events.listenerCount("session_proposal")===0&&(console.warn("No listener for session_proposal event"),l==null||l.setError(ws.proposal_listener_not_found)),this.isValidConnect(ve({},i.params));const d=a.expiryTimestamp||Le(Ge.wc_sessionPropose.req.ttl),h=ve({id:c,pairingTopic:n,expiryTimestamp:d,attestation:r,encryptedId:o},a);await this.setProposal(c,h);const u=await this.getVerifyContext({attestationId:r,hash:Dt(JSON.stringify(i)),encryptedId:o,metadata:h.proposer.metadata});l==null||l.addTrace(ns.emit_session_proposal),this.client.events.emit("session_proposal",{id:c,params:h,verifyContext:u})}catch(l){await this.sendError({id:c,topic:n,error:l,rpcOpts:Ge.wc_sessionPropose.autoReject}),this.client.logger.error(l)}}),O(this,"onSessionProposeResponse",async(s,n,i)=>{const{id:r}=n;if(ms(n)){const{result:o}=n;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:o});const a=this.client.proposal.get(r);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:a});const c=a.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:c});const l=o.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:l});const d=await this.client.core.crypto.generateSharedKey(c,l);this.pendingSessions.set(r,{sessionTopic:d,pairingTopic:s,proposalId:r,publicKey:c});const h=await this.client.core.relayer.subscribe(d,{transportType:i});this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:h}),await this.client.core.pairing.activate({topic:s})}else if(is(n)){await this.deleteProposal(r);const o=Ie("session_connect",r);if(this.events.listenerCount(o)===0)throw new Error(`emitting ${o} without any listeners, 954`);this.events.emit(o,{error:n.error})}}),O(this,"onSessionSettleRequest",async(s,n)=>{const{id:i,params:r}=n;try{this.isValidSessionSettleRequest(r);const{relay:o,controller:a,expiry:c,namespaces:l,sessionProperties:d,scopedProperties:h,sessionConfig:u,proposalRequestsResponses:p}=n.params,m=[...this.pendingSessions.values()].find(w=>w.sessionTopic===s);if(!m)return this.client.logger.error(`Pending session not found for topic ${s}`);const y=this.client.proposal.get(m.proposalId),g=Ye(ve(ve(ve({topic:s,relay:o,expiry:c,namespaces:l,acknowledged:!0,pairingTopic:m.pairingTopic,requiredNamespaces:y.requiredNamespaces,optionalNamespaces:y.optionalNamespaces,controller:a.publicKey,self:{publicKey:m.publicKey,metadata:this.client.metadata},peer:{publicKey:a.publicKey,metadata:a.metadata}},d&&{sessionProperties:d}),h&&{scopedProperties:h}),u&&{sessionConfig:u}),{transportType:ke.relay,authentication:p==null?void 0:p.authentication,walletPayResult:p==null?void 0:p.walletPay});await this.client.session.set(g.topic,g),await this.setExpiry(g.topic,g.expiry),await this.client.core.pairing.updateMetadata({topic:m.pairingTopic,metadata:g.peer.metadata}),this.pendingSessions.delete(m.proposalId),this.deleteProposal(m.proposalId,!1),this.cleanupDuplicatePairings(g),await this.sendResult({id:n.id,topic:s,throwOnFailedPublish:!0,result:!0}),this.client.events.emit("session_connect",{session:g}),this.events.emit(Ie("session_connect",m.proposalId),{session:g})}catch(o){await this.sendError({id:i,topic:s,error:o}),this.client.logger.error(o)}}),O(this,"onSessionSettleResponse",async(s,n)=>{const{id:i}=n;ms(n)?(await this.client.session.update(s,{acknowledged:!0}),this.events.emit(Ie("session_approve",i),{})):is(n)&&(await this.client.session.delete(s,Re("USER_DISCONNECTED")),this.events.emit(Ie("session_approve",i),{error:n.error}))}),O(this,"onSessionUpdateRequest",async(s,n)=>{const{params:i,id:r}=n;try{const o=`${s}_session_update`,a=gi.get(o);if(a&&this.isRequestOutOfSync(a,r)){this.client.logger.warn(`Discarding out of sync request - ${r}`),this.sendError({id:r,topic:s,error:Re("INVALID_UPDATE_REQUEST")});return}this.isValidUpdate(ve({topic:s},i));try{gi.set(o,r),await this.client.session.update(s,{namespaces:i.namespaces}),await this.sendResult({id:r,topic:s,result:!0})}catch(c){throw gi.delete(o),c}this.client.events.emit("session_update",{id:r,topic:s,params:i})}catch(o){await this.sendError({id:r,topic:s,error:o}),this.client.logger.error(o)}}),O(this,"isRequestOutOfSync",(s,n)=>n.toString().slice(0,-3)<s.toString().slice(0,-3)),O(this,"onSessionUpdateResponse",(s,n)=>{const{id:i}=n,r=Ie("session_update",i);if(this.events.listenerCount(r)===0)throw new Error(`emitting ${r} without any listeners`);ms(n)?this.events.emit(Ie("session_update",i),{}):is(n)&&this.events.emit(Ie("session_update",i),{error:n.error})}),O(this,"onSessionExtendRequest",async(s,n)=>{const{id:i}=n;try{this.isValidExtend({topic:s}),await this.setExpiry(s,Le(Wn)),await this.sendResult({id:i,topic:s,result:!0}),this.client.events.emit("session_extend",{id:i,topic:s})}catch(r){await this.sendError({id:i,topic:s,error:r}),this.client.logger.error(r)}}),O(this,"onSessionExtendResponse",(s,n)=>{const{id:i}=n,r=Ie("session_extend",i);if(this.events.listenerCount(r)===0)throw new Error(`emitting ${r} without any listeners`);ms(n)?this.events.emit(Ie("session_extend",i),{}):is(n)&&this.events.emit(Ie("session_extend",i),{error:n.error})}),O(this,"onSessionPingRequest",async(s,n)=>{const{id:i}=n;try{this.isValidPing({topic:s}),await this.sendResult({id:i,topic:s,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_ping",{id:i,topic:s})}catch(r){await this.sendError({id:i,topic:s,error:r}),this.client.logger.error(r)}}),O(this,"onSessionPingResponse",(s,n)=>{const{id:i}=n,r=Ie("session_ping",i);setTimeout(()=>{if(this.events.listenerCount(r)===0)throw new Error(`emitting ${r} without any listeners 2176`);ms(n)?this.events.emit(Ie("session_ping",i),{}):is(n)&&this.events.emit(Ie("session_ping",i),{error:n.error})},500)}),O(this,"onSessionDeleteRequest",async(s,n)=>{const{id:i}=n;try{await this.isValidDisconnect({topic:s,reason:n.params}),this.cleanupPendingSentRequestsForTopic({topic:s,error:Re("USER_DISCONNECTED")}),await this.deleteSession({topic:s,id:i})}catch(r){this.client.logger.error(r)}}),O(this,"onSessionRequest",async s=>{var n,i,r;const{topic:o,payload:a,attestation:c,encryptedId:l,transportType:d}=s,{id:h,params:u}=a;try{await this.isValidRequest(ve({topic:o},u));const p=this.client.session.get(o),m=await this.getVerifyContext({attestationId:c,hash:Dt(JSON.stringify(rs("wc_sessionRequest",u,h))),encryptedId:l,metadata:p.peer.metadata,transportType:d}),y={id:h,topic:o,params:u,verifyContext:m};await this.setPendingSessionRequest(y),d===ke.link_mode&&(n=p.peer.metadata.redirect)!=null&&n.universal&&this.client.core.addLinkModeSupportedApp((i=p.peer.metadata.redirect)==null?void 0:i.universal),(r=this.client.signConfig)!=null&&r.disableRequestQueue?this.emitSessionRequest(y):(this.addSessionRequestToSessionRequestQueue(y),this.processSessionRequestQueue())}catch(p){await this.sendError({id:h,topic:o,error:p}),this.client.logger.error(p)}}),O(this,"onSessionRequestResponse",(s,n)=>{const{id:i}=n,r=Ie("session_request",i);if(this.events.listenerCount(r)===0)throw new Error(`emitting ${r} without any listeners`);ms(n)?this.events.emit(Ie("session_request",i),{result:n.result}):is(n)&&this.events.emit(Ie("session_request",i),{error:n.error})}),O(this,"onSessionEventRequest",async(s,n)=>{const{id:i,params:r}=n;try{const o=`${s}_session_event_${r.event.name}`,a=gi.get(o);if(a&&this.isRequestOutOfSync(a,i)){this.client.logger.info(`Discarding out of sync request - ${i}`);return}this.isValidEmit(ve({topic:s},r)),this.client.events.emit("session_event",{id:i,topic:s,params:r}),gi.set(o,i)}catch(o){await this.sendError({id:i,topic:s,error:o}),this.client.logger.error(o)}}),O(this,"onSessionAuthenticateResponse",(s,n)=>{const{id:i}=n;this.client.logger.trace({type:"method",method:"onSessionAuthenticateResponse",topic:s,payload:n}),ms(n)?this.events.emit(Ie("session_request",i),{result:n.result}):is(n)&&this.events.emit(Ie("session_request",i),{error:n.error})}),O(this,"onSessionAuthenticateRequest",async s=>{var n;const{topic:i,payload:r,attestation:o,encryptedId:a,transportType:c}=s;try{const{requester:l,authPayload:d,expiryTimestamp:h}=r.params,u=await this.getVerifyContext({attestationId:o,hash:Dt(JSON.stringify(r)),encryptedId:a,metadata:l.metadata,transportType:c}),p={requester:l,pairingTopic:i,id:r.id,authPayload:d,verifyContext:u,expiryTimestamp:h};await this.setAuthRequest(r.id,{request:p,pairingTopic:i,transportType:c}),c===ke.link_mode&&(n=l.metadata.redirect)!=null&&n.universal&&this.client.core.addLinkModeSupportedApp(l.metadata.redirect.universal),this.client.events.emit("session_authenticate",{topic:i,params:r.params,id:r.id,verifyContext:u})}catch(l){this.client.logger.error(l);const d=r.params.requester.publicKey,h=await this.client.core.crypto.generateKeyPair(),u=this.getAppLinkIfEnabled(r.params.requester.metadata,c),p={type:Ss,receiverPublicKey:d,senderPublicKey:h};await this.sendError({id:r.id,topic:i,error:l,encodeOpts:p,rpcOpts:Ge.wc_sessionAuthenticate.autoReject,appLink:u})}}),O(this,"addSessionRequestToSessionRequestQueue",s=>{this.sessionRequestQueue.queue.push(s)}),O(this,"cleanupAfterResponse",s=>{this.deletePendingSessionRequest(s.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=ss.idle,this.processSessionRequestQueue()},F.toMiliseconds(this.requestQueueDelay))}),O(this,"cleanupPendingSentRequestsForTopic",({topic:s,error:n})=>{const i=this.client.core.history.pending;i.length>0&&i.filter(r=>r.topic===s&&r.request.method==="wc_sessionRequest").forEach(r=>{this.events.emit(Ie("session_request",r.request.id),{error:n})})}),O(this,"processSessionRequestQueue",()=>{if(this.sessionRequestQueue.state===ss.active){this.client.logger.info("session request queue is already active.");return}const s=this.sessionRequestQueue.queue[0];if(!s){this.client.logger.info("session request queue is empty.");return}try{this.emitSessionRequest(s)}catch(n){this.client.logger.error(n)}}),O(this,"emitSessionRequest",s=>{if(this.emittedSessionRequests.has(s.id)){this.client.logger.warn({id:s.id},`Skipping emitting \`session_request\` event for duplicate request. id: ${s.id}`);return}this.sessionRequestQueue.state=ss.active,this.emittedSessionRequests.add(s.id),this.client.events.emit("session_request",s)}),O(this,"onPairingCreated",s=>{if(s.methods&&this.expectedPairingMethodMap.set(s.topic,s.methods),s.active)return;const n=this.client.proposal.getAll().find(i=>i.pairingTopic===s.topic);n&&this.onSessionProposeRequest({topic:s.topic,payload:rs("wc_sessionPropose",Ye(ve({},n),{requiredNamespaces:n.requiredNamespaces,optionalNamespaces:n.optionalNamespaces,relays:n.relays,proposer:n.proposer,sessionProperties:n.sessionProperties,scopedProperties:n.scopedProperties}),n.id),attestation:n.attestation,encryptedId:n.encryptedId})}),O(this,"isValidConnect",async s=>{if(!pt(s)){const{message:l}=B("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(s)}`);throw new Error(l)}const{pairingTopic:n,requiredNamespaces:i,optionalNamespaces:r,sessionProperties:o,scopedProperties:a,relays:c}=s;if(He(n)||await this.isValidPairingTopic(n),!S0(c)){const{message:l}=B("MISSING_OR_INVALID",`connect() relays: ${c}`);throw new Error(l)}if(i&&!He(i)&&us(i)!==0){const l="requiredNamespaces are deprecated and are automatically assigned to optionalNamespaces";["fatal","error","silent"].includes(this.client.logger.level)?console.warn(l):this.client.logger.warn(l),this.validateNamespaces(i,"requiredNamespaces")}if(r&&!He(r)&&us(r)!==0&&this.validateNamespaces(r,"optionalNamespaces"),o&&!He(o)&&this.validateSessionProps(o,"sessionProperties"),a&&!He(a)){this.validateSessionProps(a,"scopedProperties");const l=Object.keys(i||{}).concat(Object.keys(r||{}));if(!Object.keys(a).every(d=>l.includes(d.split(":")[0])))throw new Error(`Scoped properties must be a subset of required/optional namespaces, received: ${JSON.stringify(a)}, required/optional namespaces: ${JSON.stringify(l)}`)}}),O(this,"validateNamespaces",(s,n)=>{const i=_0(s,"connect()",n);if(i)throw new Error(i.message)}),O(this,"isValidApprove",async s=>{if(!pt(s))throw new Error(B("MISSING_OR_INVALID",`approve() params: ${s}`).message);const{id:n,namespaces:i,relayProtocol:r,sessionProperties:o,scopedProperties:a}=s;this.checkRecentlyDeleted(n),await this.isValidProposalId(n);const c=this.client.proposal.get(n),l=To(i,"approve()");if(l)throw new Error(l.message);const d=_l(c.requiredNamespaces,i,"approve()");if(d)throw new Error(d.message);if(!Be(r,!0)){const{message:h}=B("MISSING_OR_INVALID",`approve() relayProtocol: ${r}`);throw new Error(h)}if(o&&!He(o)&&this.validateSessionProps(o,"sessionProperties"),a&&!He(a)){this.validateSessionProps(a,"scopedProperties");const h=new Set(Object.keys(i));if(!Object.keys(a).every(u=>h.has(u.split(":")[0])))throw new Error(`Scoped properties must be a subset of approved namespaces, received: ${JSON.stringify(a)}, approved namespaces: ${Array.from(h).join(", ")}`)}}),O(this,"isValidReject",async s=>{if(!pt(s)){const{message:r}=B("MISSING_OR_INVALID",`reject() params: ${s}`);throw new Error(r)}const{id:n,reason:i}=s;if(this.checkRecentlyDeleted(n),await this.isValidProposalId(n),!O0(i)){const{message:r}=B("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(i)}`);throw new Error(r)}}),O(this,"isValidSessionSettleRequest",s=>{if(!pt(s)){const{message:l}=B("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${s}`);throw new Error(l)}const{relay:n,controller:i,namespaces:r,expiry:o}=s;if(!gu(n)){const{message:l}=B("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(l)}const a=E0(i,"onSessionSettleRequest()");if(a)throw new Error(a.message);const c=To(r,"onSessionSettleRequest()");if(c)throw new Error(c.message);if(os(o)){const{message:l}=B("EXPIRED","onSessionSettleRequest()");throw new Error(l)}}),O(this,"isValidUpdate",async s=>{if(!pt(s)){const{message:c}=B("MISSING_OR_INVALID",`update() params: ${s}`);throw new Error(c)}const{topic:n,namespaces:i}=s;this.checkRecentlyDeleted(n),await this.isValidSessionTopic(n);const r=this.client.session.get(n),o=To(i,"update()");if(o)throw new Error(o.message);const a=_l(r.requiredNamespaces,i,"update()");if(a)throw new Error(a.message)}),O(this,"isValidExtend",async s=>{if(!pt(s)){const{message:i}=B("MISSING_OR_INVALID",`extend() params: ${s}`);throw new Error(i)}const{topic:n}=s;this.checkRecentlyDeleted(n),await this.isValidSessionTopic(n)}),O(this,"isValidRequest",async s=>{if(!pt(s)){const{message:c}=B("MISSING_OR_INVALID",`request() params: ${s}`);throw new Error(c)}const{topic:n,request:i,chainId:r,expiry:o}=s;this.checkRecentlyDeleted(n),await this.isValidSessionTopic(n);const{namespaces:a}=this.client.session.get(n);if(!Nl(a,r)){const{message:c}=B("MISSING_OR_INVALID",`request() chainId: ${r}`);throw new Error(c)}if(!k0(i)){const{message:c}=B("MISSING_OR_INVALID",`request() ${JSON.stringify(i)}`);throw new Error(c)}if(!R0(a,r,i.method)){const{message:c}=B("MISSING_OR_INVALID",`request() method: ${i.method}`);throw new Error(c)}this.validateRequestExpiry(o)}),O(this,"isValidRespond",async s=>{var n;if(!pt(s)){const{message:a}=B("MISSING_OR_INVALID",`respond() params: ${s}`);throw new Error(a)}const{topic:i,response:r}=s;try{await this.isValidSessionTopic(i)}catch(a){throw(n=s==null?void 0:s.response)!=null&&n.id&&this.cleanupAfterResponse(s),a}if(!x0(r)){const{message:a}=B("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(r)}`);throw new Error(a)}const o=this.client.pendingRequest.get(r.id);if(o.topic!==i){const{message:a}=B("MISMATCHED_TOPIC",`Request response topic mismatch. reqId: ${r.id}, expected topic: ${o.topic}, received topic: ${i}`);throw new Error(a)}}),O(this,"isValidPing",async s=>{if(!pt(s)){const{message:i}=B("MISSING_OR_INVALID",`ping() params: ${s}`);throw new Error(i)}const{topic:n}=s;await this.isValidSessionOrPairingTopic(n)}),O(this,"isValidEmit",async s=>{if(!pt(s)){const{message:a}=B("MISSING_OR_INVALID",`emit() params: ${s}`);throw new Error(a)}const{topic:n,event:i,chainId:r}=s;await this.isValidSessionTopic(n);const{namespaces:o}=this.client.session.get(n);if(!Nl(o,r)){const{message:a}=B("MISSING_OR_INVALID",`emit() chainId: ${r}`);throw new Error(a)}if(!P0(i)){const{message:a}=B("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(i)}`);throw new Error(a)}if(!U0(o,r,i.name)){const{message:a}=B("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(i)}`);throw new Error(a)}}),O(this,"isValidDisconnect",async s=>{if(!pt(s)){const{message:i}=B("MISSING_OR_INVALID",`disconnect() params: ${s}`);throw new Error(i)}const{topic:n}=s;await this.isValidSessionOrPairingTopic(n)}),O(this,"isValidAuthenticate",s=>{const{chains:n,uri:i,domain:r,nonce:o}=s;if(!Array.isArray(n)||n.length===0)throw new Error("chains is required and must be a non-empty array");if(!Be(i,!1))throw new Error("uri is required parameter");if(!Be(r,!1))throw new Error("domain is required parameter");if(!Be(o,!1))throw new Error("nonce is required parameter");if([...new Set(n.map(c=>_s(c).namespace))].length>1)throw new Error("Multi-namespace requests are not supported. Please request single namespace only.");const{namespace:a}=_s(n[0]);if(a!=="eip155")throw new Error("Only eip155 namespace is supported for authenticated sessions. Please use .connect() for non-eip155 chains.")}),O(this,"getVerifyContext",async s=>{const{attestationId:n,hash:i,encryptedId:r,metadata:o,transportType:a}=s,c={verified:{verifyUrl:o.verifyUrl||ki,validation:"UNKNOWN",origin:o.url||""}};try{if(a===ke.link_mode){const d=this.getAppLinkIfEnabled(o,a);return c.verified.validation=d&&new URL(d).origin===new URL(o.url).origin?"VALID":"INVALID",c}const l=await this.client.core.verify.resolve({attestationId:n,hash:i,encryptedId:r,verifyUrl:o.verifyUrl});l&&(c.verified.origin=l.origin,c.verified.isScam=l.isScam,c.verified.validation=l.origin===new URL(o.url).origin?"VALID":"INVALID")}catch(l){this.client.logger.warn(l)}return this.client.logger.debug(`Verify context: ${JSON.stringify(c)}`),c}),O(this,"validateSessionProps",(s,n)=>{Object.values(s).forEach((i,r)=>{if(i==null){const{message:o}=B("MISSING_OR_INVALID",`${n} must contain an existing value for each key. Received: ${i} for key ${Object.keys(s)[r]}`);throw new Error(o)}})}),O(this,"getPendingAuthRequest",s=>{const n=this.client.auth.requests.get(s);return typeof n=="object"?n:void 0}),O(this,"addToRecentlyDeleted",(s,n)=>{if(this.recentlyDeletedMap.set(s,n),this.recentlyDeletedMap.size>=this.recentlyDeletedLimit){let i=0;const r=this.recentlyDeletedLimit/2;for(const o of this.recentlyDeletedMap.keys()){if(i++>=r)break;this.recentlyDeletedMap.delete(o)}}}),O(this,"checkRecentlyDeleted",s=>{const n=this.recentlyDeletedMap.get(s);if(n){const{message:i}=B("MISSING_OR_INVALID",`Record was recently deleted - ${n}: ${s}`);throw new Error(i)}}),O(this,"isLinkModeEnabled",(s,n)=>{var i,r,o,a,c,l,d,h,u;return!s||n!==ke.link_mode?!1:((r=(i=this.client.metadata)==null?void 0:i.redirect)==null?void 0:r.linkMode)===!0&&((a=(o=this.client.metadata)==null?void 0:o.redirect)==null?void 0:a.universal)!==void 0&&((l=(c=this.client.metadata)==null?void 0:c.redirect)==null?void 0:l.universal)!==""&&((d=s==null?void 0:s.redirect)==null?void 0:d.universal)!==void 0&&((h=s==null?void 0:s.redirect)==null?void 0:h.universal)!==""&&((u=s==null?void 0:s.redirect)==null?void 0:u.linkMode)===!0&&this.client.core.linkModeSupportedApps.includes(s.redirect.universal)&&typeof(global==null?void 0:global.Linking)<"u"}),O(this,"getAppLinkIfEnabled",(s,n)=>{var i;return this.isLinkModeEnabled(s,n)?(i=s==null?void 0:s.redirect)==null?void 0:i.universal:void 0}),O(this,"handleLinkModeMessage",({url:s})=>{if(!s||!s.includes("wc_ev")||!s.includes("topic"))return;const n=Lc(s,"topic")||"",i=decodeURIComponent(Lc(s,"wc_ev")||""),r=this.client.session.keys.includes(n);r&&this.client.session.update(n,{transportType:ke.link_mode}),this.client.core.dispatchEnvelope({topic:n,message:i,sessionExists:r})}),O(this,"registerLinkModeListeners",async()=>{var s;if(Ga()||Qs()&&(s=this.client.metadata.redirect)!=null&&s.linkMode){const n=global==null?void 0:global.Linking;if(typeof n<"u"){n.addEventListener("url",this.handleLinkModeMessage,this.client.name);const i=await n.getInitialURL();i&&setTimeout(()=>{this.handleLinkModeMessage({url:i})},50)}}}),O(this,"getTVFApproveParams",s=>{try{const n=pu(s.namespaces),i=a0(s.namespaces),r=c0(s.namespaces),o=s.sessionProperties,a=s.scopedProperties;return{approvedChains:n,approvedMethods:i,approvedEvents:r,sessionProperties:o,scopedProperties:a}}catch(n){return this.client.logger.warn(n,"Error getting TVF approve params"),{}}}),O(this,"getTVFParams",(s,n,i)=>{var r,o,a;if(!((r=n.request)!=null&&r.method))return{};const c={correlationId:s,rpcMethods:[n.request.method],chainId:n.chainId};try{const l=this.extractTxHashesFromResult(n.request,i);c.txHashes=l,c.contractAddresses=this.isValidContractData(n.request.params)?[(a=(o=n.request.params)==null?void 0:o[0])==null?void 0:a.to]:[]}catch(l){this.client.logger.warn(l,"Error getting TVF params")}return c}),O(this,"isValidContractData",s=>{var n;if(!s)return!1;try{const i=(s==null?void 0:s.data)||((n=s==null?void 0:s[0])==null?void 0:n.data);if(!i.startsWith("0x"))return!1;const r=i.slice(2);return/^[0-9a-fA-F]*$/.test(r)?r.length%2===0:!1}catch{}return!1}),O(this,"extractTxHashesFromResult",(s,n)=>{var i;try{if(!n)return[];const r=s.method,o=Fv[r];if(r==="sui_signTransaction")return[Jm(n.transactionBytes)];if(r==="near_signTransaction")return[Kc(n)];if(r==="near_signTransactions")return n.map(c=>Kc(c));if(r==="xrpl_signTransactionFor"||r==="xrpl_signTransaction")return[(i=n.tx_json)==null?void 0:i.hash];if(r==="polkadot_signTransaction")return[Z0({transaction:s.params.transactionPayload,signature:n.signature})];if(r==="algo_signTxn")return Ts(n)?n.map(c=>Vc(c)):[Vc(n)];if(r==="cosmos_signDirect")return[Zm(n)];if(r==="wallet_sendCalls")return Qm(n);if(typeof n=="string")return[n];const a=n[o.key];if(Ts(a))return r==="solana_signAllTransactions"?a.map(c=>Ym(c)):a;if(typeof a=="string")return[a]}catch(r){this.client.logger.warn(r,"Error extracting tx hashes from result")}return[]})}async processPendingMessageEvents(){try{const e=this.client.session.keys,s=this.client.core.relayer.messages.getWithoutAck(e);for(const[n,i]of Object.entries(s))for(const r of i)try{await this.onProviderMessageEvent({topic:n,message:r,publishedAt:Date.now()})}catch{this.client.logger.warn(`Error processing pending message event for topic: ${n}, message: ${r}`)}}catch(e){this.client.logger.warn(e,"processPendingMessageEvents failed")}}isInitialized(){if(!this.initialized){const{message:e}=B("NOT_INITIALIZED",this.name);throw new Error(e)}}async confirmOnlineStateOrThrow(){await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(Me.message,e=>{this.onProviderMessageEvent(e)})}async onRelayMessage(e){const{topic:s,message:n,attestation:i,transportType:r}=e,{publicKey:o}=this.client.auth.authKeys.keys.includes(_r)?this.client.auth.authKeys.get(_r):{publicKey:void 0};try{const a=await this.client.core.crypto.decode(s,n,{receiverPublicKey:o,encoding:r===ke.link_mode?Hs:gt});Fa(a)?(this.client.core.history.set(s,a),await this.onRelayEventRequest({topic:s,payload:a,attestation:i,transportType:r,encryptedId:Dt(n)})):Wa(a)?(await this.client.core.history.resolve(a),await this.onRelayEventResponse({topic:s,payload:a,transportType:r}),this.client.core.history.delete(s,a.id)):(this.client.logger.error(`onRelayMessage() -> unknown payload: ${JSON.stringify(a)}`),await this.onRelayEventUnknownPayload({topic:s,payload:a,transportType:r})),await this.client.core.relayer.messages.ack(s,n)}catch(a){this.client.logger.error(`onRelayMessage() -> failed to process an inbound message: ${n}`),this.client.logger.error(a)}}registerExpirerEvents(){this.client.core.expirer.on($t.expired,async e=>{const{topic:s,id:n}=fh(e.target);if(n&&this.client.pendingRequest.keys.includes(n))return await this.deletePendingSessionRequest(n,B("EXPIRED"),!0);if(n&&this.client.auth.requests.keys.includes(n))return await this.deletePendingAuthRequest(n,B("EXPIRED"),!0);s?this.client.session.keys.includes(s)&&(await this.deleteSession({topic:s,expirerHasDeleted:!0}),this.client.events.emit("session_expire",{topic:s})):n&&(await this.deleteProposal(n,!0),this.client.events.emit("proposal_expire",{id:n}))})}registerPairingEvents(){this.client.core.pairing.events.on(hn.create,e=>this.onPairingCreated(e)),this.client.core.pairing.events.on(hn.delete,e=>{this.addToRecentlyDeleted(e.topic,"pairing")})}isValidPairingTopic(e){if(!Be(e,!1)){const{message:s}=B("MISSING_OR_INVALID",`pairing topic should be a string: ${e}`);throw new Error(s)}if(!this.client.core.pairing.pairings.keys.includes(e)){const{message:s}=B("NO_MATCHING_KEY",`pairing topic doesn't exist: ${e}`);throw new Error(s)}if(os(this.client.core.pairing.pairings.get(e).expiry)){const{message:s}=B("EXPIRED",`pairing topic: ${e}`);throw new Error(s)}}async isValidSessionTopic(e){if(!Be(e,!1)){const{message:s}=B("MISSING_OR_INVALID",`session topic should be a string: ${e}`);throw new Error(s)}if(this.checkRecentlyDeleted(e),!this.client.session.keys.includes(e)){const{message:s}=B("NO_MATCHING_KEY",`session topic doesn't exist: ${e}`);throw new Error(s)}if(os(this.client.session.get(e).expiry)){await this.deleteSession({topic:e});const{message:s}=B("EXPIRED",`session topic: ${e}`);throw new Error(s)}if(!this.client.core.crypto.keychain.has(e)){const{message:s}=B("MISSING_OR_INVALID",`session topic does not exist in keychain: ${e}`);throw await this.deleteSession({topic:e}),new Error(s)}}async isValidSessionOrPairingTopic(e){if(this.checkRecentlyDeleted(e),this.client.session.keys.includes(e))await this.isValidSessionTopic(e);else if(this.client.core.pairing.pairings.keys.includes(e))this.isValidPairingTopic(e);else if(Be(e,!1)){const{message:s}=B("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${e}`);throw new Error(s)}else{const{message:s}=B("MISSING_OR_INVALID",`session or pairing topic should be a string: ${e}`);throw new Error(s)}}async isValidProposalId(e){if(!T0(e)){const{message:s}=B("MISSING_OR_INVALID",`proposal id should be a number: ${e}`);throw new Error(s)}if(!this.client.proposal.keys.includes(e)){const{message:s}=B("NO_MATCHING_KEY",`proposal id doesn't exist: ${e}`);throw new Error(s)}if(os(this.client.proposal.get(e).expiryTimestamp)){await this.deleteProposal(e);const{message:s}=B("EXPIRED",`proposal id: ${e}`);throw new Error(s)}}validateRequestExpiry(e){if(e&&!L0(e,Uo)){const{message:s}=B("MISSING_OR_INVALID",`request() expiry: ${e}. Expiry must be a number (in seconds) between ${Uo.min} and ${Uo.max}`);throw new Error(s)}}}class e1 extends Pn{constructor(e,s){super(e,s,Lv,oc),this.core=e,this.logger=s}}let t1=class extends Pn{constructor(e,s){super(e,s,Mv,oc),this.core=e,this.logger=s}};class s1 extends Pn{constructor(e,s){super(e,s,Wv,oc,n=>n.id),this.core=e,this.logger=s}}class n1 extends Pn{constructor(e,s){super(e,s,Kv,oo,()=>_r),this.core=e,this.logger=s}}class i1 extends Pn{constructor(e,s){super(e,s,Vv,oo),this.core=e,this.logger=s}}class r1 extends Pn{constructor(e,s){super(e,s,zv,oo,n=>n.id),this.core=e,this.logger=s}}var o1=Object.defineProperty,a1=(t,e,s)=>e in t?o1(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,$o=(t,e,s)=>a1(t,typeof e!="symbol"?e+"":e,s);class c1{constructor(e,s){this.core=e,this.logger=s,$o(this,"authKeys"),$o(this,"pairingTopics"),$o(this,"requests"),this.authKeys=new n1(this.core,this.logger),this.pairingTopics=new i1(this.core,this.logger),this.requests=new r1(this.core,this.logger)}async init(){await this.authKeys.init(),await this.pairingTopics.init(),await this.requests.init()}}var l1=Object.defineProperty,d1=(t,e,s)=>e in t?l1(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,me=(t,e,s)=>d1(t,typeof e!="symbol"?e+"":e,s);class ac extends zf{constructor(e){super(e),me(this,"protocol",Ru),me(this,"version",Uu),me(this,"name",Ro.name),me(this,"metadata"),me(this,"core"),me(this,"logger"),me(this,"events",new Sn.EventEmitter),me(this,"engine"),me(this,"session"),me(this,"proposal"),me(this,"pendingRequest"),me(this,"auth"),me(this,"signConfig"),me(this,"on",(n,i)=>this.events.on(n,i)),me(this,"once",(n,i)=>this.events.once(n,i)),me(this,"off",(n,i)=>this.events.off(n,i)),me(this,"removeListener",(n,i)=>this.events.removeListener(n,i)),me(this,"removeAllListeners",n=>this.events.removeAllListeners(n)),me(this,"connect",async n=>{try{return await this.engine.connect(n)}catch(i){throw this.logger.error(i.message),i}}),me(this,"pair",async n=>{try{return await this.engine.pair(n)}catch(i){throw this.logger.error(i.message),i}}),me(this,"approve",async n=>{try{return await this.engine.approve(n)}catch(i){throw this.logger.error(i.message),i}}),me(this,"reject",async n=>{try{return await this.engine.reject(n)}catch(i){throw this.logger.error(i.message),i}}),me(this,"update",async n=>{try{return await this.engine.update(n)}catch(i){throw this.logger.error(i.message),i}}),me(this,"extend",async n=>{try{return await this.engine.extend(n)}catch(i){throw this.logger.error(i.message),i}}),me(this,"request",async n=>{try{return await this.engine.request(n)}catch(i){throw this.logger.error(i.message),i}}),me(this,"respond",async n=>{try{return await this.engine.respond(n)}catch(i){throw this.logger.error(i.message),i}}),me(this,"ping",async n=>{try{return await this.engine.ping(n)}catch(i){throw this.logger.error(i.message),i}}),me(this,"emit",async n=>{try{return await this.engine.emit(n)}catch(i){throw this.logger.error(i.message),i}}),me(this,"disconnect",async n=>{try{return await this.engine.disconnect(n)}catch(i){throw this.logger.error(i.message),i}}),me(this,"find",n=>{try{return this.engine.find(n)}catch(i){throw this.logger.error(i.message),i}}),me(this,"getPendingSessionRequests",()=>{try{return this.engine.getPendingSessionRequests()}catch(n){throw this.logger.error(n.message),n}}),me(this,"authenticate",async(n,i)=>{try{return await this.engine.authenticate(n,i)}catch(r){throw this.logger.error(r.message),r}}),me(this,"formatAuthMessage",n=>{try{return this.engine.formatAuthMessage(n)}catch(i){throw this.logger.error(i.message),i}}),me(this,"approveSessionAuthenticate",async n=>{try{return await this.engine.approveSessionAuthenticate(n)}catch(i){throw this.logger.error(i.message),i}}),me(this,"rejectSessionAuthenticate",async n=>{try{return await this.engine.rejectSessionAuthenticate(n)}catch(i){throw this.logger.error(i.message),i}}),this.name=(e==null?void 0:e.name)||Ro.name,this.metadata=jg(e==null?void 0:e.metadata),this.signConfig=e==null?void 0:e.signConfig;const s=rc({logger:(e==null?void 0:e.logger)||Ro.logger,name:this.name});this.logger=s,this.core=(e==null?void 0:e.core)||new Dv(e),this.session=new t1(this.core,this.logger),this.proposal=new e1(this.core,this.logger),this.pendingRequest=new s1(this.core,this.logger),this.engine=new Qv(this),this.auth=new c1(this.core,this.logger)}static async init(e){const s=new ac(e);return await s.initialize(),s}get context(){return Ot(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.auth.init(),await this.engine.init(),this.logger.info("SignClient Initialization Success")}catch(e){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(e.message),e}}}const h1=ac;function cc(t){return t==null||typeof t!="object"&&typeof t!="function"}function Du(t){return Object.getOwnPropertySymbols(t).filter(e=>Object.prototype.propertyIsEnumerable.call(t,e))}function Lu(t){return t==null?t===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(t)}const u1="[object RegExp]",Mu="[object String]",Bu="[object Number]",Fu="[object Boolean]",Wu="[object Arguments]",p1="[object Symbol]",f1="[object Date]",g1="[object Map]",m1="[object Set]",y1="[object Array]",w1="[object ArrayBuffer]",b1="[object Object]",E1="[object DataView]",C1="[object Uint8Array]",v1="[object Uint8ClampedArray]",A1="[object Uint16Array]",I1="[object Uint32Array]",N1="[object Int8Array]",_1="[object Int16Array]",S1="[object Int32Array]",T1="[object Float32Array]",O1="[object Float64Array]";function lc(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function k1(t,e){return Gn(t,void 0,t,new Map,e)}function Gn(t,e,s,n=new Map,i=void 0){const r=i==null?void 0:i(t,e,s,n);if(r!=null)return r;if(cc(t))return t;if(n.has(t))return n.get(t);if(Array.isArray(t)){const o=new Array(t.length);n.set(t,o);for(let a=0;a<t.length;a++)o[a]=Gn(t[a],a,s,n,i);return Object.hasOwn(t,"index")&&(o.index=t.index),Object.hasOwn(t,"input")&&(o.input=t.input),o}if(t instanceof Date)return new Date(t.getTime());if(t instanceof RegExp){const o=new RegExp(t.source,t.flags);return o.lastIndex=t.lastIndex,o}if(t instanceof Map){const o=new Map;n.set(t,o);for(const[a,c]of t)o.set(a,Gn(c,a,s,n,i));return o}if(t instanceof Set){const o=new Set;n.set(t,o);for(const a of t)o.add(Gn(a,void 0,s,n,i));return o}if(typeof Buffer<"u"&&Buffer.isBuffer(t))return t.subarray();if(lc(t)){const o=new(Object.getPrototypeOf(t)).constructor(t.length);n.set(t,o);for(let a=0;a<t.length;a++)o[a]=Gn(t[a],a,s,n,i);return o}if(t instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer)return t.slice(0);if(t instanceof DataView){const o=new DataView(t.buffer.slice(0),t.byteOffset,t.byteLength);return n.set(t,o),un(o,t,s,n,i),o}if(typeof File<"u"&&t instanceof File){const o=new File([t],t.name,{type:t.type});return n.set(t,o),un(o,t,s,n,i),o}if(t instanceof Blob){const o=new Blob([t],{type:t.type});return n.set(t,o),un(o,t,s,n,i),o}if(t instanceof Error){const o=new t.constructor;return n.set(t,o),o.message=t.message,o.name=t.name,o.stack=t.stack,o.cause=t.cause,un(o,t,s,n,i),o}if(typeof t=="object"&&x1(t)){const o=Object.create(Object.getPrototypeOf(t));return n.set(t,o),un(o,t,s,n,i),o}return t}function un(t,e,s=t,n,i){const r=[...Object.keys(e),...Du(e)];for(let o=0;o<r.length;o++){const a=r[o],c=Object.getOwnPropertyDescriptor(t,a);(c==null||c.writable)&&(t[a]=Gn(e[a],a,s,n,i))}}function x1(t){switch(Lu(t)){case Wu:case y1:case w1:case E1:case Fu:case f1:case T1:case O1:case N1:case _1:case S1:case g1:case Bu:case b1:case u1:case m1:case Mu:case p1:case C1:case v1:case A1:case I1:return!0;default:return!1}}function P1(t,e){return k1(t,(s,n,i,r)=>{if(typeof t=="object")switch(Object.prototype.toString.call(t)){case Bu:case Mu:case Fu:{const o=new t.constructor(t==null?void 0:t.valueOf());return un(o,t),o}case Wu:{const o={};return un(o,t),o.length=t.length,o[Symbol.iterator]=t[Symbol.iterator],o}default:return}})}function sd(t){return P1(t)}function nd(t){return t!==null&&typeof t=="object"&&Lu(t)==="[object Arguments]"}function id(t){return typeof t=="object"&&t!==null}function R1(){}function U1(t){return lc(t)}function $1(t){var s;if(typeof t!="object"||t==null)return!1;if(Object.getPrototypeOf(t)===null)return!0;if(Object.prototype.toString.call(t)!=="[object Object]"){const n=t[Symbol.toStringTag];return n==null||!((s=Object.getOwnPropertyDescriptor(t,Symbol.toStringTag))!=null&&s.writable)?!1:t.toString()===`[object ${n}]`}let e=t;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e}function D1(t){if(cc(t))return t;if(Array.isArray(t)||lc(t)||t instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer)return t.slice(0);const e=Object.getPrototypeOf(t),s=e.constructor;if(t instanceof Date||t instanceof Map||t instanceof Set)return new s(t);if(t instanceof RegExp){const n=new s(t);return n.lastIndex=t.lastIndex,n}if(t instanceof DataView)return new s(t.buffer.slice(0));if(t instanceof Error){const n=new s(t.message);return n.stack=t.stack,n.name=t.name,n.cause=t.cause,n}if(typeof File<"u"&&t instanceof File)return new s([t],t.name,{type:t.type,lastModified:t.lastModified});if(typeof t=="object"){const n=Object.create(e);return Object.assign(n,t)}return t}function L1(t,...e){const s=e.slice(0,-1),n=e[e.length-1];let i=t;for(let r=0;r<s.length;r++){const o=s[r];i=ka(i,o,n,new Map)}return i}function ka(t,e,s,n){var r;if(cc(t)&&(t=Object(t)),e==null||typeof e!="object")return t;if(n.has(e))return D1(n.get(e));if(n.set(e,t),Array.isArray(e)){e=e.slice();for(let o=0;o<e.length;o++)e[o]=(r=e[o])!=null?r:void 0}const i=[...Object.keys(e),...Du(e)];for(let o=0;o<i.length;o++){const a=i[o];let c=e[a],l=t[a];if(nd(c)&&(c={...c}),nd(l)&&(l={...l}),typeof Buffer<"u"&&Buffer.isBuffer(c)&&(c=sd(c)),Array.isArray(c))if(typeof l=="object"&&l!=null){const h=[],u=Reflect.ownKeys(l);for(let p=0;p<u.length;p++){const m=u[p];h[m]=l[m]}l=h}else l=[];const d=s(l,c,a,t,e,n);d!=null?t[a]=d:Array.isArray(c)||id(l)&&id(c)?t[a]=ka(l,c,s,n):l==null&&$1(c)?t[a]=ka({},c,s,n):l==null&&U1(c)?t[a]=sd(c):(l===void 0||c!==void 0)&&(t[a]=c)}return t}function M1(t,...e){return L1(t,...e,R1)}const rd="error",B1="wss://relay.walletconnect.org",F1="wc",ju="universal_provider",pr=`${F1}@2:${ju}:`,qu="https://rpc.walletconnect.org/v1/",Hu="generic",W1=`${qu}bundler`,Xn="call_status",j1=86400,dc={DEFAULT_CHAIN_CHANGED:"default_chain_changed"};var q1=Object.defineProperty,H1=Object.defineProperties,K1=Object.getOwnPropertyDescriptors,od=Object.getOwnPropertySymbols,V1=Object.prototype.hasOwnProperty,z1=Object.prototype.propertyIsEnumerable,ad=(t,e,s)=>e in t?q1(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,fr=(t,e)=>{for(var s in e||(e={}))V1.call(e,s)&&ad(t,s,e[s]);if(od)for(var s of od(e))z1.call(e,s)&&ad(t,s,e[s]);return t},G1=(t,e)=>H1(t,K1(e));function Ku(t,e,s){var n;const i=_s(t);return((n=e.rpcMap)==null?void 0:n[i.reference])||`${qu}?chainId=${i.namespace}:${i.reference}&projectId=${s}`}function Y1(t){return t.includes(":")?t.split(":")[1]:t}function Vu(t){return t.map(e=>`${e.split(":")[0]}:${e.split(":")[1]}`)}function J1(t,e){const s=Object.keys(e.namespaces).filter(i=>i.includes(t));if(!s.length)return[];const n=[];return s.forEach(i=>{const r=e.namespaces[i].accounts;n.push(...r)}),n}function cd(t){return Object.fromEntries(Object.entries(t).filter(([e,s])=>{var n,i;return((n=s==null?void 0:s.chains)==null?void 0:n.length)&&((i=s==null?void 0:s.chains)==null?void 0:i.length)>0}))}function gr(t={},e={}){const s=cd(ld(t)),n=cd(ld(e));return M1(s,n)}function ld(t){var e,s,n,i,r;const o={};if(!us(t))return o;for(const[a,c]of Object.entries(t)){const l=io(a)?[a]:c.chains,d=c.methods||[],h=c.events||[],u=c.rpcMap||{},p=zn(a);o[p]=G1(fr(fr({},o[p]),c),{chains:hs(l,(e=o[p])==null?void 0:e.chains),methods:hs(d,(s=o[p])==null?void 0:s.methods),events:hs(h,(n=o[p])==null?void 0:n.events)}),(us(u)||us(((i=o[p])==null?void 0:i.rpcMap)||{}))&&(o[p].rpcMap=fr(fr({},u),(r=o[p])==null?void 0:r.rpcMap))}return o}function dd(t){return t.includes(":")?t.split(":")[2]:t}function hd(t){const e={};for(const[s,n]of Object.entries(t)){const i=n.methods||[],r=n.events||[],o=n.accounts||[],a=io(s)?[s]:n.chains?n.chains:Vu(n.accounts);e[s]={chains:a,methods:i,events:r,accounts:o}}return e}function Do(t){return typeof t=="number"?t:t.includes("0x")?parseInt(t,16):(t=t.includes(":")?t.split(":")[1]:t,isNaN(Number(t))?t:Number(t))}function X1(t){try{const e=JSON.parse(t);return typeof e=="object"&&e!==null&&!Array.isArray(e)}catch{return!1}}const zu={},Zn=t=>zu[t],Lo=(t,e)=>{zu[t]=e};var Z1=Object.defineProperty,ud=Object.getOwnPropertySymbols,Q1=Object.prototype.hasOwnProperty,eA=Object.prototype.propertyIsEnumerable,pd=(t,e,s)=>e in t?Z1(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,fd=(t,e)=>{for(var s in e||(e={}))Q1.call(e,s)&&pd(t,s,e[s]);if(ud)for(var s of ud(e))eA.call(e,s)&&pd(t,s,e[s]);return t};const gd="eip155",tA=["atomic","flow-control","paymasterService","sessionKeys","auxiliaryFunds"],sA=t=>t&&t.startsWith("0x")?BigInt(t).toString(10):t,Mo=t=>t&&t.startsWith("0x")?t:`0x${BigInt(t).toString(16)}`,md=t=>Object.keys(t).filter(e=>tA.includes(e)).reduce((e,s)=>(e[s]=nA(t[s]),e),{}),nA=t=>typeof t=="string"&&X1(t)?JSON.parse(t):t,iA=(t,e,s)=>{const{sessionProperties:n={},scopedProperties:i={}}=t,r={};if(!us(i)&&!us(n))return;const o=md(n);for(const a of s){const c=sA(a);if(!c)continue;r[Mo(c)]=o;const l=i==null?void 0:i[`${gd}:${c}`];if(l){const d=l==null?void 0:l[`${gd}:${c}:${e}`];r[Mo(c)]=fd(fd({},r[Mo(c)]),md(d||l))}}for(const[a,c]of Object.entries(r))Object.keys(c).length===0&&delete r[a];return Object.keys(r).length>0?r:void 0};var rA=Object.defineProperty,oA=(t,e,s)=>e in t?rA(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,aA=(t,e,s)=>oA(t,e+"",s);let Bo;class hc{constructor(e){aA(this,"storage"),this.storage=e}async getItem(e){return await this.storage.getItem(e)}async setItem(e,s){return await this.storage.setItem(e,s)}async removeItem(e){return await this.storage.removeItem(e)}static getStorage(e){return Bo||(Bo=new hc(e)),Bo}}var cA=Object.defineProperty,lA=Object.defineProperties,dA=Object.getOwnPropertyDescriptors,yd=Object.getOwnPropertySymbols,hA=Object.prototype.hasOwnProperty,uA=Object.prototype.propertyIsEnumerable,wd=(t,e,s)=>e in t?cA(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,pA=(t,e)=>{for(var s in e||(e={}))hA.call(e,s)&&wd(t,s,e[s]);if(yd)for(var s of yd(e))uA.call(e,s)&&wd(t,s,e[s]);return t},fA=(t,e)=>lA(t,dA(e));async function gA(t,e){const s=_s(t.result.capabilities.caip345.caip2),n=t.result.capabilities.caip345.transactionHashes,i=await Promise.allSettled(n.map(h=>mA(s.reference,h,e))),r=i.filter(h=>h.status==="fulfilled").map(h=>h.value).filter(h=>h);i.filter(h=>h.status==="rejected").forEach(h=>console.warn("Failed to fetch transaction receipt:",h.reason));const o=!r.length||r.some(h=>!h),a=r.every(h=>(h==null?void 0:h.status)==="0x1"),c=r.every(h=>(h==null?void 0:h.status)==="0x0"),l=r.some(h=>(h==null?void 0:h.status)==="0x0");let d;return o?d=100:a?d=200:c?d=500:l&&(d=600),{id:t.result.id,version:t.request.version,atomic:t.request.atomicRequired,chainId:t.request.chainId,capabilities:t.result.capabilities,receipts:r,status:d}}async function mA(t,e,s){return await s(parseInt(t)).request(rs("eth_getTransactionReceipt",[e]))}async function yA({sendCalls:t,storage:e}){const s=await e.getItem(Xn);await e.setItem(Xn,fA(pA({},s),{[t.result.id]:{request:t.request,result:t.result,expiry:Le(j1)}}))}async function wA({resultId:t,storage:e}){const s=await e.getItem(Xn);if(s){delete s[t],await e.setItem(Xn,s);for(const n in s)os(s[n].expiry)&&delete s[n];await e.setItem(Xn,s)}}async function bA({resultId:t,storage:e}){const s=await e.getItem(Xn),n=s==null?void 0:s[t];if(n&&!os(n.expiry))return n;await wA({resultId:t,storage:e})}var EA=Object.defineProperty,CA=Object.defineProperties,vA=Object.getOwnPropertyDescriptors,bd=Object.getOwnPropertySymbols,AA=Object.prototype.hasOwnProperty,IA=Object.prototype.propertyIsEnumerable,xa=(t,e,s)=>e in t?EA(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,Fo=(t,e)=>{for(var s in e||(e={}))AA.call(e,s)&&xa(t,s,e[s]);if(bd)for(var s of bd(e))IA.call(e,s)&&xa(t,s,e[s]);return t},Wo=(t,e)=>CA(t,vA(e)),on=(t,e,s)=>xa(t,typeof e!="symbol"?e+"":e,s);class NA{constructor(e){on(this,"name","eip155"),on(this,"client"),on(this,"chainId"),on(this,"namespace"),on(this,"httpProviders"),on(this,"events"),on(this,"storage"),this.namespace=e.namespace,this.events=Zn("events"),this.client=Zn("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain()),this.storage=hc.getStorage(this.client.core.storage)}async request(e){switch(e.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(e);case"eth_chainId":return parseInt(this.getDefaultChain());case"wallet_getCapabilities":return await this.getCapabilities(e);case"wallet_getCallsStatus":return await this.getCallStatus(e);case"wallet_sendCalls":return await this.sendCalls(e)}return this.namespace.methods.includes(e.request.method)?await this.client.request(e):this.getHttpProvider().request(e.request)}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}setDefaultChain(e,s){this.httpProviders[e]||this.setHttpProvider(parseInt(e),s);const n=this.chainId;this.chainId=parseInt(e),this.events.emit(dc.DEFAULT_CHAIN_CHANGED,{currentCaipChainId:`${this.name}:${e}`,previousCaipChainId:`${this.name}:${n}`})}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}createHttpProvider(e,s){const n=s||Ku(`${this.name}:${e}`,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${e}`);return new Ba(new Kd(n,Zn("disableProviderPing")))}setHttpProvider(e,s){const n=this.createHttpProvider(e,s);n&&(this.httpProviders[e]=n)}createHttpProviders(){const e={};return this.namespace.chains.forEach(s=>{var n;const i=parseInt(Y1(s));e[i]=this.createHttpProvider(i,(n=this.namespace.rpcMap)==null?void 0:n[s])}),e}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(s=>s.split(":")[1]===this.chainId.toString()).map(s=>s.split(":")[2]))]:[]}getHttpProvider(e){const s=e||this.chainId;return this.httpProviders[s]||(this.httpProviders=Wo(Fo({},this.httpProviders),{[s]:this.createHttpProvider(s)}),this.httpProviders[s])}async handleSwitchChain(e){var s,n;let i=e.request.params?(s=e.request.params[0])==null?void 0:s.chainId:"0x0";i=i.startsWith("0x")?i:`0x${i}`;const r=parseInt(i,16);if(this.isChainApproved(r))this.setDefaultChain(`${r}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:e.topic,request:{method:e.request.method,params:[{chainId:i}]},chainId:(n=this.namespace.chains)==null?void 0:n[0]}),this.setDefaultChain(`${r}`);else throw new Error(`Failed to switch to chain 'eip155:${r}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(e){return this.namespace.chains.includes(`${this.name}:${e}`)}async getCapabilities(e){var s,n,i,r,o;const a=(n=(s=e.request)==null?void 0:s.params)==null?void 0:n[0],c=((r=(i=e.request)==null?void 0:i.params)==null?void 0:r[1])||[];if(!a)throw new Error("Missing address parameter in `wallet_getCapabilities` request");const l=this.client.session.get(e.topic),d=((o=l==null?void 0:l.sessionProperties)==null?void 0:o.capabilities)||{},h=c.length>0?c.join(","):`0x${this.chainId.toString(16)}`,u=`${a}${h}`,p=d==null?void 0:d[u];if(p)return p;let m;try{m=iA(l,a,c)}catch(g){console.warn("Failed to extract capabilities from session",g)}if(m)return m;const y=await this.client.request(e);try{await this.client.session.update(e.topic,{sessionProperties:Wo(Fo({},l.sessionProperties||{}),{capabilities:Wo(Fo({},d||{}),{[u]:y})})})}catch(g){console.warn("Failed to update session with capabilities",g)}return y}async getCallStatus(e){var s,n,i;const r=this.client.session.get(e.topic),o=(s=r.sessionProperties)==null?void 0:s.bundler_name;if(o){const l=this.getBundlerUrl(e.chainId,o);try{return await this.getUserOperationReceipt(l,e)}catch(d){console.warn("Failed to fetch call status from bundler",d,l)}}const a=(n=r.sessionProperties)==null?void 0:n.bundler_url;if(a)try{return await this.getUserOperationReceipt(a,e)}catch(l){console.warn("Failed to fetch call status from custom bundler",l,a)}const c=await bA({resultId:(i=e.request.params)==null?void 0:i[0],storage:this.storage});if(c)try{return await gA(c,this.getHttpProvider.bind(this))}catch(l){console.warn("Failed to fetch call status from stored send calls",l,c)}if(this.namespace.methods.includes(e.request.method))return await this.client.request(e);throw new Error("Fetching call status not approved by the wallet.")}async getUserOperationReceipt(e,s){var n;const i=new URL(e),r=await fetch(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(rs("eth_getUserOperationReceipt",[(n=s.request.params)==null?void 0:n[0]]))});if(!r.ok)throw new Error(`Failed to fetch user operation receipt - ${r.status}`);return await r.json()}getBundlerUrl(e,s){return`${W1}?projectId=${this.client.core.projectId}&chainId=${e}&bundler=${s}`}async sendCalls(e){var s,n,i;const r=await this.client.request(e),o=(s=e.request.params)==null?void 0:s[0],a=r==null?void 0:r.id,c=(r==null?void 0:r.capabilities)||{},l=(n=c==null?void 0:c.caip345)==null?void 0:n.caip2,d=(i=c==null?void 0:c.caip345)==null?void 0:i.transactionHashes;return!a||!l||!(d!=null&&d.length)||await yA({sendCalls:{request:o,result:r},storage:this.storage}),r}}var _A=Object.defineProperty,SA=(t,e,s)=>e in t?_A(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,jn=(t,e,s)=>SA(t,typeof e!="symbol"?e+"":e,s);class TA{constructor(e){jn(this,"name",Hu),jn(this,"client"),jn(this,"httpProviders"),jn(this,"events"),jn(this,"namespace"),jn(this,"chainId"),this.namespace=e.namespace,this.events=Zn("events"),this.client=Zn("client"),this.chainId=this.getDefaultChain(),this.name=this.getNamespaceName(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace.chains=[...new Set((this.namespace.chains||[]).concat(e.chains||[]))],this.namespace.accounts=[...new Set((this.namespace.accounts||[]).concat(e.accounts||[]))],this.namespace.methods=[...new Set((this.namespace.methods||[]).concat(e.methods||[]))],this.namespace.events=[...new Set((this.namespace.events||[]).concat(e.events||[]))],this.httpProviders=this.createHttpProviders()}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider(e.chainId).request(e.request)}setDefaultChain(e,s){this.httpProviders[e]||this.setHttpProvider(e,s);const n=this.chainId;this.chainId=e,this.events.emit(dc.DEFAULT_CHAIN_CHANGED,{currentCaipChainId:`${this.name}:${e}`,previousCaipChainId:`${this.name}:${n}`})}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getNamespaceName(){const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return _s(e).namespace}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(s=>s.split(":")[1]===this.chainId.toString()).map(s=>s.split(":")[2]))]:[]}createHttpProviders(){var e,s;const n={};return(s=(e=this.namespace)==null?void 0:e.accounts)==null||s.forEach(i=>{var r,o;const a=_s(i),c=(o=(r=this.namespace)==null?void 0:r.rpcMap)==null?void 0:o[`${a.namespace}:${a.reference}`];n[a.reference]=this.createHttpProvider(i,c)}),n}getHttpProvider(e){const s=_s(e).reference,n=this.httpProviders[s];if(typeof n>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return n}setHttpProvider(e,s){const n=this.createHttpProvider(e,s);n&&(this.httpProviders[e]=n)}createHttpProvider(e,s){const n=s||Ku(e,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${e}`);return new Ba(new Kd(n,Zn("disableProviderPing")))}}var OA=Object.defineProperty,kA=Object.defineProperties,xA=Object.getOwnPropertyDescriptors,Ed=Object.getOwnPropertySymbols,PA=Object.prototype.hasOwnProperty,RA=Object.prototype.propertyIsEnumerable,Pa=(t,e,s)=>e in t?OA(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,Ei=(t,e)=>{for(var s in e||(e={}))PA.call(e,s)&&Pa(t,s,e[s]);if(Ed)for(var s of Ed(e))RA.call(e,s)&&Pa(t,s,e[s]);return t},mr=(t,e)=>kA(t,xA(e)),Et=(t,e,s)=>Pa(t,typeof e!="symbol"?e+"":e,s);let UA=class Gu{constructor(e){Et(this,"client"),Et(this,"namespaces"),Et(this,"optionalNamespaces"),Et(this,"sessionProperties"),Et(this,"scopedProperties"),Et(this,"events",new ja),Et(this,"rpcProviders",{}),Et(this,"session"),Et(this,"providerOpts"),Et(this,"logger"),Et(this,"uri"),Et(this,"disableProviderPing",!1),Et(this,"connectParams");var s,n;this.providerOpts=e,this.logger=rc({logger:(s=e.logger)!=null?s:rd,name:(n=this.providerOpts.name)!=null?n:ju}),this.disableProviderPing=(e==null?void 0:e.disableProviderPing)||!1}static async init(e){const s=new Gu(e);return await s.initialize(),s}async request(e,s,n){const[i,r]=this.validateChain(s);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(i).request({request:Ei({},e),chainId:`${i}:${r}`,topic:this.session.topic,expiry:n})}sendAsync(e,s,n,i){const r=new Date().getTime();this.request(e,n,i).then(o=>s(null,$i(r,o))).catch(o=>s(o,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties,scopedProperties:this.scopedProperties}),await this.requestAccounts()}async disconnect(){var e;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(e=this.session)==null?void 0:e.topic,reason:Re("USER_DISCONNECTED")}),await this.cleanup()}async connect(e){if(!this.client)throw new Error("Sign Client not initialized");if(this.connectParams=e,this.setNamespaces(e),this.cleanupPendingPairings(),!e.skipPairing)return await this.pair(e.pairingTopic)}async authenticate(e,s){if(!this.client)throw new Error("Sign Client not initialized");this.setNamespaces(e),await this.cleanupPendingPairings();const{uri:n,response:i}=await this.client.authenticate(e,s);n&&(this.uri=n,this.events.emit("display_uri",n));const r=await i();if(this.session=r.session,this.session){const o=hd(this.session.namespaces);this.namespaces=gr(this.namespaces,o),await this.persist("namespaces",this.namespaces),this.onConnect()}return r}on(e,s){this.events.on(e,s)}once(e,s){this.events.once(e,s)}removeListener(e,s){this.events.removeListener(e,s)}off(e,s){this.events.off(e,s)}get isWalletConnect(){return!0}async pair(e){var s,n;const{uri:i,approval:r}=await this.client.connect({pairingTopic:e,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties,scopedProperties:this.scopedProperties,authentication:(s=this.connectParams)==null?void 0:s.authentication,walletPay:(n=this.connectParams)==null?void 0:n.walletPay});i&&(this.uri=i,this.events.emit("display_uri",i));const o=await r();this.session=o;const a=hd(o.namespaces);return this.namespaces=gr(this.namespaces,a),await this.persist("namespaces",this.namespaces),await this.persist("optionalNamespaces",this.optionalNamespaces),this.onConnect(),this.session}setDefaultChain(e,s){try{if(!this.session)return;const[n,i]=this.validateChain(e);this.getProvider(n).setDefaultChain(i,s)}catch(n){if(!/Please call connect/.test(n.message))throw n}}async cleanupPendingPairings(e={}){try{this.logger.info("Cleaning up inactive pairings...");const s=this.client.pairing.getAll();if(!Ts(s))return;for(const n of s)e.deletePairings?this.client.core.expirer.set(n.topic,0):await this.client.core.relayer.subscriber.unsubscribe(n.topic);this.logger.info(`Inactive pairings cleared: ${s.length}`)}catch(s){this.logger.warn(s,"Failed to cleanup pending pairings")}}abortPairingAttempt(){this.logger.warn("abortPairingAttempt is deprecated. This is now a no-op.")}async checkStorage(){this.namespaces=await this.getFromStore("namespaces")||{},this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.session&&this.createProviders()}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){var e,s;if(this.client=this.providerOpts.client||await h1.init({core:this.providerOpts.core,logger:this.providerOpts.logger||rd,relayUrl:this.providerOpts.relayUrl||B1,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name,customStoragePrefix:this.providerOpts.customStoragePrefix,telemetryEnabled:this.providerOpts.telemetryEnabled}),this.providerOpts.session)try{this.session=this.client.session.get(this.providerOpts.session.topic)}catch(n){throw this.logger.error(n,"Failed to get session"),new Error(`The provided session: ${(s=(e=this.providerOpts)==null?void 0:e.session)==null?void 0:s.topic} doesn't exist in the Sign client`)}else{const n=this.client.session.getAll();this.session=n[0]}this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");const e=[...new Set(Object.keys(this.session.namespaces).map(s=>zn(s)))];Lo("client",this.client),Lo("events",this.events),Lo("disableProviderPing",this.disableProviderPing),e.forEach(s=>{if(!this.session)return;const n=J1(s,this.session);if((n==null?void 0:n.length)===0)return;const i=Vu(n),r=gr(this.namespaces,this.optionalNamespaces),o=mr(Ei({},r[s]),{accounts:n,chains:i});s==="eip155"?this.rpcProviders[s]=new NA({namespace:o}):this.rpcProviders[s]=new TA({namespace:o})})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",e=>{var s;const{topic:n}=e;n===((s=this.session)==null?void 0:s.topic)&&this.events.emit("session_ping",e)}),this.client.on("session_event",e=>{var s;const{params:n,topic:i}=e;if(i!==((s=this.session)==null?void 0:s.topic))return;const{event:r}=n;if(r.name==="accountsChanged"){const o=r.data;o&&Ts(o)&&this.events.emit("accountsChanged",o.map(dd))}else if(r.name==="chainChanged"){const o=n.chainId,a=n.event.data,c=zn(o),l=Do(o)!==Do(a)?`${c}:${Do(a)}`:o;this.onChainChanged({currentCaipChainId:l})}else this.events.emit(r.name,r.data);this.events.emit("session_event",e)}),this.client.on("session_update",({topic:e,params:s})=>{var n,i;if(e!==((n=this.session)==null?void 0:n.topic))return;const{namespaces:r}=s,o=(i=this.client)==null?void 0:i.session.get(e);this.session=mr(Ei({},o),{namespaces:r}),this.onSessionUpdate(),this.events.emit("session_update",{topic:e,params:s})}),this.client.on("session_delete",async e=>{var s;e.topic===((s=this.session)==null?void 0:s.topic)&&(await this.cleanup(),this.events.emit("session_delete",e),this.events.emit("disconnect",mr(Ei({},Re("USER_DISCONNECTED")),{data:e.topic})))}),this.on(dc.DEFAULT_CHAIN_CHANGED,e=>{this.onChainChanged(mr(Ei({},e),{internal:!0}))})}getProvider(e){return this.rpcProviders[e]||this.rpcProviders[Hu]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(e=>{var s;this.getProvider(e).updateNamespace((s=this.session)==null?void 0:s.namespaces[e])})}setNamespaces(e){const{namespaces:s={},optionalNamespaces:n={},sessionProperties:i,scopedProperties:r}=e;this.optionalNamespaces=gr(s,n),this.sessionProperties=i,this.scopedProperties=r}validateChain(e){const[s,n]=(e==null?void 0:e.split(":"))||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[s,n];if(s&&!Object.keys(this.namespaces||{}).map(o=>zn(o)).includes(s))throw new Error(`Namespace '${s}' is not configured. Please call connect() first with namespace config.`);if(s&&n)return[s,n];const i=zn(Object.keys(this.namespaces)[0]),r=this.rpcProviders[i].getDefaultChain();return[i,r]}async requestAccounts(){const[e]=this.validateChain();return await this.getProvider(e).requestAccounts()}async onChainChanged({currentCaipChainId:e,previousCaipChainId:s,internal:n=!1}){if(!this.namespaces)return;const[i,r]=this.validateChain(e);r&&(this.updateNamespaceChain(i,r),n?(this.events.emit("chainChanged",r),this.emitAccountsChangedOnChainChange({namespace:i,currentCaipChainId:e,previousCaipChainId:s})):this.getProvider(i).setDefaultChain(r),await this.persist("namespaces",this.namespaces))}emitAccountsChangedOnChainChange({namespace:e,currentCaipChainId:s,previousCaipChainId:n}){var i,r;try{if(n===s)return;const o=(r=(i=this.session)==null?void 0:i.namespaces[e])==null?void 0:r.accounts;if(!o)return;const a=o.filter(c=>c.includes(`${s}:`)).map(dd);if(!Ts(a))return;this.events.emit("accountsChanged",a)}catch(o){this.logger.warn(o,"Failed to emit accountsChanged on chain change")}}updateNamespaceChain(e,s){if(!this.namespaces)return;const n=this.namespaces[e]?e:`${e}:${s}`,i={chains:[],methods:[],events:[],defaultChain:s};this.namespaces[n]?this.namespaces[n]&&(this.namespaces[n].defaultChain=s):this.namespaces[n]=i}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.connectParams=void 0,this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,await this.deleteFromStore("namespaces"),await this.deleteFromStore("optionalNamespaces"),await this.deleteFromStore("sessionProperties"),this.session=void 0,this.cleanupPendingPairings({deletePairings:!0}),await this.cleanupStorage()}async persist(e,s){var n;const i=((n=this.session)==null?void 0:n.topic)||"";await this.client.core.storage.setItem(`${pr}/${e}${i}`,s)}async getFromStore(e){var s;const n=((s=this.session)==null?void 0:s.topic)||"";return await this.client.core.storage.getItem(`${pr}/${e}${n}`)}async deleteFromStore(e){var s;const n=((s=this.session)==null?void 0:s.topic)||"";await this.client.core.storage.removeItem(`${pr}/${e}${n}`)}async cleanupStorage(){var e;try{if(((e=this.client)==null?void 0:e.session.length)>0)return;const s=await this.client.core.storage.getKeys();for(const n of s)n.startsWith(pr)&&await this.client.core.storage.removeItem(n)}catch(s){this.logger.warn(s,"Failed to cleanup storage")}}};const Cd=2147483648,$A={convertEVMChainIdToCoinType(t){if(t>=Cd)throw new Error("Invalid chainId");return(Cd|t)>>>0}},Pt=xe({suggestions:[],loading:!1}),DA={state:Pt,subscribe(t){return Xe(Pt,()=>t(Pt))},subscribeKey(t,e){return Ze(Pt,t,e)},async resolveName(t){var e,s;try{return await te.lookupEnsName(t)}catch(n){const i=n;throw new Error(((s=(e=i==null?void 0:i.reasons)==null?void 0:e[0])==null?void 0:s.description)||"Error resolving name")}},async isNameRegistered(t){try{return await te.lookupEnsName(t),!0}catch{return!1}},async getSuggestions(t){try{Pt.loading=!0,Pt.suggestions=[];const e=await te.getEnsNameSuggestions(t);return Pt.suggestions=e.suggestions||[],Pt.suggestions}catch(e){const s=Pi.parseEnsApiError(e,"Error fetching name suggestions");throw new Error(s)}finally{Pt.loading=!1}},async getNamesForAddress(t){try{if(!f.state.activeCaipNetwork)return[];const s=k.getEnsFromCacheForAddress(t);if(s)return s;const n=await te.reverseLookupEnsName({address:t});return k.updateEnsCache({address:t,ens:n,timestamp:Date.now()}),n}catch(e){const s=Pi.parseEnsApiError(e,"Error fetching names for address");throw new Error(s)}},async registerName(t){var i;const e=f.state.activeCaipNetwork,s=(i=f.getAccountData(e==null?void 0:e.chainNamespace))==null?void 0:i.address,n=U.getAuthConnector();if(!e)throw new Error("Network not found");if(!s||!n)throw new Error("Address or auth connector not found");Pt.loading=!0;try{const r=JSON.stringify({name:t,attributes:{},timestamp:Math.floor(Date.now()/1e3)});ee.pushTransactionStack({onCancel(){ee.replace("RegisterAccountName")}});const o=await D.signMessage(r);Pt.loading=!1;const a=e.id;if(!a)throw new Error("Network not found");const c=$A.convertEVMChainIdToCoinType(Number(a));await te.registerEnsName({coinType:c,address:s,signature:o,message:r}),f.setAccountProp("profileName",t,e.chainNamespace),k.updateEnsCache({address:s,ens:[{name:t,registered_at:new Date().toISOString(),updated_at:void 0,addresses:{},attributes:[]}],timestamp:Date.now()}),ee.replace("RegisterAccountNameSuccess")}catch(r){const o=Pi.parseEnsApiError(r,`Error registering name ${t}`);throw ee.replace("RegisterAccountName"),new Error(o)}finally{Pt.loading=!1}},validateName(t){return/^[a-zA-Z0-9-]{4,}$/u.test(t)},parseEnsApiError(t,e){var n,i;const s=t;return((i=(n=s==null?void 0:s.reasons)==null?void 0:n[0])==null?void 0:i.description)||e}},Pi=Wt(DA);function Ra(t){try{return new URL(t)}catch{return null}}function LA(t){const e=t.split("/"),s=e.length>0&&e[0]!==void 0?e[0]:"",n=s.lastIndexOf(":");return n===-1?{host:s}:{host:s.slice(0,n),port:s.slice(n+1)}}function MA(t){const e=t.indexOf("://");if(e===-1)return null;const s=t.slice(0,e),n=e+3;let i=t.indexOf("/",n);i===-1&&(i=t.length);const r=t.slice(n,i),o=r.lastIndexOf(":");return o===-1?{scheme:s,host:r}:{scheme:s,host:r.slice(0,o),port:r.slice(o+1)}}function BA(t,e){if(e.includes("://")){const o=Ra(e);return o?o.origin===t:!1}const{host:s,port:n}=LA(e),i=t.indexOf("://");if(i!==-1){const o=i+3;let a=t.indexOf("/",o);a===-1&&(a=t.length);const c=t.slice(o,a);if(n!==void 0)return`${s}:${n}`===c;const l=c.split(":")[0];return s===l}const r=Ra(t);return r?n!==void 0?s===r.hostname&&n===(r.port||void 0):s===r.hostname:!1}function FA(t,e,s){let n=s,i;const r=n.indexOf("://");r!==-1&&(i=n.slice(0,r),n=n.slice(r+3));const o=n.indexOf("/");o!==-1&&(n=n.slice(0,o));let a=n,c;const l=a.lastIndexOf(":");l!==-1&&(c=a.slice(l+1),a=a.slice(0,l));const d=a.split(".");for(const y of d)if(y.includes("*")&&y!=="*")return!1;const h=t.protocol.replace(/:$/u,"");if(i&&i!==h||c!==void 0&&c!=="*"&&c!==t.port)return!1;const u=MA(e),m=(u?u.host:t.hostname).split(".");if(d.length!==m.length)return!1;for(let y=d.length-1;y>=0;y-=1){const g=d[y],w=m[y];if(g!=="*"&&g!==w)return!1}return!0}const WA={ton:["ton_sendMessage","ton_signData"],solana:["solana_signMessage","solana_signTransaction","solana_requestAccounts","solana_getAccounts","solana_signAllTransactions","solana_signAndSendTransaction"],eip155:["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sendTransaction","personal_sign","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode","wallet_getCallsStatus","wallet_showCallsStatus","wallet_sendCalls","wallet_getCapabilities","wallet_grantPermissions","wallet_revokePermissions","wallet_getAssets"],bip122:["sendTransfer","signMessage","signPsbt","getAccountAddresses"]},Ys={RPC_ERROR_CODE:{USER_REJECTED:5e3,USER_REJECTED_METHODS:5002},getMethodsByChainNamespace(t){return WA[t]||[]},createDefaultNamespace(t){return{methods:this.getMethodsByChainNamespace(t),events:["accountsChanged","chainChanged"],chains:[],rpcMap:{}}},applyNamespaceOverrides(t,e){if(!e)return{...t};const s={...t},n=new Set;if(e.methods&&Object.keys(e.methods).forEach(i=>n.add(i)),e.chains&&Object.keys(e.chains).forEach(i=>n.add(i)),e.events&&Object.keys(e.events).forEach(i=>n.add(i)),e.rpcMap&&Object.keys(e.rpcMap).forEach(i=>{const[r]=i.split(":");r&&n.add(r)}),n.forEach(i=>{s[i]||(s[i]=this.createDefaultNamespace(i))}),e.methods&&Object.entries(e.methods).forEach(([i,r])=>{s[i]&&(s[i].methods=r)}),e.chains&&Object.entries(e.chains).forEach(([i,r])=>{s[i]&&(s[i].chains=r)}),e.events&&Object.entries(e.events).forEach(([i,r])=>{s[i]&&(s[i].events=r)}),e.rpcMap){const i=new Set;Object.entries(e.rpcMap).forEach(([r,o])=>{const[a,c]=r.split(":");!a||!c||!s[a]||(s[a].rpcMap||(s[a].rpcMap={}),i.has(a)||(s[a].rpcMap={},i.add(a)),s[a].rpcMap[c]=o)})}return s},createNamespaces(t,e){const s=t.reduce((n,i)=>{const{id:r,chainNamespace:o,rpcUrls:a}=i,c=a.default.http[0];n[o]||(n[o]=this.createDefaultNamespace(o));const l=`${o}:${r}`,d=n[o];switch(d.chains.push(l),l){case"solana:5eykt4UsFv8P8NJdTREpY1vzqKqZKvdp":d.chains.push("solana:4sGjMW1sUnHzSxGspuhpqLDx6wiyjNtZ");break;case"solana:EtWTRABZaYq6iMfeYKouRu166VU2xqa1":d.chains.push("solana:8E9rvCKLFQia2Y35HXjjpWzj8weVo44K");break}return d!=null&&d.rpcMap&&c&&(d.rpcMap[r]=c),n},{});return this.applyNamespaceOverrides(s,e)},resolveReownName:async t=>{var n;const e=await Pi.resolveName(t);return((n=(e!=null&&e.addresses?Object.values(e.addresses):[])[0])==null?void 0:n.address)||!1},getChainsFromNamespaces(t={}){return Object.values(t).flatMap(e=>{const s=e.chains||[],n=e.accounts.map(i=>{const[r,o]=i.split(":");return`${r}:${o}`});return Array.from(new Set([...s,...n]))})},isSessionEventData(t){return typeof t=="object"&&t!==null&&"id"in t&&"topic"in t&&"params"in t&&typeof t.params=="object"&&t.params!==null&&"chainId"in t.params&&"event"in t.params&&typeof t.params.event=="object"&&t.params.event!==null},isUserRejectedRequestError(t){try{if(typeof t=="object"&&t!==null){const e=t,s=typeof e.code=="number",n=s&&e.code===Ys.RPC_ERROR_CODE.USER_REJECTED_METHODS,i=s&&e.code===Ys.RPC_ERROR_CODE.USER_REJECTED;return n||i}return!1}catch{return!1}},isOriginAllowed(t,e,s){const n=[...e,...s];if(e.length===0)return!0;const i=Ra(t);if(!i)return n.some(r=>!r.includes("*")&&r===t);if(i.hostname==="localhost"||i.hostname==="127.0.0.1")return!0;for(const r of n)if(r.includes("*")){if(FA(i,t,r))return!0}else if(BA(t,r))return!0;return!1},listenWcProvider({universalProvider:t,namespace:e,onConnect:s,onDisconnect:n,onAccountsChanged:i,onChainChanged:r,onDisplayUri:o}){s&&t.on("connect",()=>{const a=Ys.getWalletConnectAccounts(t,e);s(a)}),n&&t.on("disconnect",()=>{n()}),i&&t.on("accountsChanged",a=>{var c,l,d,h,u;try{const p=((d=(l=(c=t.session)==null?void 0:c.namespaces)==null?void 0:l[e])==null?void 0:d.accounts)||[],m=(u=(h=t.rpcProviders)==null?void 0:h[e])==null?void 0:u.getDefaultChain(),y=a.map(g=>{const w=p.find(x=>x.includes(`${e}:${m}:${g}`));if(!w)return;const{chainId:b,chainNamespace:A}=Je.parseCaipAddress(w);return{address:g,chainId:b,chainNamespace:A}}).filter(g=>g!==void 0);y.length>0&&i(y)}catch(p){console.warn("Failed to parse accounts for namespace on accountsChanged event",e,a,p)}}),r&&t.on("chainChanged",a=>{r(a)}),o&&t.on("display_uri",a=>{o(a)})},getWalletConnectAccounts(t,e){var i,r,o,a;const s=new Set,n=(a=(o=(r=(i=t==null?void 0:t.session)==null?void 0:i.namespaces)==null?void 0:r[e])==null?void 0:o.accounts)==null?void 0:a.map(c=>Je.parseCaipAddress(c)).filter(({address:c})=>s.has(c.toLowerCase())?!1:(s.add(c.toLowerCase()),!0));return n&&n.length>0?n:[]}},jA=[I.CONNECTOR_ID.AUTH,I.CONNECTOR_ID.WALLET_CONNECT];class qA{constructor(e){this.availableConnectors=[],this.availableConnections=[],this.providerHandlers={},this.eventListeners=new Map,this.getCaipNetworks=s=>f.getCaipNetworks(s),this.getConnectorId=s=>U.getConnectorId(s),e&&this.construct(e)}construct(e){this.projectId=e.projectId,this.namespace=e.namespace,this.adapterType=e.adapterType}get connectors(){return this.availableConnectors}get connections(){return this.availableConnections}get networks(){return this.getCaipNetworks(this.namespace)}onAuthConnected({accounts:e,chainId:s}){const n=this.getCaipNetworks().filter(i=>i.chainNamespace===this.namespace).find(i=>i.id.toString()===(s==null?void 0:s.toString()));e&&n&&this.addConnection({connectorId:I.CONNECTOR_ID.AUTH,accounts:e,caipNetwork:n})}setAuthProvider(e){e.onConnect(this.onAuthConnected.bind(this)),e.onSocialConnected(this.onAuthConnected.bind(this)),this.addConnector({id:I.CONNECTOR_ID.AUTH,type:"AUTH",name:I.CONNECTOR_NAMES.AUTH,provider:e,imageId:void 0,chain:this.namespace,chains:[]})}addConnector(...e){const s=new Set;this.availableConnectors=[...e,...this.availableConnectors].filter(n=>s.has(n.id)?!1:(s.add(n.id),!0)),this.emit("connectors",this.availableConnectors)}addConnection(...e){const s=new Set;this.availableConnections=[...e,...this.availableConnections].filter(n=>s.has(n.connectorId.toLowerCase())?!1:(s.add(n.connectorId.toLowerCase()),!0)),this.emit("connections",this.availableConnections)}deleteConnection(e){this.availableConnections=this.availableConnections.filter(s=>s.connectorId.toLowerCase()!==e.toLowerCase()),this.emit("connections",this.availableConnections)}clearConnections(e=!1){this.availableConnections=[],e&&this.emit("connections",this.availableConnections)}setStatus(e,s){f.setAccountProp("status",e,s)}on(e,s){var n;this.eventListeners.has(e)||this.eventListeners.set(e,new Set),(n=this.eventListeners.get(e))==null||n.add(s)}off(e,s){const n=this.eventListeners.get(e);n&&n.delete(s)}removeAllEventListeners(){this.eventListeners.forEach(e=>{e.clear()})}emit(e,s){const n=this.eventListeners.get(e);n&&n.forEach(i=>i(s))}async connectWalletConnect(e){try{return{clientId:(await this.getWalletConnectConnector().connectWalletConnect()).clientId}}catch(s){throw Ys.isUserRejectedRequestError(s)?new Zd(s):s}}async switchNetwork(e){var r;const{caipNetwork:s}=e,n=Oe.getProviderId(s.chainNamespace),i=Oe.getProvider(s.chainNamespace);if(!i)throw new Error("Provider not found");if(n==="WALLET_CONNECT"){i.setDefaultChain(s.caipNetworkId);return}if(n==="AUTH"){const o=(r=U.getAuthConnector())==null?void 0:r.provider;if(!o)throw new Error("Auth provider not found");const a=Bt(s.chainNamespace);await o.switchNetwork({chainId:s.caipNetworkId});const c=await o.getUser({chainId:s.caipNetworkId,preferredAccountType:a});this.emit("switchNetwork",c)}}getWalletConnectConnector(){const e=this.connectors.find(s=>s.id==="walletConnect");if(!e)throw new Error("WalletConnectConnector not found");return e}onConnect(e,s){if(e.length>0){const{address:n,chainId:i}=j.getAccount(e[0]),r=this.getCaipNetworks().filter(a=>a.chainNamespace===this.namespace).find(a=>a.id.toString()===(i==null?void 0:i.toString())),o=this.connectors.find(a=>a.id===s);n&&(this.emit("accountChanged",{address:n,chainId:i,connector:o}),this.addConnection({connectorId:s,accounts:e.map(a=>{const{address:c}=j.getAccount(a);return{address:c}}),caipNetwork:r}))}}onAccountsChanged(e,s,n=!0){var i,r;if(e.length>0){const{address:o}=j.getAccount(e[0]),a=this.getConnection({connectorId:s,connections:this.connections,connectors:this.connectors});o&&((i=this.getConnectorId(I.CHAIN.EVM))==null?void 0:i.toLowerCase())===s.toLowerCase()&&this.emit("accountChanged",{address:o,chainId:(r=a==null?void 0:a.caipNetwork)==null?void 0:r.id,connector:a==null?void 0:a.connector}),this.addConnection({connectorId:s,accounts:e.map(c=>{const{address:l}=j.getAccount(c);return{address:l}}),caipNetwork:a==null?void 0:a.caipNetwork})}else n&&this.onDisconnect(s)}onDisconnect(e){var s;this.removeProviderListeners(e),this.deleteConnection(e),((s=this.getConnectorId(I.CHAIN.EVM))==null?void 0:s.toLowerCase())===e.toLowerCase()&&this.emitFirstAvailableConnection(),this.connections.length===0&&this.emit("disconnect")}onChainChanged(e,s){var o;const n=typeof e=="string"&&e.startsWith("0x")?parseInt(e,16).toString():e.toString(),i=this.getConnection({connectorId:s,connections:this.connections,connectors:this.connectors}),r=this.getCaipNetworks().filter(a=>a.chainNamespace===this.namespace).find(a=>a.id.toString()===n);i&&this.addConnection({connectorId:s,accounts:i.accounts,caipNetwork:r}),((o=this.getConnectorId(I.CHAIN.EVM))==null?void 0:o.toLowerCase())===s.toLowerCase()&&this.emit("switchNetwork",{chainId:n})}listenProviderEvents(e,s){if(jA.includes(e))return;const n=o=>this.onAccountsChanged(o,e),i=o=>this.onChainChanged(o,e),r=()=>this.onDisconnect(e);this.providerHandlers[e]||(s.on("disconnect",r),s.on("accountsChanged",n),s.on("chainChanged",i),this.providerHandlers[e]={provider:s,disconnect:r,accountsChanged:n,chainChanged:i})}removeProviderListeners(e){if(this.providerHandlers[e]){const{provider:s,disconnect:n,accountsChanged:i,chainChanged:r}=this.providerHandlers[e];s.removeListener("disconnect",n),s.removeListener("accountsChanged",i),s.removeListener("chainChanged",r),this.providerHandlers[e]=null}}emitFirstAvailableConnection(){var s;const e=this.getConnection({connections:this.connections,connectors:this.connectors});if(e){const[n]=e.accounts;this.emit("accountChanged",{address:n==null?void 0:n.address,chainId:(s=e.caipNetwork)==null?void 0:s.id,connector:e.connector})}}getConnection({address:e,connectorId:s,connections:n,connectors:i}){if(s){const o=n.find(l=>l.connectorId.toLowerCase()===s.toLowerCase());if(!o)return null;const a=i.find(l=>l.id.toLowerCase()===o.connectorId.toLowerCase()),c=e?o.accounts.find(l=>l.address.toLowerCase()===e.toLowerCase()):o.accounts[0];return{...o,account:c,connector:a}}const r=n.find(o=>o.accounts.length>0&&i.some(a=>a.id.toLowerCase()===o.connectorId.toLowerCase()));if(r){const[o]=r.accounts,a=i.find(c=>c.id.toLowerCase()===r.connectorId.toLowerCase());return{...r,account:o,connector:a}}return null}}let an=null;const Yt={getSIWX(){return _.state.siwx},async initializeIfEnabled(t=f.getActiveCaipAddress()){var r,o,a,c;const e=_.state.siwx;if(!(e&&t))return;const[s,n,i]=t.split(":");if(f.checkIfSupportedNetwork(s,`${s}:${n}`))try{if((r=_.state.remoteFeatures)!=null&&r.emailCapture){const d=(o=f.getAccountData(s))==null?void 0:o.user;await de.open({view:"DataCapture",data:{email:(a=d==null?void 0:d.email)!=null?a:void 0}});return}if(an&&await an,(await e.getSessions(`${s}:${n}`,i)).length)return;await de.open({view:"SIWXSignMessage"})}catch(l){console.error("SIWXUtil:initializeIfEnabled",l),oe.sendEvent({type:"track",event:"SIWX_AUTH_ERROR",properties:this.getSIWXEventProperties(l)}),await((c=D._getClient())==null?void 0:c.disconnect().catch(console.error)),ee.reset("Connect"),as.showError("A problem occurred while trying initialize authentication")}},async isAuthenticated(t=f.getActiveCaipAddress()){if(!_.state.siwx||!t)return!0;const{chainNamespace:s,chainId:n,address:i}=Je.parseCaipAddress(t),r=`${s}:${n}`;return(await Yt.getSessions({address:i,caipNetworkId:r})).length>0},async requestSignMessage(){const t=_.state.siwx,e=j.getPlainAddress(f.getActiveCaipAddress()),s=ir();if(!t)throw new Error("SIWX is not enabled");if(!e)throw new Error("No ActiveCaipAddress found");if(!s)throw new Error("No ActiveCaipNetwork or client found");try{const n=await t.createMessage({chainId:s.caipNetworkId,accountAddress:e}),i=n.toString();let r="";t.signMessage?r=await t.signMessage({message:i,chainId:s.caipNetworkId,accountAddress:e}):(U.getConnectorId(s.chainNamespace)===I.CONNECTOR_ID.AUTH&&ee.pushTransactionStack({}),r=await D.signMessage(i)||""),await t.addSession({data:n,message:i,signature:r}),f.setLastConnectedSIWECaipNetwork(s),de.close(),oe.sendEvent({type:"track",event:"SIWX_AUTH_SUCCESS",properties:this.getSIWXEventProperties()})}catch(n){(!de.state.open||ee.state.view==="ApproveTransaction")&&await de.open({view:"SIWXSignMessage"}),as.showError("Error signing message"),oe.sendEvent({type:"track",event:"SIWX_AUTH_ERROR",properties:this.getSIWXEventProperties(n)}),console.error("SWIXUtil:requestSignMessage",n)}},async cancelSignMessage(){var t;try{const e=this.getSIWX();if((t=e==null?void 0:e.getRequired)==null?void 0:t.call(e)){const n=f.getLastConnectedSIWECaipNetwork();if(n){const i=await(e==null?void 0:e.getSessions(n==null?void 0:n.caipNetworkId,j.getPlainAddress(f.getActiveCaipAddress())||""));i&&i.length>0?await f.switchActiveNetwork(n):await D.disconnect()}else await D.disconnect()}else de.close();de.close(),oe.sendEvent({event:"CLICK_CANCEL_SIWX",type:"track",properties:this.getSIWXEventProperties()})}catch(e){console.error("SIWXUtil:cancelSignMessage",e)}},async getAllSessions(){const t=this.getSIWX(),e=f.getAllRequestedCaipNetworks(),s=[];return await Promise.all(e.map(async n=>{const i=await(t==null?void 0:t.getSessions(n.caipNetworkId,j.getPlainAddress(f.getActiveCaipAddress())||""));i&&s.push(...i)})),s},async getSessions(t){const e=_.state.siwx;let s=t==null?void 0:t.address;if(!s){const i=f.getActiveCaipAddress();s=j.getPlainAddress(i)}let n=t==null?void 0:t.caipNetworkId;if(!n){const i=f.getActiveCaipNetwork();n=i==null?void 0:i.caipNetworkId}return e&&s&&n?e.getSessions(n,s):[]},async isSIWXCloseDisabled(){var e;const t=this.getSIWX();if(t){const s=ee.state.view==="ApproveTransaction",n=ee.state.view==="SIWXSignMessage";if(s||n)return((e=t.getRequired)==null?void 0:e.call(t))&&(await this.getSessions()).length===0}return!1},async authConnectorAuthenticate({authConnector:t,chainId:e,socialUri:s,preferredAccountType:n,chainNamespace:i}){var h;const r=Yt.getSIWX(),o=ir();if(!r||!i.includes(I.CHAIN.EVM)||(h=_.state.remoteFeatures)!=null&&h.emailCapture){const u=await t.connect({chainId:e,socialUri:s,preferredAccountType:n});return{address:u.address,chainId:u.chainId,accounts:u.accounts}}const a=`${i}:${e}`,c=await r.createMessage({chainId:a,accountAddress:"<<AccountAddress>>"}),l={accountAddress:c.accountAddress,chainId:c.chainId,domain:c.domain,uri:c.uri,version:c.version,nonce:c.nonce,notBefore:c.notBefore,statement:c.statement,resources:c.resources,requestId:c.requestId,issuedAt:c.issuedAt,expirationTime:c.expirationTime,serializedMessage:c.toString()},d=await t.connect({chainId:e,socialUri:s,siwxMessage:l,preferredAccountType:n});return l.accountAddress=d.address,l.serializedMessage=d.message||"",d.signature&&d.message&&await Yt.addEmbeddedWalletSession(l,d.message,d.signature),f.setLastConnectedSIWECaipNetwork(o),{address:d.address,chainId:d.chainId,accounts:d.accounts}},async addEmbeddedWalletSession(t,e,s){if(an)return an;const n=Yt.getSIWX();return n?(an=n.addSession({data:t,message:e,signature:s}).finally(()=>{an=null}),an):Promise.resolve()},async universalProviderAuthenticate({universalProvider:t,chains:e,methods:s}){var l,d,h;const n=Yt.getSIWX(),i=ir(),r=new Set(e.map(u=>u.split(":")[0]));if(!n||r.size!==1||!r.has("eip155"))return!1;const o=await n.createMessage({chainId:((l=ir())==null?void 0:l.caipNetworkId)||"",accountAddress:""}),a=await t.authenticate({nonce:o.nonce,domain:o.domain,uri:o.uri,exp:o.expirationTime,iat:o.issuedAt,nbf:o.notBefore,requestId:o.requestId,version:o.version,resources:o.resources,statement:o.statement,chainId:o.chainId,methods:s,chains:[o.chainId,...e.filter(u=>u!==o.chainId)]});as.showLoading("Authenticating...",{autoClose:!1});const c={...a.session.peer.metadata,name:a.session.peer.metadata.name,icon:(d=a.session.peer.metadata.icons)==null?void 0:d[0],type:"WALLET_CONNECT"};if(f.setAccountProp("connectedWalletInfo",c,Array.from(r)[0]),(h=a==null?void 0:a.auths)!=null&&h.length){const u=a.auths.map(p=>{var y;const m=t.client.formatAuthMessage({request:p.p,iss:p.p.iss});return{data:{...p.p,accountAddress:p.p.iss.split(":").slice(-1).join(""),chainId:p.p.iss.split(":").slice(2,4).join(":"),uri:(y=p.p.aud)!=null?y:"",version:p.p.version||o.version,expirationTime:p.p.exp,issuedAt:p.p.iat,notBefore:p.p.nbf},message:m,signature:p.s.s,cacao:p}});try{await n.setSessions(u),i&&f.setLastConnectedSIWECaipNetwork(i),oe.sendEvent({type:"track",event:"SIWX_AUTH_SUCCESS",properties:Yt.getSIWXEventProperties()})}catch(p){throw console.error("SIWX:universalProviderAuth - failed to set sessions",p),oe.sendEvent({type:"track",event:"SIWX_AUTH_ERROR",properties:Yt.getSIWXEventProperties(p)}),await t.disconnect().catch(console.error),p}finally{as.hide()}}return!0},getSIWXEventProperties(t){var s;const e=f.state.activeChain;if(!e)throw new Error("SIWXUtil:getSIWXEventProperties - namespace is required");return{network:((s=f.state.activeCaipNetwork)==null?void 0:s.caipNetworkId)||"",isSmartAccount:Bt(e)===Is.ACCOUNT_TYPES.SMART_ACCOUNT,message:t?j.parseError(t):void 0}},async clearSessions(){const t=this.getSIWX();t&&await t.setSessions([])}};class HA{constructor({provider:e,namespace:s}){this.id=I.CONNECTOR_ID.WALLET_CONNECT,this.name="WalletConnect",this.type="WALLET_CONNECT",this.imageId="ef1a1fcf-7fe8-4d69-bd6d-fda1345b4400",this.getCaipNetworks=f.getCaipNetworks.bind(f),this.caipNetworks=this.getCaipNetworks(),this.provider=e,this.chain=s}get chains(){return this.getCaipNetworks()}async connectWalletConnect(){if(!await this.authenticate()){const s=this.getCaipNetworks(),n=_.state.universalProviderConfigOverride,i=Ys.createNamespaces(s,n);await this.provider.connect({optionalNamespaces:i})}return{clientId:await this.provider.client.core.crypto.getClientId(),session:this.provider.session}}async disconnect(){await this.provider.disconnect()}async authenticate(){const e=this.chains.map(s=>s.caipNetworkId);return Yt.universalProviderAuthenticate({universalProvider:this.provider,chains:e,methods:KA})}}const KA=["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sendTransaction","personal_sign","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode","wallet_getCallsStatus","wallet_sendCalls","wallet_getCapabilities","wallet_grantPermissions","wallet_revokePermissions","wallet_getAssets"],Kt=xe({message:"",variant:"info",open:!1}),VA={state:Kt,subscribeKey(t,e){return Ze(Kt,t,e)},open(t,e){const{debug:s}=_.state,{code:n,displayMessage:i,debugMessage:r}=t;i&&s&&(Kt.message=i,Kt.variant=e,Kt.open=!0)},warn(t,e,s){Kt.open=!0,Kt.message=t,Kt.variant="warning",e&&console.warn(e,s)},close(){Kt.open=!1,Kt.message="",Kt.variant="info"}},Ct=Wt(VA),zA={asset:"0x833589fcd6edb6e08f4c7c32d4f71b54bda02913"},GA={asset:"0x036CbD53842c5426634e7929541eC2318f3dCF7e"};const Sr=globalThis,uc=Sr.ShadowRoot&&(Sr.ShadyCSS===void 0||Sr.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,pc=Symbol(),vd=new WeakMap;let Yu=class{constructor(e,s,n){if(this._$cssResult$=!0,n!==pc)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=e,this.t=s}get styleSheet(){let e=this.o;const s=this.t;if(uc&&e===void 0){const n=s!==void 0&&s.length===1;n&&(e=vd.get(s)),e===void 0&&((this.o=e=new CSSStyleSheet).replaceSync(this.cssText),n&&vd.set(s,e))}return e}toString(){return this.cssText}};const Gt=t=>new Yu(typeof t=="string"?t:t+"",void 0,pc),Ks=(t,...e)=>{const s=t.length===1?t[0]:e.reduce((n,i,r)=>n+(o=>{if(o._$cssResult$===!0)return o.cssText;if(typeof o=="number")return o;throw Error("Value passed to 'css' function must be a 'css' function result: "+o+". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.")})(i)+t[r+1],t[0]);return new Yu(s,t,pc)},YA=(t,e)=>{if(uc)t.adoptedStyleSheets=e.map(s=>s instanceof CSSStyleSheet?s:s.styleSheet);else for(const s of e){const n=document.createElement("style"),i=Sr.litNonce;i!==void 0&&n.setAttribute("nonce",i),n.textContent=s.cssText,t.appendChild(n)}},Ad=uc?t=>t:t=>t instanceof CSSStyleSheet?(e=>{let s="";for(const n of e.cssRules)s+=n.cssText;return Gt(s)})(t):t;const{is:JA,defineProperty:XA,getOwnPropertyDescriptor:ZA,getOwnPropertyNames:QA,getOwnPropertySymbols:eI,getPrototypeOf:tI}=Object,Js=globalThis,Id=Js.trustedTypes,sI=Id?Id.emptyScript:"",jo=Js.reactiveElementPolyfillSupport,Ri=(t,e)=>t,Ua={toAttribute(t,e){switch(e){case Boolean:t=t?sI:null;break;case Object:case Array:t=t==null?t:JSON.stringify(t)}return t},fromAttribute(t,e){let s=t;switch(e){case Boolean:s=t!==null;break;case Number:s=t===null?null:Number(t);break;case Object:case Array:try{s=JSON.parse(t)}catch{s=null}}return s}},Ju=(t,e)=>!JA(t,e),Nd={attribute:!0,type:String,converter:Ua,reflect:!1,useDefault:!1,hasChanged:Ju};var Dd,Ld;(Dd=Symbol.metadata)!=null||(Symbol.metadata=Symbol("metadata")),(Ld=Js.litPropertyMetadata)!=null||(Js.litPropertyMetadata=new WeakMap);let qn=class extends HTMLElement{static addInitializer(e){var s;this._$Ei(),((s=this.l)!=null?s:this.l=[]).push(e)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(e,s=Nd){if(s.state&&(s.attribute=!1),this._$Ei(),this.prototype.hasOwnProperty(e)&&((s=Object.create(s)).wrapped=!0),this.elementProperties.set(e,s),!s.noAccessor){const n=Symbol(),i=this.getPropertyDescriptor(e,n,s);i!==void 0&&XA(this.prototype,e,i)}}static getPropertyDescriptor(e,s,n){var o;const{get:i,set:r}=(o=ZA(this.prototype,e))!=null?o:{get(){return this[s]},set(a){this[s]=a}};return{get:i,set(a){const c=i==null?void 0:i.call(this);r==null||r.call(this,a),this.requestUpdate(e,c,n)},configurable:!0,enumerable:!0}}static getPropertyOptions(e){var s;return(s=this.elementProperties.get(e))!=null?s:Nd}static _$Ei(){if(this.hasOwnProperty(Ri("elementProperties")))return;const e=tI(this);e.finalize(),e.l!==void 0&&(this.l=[...e.l]),this.elementProperties=new Map(e.elementProperties)}static finalize(){if(this.hasOwnProperty(Ri("finalized")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(Ri("properties"))){const s=this.properties,n=[...QA(s),...eI(s)];for(const i of n)this.createProperty(i,s[i])}const e=this[Symbol.metadata];if(e!==null){const s=litPropertyMetadata.get(e);if(s!==void 0)for(const[n,i]of s)this.elementProperties.set(n,i)}this._$Eh=new Map;for(const[s,n]of this.elementProperties){const i=this._$Eu(s,n);i!==void 0&&this._$Eh.set(i,s)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(e){const s=[];if(Array.isArray(e)){const n=new Set(e.flat(1/0).reverse());for(const i of n)s.unshift(Ad(i))}else e!==void 0&&s.push(Ad(e));return s}static _$Eu(e,s){const n=s.attribute;return n===!1?void 0:typeof n=="string"?n:typeof e=="string"?e.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){var e;this._$ES=new Promise(s=>this.enableUpdating=s),this._$AL=new Map,this._$E_(),this.requestUpdate(),(e=this.constructor.l)==null||e.forEach(s=>s(this))}addController(e){var s,n;((s=this._$EO)!=null?s:this._$EO=new Set).add(e),this.renderRoot!==void 0&&this.isConnected&&((n=e.hostConnected)==null||n.call(e))}removeController(e){var s;(s=this._$EO)==null||s.delete(e)}_$E_(){const e=new Map,s=this.constructor.elementProperties;for(const n of s.keys())this.hasOwnProperty(n)&&(e.set(n,this[n]),delete this[n]);e.size>0&&(this._$Ep=e)}createRenderRoot(){var s;const e=(s=this.shadowRoot)!=null?s:this.attachShadow(this.constructor.shadowRootOptions);return YA(e,this.constructor.elementStyles),e}connectedCallback(){var e,s;(e=this.renderRoot)!=null||(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),(s=this._$EO)==null||s.forEach(n=>{var i;return(i=n.hostConnected)==null?void 0:i.call(n)})}enableUpdating(e){}disconnectedCallback(){var e;(e=this._$EO)==null||e.forEach(s=>{var n;return(n=s.hostDisconnected)==null?void 0:n.call(s)})}attributeChangedCallback(e,s,n){this._$AK(e,n)}_$ET(e,s){var r;const n=this.constructor.elementProperties.get(e),i=this.constructor._$Eu(e,n);if(i!==void 0&&n.reflect===!0){const o=(((r=n.converter)==null?void 0:r.toAttribute)!==void 0?n.converter:Ua).toAttribute(s,n.type);this._$Em=e,o==null?this.removeAttribute(i):this.setAttribute(i,o),this._$Em=null}}_$AK(e,s){var r,o,a;const n=this.constructor,i=n._$Eh.get(e);if(i!==void 0&&this._$Em!==i){const c=n.getPropertyOptions(i),l=typeof c.converter=="function"?{fromAttribute:c.converter}:((r=c.converter)==null?void 0:r.fromAttribute)!==void 0?c.converter:Ua;this._$Em=i;const d=l.fromAttribute(s,c.type);this[i]=(a=d!=null?d:(o=this._$Ej)==null?void 0:o.get(i))!=null?a:d,this._$Em=null}}requestUpdate(e,s,n,i=!1,r){var o,a;if(e!==void 0){const c=this.constructor;if(i===!1&&(r=this[e]),n!=null||(n=c.getPropertyOptions(e)),!(((o=n.hasChanged)!=null?o:Ju)(r,s)||n.useDefault&&n.reflect&&r===((a=this._$Ej)==null?void 0:a.get(e))&&!this.hasAttribute(c._$Eu(e,n))))return;this.C(e,s,n)}this.isUpdatePending===!1&&(this._$ES=this._$EP())}C(e,s,{useDefault:n,reflect:i,wrapped:r},o){var a,c,l;n&&!((a=this._$Ej)!=null?a:this._$Ej=new Map).has(e)&&(this._$Ej.set(e,(c=o!=null?o:s)!=null?c:this[e]),r!==!0||o!==void 0)||(this._$AL.has(e)||(this.hasUpdated||n||(s=void 0),this._$AL.set(e,s)),i===!0&&this._$Em!==e&&((l=this._$Eq)!=null?l:this._$Eq=new Set).add(e))}async _$EP(){this.isUpdatePending=!0;try{await this._$ES}catch(s){Promise.reject(s)}const e=this.scheduleUpdate();return e!=null&&await e,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){var n,i;if(!this.isUpdatePending)return;if(!this.hasUpdated){if((n=this.renderRoot)!=null||(this.renderRoot=this.createRenderRoot()),this._$Ep){for(const[o,a]of this._$Ep)this[o]=a;this._$Ep=void 0}const r=this.constructor.elementProperties;if(r.size>0)for(const[o,a]of r){const{wrapped:c}=a,l=this[o];c!==!0||this._$AL.has(o)||l===void 0||this.C(o,void 0,a,l)}}let e=!1;const s=this._$AL;try{e=this.shouldUpdate(s),e?(this.willUpdate(s),(i=this._$EO)==null||i.forEach(r=>{var o;return(o=r.hostUpdate)==null?void 0:o.call(r)}),this.update(s)):this._$EM()}catch(r){throw e=!1,this._$EM(),r}e&&this._$AE(s)}willUpdate(e){}_$AE(e){var s;(s=this._$EO)==null||s.forEach(n=>{var i;return(i=n.hostUpdated)==null?void 0:i.call(n)}),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(e)),this.updated(e)}_$EM(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$ES}shouldUpdate(e){return!0}update(e){this._$Eq&&(this._$Eq=this._$Eq.forEach(s=>this._$ET(s,this[s]))),this._$EM()}updated(e){}firstUpdated(e){}};var Md;qn.elementStyles=[],qn.shadowRootOptions={mode:"open"},qn[Ri("elementProperties")]=new Map,qn[Ri("finalized")]=new Map,jo==null||jo({ReactiveElement:qn}),((Md=Js.reactiveElementVersions)!=null?Md:Js.reactiveElementVersions=[]).push("2.1.2");const Ui=globalThis,_d=t=>t,Hr=Ui.trustedTypes,Sd=Hr?Hr.createPolicy("lit-html",{createHTML:t=>t}):void 0,Xu="$lit$",Vs=`lit$${Math.random().toFixed(9).slice(2)}$`,Zu="?"+Vs,nI=`<${Zu}>`,_n=document,ji=()=>_n.createComment(""),qi=t=>t===null||typeof t!="object"&&typeof t!="function",fc=Array.isArray,iI=t=>fc(t)||typeof(t==null?void 0:t[Symbol.iterator])=="function",qo=`[ 	
\f\r]`,Ci=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,Td=/-->/g,Od=/>/g,cn=RegExp(`>|${qo}(?:([^\\s"'>=/]+)(${qo}*=${qo}*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),kd=/'/g,xd=/"/g,Qu=/^(?:script|style|textarea|title)$/i,ep=t=>(e,...s)=>({_$litType$:t,strings:e,values:s}),sN=ep(1),nN=ep(2),si=Symbol.for("lit-noChange"),Ke=Symbol.for("lit-nothing"),Pd=new WeakMap,bn=_n.createTreeWalker(_n,129);function tp(t,e){if(!fc(t)||!t.hasOwnProperty("raw"))throw Error("invalid template strings array");return Sd!==void 0?Sd.createHTML(e):e}const rI=(t,e)=>{const s=t.length-1,n=[];let i,r=e===2?"<svg>":e===3?"<math>":"",o=Ci;for(let a=0;a<s;a++){const c=t[a];let l,d,h=-1,u=0;for(;u<c.length&&(o.lastIndex=u,d=o.exec(c),d!==null);)u=o.lastIndex,o===Ci?d[1]==="!--"?o=Td:d[1]!==void 0?o=Od:d[2]!==void 0?(Qu.test(d[2])&&(i=RegExp("</"+d[2],"g")),o=cn):d[3]!==void 0&&(o=cn):o===cn?d[0]===">"?(o=i!=null?i:Ci,h=-1):d[1]===void 0?h=-2:(h=o.lastIndex-d[2].length,l=d[1],o=d[3]===void 0?cn:d[3]==='"'?xd:kd):o===xd||o===kd?o=cn:o===Td||o===Od?o=Ci:(o=cn,i=void 0);const p=o===cn&&t[a+1].startsWith("/>")?" ":"";r+=o===Ci?c+nI:h>=0?(n.push(l),c.slice(0,h)+Xu+c.slice(h)+Vs+p):c+Vs+(h===-2?a:p)}return[tp(t,r+(t[s]||"<?>")+(e===2?"</svg>":e===3?"</math>":"")),n]};class Hi{constructor({strings:e,_$litType$:s},n){let i;this.parts=[];let r=0,o=0;const a=e.length-1,c=this.parts,[l,d]=rI(e,s);if(this.el=Hi.createElement(l,n),bn.currentNode=this.el.content,s===2||s===3){const h=this.el.content.firstChild;h.replaceWith(...h.childNodes)}for(;(i=bn.nextNode())!==null&&c.length<a;){if(i.nodeType===1){if(i.hasAttributes())for(const h of i.getAttributeNames())if(h.endsWith(Xu)){const u=d[o++],p=i.getAttribute(h).split(Vs),m=/([.?@])?(.*)/.exec(u);c.push({type:1,index:r,name:m[2],strings:p,ctor:m[1]==="."?aI:m[1]==="?"?cI:m[1]==="@"?lI:ao}),i.removeAttribute(h)}else h.startsWith(Vs)&&(c.push({type:6,index:r}),i.removeAttribute(h));if(Qu.test(i.tagName)){const h=i.textContent.split(Vs),u=h.length-1;if(u>0){i.textContent=Hr?Hr.emptyScript:"";for(let p=0;p<u;p++)i.append(h[p],ji()),bn.nextNode(),c.push({type:2,index:++r});i.append(h[u],ji())}}}else if(i.nodeType===8)if(i.data===Zu)c.push({type:2,index:r});else{let h=-1;for(;(h=i.data.indexOf(Vs,h+1))!==-1;)c.push({type:7,index:r}),h+=Vs.length-1}r++}}static createElement(e,s){const n=_n.createElement("template");return n.innerHTML=e,n}}function ni(t,e,s=t,n){var o,a,c;if(e===si)return e;let i=n!==void 0?(o=s._$Co)==null?void 0:o[n]:s._$Cl;const r=qi(e)?void 0:e._$litDirective$;return(i==null?void 0:i.constructor)!==r&&((a=i==null?void 0:i._$AO)==null||a.call(i,!1),r===void 0?i=void 0:(i=new r(t),i._$AT(t,s,n)),n!==void 0?((c=s._$Co)!=null?c:s._$Co=[])[n]=i:s._$Cl=i),i!==void 0&&(e=ni(t,i._$AS(t,e.values),i,n)),e}class oI{constructor(e,s){this._$AV=[],this._$AN=void 0,this._$AD=e,this._$AM=s}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(e){var l;const{el:{content:s},parts:n}=this._$AD,i=((l=e==null?void 0:e.creationScope)!=null?l:_n).importNode(s,!0);bn.currentNode=i;let r=bn.nextNode(),o=0,a=0,c=n[0];for(;c!==void 0;){if(o===c.index){let d;c.type===2?d=new er(r,r.nextSibling,this,e):c.type===1?d=new c.ctor(r,c.name,c.strings,this,e):c.type===6&&(d=new dI(r,this,e)),this._$AV.push(d),c=n[++a]}o!==(c==null?void 0:c.index)&&(r=bn.nextNode(),o++)}return bn.currentNode=_n,i}p(e){let s=0;for(const n of this._$AV)n!==void 0&&(n.strings!==void 0?(n._$AI(e,n,s),s+=n.strings.length-2):n._$AI(e[s])),s++}}class er{get _$AU(){var e,s;return(s=(e=this._$AM)==null?void 0:e._$AU)!=null?s:this._$Cv}constructor(e,s,n,i){var r;this.type=2,this._$AH=Ke,this._$AN=void 0,this._$AA=e,this._$AB=s,this._$AM=n,this.options=i,this._$Cv=(r=i==null?void 0:i.isConnected)!=null?r:!0}get parentNode(){let e=this._$AA.parentNode;const s=this._$AM;return s!==void 0&&(e==null?void 0:e.nodeType)===11&&(e=s.parentNode),e}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(e,s=this){e=ni(this,e,s),qi(e)?e===Ke||e==null||e===""?(this._$AH!==Ke&&this._$AR(),this._$AH=Ke):e!==this._$AH&&e!==si&&this._(e):e._$litType$!==void 0?this.$(e):e.nodeType!==void 0?this.T(e):iI(e)?this.k(e):this._(e)}O(e){return this._$AA.parentNode.insertBefore(e,this._$AB)}T(e){this._$AH!==e&&(this._$AR(),this._$AH=this.O(e))}_(e){this._$AH!==Ke&&qi(this._$AH)?this._$AA.nextSibling.data=e:this.T(_n.createTextNode(e)),this._$AH=e}$(e){var r;const{values:s,_$litType$:n}=e,i=typeof n=="number"?this._$AC(e):(n.el===void 0&&(n.el=Hi.createElement(tp(n.h,n.h[0]),this.options)),n);if(((r=this._$AH)==null?void 0:r._$AD)===i)this._$AH.p(s);else{const o=new oI(i,this),a=o.u(this.options);o.p(s),this.T(a),this._$AH=o}}_$AC(e){let s=Pd.get(e.strings);return s===void 0&&Pd.set(e.strings,s=new Hi(e)),s}k(e){fc(this._$AH)||(this._$AH=[],this._$AR());const s=this._$AH;let n,i=0;for(const r of e)i===s.length?s.push(n=new er(this.O(ji()),this.O(ji()),this,this.options)):n=s[i],n._$AI(r),i++;i<s.length&&(this._$AR(n&&n._$AB.nextSibling,i),s.length=i)}_$AR(e=this._$AA.nextSibling,s){var n;for((n=this._$AP)==null?void 0:n.call(this,!1,!0,s);e!==this._$AB;){const i=_d(e).nextSibling;_d(e).remove(),e=i}}setConnected(e){var s;this._$AM===void 0&&(this._$Cv=e,(s=this._$AP)==null||s.call(this,e))}}class ao{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(e,s,n,i,r){this.type=1,this._$AH=Ke,this._$AN=void 0,this.element=e,this.name=s,this._$AM=i,this.options=r,n.length>2||n[0]!==""||n[1]!==""?(this._$AH=Array(n.length-1).fill(new String),this.strings=n):this._$AH=Ke}_$AI(e,s=this,n,i){const r=this.strings;let o=!1;if(r===void 0)e=ni(this,e,s,0),o=!qi(e)||e!==this._$AH&&e!==si,o&&(this._$AH=e);else{const a=e;let c,l;for(e=r[0],c=0;c<r.length-1;c++)l=ni(this,a[n+c],s,c),l===si&&(l=this._$AH[c]),o||(o=!qi(l)||l!==this._$AH[c]),l===Ke?e=Ke:e!==Ke&&(e+=(l!=null?l:"")+r[c+1]),this._$AH[c]=l}o&&!i&&this.j(e)}j(e){e===Ke?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,e!=null?e:"")}}class aI extends ao{constructor(){super(...arguments),this.type=3}j(e){this.element[this.name]=e===Ke?void 0:e}}class cI extends ao{constructor(){super(...arguments),this.type=4}j(e){this.element.toggleAttribute(this.name,!!e&&e!==Ke)}}class lI extends ao{constructor(e,s,n,i,r){super(e,s,n,i,r),this.type=5}_$AI(e,s=this){var o;if((e=(o=ni(this,e,s,0))!=null?o:Ke)===si)return;const n=this._$AH,i=e===Ke&&n!==Ke||e.capture!==n.capture||e.once!==n.once||e.passive!==n.passive,r=e!==Ke&&(n===Ke||i);i&&this.element.removeEventListener(this.name,this,n),r&&this.element.addEventListener(this.name,this,e),this._$AH=e}handleEvent(e){var s,n;typeof this._$AH=="function"?this._$AH.call((n=(s=this.options)==null?void 0:s.host)!=null?n:this.element,e):this._$AH.handleEvent(e)}}class dI{constructor(e,s,n){this.element=e,this.type=6,this._$AN=void 0,this._$AM=s,this.options=n}get _$AU(){return this._$AM._$AU}_$AI(e){ni(this,e)}}const Ho=Ui.litHtmlPolyfillSupport;var Bd;Ho==null||Ho(Hi,er),((Bd=Ui.litHtmlVersions)!=null?Bd:Ui.litHtmlVersions=[]).push("3.3.2");const hI=(t,e,s)=>{var r,o;const n=(r=s==null?void 0:s.renderBefore)!=null?r:e;let i=n._$litPart$;if(i===void 0){const a=(o=s==null?void 0:s.renderBefore)!=null?o:null;n._$litPart$=i=new er(e.insertBefore(ji(),a),a,void 0,s!=null?s:{})}return i._$AI(t),i};const Cn=globalThis;class Tr extends qn{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){var s,n;const e=super.createRenderRoot();return(n=(s=this.renderOptions).renderBefore)!=null||(s.renderBefore=e.firstChild),e}update(e){const s=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(e),this._$Do=hI(s,this.renderRoot,this.renderOptions)}connectedCallback(){var e;super.connectedCallback(),(e=this._$Do)==null||e.setConnected(!0)}disconnectedCallback(){var e;super.disconnectedCallback(),(e=this._$Do)==null||e.setConnected(!1)}render(){return si}}var Fd;Tr._$litElement$=!0,Tr.finalized=!0,(Fd=Cn.litElementHydrateSupport)==null||Fd.call(Cn,{LitElement:Tr});const Ko=Cn.litElementPolyfillSupport;Ko==null||Ko({LitElement:Tr});var Wd;((Wd=Cn.litElementVersions)!=null?Wd:Cn.litElementVersions=[]).push("4.2.2");const uI={black:"#202020",white:"#FFFFFF",white010:"rgba(255, 255, 255, 0.1)",accent010:"rgba(9, 136, 240, 0.1)",accent020:"rgba(9, 136, 240, 0.2)",accent030:"rgba(9, 136, 240, 0.3)",accent040:"rgba(9, 136, 240, 0.4)",accent050:"rgba(9, 136, 240, 0.5)",accent060:"rgba(9, 136, 240, 0.6)",accent070:"rgba(9, 136, 240, 0.7)",accent080:"rgba(9, 136, 240, 0.8)",accent090:"rgba(9, 136, 240, 0.9)",accent100:"rgba(9, 136, 240, 1.0)",accentSecondary010:"rgba(199, 185, 148, 0.1)",accentSecondary020:"rgba(199, 185, 148, 0.2)",accentSecondary030:"rgba(199, 185, 148, 0.3)",accentSecondary040:"rgba(199, 185, 148, 0.4)",accentSecondary050:"rgba(199, 185, 148, 0.5)",accentSecondary060:"rgba(199, 185, 148, 0.6)",accentSecondary070:"rgba(199, 185, 148, 0.7)",accentSecondary080:"rgba(199, 185, 148, 0.8)",accentSecondary090:"rgba(199, 185, 148, 0.9)",accentSecondary100:"rgba(199, 185, 148, 1.0)",productWalletKit:"#FFB800",productAppKit:"#FF573B",productCloud:"#0988F0",productDocumentation:"#008847",neutrals050:"#F6F6F6",neutrals100:"#F3F3F3",neutrals200:"#E9E9E9",neutrals300:"#D0D0D0",neutrals400:"#BBB",neutrals500:"#9A9A9A",neutrals600:"#6C6C6C",neutrals700:"#4F4F4F",neutrals800:"#363636",neutrals900:"#2A2A2A",neutrals1000:"#252525",semanticSuccess010:"rgba(48, 164, 107, 0.1)",semanticSuccess020:"rgba(48, 164, 107, 0.2)",semanticSuccess030:"rgba(48, 164, 107, 0.3)",semanticSuccess040:"rgba(48, 164, 107, 0.4)",semanticSuccess050:"rgba(48, 164, 107, 0.5)",semanticSuccess060:"rgba(48, 164, 107, 0.6)",semanticSuccess070:"rgba(48, 164, 107, 0.7)",semanticSuccess080:"rgba(48, 164, 107, 0.8)",semanticSuccess090:"rgba(48, 164, 107, 0.9)",semanticSuccess100:"rgba(48, 164, 107, 1.0)",semanticError010:"rgba(223, 74, 52, 0.1)",semanticError020:"rgba(223, 74, 52, 0.2)",semanticError030:"rgba(223, 74, 52, 0.3)",semanticError040:"rgba(223, 74, 52, 0.4)",semanticError050:"rgba(223, 74, 52, 0.5)",semanticError060:"rgba(223, 74, 52, 0.6)",semanticError070:"rgba(223, 74, 52, 0.7)",semanticError080:"rgba(223, 74, 52, 0.8)",semanticError090:"rgba(223, 74, 52, 0.9)",semanticError100:"rgba(223, 74, 52, 1.0)",semanticWarning010:"rgba(243, 161, 63, 0.1)",semanticWarning020:"rgba(243, 161, 63, 0.2)",semanticWarning030:"rgba(243, 161, 63, 0.3)",semanticWarning040:"rgba(243, 161, 63, 0.4)",semanticWarning050:"rgba(243, 161, 63, 0.5)",semanticWarning060:"rgba(243, 161, 63, 0.6)",semanticWarning070:"rgba(243, 161, 63, 0.7)",semanticWarning080:"rgba(243, 161, 63, 0.8)",semanticWarning090:"rgba(243, 161, 63, 0.9)",semanticWarning100:"rgba(243, 161, 63, 1.0)"},Kr={core:{backgroundAccentPrimary:"#0988F0",backgroundAccentCertified:"#C7B994",backgroundWalletKit:"#FFB800",backgroundAppKit:"#FF573B",backgroundCloud:"#0988F0",backgroundDocumentation:"#008847",backgroundSuccess:"rgba(48, 164, 107, 0.20)",backgroundError:"rgba(223, 74, 52, 0.20)",backgroundWarning:"rgba(243, 161, 63, 0.20)",textAccentPrimary:"#0988F0",textAccentCertified:"#C7B994",textWalletKit:"#FFB800",textAppKit:"#FF573B",textCloud:"#0988F0",textDocumentation:"#008847",textSuccess:"#30A46B",textError:"#DF4A34",textWarning:"#F3A13F",borderAccentPrimary:"#0988F0",borderSecondary:"#C7B994",borderSuccess:"#30A46B",borderError:"#DF4A34",borderWarning:"#F3A13F",foregroundAccent010:"rgba(9, 136, 240, 0.1)",foregroundAccent020:"rgba(9, 136, 240, 0.2)",foregroundAccent040:"rgba(9, 136, 240, 0.4)",foregroundAccent060:"rgba(9, 136, 240, 0.6)",foregroundSecondary020:"rgba(199, 185, 148, 0.2)",foregroundSecondary040:"rgba(199, 185, 148, 0.4)",foregroundSecondary060:"rgba(199, 185, 148, 0.6)",iconAccentPrimary:"#0988F0",iconAccentCertified:"#C7B994",iconSuccess:"#30A46B",iconError:"#DF4A34",iconWarning:"#F3A13F",glass010:"rgba(255, 255, 255, 0.1)",zIndex:"9999"},dark:{overlay:"rgba(0, 0, 0, 0.50)",backgroundPrimary:"#202020",backgroundInvert:"#FFFFFF",textPrimary:"#FFFFFF",textSecondary:"#9A9A9A",textTertiary:"#BBBBBB",textInvert:"#202020",borderPrimary:"#2A2A2A",borderPrimaryDark:"#363636",borderSecondary:"#4F4F4F",foregroundPrimary:"#252525",foregroundSecondary:"#2A2A2A",foregroundTertiary:"#363636",iconDefault:"#9A9A9A",iconInverse:"#FFFFFF"},light:{overlay:"rgba(230 , 230, 230, 0.5)",backgroundPrimary:"#FFFFFF",borderPrimaryDark:"#E9E9E9",backgroundInvert:"#202020",textPrimary:"#202020",textSecondary:"#9A9A9A",textTertiary:"#6C6C6C",textInvert:"#FFFFFF",borderPrimary:"#E9E9E9",borderSecondary:"#D0D0D0",foregroundPrimary:"#F3F3F3",foregroundSecondary:"#E9E9E9",foregroundTertiary:"#D0D0D0",iconDefault:"#9A9A9A",iconInverse:"#202020"}},pI={1:"4px",2:"8px",10:"10px",3:"12px",4:"16px",6:"24px",5:"20px",8:"32px",16:"64px",20:"80px",32:"128px",64:"256px",128:"512px",round:"9999px"},fI={0:"0px","01":"2px",1:"4px",2:"8px",3:"12px",4:"16px",5:"20px",6:"24px",7:"28px",8:"32px",9:"36px",10:"40px",12:"48px",14:"56px",16:"64px",20:"80px",32:"128px",64:"256px"},gI={regular:"KHTeka",mono:"KHTekaMono"},mI={regular:"400",medium:"500"},yI={h1:"50px",h2:"44px",h3:"38px",h4:"32px",h5:"26px",h6:"20px",large:"16px",medium:"14px",small:"12px"},wI={"h1-regular-mono":{lineHeight:"50px",letterSpacing:"-3px"},"h1-regular":{lineHeight:"50px",letterSpacing:"-1px"},"h1-medium":{lineHeight:"50px",letterSpacing:"-0.84px"},"h2-regular-mono":{lineHeight:"44px",letterSpacing:"-2.64px"},"h2-regular":{lineHeight:"44px",letterSpacing:"-0.88px"},"h2-medium":{lineHeight:"44px",letterSpacing:"-0.88px"},"h3-regular-mono":{lineHeight:"38px",letterSpacing:"-2.28px"},"h3-regular":{lineHeight:"38px",letterSpacing:"-0.76px"},"h3-medium":{lineHeight:"38px",letterSpacing:"-0.76px"},"h4-regular-mono":{lineHeight:"32px",letterSpacing:"-1.92px"},"h4-regular":{lineHeight:"32px",letterSpacing:"-0.32px"},"h4-medium":{lineHeight:"32px",letterSpacing:"-0.32px"},"h5-regular-mono":{lineHeight:"26px",letterSpacing:"-1.56px"},"h5-regular":{lineHeight:"26px",letterSpacing:"-0.26px"},"h5-medium":{lineHeight:"26px",letterSpacing:"-0.26px"},"h6-regular-mono":{lineHeight:"20px",letterSpacing:"-1.2px"},"h6-regular":{lineHeight:"20px",letterSpacing:"-0.6px"},"h6-medium":{lineHeight:"20px",letterSpacing:"-0.6px"},"lg-regular-mono":{lineHeight:"16px",letterSpacing:"-0.96px"},"lg-regular":{lineHeight:"18px",letterSpacing:"-0.16px"},"lg-medium":{lineHeight:"18px",letterSpacing:"-0.16px"},"md-regular-mono":{lineHeight:"14px",letterSpacing:"-0.84px"},"md-regular":{lineHeight:"16px",letterSpacing:"-0.14px"},"md-medium":{lineHeight:"16px",letterSpacing:"-0.14px"},"sm-regular-mono":{lineHeight:"12px",letterSpacing:"-0.72px"},"sm-regular":{lineHeight:"14px",letterSpacing:"-0.12px"},"sm-medium":{lineHeight:"14px",letterSpacing:"-0.12px"}},bI={"ease-out-power-2":"cubic-bezier(0.23, 0.09, 0.08, 1.13)","ease-out-power-1":"cubic-bezier(0.12, 0.04, 0.2, 1.06)","ease-in-power-2":"cubic-bezier(0.92, -0.13, 0.77, 0.91)","ease-in-power-1":"cubic-bezier(0.88, -0.06, 0.8, 0.96)","ease-inout-power-2":"cubic-bezier(0.77, 0.09, 0.23, 1.13)","ease-inout-power-1":"cubic-bezier(0.88, 0.04, 0.12, 1.06)"},EI={xl:"400ms",lg:"200ms",md:"125ms",sm:"75ms"},$a={colors:uI,fontFamily:gI,fontWeight:mI,textSize:yI,typography:wI,tokens:{core:Kr.core,theme:Kr.dark},borderRadius:pI,spacing:fI,durations:EI,easings:bI},Rd="--apkt";function yr(t){var s,n,i,r,o,a,c,l,d,h,u,p;if(!t)return{};const e={};return e["font-family"]=(n=(s=t["--apkt-font-family"])!=null?s:t["--w3m-font-family"])!=null?n:"KHTeka",e.accent=(r=(i=t["--apkt-accent"])!=null?i:t["--w3m-accent"])!=null?r:"#0988F0",e["color-mix"]=(a=(o=t["--apkt-color-mix"])!=null?o:t["--w3m-color-mix"])!=null?a:"#000",e["color-mix-strength"]=(l=(c=t["--apkt-color-mix-strength"])!=null?c:t["--w3m-color-mix-strength"])!=null?l:0,e["font-size-master"]=(h=(d=t["--apkt-font-size-master"])!=null?d:t["--w3m-font-size-master"])!=null?h:"10px",e["border-radius-master"]=(p=(u=t["--apkt-border-radius-master"])!=null?u:t["--w3m-border-radius-master"])!=null?p:"4px",t["--apkt-z-index"]!==void 0?e["z-index"]=t["--apkt-z-index"]:t["--w3m-z-index"]!==void 0&&(e["z-index"]=t["--w3m-z-index"]),e}const Cs={createCSSVariables(t){const e={},s={};function n(r,o,a=""){for(const[c,l]of Object.entries(r)){const d=a?`${a}-${c}`:c;l&&typeof l=="object"&&Object.keys(l).length?(o[c]={},n(l,o[c],d)):typeof l=="string"&&(o[c]=`${Rd}-${d}`)}}function i(r,o){for(const[a,c]of Object.entries(r))c&&typeof c=="object"?(o[a]={},i(c,o[a])):typeof c=="string"&&(o[a]=`var(${c})`)}return n(t,e),i(e,s),{cssVariables:e,cssVariablesVarPrefix:s}},assignCSSVariables(t,e){const s={};function n(i,r,o){for(const[a,c]of Object.entries(i)){const l=o?`${o}-${a}`:a,d=r[a];c&&typeof c=="object"?n(c,d,l):typeof d=="string"&&(s[`${Rd}-${l}`]=d)}}return n(t,e),s},createRootStyles(t,e){const s={...$a,tokens:{...$a.tokens,theme:t==="light"?Kr.light:Kr.dark}},{cssVariables:n}=Cs.createCSSVariables(s),i=Cs.assignCSSVariables(n,s),r=Cs.generateW3MVariables(e),o=Cs.generateW3MOverrides(e),a=Cs.generateScaledVariables(e),c=Cs.generateBaseVariables(i),l={...i,...c,...r,...o,...a},d=Cs.applyColorMixToVariables(e,l),h={...l,...d};return`:root {${Object.entries(h).map(([p,m])=>`${p}:${m.replace("/[:;{}</>]/g","")};`).join("")}}`},generateW3MVariables(t){if(!t)return{};const e=yr(t),s={};return s["--w3m-font-family"]=e["font-family"],s["--w3m-accent"]=e.accent,s["--w3m-color-mix"]=e["color-mix"],s["--w3m-color-mix-strength"]=`${e["color-mix-strength"]}%`,s["--w3m-font-size-master"]=e["font-size-master"],s["--w3m-border-radius-master"]=e["border-radius-master"],s},generateW3MOverrides(t){if(!t)return{};const e=yr(t),s={};if(t["--apkt-accent"]||t["--w3m-accent"]){const n=e.accent;s["--apkt-tokens-core-iconAccentPrimary"]=n,s["--apkt-tokens-core-borderAccentPrimary"]=n,s["--apkt-tokens-core-textAccentPrimary"]=n,s["--apkt-tokens-core-backgroundAccentPrimary"]=n}return(t["--apkt-font-family"]||t["--w3m-font-family"])&&(s["--apkt-fontFamily-regular"]=e["font-family"]),e["z-index"]!==void 0&&(s["--apkt-tokens-core-zIndex"]=`${e["z-index"]}`),s},generateScaledVariables(t){if(!t)return{};const e=yr(t),s={};if(t["--apkt-font-size-master"]||t["--w3m-font-size-master"]){const n=parseFloat(e["font-size-master"].replace("px",""));s["--apkt-textSize-h1"]=`${Number(n)*5}px`,s["--apkt-textSize-h2"]=`${Number(n)*4.4}px`,s["--apkt-textSize-h3"]=`${Number(n)*3.8}px`,s["--apkt-textSize-h4"]=`${Number(n)*3.2}px`,s["--apkt-textSize-h5"]=`${Number(n)*2.6}px`,s["--apkt-textSize-h6"]=`${Number(n)*2}px`,s["--apkt-textSize-large"]=`${Number(n)*1.6}px`,s["--apkt-textSize-medium"]=`${Number(n)*1.4}px`,s["--apkt-textSize-small"]=`${Number(n)*1.2}px`}if(t["--apkt-border-radius-master"]||t["--w3m-border-radius-master"]){const n=parseFloat(e["border-radius-master"].replace("px",""));s["--apkt-borderRadius-1"]=`${Number(n)}px`,s["--apkt-borderRadius-2"]=`${Number(n)*2}px`,s["--apkt-borderRadius-3"]=`${Number(n)*3}px`,s["--apkt-borderRadius-4"]=`${Number(n)*4}px`,s["--apkt-borderRadius-5"]=`${Number(n)*5}px`,s["--apkt-borderRadius-6"]=`${Number(n)*6}px`,s["--apkt-borderRadius-8"]=`${Number(n)*8}px`,s["--apkt-borderRadius-16"]=`${Number(n)*16}px`,s["--apkt-borderRadius-20"]=`${Number(n)*20}px`,s["--apkt-borderRadius-32"]=`${Number(n)*32}px`,s["--apkt-borderRadius-64"]=`${Number(n)*64}px`,s["--apkt-borderRadius-128"]=`${Number(n)*128}px`}return s},generateColorMixCSS(t,e){if(!(t!=null&&t["--w3m-color-mix"])||!t["--w3m-color-mix-strength"])return"";const s=t["--w3m-color-mix"],n=t["--w3m-color-mix-strength"];if(!n||n===0)return"";const i=Object.keys(e||{}).filter(o=>{const a=o.includes("-tokens-core-background")||o.includes("-tokens-core-text")||o.includes("-tokens-core-border")||o.includes("-tokens-core-foreground")||o.includes("-tokens-core-icon")||o.includes("-tokens-theme-background")||o.includes("-tokens-theme-text")||o.includes("-tokens-theme-border")||o.includes("-tokens-theme-foreground")||o.includes("-tokens-theme-icon"),c=o.includes("-borderRadius-")||o.includes("-spacing-")||o.includes("-textSize-")||o.includes("-fontFamily-")||o.includes("-fontWeight-")||o.includes("-typography-")||o.includes("-duration-")||o.includes("-ease-")||o.includes("-path-")||o.includes("-width-")||o.includes("-height-")||o.includes("-visual-size-")||o.includes("-modal-width")||o.includes("-cover");return a&&!c});return i.length===0?"":` @supports (background: color-mix(in srgb, white 50%, black)) {
      :root {
        ${i.map(o=>{const a=(e==null?void 0:e[o])||"";return a.includes("color-mix")||a.startsWith("#")||a.startsWith("rgb")?`${o}: color-mix(in srgb, ${s} ${n}%, ${a});`:`${o}: color-mix(in srgb, ${s} ${n}%, var(${o}-base, ${a}));`}).join("")}
      }
    }`},generateBaseVariables(t){const e={},s=t["--apkt-tokens-theme-backgroundPrimary"];s&&(e["--apkt-tokens-theme-backgroundPrimary-base"]=s);const n=t["--apkt-tokens-core-backgroundAccentPrimary"];return n&&(e["--apkt-tokens-core-backgroundAccentPrimary-base"]=n),e},applyColorMixToVariables(t,e){const s={};e!=null&&e["--apkt-tokens-theme-backgroundPrimary"]&&(s["--apkt-tokens-theme-backgroundPrimary"]="var(--apkt-tokens-theme-backgroundPrimary-base)"),e!=null&&e["--apkt-tokens-core-backgroundAccentPrimary"]&&(s["--apkt-tokens-core-backgroundAccentPrimary"]="var(--apkt-tokens-core-backgroundAccentPrimary-base)");const n=yr(t),i=n["color-mix"],r=n["color-mix-strength"];if(!r||r===0)return s;const o=Object.keys(e||{}).filter(a=>{const c=a.includes("-tokens-core-background")||a.includes("-tokens-core-text")||a.includes("-tokens-core-border")||a.includes("-tokens-core-foreground")||a.includes("-tokens-core-icon")||a.includes("-tokens-theme-background")||a.includes("-tokens-theme-text")||a.includes("-tokens-theme-border")||a.includes("-tokens-theme-foreground")||a.includes("-tokens-theme-icon")||a.includes("-tokens-theme-overlay"),l=a.includes("-borderRadius-")||a.includes("-spacing-")||a.includes("-textSize-")||a.includes("-fontFamily-")||a.includes("-fontWeight-")||a.includes("-typography-")||a.includes("-duration-")||a.includes("-ease-")||a.includes("-path-")||a.includes("-width-")||a.includes("-height-")||a.includes("-visual-size-")||a.includes("-modal-width")||a.includes("-cover");return c&&!l});return o.length===0||o.forEach(a=>{const c=(e==null?void 0:e[a])||"";a.endsWith("-base")||(a==="--apkt-tokens-theme-backgroundPrimary"||a==="--apkt-tokens-core-backgroundAccentPrimary"?s[a]=`color-mix(in srgb, ${i} ${r}%, var(${a}-base))`:c.includes("color-mix")||c.startsWith("#")||c.startsWith("rgb")?s[a]=`color-mix(in srgb, ${i} ${r}%, ${c})`:s[a]=`color-mix(in srgb, ${i} ${r}%, var(${a}-base, ${c}))`)}),s}},{cssVariablesVarPrefix:CI}=Cs.createCSSVariables($a);function iN(t,...e){return Ks(t,...e.map(s=>Gt(typeof s=="function"?s(CI):s)))}let pn,En,ls,_t,Vr;const bs={"KHTeka-500-woff2":"https://fonts.reown.com/KHTeka-Medium.woff2","KHTeka-400-woff2":"https://fonts.reown.com/KHTeka-Regular.woff2","KHTeka-300-woff2":"https://fonts.reown.com/KHTeka-Light.woff2","KHTekaMono-400-woff2":"https://fonts.reown.com/KHTekaMono-Regular.woff2","KHTeka-500-woff":"https://fonts.reown.com/KHTeka-Light.woff","KHTeka-400-woff":"https://fonts.reown.com/KHTeka-Regular.woff","KHTeka-300-woff":"https://fonts.reown.com/KHTeka-Light.woff","KHTekaMono-400-woff":"https://fonts.reown.com/KHTekaMono-Regular.woff"};function zr(t,e="dark"){pn&&document.head.removeChild(pn),pn=document.createElement("style"),pn.textContent=Cs.createRootStyles(e,t),document.head.appendChild(pn)}function rN(t,e="dark"){if(Vr=t,En=document.createElement("style"),ls=document.createElement("style"),_t=document.createElement("style"),En.textContent=Qn(t).core.cssText,ls.textContent=Qn(t).dark.cssText,_t.textContent=Qn(t).light.cssText,document.head.appendChild(En),document.head.appendChild(ls),document.head.appendChild(_t),zr(t,e),Da(e),!((t==null?void 0:t["--apkt-font-family"])||(t==null?void 0:t["--w3m-font-family"])))for(const[n,i]of Object.entries(bs)){const r=document.createElement("link");r.rel="preload",r.href=i,r.as="font",r.type=n.includes("woff2")?"font/woff2":"font/woff",r.crossOrigin="anonymous",document.head.appendChild(r)}Da(e)}function Da(t="dark"){ls&&_t&&pn&&(t==="light"?(zr(Vr,t),ls.removeAttribute("media"),_t.media="enabled"):(zr(Vr,t),_t.removeAttribute("media"),ls.media="enabled"))}function vI(t){var e,s,n;if(Vr=t,En&&ls&&_t){En.textContent=Qn(t).core.cssText,ls.textContent=Qn(t).dark.cssText,_t.textContent=Qn(t).light.cssText;const i=(t==null?void 0:t["--apkt-font-family"])||(t==null?void 0:t["--w3m-font-family"]);i&&(En.textContent=(e=En.textContent)==null?void 0:e.replace("font-family: KHTeka",`font-family: ${i}`),ls.textContent=(s=ls.textContent)==null?void 0:s.replace("font-family: KHTeka",`font-family: ${i}`),_t.textContent=(n=_t.textContent)==null?void 0:n.replace("font-family: KHTeka",`font-family: ${i}`))}if(pn){const i=(_t==null?void 0:_t.media)==="enabled"?"light":"dark";zr(t,i)}}function Qn(t){const e=!!(t!=null&&t["--apkt-font-family"]||t!=null&&t["--w3m-font-family"]);return{core:Ks`
      ${e?Ks``:Ks`
            @font-face {
              font-family: 'KHTeka';
              src:
                url(${Gt(bs["KHTeka-400-woff2"])}) format('woff2'),
                url(${Gt(bs["KHTeka-400-woff"])}) format('woff');
              font-weight: 400;
              font-style: normal;
              font-display: swap;
            }

            @font-face {
              font-family: 'KHTeka';
              src:
                url(${Gt(bs["KHTeka-300-woff2"])}) format('woff2'),
                url(${Gt(bs["KHTeka-300-woff"])}) format('woff');
              font-weight: 300;
              font-style: normal;
            }

            @font-face {
              font-family: 'KHTekaMono';
              src:
                url(${Gt(bs["KHTekaMono-400-woff2"])}) format('woff2'),
                url(${Gt(bs["KHTekaMono-400-woff"])}) format('woff');
              font-weight: 400;
              font-style: normal;
            }

            @font-face {
              font-family: 'KHTeka';
              src:
                url(${Gt(bs["KHTeka-400-woff2"])}) format('woff2'),
                url(${Gt(bs["KHTeka-400-woff"])}) format('woff');
              font-weight: 400;
              font-style: normal;
            }
          `}

      @keyframes w3m-shake {
        0% {
          transform: scale(1) rotate(0deg);
        }
        20% {
          transform: scale(1) rotate(-1deg);
        }
        40% {
          transform: scale(1) rotate(1.5deg);
        }
        60% {
          transform: scale(1) rotate(-1.5deg);
        }
        80% {
          transform: scale(1) rotate(1deg);
        }
        100% {
          transform: scale(1) rotate(0deg);
        }
      }
      @keyframes w3m-iframe-fade-out {
        0% {
          opacity: 1;
        }
        100% {
          opacity: 0;
        }
      }
      @keyframes w3m-iframe-zoom-in {
        0% {
          transform: translateY(50px);
          opacity: 0;
        }
        100% {
          transform: translateY(0px);
          opacity: 1;
        }
      }
      @keyframes w3m-iframe-zoom-in-mobile {
        0% {
          transform: scale(0.95);
          opacity: 0;
        }
        100% {
          transform: scale(1);
          opacity: 1;
        }
      }
      :root {
        --apkt-modal-width: 370px;

        --apkt-visual-size-inherit: inherit;
        --apkt-visual-size-sm: 40px;
        --apkt-visual-size-md: 55px;
        --apkt-visual-size-lg: 80px;

        --apkt-path-network-sm: path(
          'M15.4 2.1a5.21 5.21 0 0 1 5.2 0l11.61 6.7a5.21 5.21 0 0 1 2.61 4.52v13.4c0 1.87-1 3.59-2.6 4.52l-11.61 6.7c-1.62.93-3.6.93-5.22 0l-11.6-6.7a5.21 5.21 0 0 1-2.61-4.51v-13.4c0-1.87 1-3.6 2.6-4.52L15.4 2.1Z'
        );

        --apkt-path-network-md: path(
          'M43.4605 10.7248L28.0485 1.61089C25.5438 0.129705 22.4562 0.129705 19.9515 1.61088L4.53951 10.7248C2.03626 12.2051 0.5 14.9365 0.5 17.886V36.1139C0.5 39.0635 2.03626 41.7949 4.53951 43.2752L19.9515 52.3891C22.4562 53.8703 25.5438 53.8703 28.0485 52.3891L43.4605 43.2752C45.9637 41.7949 47.5 39.0635 47.5 36.114V17.8861C47.5 14.9365 45.9637 12.2051 43.4605 10.7248Z'
        );

        --apkt-path-network-lg: path(
          'M78.3244 18.926L50.1808 2.45078C45.7376 -0.150261 40.2624 -0.150262 35.8192 2.45078L7.6756 18.926C3.23322 21.5266 0.5 26.3301 0.5 31.5248V64.4752C0.5 69.6699 3.23322 74.4734 7.6756 77.074L35.8192 93.5492C40.2624 96.1503 45.7376 96.1503 50.1808 93.5492L78.3244 77.074C82.7668 74.4734 85.5 69.6699 85.5 64.4752V31.5248C85.5 26.3301 82.7668 21.5266 78.3244 18.926Z'
        );

        --apkt-width-network-sm: 36px;
        --apkt-width-network-md: 48px;
        --apkt-width-network-lg: 86px;

        --apkt-duration-dynamic: 0ms;
        --apkt-height-network-sm: 40px;
        --apkt-height-network-md: 54px;
        --apkt-height-network-lg: 96px;
      }
    `,dark:Ks`
      :root {
      }
    `,light:Ks`
      :root {
      }
    `}}const oN=Ks`
  div,
  span,
  iframe,
  a,
  img,
  form,
  button,
  label,
  *::after,
  *::before {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-style: normal;
    text-rendering: optimizeSpeed;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    -webkit-tap-highlight-color: transparent;
    backface-visibility: hidden;
  }

  :host {
    font-family: var(--apkt-fontFamily-regular);
  }
`,aN=Ks`
  button,
  a {
    cursor: pointer;
    display: flex;
    justify-content: center;
    align-items: center;
    position: relative;

    will-change: background-color, color, border, box-shadow, width, height, transform, opacity;
    outline: none;
    border: none;
    text-decoration: none;
    transition:
      background-color var(--apkt-durations-lg) var(--apkt-easings-ease-out-power-2),
      color var(--apkt-durations-lg) var(--apkt-easings-ease-out-power-2),
      border var(--apkt-durations-lg) var(--apkt-easings-ease-out-power-2),
      box-shadow var(--apkt-durations-lg) var(--apkt-easings-ease-out-power-2),
      width var(--apkt-durations-lg) var(--apkt-easings-ease-out-power-2),
      height var(--apkt-durations-lg) var(--apkt-easings-ease-out-power-2),
      transform var(--apkt-durations-lg) var(--apkt-easings-ease-out-power-2),
      opacity var(--apkt-durations-lg) var(--apkt-easings-ease-out-power-2),
      scale var(--apkt-durations-lg) var(--apkt-easings-ease-out-power-2),
      border-radius var(--apkt-durations-lg) var(--apkt-easings-ease-out-power-2);
    will-change:
      background-color, color, border, box-shadow, width, height, transform, opacity, scale,
      border-radius;
  }

  a:active:not([disabled]),
  button:active:not([disabled]) {
    scale: 0.975;
    transform-origin: center;
  }

  button:disabled {
    cursor: default;
  }

  input {
    border: none;
    outline: none;
    appearance: none;
  }
`,Es={EIP155:I.CHAIN.EVM,CONNECTOR_TYPE_WALLET_CONNECT:"WALLET_CONNECT",CONNECTOR_TYPE_INJECTED:"INJECTED",CONNECTOR_TYPE_ANNOUNCED:"ANNOUNCED",CONNECTOR_TYPE_AUTH:"AUTH"},AI={NetworkImageIds:{1:"ba0ba0cd-17c6-4806-ad93-f9d174f17900",42161:"3bff954d-5cb0-47a0-9a23-d20192e74600",43114:"30c46e53-e989-45fb-4549-be3bd4eb3b00",56:"93564157-2e8e-4ce7-81df-b264dbee9b00",250:"06b26297-fe0c-4733-5d6b-ffa5498aac00",10:"ab9c186a-c52f-464b-2906-ca59d760a400",137:"41d04d42-da3b-4453-8506-668cc0727900",5e3:"e86fae9b-b770-4eea-e520-150e12c81100",295:"6a97d510-cac8-4e58-c7ce-e8681b044c00",11155111:"e909ea0a-f92a-4512-c8fc-748044ea6800",84532:"a18a7ecd-e307-4360-4746-283182228e00",1301:"4eeea7ef-0014-4649-5d1d-07271a80f600",130:"2257980a-3463-48c6-cbac-a42d2a956e00",10143:"0a728e83-bacb-46db-7844-948f05434900",100:"02b53f6a-e3d4-479e-1cb4-21178987d100",9001:"f926ff41-260d-4028-635e-91913fc28e00",324:"b310f07f-4ef7-49f3-7073-2a0a39685800",314:"5a73b3dd-af74-424e-cae0-0de859ee9400",4689:"34e68754-e536-40da-c153-6ef2e7188a00",1088:"3897a66d-40b9-4833-162f-a2c90531c900",1284:"161038da-44ae-4ec7-1208-0ea569454b00",1285:"f1d73bb6-5450-4e18-38f7-fb6484264a00",7777777:"845c60df-d429-4991-e687-91ae45791600",42220:"ab781bbc-ccc6-418d-d32d-789b15da1f00",8453:"7289c336-3981-4081-c5f4-efc26ac64a00",1313161554:"3ff73439-a619-4894-9262-4470c773a100",2020:"b8101fc0-9c19-4b6f-ec65-f6dfff106e00",2021:"b8101fc0-9c19-4b6f-ec65-f6dfff106e00",80094:"e329c2c9-59b0-4a02-83e4-212ff3779900",2741:"fc2427d1-5af9-4a9c-8da5-6f94627cd900","5eykt4UsFv8P8NJdTREpY1vzqKqZKvdp":"a1b58899-f671-4276-6a5e-56ca5bd59700","4uhcVJyU9pJkvQyS88uRDiswHXSCkY3z":"a1b58899-f671-4276-6a5e-56ca5bd59700",EtWTRABZaYq6iMfeYKouRu166VU2xqa1:"a1b58899-f671-4276-6a5e-56ca5bd59700","000000000019d6689c085ae165831e93":"0b4838db-0161-4ffe-022d-532bf03dba00","000000000933ea01ad0ee984209779ba":"39354064-d79b-420b-065d-f980c4b78200","00000008819873e925422c1ff0f99f7c":"b3406e4a-bbfc-44fb-e3a6-89673c78b700","-239":"20f673c0-095e-49b2-07cf-eb5049dcf600","-3":"20f673c0-095e-49b2-07cf-eb5049dcf600"}},La={getCaipTokens(t){if(!t)return;const e={};return Object.entries(t).forEach(([s,n])=>{e[`${Es.EIP155}:${s}`]=n}),e},isLowerCaseMatch(t,e){return(t==null?void 0:t.toLowerCase())===(e==null?void 0:e.toLowerCase())},getActiveNamespaceConnectedToAuth(){const t=f.state.activeChain;return I.AUTH_CONNECTOR_SUPPORTED_CHAINS.find(e=>U.getConnectorId(e)===I.CONNECTOR_ID.AUTH&&e===t)},withRetry({conditionFn:t,intervalMs:e,maxRetries:s}){let n=0;return new Promise(i=>{async function r(){return n+=1,await t()?i(!0):n>=s?i(!1):(setTimeout(r,e),null)}r()})},userChainIdToChainNamespace(t){if(typeof t=="number")return I.CHAIN.EVM;const[e]=t.split(":");return e},getOtherAuthNamespaces(t){return t?I.AUTH_CONNECTOR_SUPPORTED_CHAINS.filter(n=>n!==t):[]},getConnectorStorageInfo(t,e){var i;const n=(i=k.getConnections()[e])!=null?i:[];return{hasDisconnected:k.isConnectorDisconnected(t,e),hasConnected:n.some(r=>La.isLowerCaseMatch(r.connectorId,t))}}},II=new AbortController,Rt={EmbeddedWalletAbortController:II,UniversalProviderErrors:{UNAUTHORIZED_DOMAIN_NOT_ALLOWED:{message:"Unauthorized: origin not allowed",alertErrorKey:"ORIGIN_NOT_ALLOWED"},JWT_VALIDATION_ERROR:{message:"JWT validation error: JWT Token is not yet valid",alertErrorKey:"JWT_TOKEN_NOT_VALID"},INVALID_KEY:{message:"Unauthorized: invalid key",alertErrorKey:"INVALID_PROJECT_ID"}},ALERT_ERRORS:{SWITCH_NETWORK_NOT_FOUND:{code:"APKT001",displayMessage:"Network Not Found",debugMessage:"The specified network is not recognized. Please ensure it is included in the `networks` array of your `createAppKit` configuration."},ORIGIN_NOT_ALLOWED:{code:"APKT002",displayMessage:"Invalid App Configuration",debugMessage:()=>`The origin ${vi()?window.origin:"unknown"} is not in your allow list. Please update your allowed domains at https://dashboard.reown.com. [PID: ${_.state.projectId}]`},IFRAME_LOAD_FAILED:{code:"APKT003",displayMessage:"Network Error: Wallet Load Failed",debugMessage:()=>"Failed to load the embedded wallet. This may be due to network issues or server downtime. Please check your network connection and try again shortly. Contact support if the issue persists."},IFRAME_REQUEST_TIMEOUT:{code:"APKT004",displayMessage:"Wallet Request Timeout",debugMessage:()=>"The request to the embedded wallet timed out. Please check your network connection and try again shortly. Contact support if the issue persists."},UNVERIFIED_DOMAIN:{code:"APKT005",displayMessage:"Unverified Domain",debugMessage:()=>"Embedded wallet load failed. Ensure your domain is verified in https://dashboard.reown.com."},JWT_TOKEN_NOT_VALID:{code:"APKT006",displayMessage:"Session Expired",debugMessage:"Your session is invalid or expired. Please check your systemâ€™s date and time settings, then reconnect."},INVALID_PROJECT_ID:{code:"APKT007",displayMessage:"Invalid Project ID",debugMessage:"The specified project ID is invalid. Please visit https://dashboard.reown.com to obtain a valid project ID."},PROJECT_ID_NOT_CONFIGURED:{code:"APKT008",displayMessage:"Project ID Missing",debugMessage:"No project ID is configured. You can create and configure a project ID at https://dashboard.reown.com."},SERVER_ERROR_APP_CONFIGURATION:{code:"APKT009",displayMessage:"Server Error",debugMessage:t=>`Unable to fetch App Configuration. ${t}. Please check your network connection and try again shortly. Contact support if the issue persists.`},RATE_LIMITED_APP_CONFIGURATION:{code:"APKT010",displayMessage:"Rate Limited",debugMessage:"You have been rate limited while retrieving App Configuration. Please wait a few minutes and try again. Contact support if the issue persists."}},ALERT_WARNINGS:{LOCAL_CONFIGURATION_IGNORED:{debugMessage:t=>`[Reown Config Notice] ${t}`},INACTIVE_NAMESPACE_NOT_CONNECTED:{code:"APKTW001",displayMessage:"Inactive Namespace Not Connected",debugMessage:(t,e)=>`An error occurred while connecting an inactive namespace ${t}: "${e}"`},INVALID_EMAIL:{code:"APKTW002",displayMessage:"Invalid Email Address",debugMessage:"Please enter a valid email address"}}},sp={TOKEN_ADDRESSES_BY_SYMBOL:{USDC:{8453:zA.asset,84532:GA.asset}},getTokenSymbolByAddress(t){var s;if(!t)return;const[e]=(s=Object.entries(sp.TOKEN_ADDRESSES_BY_SYMBOL).find(([n,i])=>Object.values(i).includes(t)))!=null?s:[];return e}},NI={createLogger(t,e="error"){const s=qd({level:e}),{logger:n}=Ma({opts:s});return n.error=(...i)=>{for(const r of i)if(r instanceof Error){t(r,...i);return}t(void 0,...i)},n}},_I="rpc.walletconnect.org";function Ud(t,e){const s=new URL("https://rpc.walletconnect.org/v1/");return s.searchParams.set("chainId",t),s.searchParams.set("projectId",e),s.toString()}const Vo=["near:mainnet","solana:5eykt4UsFv8P8NJdTREpY1vzqKqZKvdp","eip155:1101","eip155:56","eip155:42161","eip155:7777777","eip155:59144","eip155:324","solana:EtWTRABZaYq6iMfeYKouRu166VU2xqa1","eip155:5000","solana:4sgjmw1sunhzsxgspuhpqldx6wiyjntz","eip155:80084","eip155:5003","eip155:100","eip155:8453","eip155:42220","eip155:1313161555","eip155:17000","eip155:1","eip155:300","eip155:1313161554","eip155:1329","eip155:84532","eip155:421614","eip155:11155111","eip155:8217","eip155:43114","solana:4uhcVJyU9pJkvQyS88uRDiswHXSCkY3z","eip155:999999999","eip155:11155420","eip155:80002","eip155:97","eip155:43113","eip155:137","eip155:10","eip155:1301","eip155:80094","eip155:80069","eip155:560048","eip155:31","eip155:2818","eip155:57054","eip155:911867","eip155:534351","eip155:1112","eip155:534352","eip155:1111","eip155:146","eip155:130","eip155:1284","eip155:30","eip155:2810","bip122:000000000019d6689c085ae165831e93","bip122:000000000933ea01ad0ee984209779ba"],Hn={extendRpcUrlWithProjectId(t,e){let s=!1;try{s=new URL(t).host===_I}catch{s=!1}if(s){const n=new URL(t);return n.searchParams.has("projectId")||n.searchParams.set("projectId",e),n.toString()}return t},isCaipNetwork(t){return"chainNamespace"in t&&"caipNetworkId"in t},getChainNamespace(t){return this.isCaipNetwork(t)?t.chainNamespace:I.CHAIN.EVM},getCaipNetworkId(t){return this.isCaipNetwork(t)?t.caipNetworkId:`${I.CHAIN.EVM}:${t.id}`},getDefaultRpcUrl(t,e,s){var i,r,o;const n=(o=(r=(i=t.rpcUrls)==null?void 0:i.default)==null?void 0:r.http)==null?void 0:o[0];return Vo.includes(e)?Ud(e,s):n||""},extendCaipNetwork(t,{customNetworkImageUrls:e,projectId:s,customRpcUrls:n}){var u,p,m,y,g,w,b;const i=this.getChainNamespace(t),r=this.getCaipNetworkId(t),o=(m=(p=(u=t.rpcUrls)==null?void 0:u.default)==null?void 0:p.http)==null?void 0:m[0],a=this.getDefaultRpcUrl(t,r,s),c=((w=(g=(y=t==null?void 0:t.rpcUrls)==null?void 0:y.chainDefault)==null?void 0:g.http)==null?void 0:w[0])||o,l=((b=n==null?void 0:n[r])==null?void 0:b.map(A=>A.url))||[],d=[...l,...a?[a]:[]],h=[...l];return c&&!h.includes(c)&&h.push(c),{...t,chainNamespace:i,caipNetworkId:r,assets:{imageId:AI.NetworkImageIds[t.id],imageUrl:e==null?void 0:e[t.id]},rpcUrls:{...t.rpcUrls,default:{http:d},chainDefault:{http:h}}}},extendCaipNetworks(t,{customNetworkImageUrls:e,projectId:s,customRpcUrls:n}){return t.map(i=>Hn.extendCaipNetwork(i,{customNetworkImageUrls:e,customRpcUrls:n,projectId:s}))},getViemTransport(t,e,s){var i,r,o;const n=[];return s==null||s.forEach(a=>{n.push(sr(a.url,a.config))}),Vo.includes(t.caipNetworkId)&&n.push(sr(Ud(t.caipNetworkId,e),{fetchOptions:{headers:{"Content-Type":"text/plain"}}})),(o=(r=(i=t==null?void 0:t.rpcUrls)==null?void 0:i.default)==null?void 0:r.http)==null||o.forEach(a=>{n.push(sr(a))}),wc(n)},extendWagmiTransports(t,e,s){if(Vo.includes(t.caipNetworkId)){const n=this.getDefaultRpcUrl(t,t.caipNetworkId,e);return wc([s,sr(n)])}return s},getUnsupportedNetwork(t){return{id:t.split(":")[1],caipNetworkId:t,name:I.UNSUPPORTED_NETWORK_NAME,chainNamespace:t.split(":")[0],nativeCurrency:{name:"",decimals:0,symbol:""},rpcUrls:{default:{http:[]}}}},getCaipNetworkFromStorage(t){var c;const e=k.getActiveCaipNetworkId(),s=f.getAllRequestedCaipNetworks(),n=Array.from(((c=f.state.chains)==null?void 0:c.keys())||[]),i=e==null?void 0:e.split(":")[0],r=i?n.includes(i):!1,o=s==null?void 0:s.find(l=>l.caipNetworkId===e);return r&&!o&&e?this.getUnsupportedNetwork(e):o||t||(s==null?void 0:s[0])}},wr={ERROR_CODE_UNRECOGNIZED_CHAIN_ID:4902,ERROR_CODE_DEFAULT:5e3,ERROR_INVALID_CHAIN_ID:32603};class SI extends qA{async setUniversalProvider(e){if(!this.namespace)throw new Error("UniversalAdapter:setUniversalProvider - namespace is required");return this.addConnector(new HA({provider:e,caipNetworks:this.getCaipNetworks(),namespace:this.namespace})),Promise.resolve()}async connect(e){return Promise.resolve({id:"WALLET_CONNECT",type:"WALLET_CONNECT",chainId:Number(e.chainId),provider:this.provider,address:""})}async disconnect(){try{await this.getWalletConnectConnector().disconnect(),this.emit("disconnect")}catch(e){console.warn("UniversalAdapter:disconnect - error",e)}return{connections:[]}}syncConnections(){return Promise.resolve()}async writeSolanaTransaction(){return Promise.resolve({hash:""})}async getAccounts({namespace:e}){var i,r,o,a;const s=this.provider,n=((a=(o=(r=(i=s==null?void 0:s.session)==null?void 0:i.namespaces)==null?void 0:r[e])==null?void 0:o.accounts)==null?void 0:a.map(c=>{const[,,l]=c.split(":");return l}).filter((c,l,d)=>d.indexOf(c)===l))||[];return Promise.resolve({accounts:n.map(c=>j.createAccount(e,c,e==="bip122"?"payment":"eoa"))})}async syncConnectors(){return Promise.resolve()}async getBalance(e){var o,a,c,l,d;if(!(e.caipNetwork&&le.BALANCE_SUPPORTED_CHAINS.includes((o=e.caipNetwork)==null?void 0:o.chainNamespace))||(a=e.caipNetwork)!=null&&a.testnet)return{balance:"0.00",symbol:((c=e.caipNetwork)==null?void 0:c.nativeCurrency.symbol)||""};const n=f.getAccountData();if(n!=null&&n.balanceLoading&&e.chainId===((l=f.state.activeCaipNetwork)==null?void 0:l.id))return{balance:(n==null?void 0:n.balance)||"0.00",symbol:(n==null?void 0:n.balanceSymbol)||""};const r=(await f.fetchTokenBalance()).find(h=>{var u,p;return h.chainId===`${(u=e.caipNetwork)==null?void 0:u.chainNamespace}:${e.chainId}`&&h.symbol===((p=e.caipNetwork)==null?void 0:p.nativeCurrency.symbol)});return{balance:(r==null?void 0:r.quantity.numeric)||"0.00",symbol:(r==null?void 0:r.symbol)||((d=e.caipNetwork)==null?void 0:d.nativeCurrency.symbol)||""}}async signMessage(e){var o,a,c;const{provider:s,message:n,address:i}=e;if(!s)throw new Error("UniversalAdapter:signMessage - provider is undefined");let r="";return((o=f.state.activeCaipNetwork)==null?void 0:o.chainNamespace)===I.CHAIN.SOLANA?r=(await s.request({method:"solana_signMessage",params:{message:ri.encode(new TextEncoder().encode(n)),pubkey:i}},(a=f.state.activeCaipNetwork)==null?void 0:a.caipNetworkId)).signature:r=await s.request({method:"personal_sign",params:[n,i]},(c=f.state.activeCaipNetwork)==null?void 0:c.caipNetworkId),{signature:r}}async estimateGas(){return Promise.resolve({gas:BigInt(0)})}async sendTransaction(){return Promise.resolve({hash:""})}walletGetAssets(e){return Promise.resolve({})}async writeContract(){return Promise.resolve({hash:""})}emitFirstAvailableConnection(){}parseUnits(){return BigInt(0)}formatUnits(){return"0"}async getCapabilities(){return Promise.resolve({})}async grantPermissions(){return Promise.resolve({})}async revokePermissions(){return Promise.resolve("0x")}async syncConnection(){return Promise.resolve({id:"WALLET_CONNECT",type:"WALLET_CONNECT",chainId:1,provider:this.provider,address:""})}async switchNetwork(e){var i,r,o,a,c,l;const{caipNetwork:s}=e,n=this.getWalletConnectConnector();if(s.chainNamespace===I.CHAIN.EVM)try{await((i=n.provider)==null?void 0:i.request({method:"wallet_switchEthereumChain",params:[{chainId:gc(s.id)}]}))}catch(d){if(d.code===wr.ERROR_CODE_UNRECOGNIZED_CHAIN_ID||d.code===wr.ERROR_INVALID_CHAIN_ID||d.code===wr.ERROR_CODE_DEFAULT||((o=(r=d==null?void 0:d.data)==null?void 0:r.originalError)==null?void 0:o.code)===wr.ERROR_CODE_UNRECOGNIZED_CHAIN_ID)try{await((l=n.provider)==null?void 0:l.request({method:"wallet_addEthereumChain",params:[{chainId:gc(s.id),rpcUrls:[(a=s==null?void 0:s.rpcUrls.chainDefault)==null?void 0:a.http],chainName:s.name,nativeCurrency:s.nativeCurrency,blockExplorerUrls:[(c=s.blockExplorers)==null?void 0:c.default.url]}]}))}catch{throw new Error("Chain is not supported")}}n.provider.setDefaultChain(s.caipNetworkId)}getWalletConnectProvider(){const e=this.connectors.find(n=>n.type==="WALLET_CONNECT");return e==null?void 0:e.provider}}const TI=["email","socials","swaps","onramp","activity","reownBranding","multiWallet","emailCapture","payWithExchange","payments","reownAuthentication","headless"],br={email:{apiFeatureName:"social_login",localFeatureName:"email",returnType:!1,isLegacy:!1,isAvailableOnBasic:!1,processApi:t=>{if(!(t!=null&&t.config))return!1;const e=t.config;return!!t.isEnabled&&e.includes("email")},processFallback:t=>t===void 0?le.DEFAULT_REMOTE_FEATURES.email:!!t},socials:{apiFeatureName:"social_login",localFeatureName:"socials",returnType:!1,isLegacy:!1,isAvailableOnBasic:!1,processApi:t=>{if(!(t!=null&&t.config))return!1;const e=t.config;return t.isEnabled&&e.length>0?e.filter(s=>s!=="email"):!1},processFallback:t=>t===void 0?le.DEFAULT_REMOTE_FEATURES.socials:typeof t=="boolean"?t?le.DEFAULT_REMOTE_FEATURES.socials:!1:t},swaps:{apiFeatureName:"swap",localFeatureName:"swaps",returnType:!1,isLegacy:!1,isAvailableOnBasic:!1,processApi:t=>{if(!(t!=null&&t.config))return!1;const e=t.config;return t.isEnabled&&e.length>0?e:!1},processFallback:t=>t===void 0?le.DEFAULT_REMOTE_FEATURES.swaps:typeof t=="boolean"?t?le.DEFAULT_REMOTE_FEATURES.swaps:!1:t},onramp:{apiFeatureName:"onramp",localFeatureName:"onramp",returnType:!1,isLegacy:!1,isAvailableOnBasic:!1,processApi:t=>{if(!(t!=null&&t.config))return!1;const e=t.config;return t.isEnabled&&e.length>0?e:!1},processFallback:t=>t===void 0?le.DEFAULT_REMOTE_FEATURES.onramp:typeof t=="boolean"?t?le.DEFAULT_REMOTE_FEATURES.onramp:!1:t},activity:{apiFeatureName:"activity",localFeatureName:"history",returnType:!1,isLegacy:!0,isAvailableOnBasic:!1,processApi:t=>!!t.isEnabled,processFallback:t=>t===void 0?le.DEFAULT_REMOTE_FEATURES.activity:!!t},reownBranding:{apiFeatureName:"reown_branding",localFeatureName:"reownBranding",returnType:!1,isLegacy:!1,isAvailableOnBasic:!1,processApi:t=>!!t.isEnabled,processFallback:t=>t===void 0?le.DEFAULT_REMOTE_FEATURES.reownBranding:!!t},emailCapture:{apiFeatureName:"email_capture",localFeatureName:"emailCapture",returnType:!1,isLegacy:!1,isAvailableOnBasic:!1,processApi:t=>{var e;return t.isEnabled&&((e=t.config)!=null?e:[])},processFallback:t=>!1},multiWallet:{apiFeatureName:"multi_wallet",localFeatureName:"multiWallet",returnType:!1,isLegacy:!1,isAvailableOnBasic:!1,processApi:t=>!!t.isEnabled,processFallback:()=>le.DEFAULT_REMOTE_FEATURES.multiWallet},payWithExchange:{apiFeatureName:"fund_from_exchange",localFeatureName:"payWithExchange",returnType:!1,isLegacy:!1,isAvailableOnBasic:!1,processApi:t=>!!t.isEnabled,processFallback:()=>le.DEFAULT_REMOTE_FEATURES.payWithExchange},payments:{apiFeatureName:"payments",localFeatureName:"payments",returnType:!1,isLegacy:!1,isAvailableOnBasic:!1,processApi:t=>!!t.isEnabled,processFallback:()=>le.DEFAULT_REMOTE_FEATURES.payments},reownAuthentication:{apiFeatureName:"reown_authentication",localFeatureName:"reownAuthentication",returnType:!1,isLegacy:!1,isAvailableOnBasic:!1,processApi:t=>!!t.isEnabled,processFallback:t=>typeof t>"u"?le.DEFAULT_REMOTE_FEATURES.reownAuthentication:!!t},headless:{apiFeatureName:"headless",localFeatureName:"headless",returnType:!1,isLegacy:!1,isAvailableOnBasic:!1,processApi:t=>!!t.isEnabled,processFallback:()=>le.DEFAULT_REMOTE_FEATURES.headless}},OI={localSettingsOverridden:new Set,getApiConfig(t,e){return e==null?void 0:e.find(s=>s.id===t)},addWarning(t,e){if(t!==void 0){const s=br[e],n=s.isLegacy?`"features.${s.localFeatureName}" (now "${e}")`:`"features.${e}"`;this.localSettingsOverridden.add(n)}},processFeature(t,e,s,n,i){const r=br[t],o=e[r.localFeatureName];if(i&&!r.isAvailableOnBasic)return!1;if(n){const a=this.getApiConfig(r.apiFeatureName,s);return(a==null?void 0:a.config)===null?this.processFallbackFeature(t,o):a!=null&&a.config?(o!==void 0&&this.addWarning(o,t),this.processApiFeature(t,a)):!1}return this.processFallbackFeature(t,o)},processApiFeature(t,e){return br[t].processApi(e)},processFallbackFeature(t,e){return br[t].processFallback(e)},async fetchRemoteFeatures(t){var o;const e=(o=t.basic)!=null?o:!1,s=t.features||{};this.localSettingsOverridden.clear();let n=null,i=!1;try{n=await z.fetchProjectConfig(),i=n!=null}catch(a){console.warn("[Reown Config] Failed to fetch remote project configuration. Using local/default values.",a)}const r=i&&!e?le.DEFAULT_REMOTE_FEATURES:le.DEFAULT_REMOTE_FEATURES_DISABLED;try{for(const a of TI){const c=this.processFeature(a,s,n,i,e);Object.assign(r,{[a]:c})}}catch(a){return console.warn("[Reown Config] Failed to process the configuration from Cloud. Using default values.",a),le.DEFAULT_REMOTE_FEATURES}if(i&&this.localSettingsOverridden.size>0){const a=`Your local configuration for ${Array.from(this.localSettingsOverridden).join(", ")} was ignored because a remote configuration was successfully fetched. Please manage these features via your project dashboard on dashboard.reown.com.`;Ct.open({debugMessage:Rt.ALERT_WARNINGS.LOCAL_CONFIGURATION_IGNORED.debugMessage(a)},"warning")}return r}};class kI{constructor(e){this.chainNamespaces=[],this.features={},this.remoteFeatures={},this.reportedAlertErrors={},this.getCaipNetwork=(s,n)=>{var i,r,o;if(s){const a=(i=f.getCaipNetworks(s))==null?void 0:i.find(d=>d.id===n);if(a)return a;const c=(r=f.getNetworkData(s))==null?void 0:r.caipNetwork;return c||((o=f.getRequestedCaipNetworks(s).filter(d=>d.chainNamespace===s))==null?void 0:o[0])}return f.state.activeCaipNetwork||this.defaultCaipNetwork},this.getCaipNetworkId=()=>{const s=this.getCaipNetwork();if(s)return s.id},this.getCaipNetworks=s=>f.getCaipNetworks(s),this.getActiveChainNamespace=()=>f.state.activeChain,this.setRequestedCaipNetworks=(s,n)=>{f.setRequestedCaipNetworks(s,n)},this.getApprovedCaipNetworkIds=()=>f.getAllApprovedCaipNetworkIds(),this.getCaipAddress=s=>{var n,i;return f.state.activeChain===s||!s?f.state.activeCaipAddress:(i=(n=f.state.chains.get(s))==null?void 0:n.accountState)==null?void 0:i.caipAddress},this.setClientId=s=>{te.setClientId(s)},this.getProvider=s=>Oe.getProvider(s),this.getProviderType=s=>Oe.getProviderId(s),this.getPreferredAccountType=s=>Bt(s),this.setCaipAddress=(s,n,i=!1)=>{f.setAccountProp("caipAddress",s,n,i),f.setAccountProp("address",j.getPlainAddress(s),n,i)},this.setBalance=(s,n,i)=>{f.setAccountProp("balance",s,i),f.setAccountProp("balanceSymbol",n,i)},this.setProfileName=(s,n)=>{f.setAccountProp("profileName",s,n)},this.setProfileImage=(s,n)=>{f.setAccountProp("profileImage",s,n)},this.setUser=(s,n)=>{f.setAccountProp("user",s,n)},this.resetAccount=s=>{f.resetAccount(s)},this.setCaipNetwork=s=>{f.setActiveCaipNetwork(s)},this.setCaipNetworkOfNamespace=(s,n)=>{f.setChainNetworkData(n,{caipNetwork:s})},this.setStatus=(s,n)=>{f.setAccountProp("status",s,n),U.isConnected()?k.setConnectionStatus("connected"):k.setConnectionStatus("disconnected")},this.getAddressByChainNamespace=s=>{var n;return(n=f.getAccountData(s))==null?void 0:n.address},this.setConnectors=s=>{const n=[...U.state.allConnectors,...s];U.setConnectors(n)},this.setConnections=(s,n)=>{k.setConnections(s,n),D.setConnections(s,n)},this.fetchIdentity=s=>te.fetchIdentity(s),this.getReownName=s=>Pi.getNamesForAddress(s),this.getConnectors=()=>U.getConnectors(),this.getConnectorImage=s=>Pr.getConnectorImage(s),this.getConnections=s=>this.remoteFeatures.multiWallet?Rr.getConnectionsData(s).connections:(Ct.open(I.REMOTE_FEATURES_ALERTS.MULTI_WALLET_NOT_ENABLED.DEFAULT,"info"),[]),this.getRecentConnections=s=>this.remoteFeatures.multiWallet?Rr.getConnectionsData(s).recentConnections:(Ct.open(I.REMOTE_FEATURES_ALERTS.MULTI_WALLET_NOT_ENABLED.DEFAULT,"info"),[]),this.switchConnection=async s=>{if(!this.remoteFeatures.multiWallet){Ct.open(I.REMOTE_FEATURES_ALERTS.MULTI_WALLET_NOT_ENABLED.DEFAULT,"info");return}await D.switchConnection(s)},this.deleteConnection=s=>{if(!this.remoteFeatures.multiWallet){Ct.open(I.REMOTE_FEATURES_ALERTS.MULTI_WALLET_NOT_ENABLED.DEFAULT,"info");return}k.deleteAddressFromConnection(s),D.syncStorageConnections()},this.setConnectedWalletInfo=(s,n)=>{const i=Oe.getProviderId(n),r=s?{...s,type:i}:void 0;f.setAccountProp("connectedWalletInfo",r,n)},this.getIsConnectedState=()=>!!f.state.activeCaipAddress,this.addAddressLabel=(s,n,i)=>{var o;const r=((o=f.getAccountData(i))==null?void 0:o.addressLabels)||{};f.setAccountProp("addressLabels",{...r,[s]:n},i)},this.removeAddressLabel=(s,n)=>{var r;const i=((r=f.getAccountData(n))==null?void 0:r.addressLabels)||{};f.setAccountProp("addressLabels",{...i,[s]:void 0},n)},this.getAddress=s=>{var i;const n=s||f.state.activeChain;return(i=f.getAccountData(n))==null?void 0:i.address},this.resetNetwork=s=>{f.resetNetwork(s)},this.addConnector=s=>{U.addConnector(s)},this.resetWcConnection=()=>{D.resetWcConnection()},this.setAddressExplorerUrl=(s,n)=>{f.setAccountProp("addressExplorerUrl",s,n)},this.setSmartAccountDeployed=(s,n)=>{f.setAccountProp("smartAccountDeployed",s,n)},this.setPreferredAccountType=(s,n)=>{f.setAccountProp("preferredAccountType",s,n)},this.setEIP6963Enabled=s=>{_.setEIP6963Enabled(s)},this.handleUnsafeRPCRequest=()=>{if(this.isOpen()){if(this.isTransactionStackEmpty())return;this.redirect("ApproveTransaction")}else this.open({view:"ApproveTransaction"})},this.options=e,this.version=e.sdkVersion,this.caipNetworks=this.extendCaipNetworks(e),this.chainNamespaces=this.getChainNamespacesSet(e.adapters,this.caipNetworks),this.defaultCaipNetwork=this.extendDefaultCaipNetwork(e),this.chainAdapters=this.createAdapters(e.adapters),this.readyPromise=this.initialize(e)}getChainNamespacesSet(e,s){const n=e==null?void 0:e.map(r=>r.namespace).filter(r=>!!r);if(n!=null&&n.length)return[...new Set(n)];const i=s==null?void 0:s.map(r=>r.chainNamespace);return[...new Set(i)]}async initialize(e){var s,n,i,r,o,a;if(this.initializeProjectSettings(e),this.initControllers(e),await this.initChainAdapters(),this.sendInitializeEvent(e),(s=e.features)!=null&&s.headless&&!at.hasInjectedConnectors()&&z.prefetch({fetchNetworkImages:!1,fetchConnectorImages:!1,fetchWalletRanks:!1,fetchRecommendedWallets:!0}),_.state.enableReconnect?(await this.syncExistingConnection(),await this.syncAdapterConnections()):await this.unSyncExistingConnection(),!e.basic&&!e.manualWCControl&&(this.remoteFeatures=await OI.fetchRemoteFeatures(e)),await z.fetchUsage(),_.setRemoteFeatures(this.remoteFeatures),this.remoteFeatures.onramp&&ea.setOnrampProviders(this.remoteFeatures.onramp),((n=_.state.remoteFeatures)!=null&&n.email||Array.isArray((i=_.state.remoteFeatures)==null?void 0:i.socials)&&((r=_.state.remoteFeatures)==null?void 0:r.socials.length)>0)&&await this.checkAllowedOrigins(),(o=_.state.features)!=null&&o.reownAuthentication||(a=_.state.remoteFeatures)!=null&&a.reownAuthentication){const{ReownAuthentication:c}=await Or(async()=>{const{ReownAuthentication:d}=await import("./features-CSPgGe_G.js");return{ReownAuthentication:d}},__vite__mapDeps([5,1,2,4]),import.meta.url),l=_.state.siwx;l instanceof c||(l&&console.warn("ReownAuthentication option is enabled, SIWX configuration will be overridden."),_.setSIWX(new c))}}async openSend(e){var r;const s=e.namespace||f.state.activeChain,n=this.getCaipAddress(s),i=(r=this.getCaipNetwork(s))==null?void 0:r.id;if(!n)throw new Error("openSend: caipAddress not found");if((i==null?void 0:i.toString())!==e.chainId.toString()){const o=f.getCaipNetworkById(e.chainId,s);if(!o)throw new Error(`openSend: caipNetwork with chainId ${e.chainId} not found`);await this.switchNetwork(o,{throwOnFailure:!0})}try{const o=sp.getTokenSymbolByAddress(e.assetAddress);o&&await z.fetchTokenImages([o])}catch{}return await de.open({view:"WalletSend",data:{send:e}}),new Promise((o,a)=>{const c=ae.subscribeKey("hash",h=>{h&&(d(),o({hash:h}))}),l=de.subscribe(h=>{h.open||(d(),a(new Error("Modal closed")))}),d=this.createCleanupHandler([c,l])})}toModalOptions(){function e(n){return(n==null?void 0:n.view)==="Swap"}function s(n){return(n==null?void 0:n.view)==="WalletSend"}return{isSwap:e,isSend:s}}async checkAllowedOrigins(){try{const e=await z.fetchAllowedOrigins();if(!j.isClient())return;const s=window.location.origin;Ys.isOriginAllowed(s,e,I.DEFAULT_ALLOWED_ANCESTORS)||Ct.open(Rt.ALERT_ERRORS.ORIGIN_NOT_ALLOWED,"error")}catch(e){if(!(e instanceof Error))return;switch(e.message){case"RATE_LIMITED":Ct.open(Rt.ALERT_ERRORS.RATE_LIMITED_APP_CONFIGURATION,"error");break;case"SERVER_ERROR":{const s=e.cause instanceof Error?e.cause:e;Ct.open({displayMessage:Rt.ALERT_ERRORS.SERVER_ERROR_APP_CONFIGURATION.displayMessage,debugMessage:Rt.ALERT_ERRORS.SERVER_ERROR_APP_CONFIGURATION.debugMessage(s.message)},"error");break}}}}createCleanupHandler(e){return()=>{e.forEach(s=>{try{s()}catch{}})}}sendInitializeEvent(e){var n;const{...s}=e;delete s.adapters,delete s.universalProvider,oe.sendEvent({type:"track",event:"INITIALIZE",properties:{...s,networks:e.networks.map(i=>i.id),siweConfig:{options:((n=e.siweConfig)==null?void 0:n.options)||{}}}})}initControllers(e){this.initializeOptionsController(e),this.initializeChainController(e),this.initializeThemeController(e),this.initializeConnectionController(e),this.initializeConnectorController()}initAdapterController(){ih.initialize(this.chainAdapters)}initializeThemeController(e){e.themeMode&&At.setThemeMode(e.themeMode),e.themeVariables&&At.setThemeVariables(e.themeVariables)}initializeChainController(e){var n;if(!this.connectionControllerClient)throw new Error("ConnectionControllerClient must be set");f.initialize((n=e.adapters)!=null?n:[],this.caipNetworks,{connectionControllerClient:this.connectionControllerClient});const s=this.getDefaultNetwork();s&&f.setActiveCaipNetwork(s)}initializeConnectionController(e){var s,n;D.initialize((s=e.adapters)!=null?s:[]),D.setWcBasic((n=e.basic)!=null?n:!1)}initializeConnectorController(){U.initialize(this.chainNamespaces)}initializeProjectSettings(e){_.setProjectId(e.projectId),_.setSdkVersion(e.sdkVersion)}initializeOptionsController(e){var i,r;_.setDebug(e.debug!==!1),_.setEnableWalletGuide(e.enableWalletGuide!==!1),_.setEnableWallets(e.enableWallets!==!1),_.setEIP6963Enabled(e.enableEIP6963!==!1),_.setEnableNetworkSwitch(e.enableNetworkSwitch!==!1),_.setEnableReconnect(e.enableReconnect!==!1),_.setEnableMobileFullScreen(e.enableMobileFullScreen===!0),_.setCoinbasePreference(e.coinbasePreference),_.setEnableAuthLogger(e.enableAuthLogger!==!1),_.setCustomRpcUrls(e.customRpcUrls),_.setEnableEmbedded(e.enableEmbedded),_.setAllWallets(e.allWallets),_.setIncludeWalletIds(e.includeWalletIds),_.setExcludeWalletIds(e.excludeWalletIds),_.setFeaturedWalletIds(e.featuredWalletIds),_.setTokens(e.tokens),_.setTermsConditionsUrl(e.termsConditionsUrl),_.setPrivacyPolicyUrl(e.privacyPolicyUrl),_.setCustomWallets(e.customWallets),_.setFeatures(e.features),_.setAllowUnsupportedChain(e.allowUnsupportedChain),_.setUniversalProviderConfigOverride(e.universalProviderConfigOverride),_.setPreferUniversalLinks(e.experimental_preferUniversalLinks),_.setDefaultAccountTypes(e.defaultAccountTypes);const s=this.getDefaultMetaData();if(!e.metadata&&s&&(e.metadata=s),_.setMetadata(e.metadata),_.setDisableAppend(e.disableAppend),_.setEnableEmbedded(e.enableEmbedded),_.setSIWX(e.siwx),this.features=(i=_.state.features)!=null?i:{},!e.projectId){Ct.open(Rt.ALERT_ERRORS.PROJECT_ID_NOT_CONFIGURED,"error");return}if(((r=e.adapters)==null?void 0:r.find(o=>o.namespace===I.CHAIN.EVM))&&e.siweConfig){if(e.siwx)throw new Error("Cannot set both `siweConfig` and `siwx` options");_.setSIWX(e.siweConfig.mapToSIWX())}}getDefaultMetaData(){var e,s,n,i;return j.isClient()?{name:((s=(e=document.getElementsByTagName("title"))==null?void 0:e[0])==null?void 0:s.textContent)||"",description:((n=document.querySelector('meta[property="og:description"]'))==null?void 0:n.content)||"",url:window.location.origin,icons:[((i=document.querySelector('link[rel~="icon"]'))==null?void 0:i.href)||""]}:null}setUnsupportedNetwork(e){const s=this.getActiveChainNamespace();if(s){const n=Hn.getUnsupportedNetwork(`${s}:${e}`);f.setActiveCaipNetwork(n)}}getDefaultNetwork(){return Hn.getCaipNetworkFromStorage(this.defaultCaipNetwork)}extendCaipNetwork(e,s){return Hn.extendCaipNetwork(e,{customNetworkImageUrls:s.chainImages,projectId:s.projectId})}extendCaipNetworks(e){return Hn.extendCaipNetworks(e.networks,{customNetworkImageUrls:e.chainImages,customRpcUrls:e.customRpcUrls,projectId:e.projectId})}extendDefaultCaipNetwork(e){const s=e.networks.find(i=>{var r;return i.id===((r=e.defaultNetwork)==null?void 0:r.id)});return s?Hn.extendCaipNetwork(s,{customNetworkImageUrls:e.chainImages,customRpcUrls:e.customRpcUrls,projectId:e.projectId}):void 0}async disconnectConnector(e,s){var n,i;try{this.setLoading(!0,e);let r={connections:[]};const o=this.getAdapter(e);return((i=(n=f.state.chains.get(e))==null?void 0:n.accountState)!=null&&i.caipAddress||!_.state.enableReconnect)&&(o!=null&&o.disconnect)&&(r=await o.disconnect({id:s})),this.setLoading(!1,e),r}catch(r){throw this.setLoading(!1,e),new Error(`Failed to disconnect chains: ${r.message}`)}}createClients(){this.connectionControllerClient={connectWalletConnect:async()=>{var l;const e=f.state.activeChain,s=this.getAdapter(e),n=(l=this.getCaipNetwork(e))==null?void 0:l.id,i=D.getConnections(e),r=this.remoteFeatures.multiWallet,o=i.length>0;if(!s)throw new Error("Adapter not found");const a=await s.connectWalletConnect(n);(!o||!r)&&this.close(),this.setClientId((a==null?void 0:a.clientId)||null),k.setConnectedNamespaces([...f.state.chains.keys()]),await this.syncWalletConnectAccount(),await Yt.initializeIfEnabled()},connectExternal:async e=>{const s=await this.onConnectExternal(e);return await this.connectInactiveNamespaces(e,s),s?{address:s.address}:void 0},reconnectExternal:async({id:e,info:s,type:n,provider:i})=>{var a;const r=f.state.activeChain,o=this.getAdapter(r);if(!r)throw new Error("reconnectExternal: namespace not found");if(!o)throw new Error("reconnectExternal: adapter not found");o!=null&&o.reconnect&&(await(o==null?void 0:o.reconnect({id:e,info:s,type:n,provider:i,chainId:(a=this.getCaipNetwork())==null?void 0:a.id})),k.addConnectedNamespace(r),this.syncConnectedWalletInfo(r))},disconnectConnector:async e=>{await this.disconnectConnector(e.namespace,e.id)},disconnect:async e=>{var l;const{id:s,chainNamespace:n,initialDisconnect:i}=e||{},r=n||f.state.activeChain,o=U.getConnectorId(r),a=s===I.CONNECTOR_ID.AUTH||o===I.CONNECTOR_ID.AUTH,c=s===I.CONNECTOR_ID.WALLET_CONNECT||o===I.CONNECTOR_ID.WALLET_CONNECT;try{const d=Array.from(f.state.chains.keys());let h=n?[n]:d;(c||a)&&(h=d);const u=h.map(async y=>{const g=U.getConnectorId(y),w=s||g,b=await this.disconnectConnector(y,w);b&&(a&&k.deleteConnectedSocialProvider(),b.connections.forEach(A=>{k.addDisconnectedConnectorId(A.connectorId,y)})),i&&this.onDisconnectNamespace({chainNamespace:y,closeModal:!1})}),p=await Promise.allSettled(u);ae.resetSend(),D.resetWcConnection(),(l=Yt.getSIWX())!=null&&l.signOutOnDisconnect&&await Yt.clearSessions(),U.setFilterByNamespace(void 0),D.syncStorageConnections();const m=p.filter(y=>y.status==="rejected");if(m.length>0)throw new Error(m.map(y=>y.reason.message).join(", "));oe.sendEvent({type:"track",event:"DISCONNECT_SUCCESS",properties:{namespace:n||"all"}})}catch(d){throw new Error(`Failed to disconnect chains: ${d.message}`)}},checkInstalled:e=>e?e.some(s=>{var n;return!!((n=window.ethereum)!=null&&n[String(s)])}):!!window.ethereum,signMessage:async e=>{const s=f.state.activeChain,n=this.getAdapter(f.state.activeChain);if(!s)throw new Error("signMessage: namespace not found");if(!n)throw new Error("signMessage: adapter not found");const i=this.getAddress(s);if(!i)throw new Error("signMessage: address not found");const r=await(n==null?void 0:n.signMessage({message:e,address:i,provider:Oe.getProvider(s)}));return(r==null?void 0:r.signature)||""},sendTransaction:async e=>{const s=e.chainNamespace;if(!s)throw new Error("sendTransaction: namespace not found");if(le.SEND_SUPPORTED_NAMESPACES.includes(s)){const n=this.getAdapter(s);if(!n)throw new Error("sendTransaction: adapter not found");const i=Oe.getProvider(s),r=await(n==null?void 0:n.sendTransaction({...e,caipNetwork:this.getCaipNetwork(),provider:i}));return(r==null?void 0:r.hash)||""}return""},estimateGas:async e=>{const s=e.chainNamespace;if(s===I.CHAIN.EVM){const n=this.getAdapter(s);if(!n)throw new Error("estimateGas: adapter is required but got undefined");const i=Oe.getProvider(s),r=this.getCaipNetwork();if(!r)throw new Error("estimateGas: caipNetwork is required but got undefined");const o=await(n==null?void 0:n.estimateGas({...e,provider:i,caipNetwork:r}));return(o==null?void 0:o.gas)||BigInt(0)}return BigInt(0)},getEnsAvatar:async()=>{var i;const e=f.state.activeChain;if(!e)throw new Error("getEnsAvatar: namespace is required but got undefined");const s=this.getAddress(e);if(!s)throw new Error("getEnsAvatar: address not found");await this.syncIdentity({address:s,chainId:Number((i=this.getCaipNetwork())==null?void 0:i.id),chainNamespace:e});const n=f.getAccountData();return(n==null?void 0:n.profileImage)||!1},getEnsAddress:async e=>await Ys.resolveReownName(e),writeContract:async e=>{const s=f.state.activeChain,n=this.getAdapter(s);if(!s)throw new Error("writeContract: namespace is required but got undefined");if(!n)throw new Error("writeContract: adapter is required but got undefined");const i=this.getCaipNetwork(),r=this.getCaipAddress(),o=Oe.getProvider(s);if(!i||!r)throw new Error("writeContract: caipNetwork or caipAddress is required but got undefined");const a=await(n==null?void 0:n.writeContract({...e,caipNetwork:i,provider:o,caipAddress:r}));return a==null?void 0:a.hash},writeSolanaTransaction:async e=>{const s=f.state.activeChain,n=this.getAdapter(s);if(!s)throw new Error("writeContract: namespace is required but got undefined");if(!n)throw new Error("writeContract: adapter is required but got undefined");const i=this.getCaipNetwork(),r=this.getCaipAddress(),o=Oe.getProvider(s);if(!i||!r)throw new Error("writeContract: caipNetwork or caipAddress is required but got undefined");const a=await(n==null?void 0:n.writeSolanaTransaction({...e,caipNetwork:i,provider:o,caipAddress:r}));return a==null?void 0:a.hash},parseUnits:(e,s)=>{var i;const n=this.getAdapter(f.state.activeChain);if(!n)throw new Error("parseUnits: adapter is required but got undefined");return(i=n==null?void 0:n.parseUnits({value:e,decimals:s}))!=null?i:BigInt(0)},formatUnits:(e,s)=>{var i;const n=this.getAdapter(f.state.activeChain);if(!n)throw new Error("formatUnits: adapter is required but got undefined");return(i=n==null?void 0:n.formatUnits({value:e,decimals:s}))!=null?i:"0"},getCapabilities:async e=>{const s=this.getAdapter(f.state.activeChain);if(!s)throw new Error("getCapabilities: adapter is required but got undefined");return await(s==null?void 0:s.getCapabilities(e))},grantPermissions:async e=>{const s=this.getAdapter(f.state.activeChain);if(!s)throw new Error("grantPermissions: adapter is required but got undefined");return await(s==null?void 0:s.grantPermissions(e))},revokePermissions:async e=>{const s=this.getAdapter(f.state.activeChain);if(!s)throw new Error("revokePermissions: adapter is required but got undefined");return s!=null&&s.revokePermissions?await s.revokePermissions(e):"0x"},walletGetAssets:async e=>{var n;const s=this.getAdapter(f.state.activeChain);if(!s)throw new Error("walletGetAssets: adapter is required but got undefined");return(n=await(s==null?void 0:s.walletGetAssets(e)))!=null?n:{}},updateBalance:e=>{const s=this.getAddress(e),n=this.getCaipNetwork(e);!n||!s||this.updateNativeBalance(s,n==null?void 0:n.id,e)}},D.setClient(this.connectionControllerClient)}async onConnectExternal(e){var l,d,h,u,p,m,y,g;const s=f.state.activeChain,n=e.chain||s,i=this.getAdapter(n);let r=!0;if(e.type===Es.CONNECTOR_TYPE_AUTH&&I.AUTH_CONNECTOR_SUPPORTED_CHAINS.some(A=>U.getConnectorId(A)===I.CONNECTOR_ID.AUTH)&&e.chain!==s&&(r=!1),e.chain&&e.chain!==s&&!e.caipNetwork){const w=this.getCaipNetworks().find(b=>b.chainNamespace===e.chain);w&&r&&this.setCaipNetwork(w)}if(!n)throw new Error("connectExternal: namespace not found");if(!i)throw new Error("connectExternal: adapter not found");const o=this.getCaipNetwork(n),a=e.caipNetwork||o,c=await i.connect({id:e.id,address:e.address,info:e.info,type:e.type,provider:e.provider,socialUri:e.socialUri,chainId:((l=e.caipNetwork)==null?void 0:l.id)||(o==null?void 0:o.id),rpcUrl:((p=(u=(h=(d=e.caipNetwork)==null?void 0:d.rpcUrls)==null?void 0:h.default)==null?void 0:u.http)==null?void 0:p[0])||((g=(y=(m=o==null?void 0:o.rpcUrls)==null?void 0:m.default)==null?void 0:y.http)==null?void 0:g[0])});if(c)return k.addConnectedNamespace(n),this.syncProvider({...c,chainNamespace:n}),this.setStatus("connected",n),this.syncConnectedWalletInfo(n),k.removeDisconnectedConnectorId(e.id,n),{address:c.address,connectedCaipNetwork:a}}async connectInactiveNamespaces(e,s){var a;const n=e.type===Es.CONNECTOR_TYPE_AUTH,i=La.getOtherAuthNamespaces((a=s==null?void 0:s.connectedCaipNetwork)==null?void 0:a.chainNamespace),r=f.state.activeCaipNetwork,o=this.getAdapter(r==null?void 0:r.chainNamespace);n&&(await Promise.all(i.map(async c=>{var l,d,h;try{const u=Oe.getProvider(c),p=this.getCaipNetwork(c),m=this.getAdapter(c);await(m==null?void 0:m.connect({...e,provider:u,socialUri:void 0,chainId:p==null?void 0:p.id,rpcUrl:(h=(d=(l=p==null?void 0:p.rpcUrls)==null?void 0:l.default)==null?void 0:d.http)==null?void 0:h[0]}))&&(k.addConnectedNamespace(c),k.removeDisconnectedConnectorId(e.id,c),this.setStatus("connected",c),this.syncConnectedWalletInfo(c))}catch(u){Ct.warn(Rt.ALERT_WARNINGS.INACTIVE_NAMESPACE_NOT_CONNECTED.displayMessage,Rt.ALERT_WARNINGS.INACTIVE_NAMESPACE_NOT_CONNECTED.debugMessage(c,u instanceof Error?u.message:void 0),Rt.ALERT_WARNINGS.INACTIVE_NAMESPACE_NOT_CONNECTED.code)}})),r&&await(o==null?void 0:o.switchNetwork({caipNetwork:r})))}getApprovedCaipNetworksData(){var s,n,i,r,o;if(Oe.getProviderId(f.state.activeChain)===Es.CONNECTOR_TYPE_WALLET_CONNECT){const a=(n=(s=this.universalProvider)==null?void 0:s.session)==null?void 0:n.namespaces;return{supportsAllNetworks:((o=(r=(i=this.universalProvider)==null?void 0:i.session)==null?void 0:r.peer)==null?void 0:o.metadata.name)==="MetaMask Wallet",approvedCaipNetworkIds:this.getChainsFromNamespaces(a)}}return{supportsAllNetworks:!0,approvedCaipNetworkIds:[]}}async switchCaipNetwork(e){const s=e.chainNamespace;if(this.getAddressByChainNamespace(e.chainNamespace)){const i=Oe.getProviderId(s);if(e.chainNamespace===f.state.activeChain){const r=this.getAdapter(s);await(r==null?void 0:r.switchNetwork({caipNetwork:e}))}else if(this.setCaipNetwork(e),i===Es.CONNECTOR_TYPE_WALLET_CONNECT)this.syncWalletConnectAccount();else{const r=this.getAddressByChainNamespace(s);r&&this.syncAccount({address:r,chainId:e.id,chainNamespace:s})}}else this.setCaipNetwork(e)}getChainsFromNamespaces(e={}){return Object.values(e).flatMap(s=>{const n=s.chains||[],i=s.accounts.map(r=>{const{chainId:o,chainNamespace:a}=Je.parseCaipAddress(r);return`${a}:${o}`});return Array.from(new Set([...n,...i]))})}createAdapters(e){return this.createClients(),this.chainNamespaces.reduce((s,n)=>{var r,o;const i=e==null?void 0:e.find(a=>a.namespace===n);return i?(i.construct({namespace:n,projectId:(r=this.options)==null?void 0:r.projectId,networks:(o=this.caipNetworks)==null?void 0:o.filter(({chainNamespace:a})=>a===n)}),s[n]=i):s[n]=new SI({namespace:n,networks:this.getCaipNetworks()}),s},{})}async initChainAdapter(e){this.onConnectors(e),this.listenAdapter(e);const s=this.getAdapter(e);if(!s)throw new Error("adapter not found");await s.syncConnectors(),await this.createUniversalProviderForAdapter(e)}async initChainAdapters(){await Promise.all(this.chainNamespaces.map(async e=>{await this.initChainAdapter(e)})),this.initAdapterController()}onConnectors(e){const s=this.getAdapter(e);s==null||s.on("connectors",this.setConnectors.bind(this))}listenAdapter(e){const s=this.getAdapter(e);if(!s)return;const n=k.getConnectionStatus();_.state.enableReconnect===!1?this.setStatus("disconnected",e):n==="connected"?this.setStatus("connecting",e):n==="disconnected"?(k.clearAddressCache(),this.setStatus(n,e)):this.setStatus(n,e),s.on("switchNetwork",({address:i,chainId:r})=>{var l,d;const o=this.getCaipNetworks().find(h=>h.id.toString()===r.toString()||h.caipNetworkId.toString()===r.toString()),a=f.state.activeChain===e,c=(d=(l=f.state.chains.get(e))==null?void 0:l.accountState)==null?void 0:d.address;if(o){const h=a&&i?i:c;h&&this.syncAccount({address:h,chainId:o.id,chainNamespace:e})}else this.setUnsupportedNetwork(r)}),s.on("disconnect",()=>{const i=this.remoteFeatures.multiWallet,r=Array.from(D.state.connections.values()).flat();this.onDisconnectNamespace({chainNamespace:e,closeModal:!i||r.length===0})}),s.on("connections",i=>{this.setConnections(i,e)}),s.on("pendingTransactions",()=>{const i=this.getAddress(e),r=f.state.activeCaipNetwork;!i||!(r!=null&&r.id)||this.updateNativeBalance(i,r.id,r.chainNamespace)}),s.on("accountChanged",({address:i,chainId:r,connector:o})=>{var d,h;this.handlePreviousConnectorConnection(o);const a=f.state.activeChain===e;o!=null&&o.provider&&(this.syncProvider({id:o.id,type:o.type,provider:o==null?void 0:o.provider,chainNamespace:e}),this.syncConnectedWalletInfo(e));const c=(h=(d=f.getNetworkData(e))==null?void 0:d.caipNetwork)==null?void 0:h.id,l=r||c;a&&l?this.syncAccount({address:i,chainId:l,chainNamespace:e}):!a&&l?(this.syncAccountInfo(i,l,e),this.syncBalance({address:i,chainId:l,chainNamespace:e})):this.syncAccountInfo(i,r,e),k.addConnectedNamespace(e)})}async handlePreviousConnectorConnection(e){var c;const s=e==null?void 0:e.chain,n=e==null?void 0:e.id,i=U.getConnectorId(s),r=(c=_.state.remoteFeatures)==null?void 0:c.multiWallet,a=s&&n&&i&&i!==n&&!r;try{a&&await D.disconnect({id:i,namespace:s})}catch(l){console.warn("Error disconnecting previous connector",l)}}async createUniversalProviderForAdapter(e){var s,n,i;await this.getUniversalProvider(),this.universalProvider&&await((i=(n=(s=this.chainAdapters)==null?void 0:s[e])==null?void 0:n.setUniversalProvider)==null?void 0:i.call(n,this.universalProvider))}async syncExistingConnection(){await Promise.allSettled(this.chainNamespaces.map(e=>this.syncNamespaceConnection(e)))}async unSyncExistingConnection(){try{await Promise.allSettled(this.chainNamespaces.map(e=>D.disconnect({namespace:e,initialDisconnect:!0})))}catch(e){console.error("Error disconnecting existing connections:",e)}}async reconnectWalletConnect(){await this.syncWalletConnectAccount();const e=this.getAddress();this.getCaipAddress()||k.deleteRecentWallet();const s=k.getRecentWallet();oe.sendEvent({type:"track",event:"CONNECT_SUCCESS",address:e,properties:{method:j.isMobile()?"mobile":"qrcode",name:(s==null?void 0:s.name)||"Unknown",reconnect:!0,view:ee.state.view,walletRank:s==null?void 0:s.order}})}async syncNamespaceConnection(e){try{e===I.CHAIN.EVM&&j.isSafeApp()&&U.setConnectorId(I.CONNECTOR_ID.SAFE,e);const s=U.getConnectorId(e);switch(this.setStatus("connecting",e),s){case I.CONNECTOR_ID.WALLET_CONNECT:await this.reconnectWalletConnect();break;case I.CONNECTOR_ID.AUTH:break;default:await this.syncAdapterConnection(e)}}catch(s){console.warn("AppKit couldn't sync existing connection",s),this.setStatus("disconnected",e)}}onDisconnectNamespace(e){const{chainNamespace:s,closeModal:n}=e||{};f.resetAccount(s),f.resetNetwork(s),k.removeConnectedNamespace(s);const i=Array.from(f.state.chains.keys());(s?[s]:i).forEach(o=>k.addDisconnectedConnectorId(U.getConnectorId(o)||"",o)),U.removeConnectorId(s),Oe.resetChain(s),this.setUser(null,s),this.setStatus("disconnected",s),this.setConnectedWalletInfo(null,s),n!==!1&&de.close()}async syncAdapterConnections(){await Promise.allSettled(this.chainNamespaces.map(e=>{const s=this.getAdapter(e),n=this.getCaipAddress(e),i=this.getCaipNetwork(e);return s==null?void 0:s.syncConnections({connectToFirstConnector:!n,caipNetwork:i})}))}async syncAdapterConnection(e){var a,c,l,d,h;const s=this.getAdapter(e),n=this.getCaipNetwork(e),i=U.getConnectorId(e),o=U.getConnectors(e).find(u=>u.id===i);try{if(!s||!o)throw new Error(`Adapter or connector not found for namespace ${e}`);if(!(n!=null&&n.id))throw new Error("CaipNetwork not found");const u=await(s==null?void 0:s.syncConnection({namespace:e,id:o.id,chainId:n.id,rpcUrl:(l=(c=(a=n==null?void 0:n.rpcUrls)==null?void 0:a.default)==null?void 0:c.http)==null?void 0:l[0]}));u?(this.syncProvider({...u,chainNamespace:e}),await this.syncAccount({...u,chainNamespace:e}),this.setStatus("connected",e),oe.sendEvent({type:"track",event:"CONNECT_SUCCESS",address:u.address,properties:{method:"browser",name:((d=o.info)==null?void 0:d.name)||o.name||"Unknown",reconnect:!0,view:ee.state.view,walletRank:(h=o==null?void 0:o.explorerWallet)==null?void 0:h.order}})):this.setStatus("disconnected",e)}catch{this.onDisconnectNamespace({chainNamespace:e,closeModal:!1})}}async syncWalletConnectAccount(){var n,i;const e=Object.keys(((i=(n=this.universalProvider)==null?void 0:n.session)==null?void 0:i.namespaces)||{}),s=this.chainNamespaces.map(async r=>{var h,u,p,m,y;const o=this.getAdapter(r);if(!o)return;const a=((m=(p=(u=(h=this.universalProvider)==null?void 0:h.session)==null?void 0:u.namespaces)==null?void 0:p[r])==null?void 0:m.accounts)||[],c=(y=f.state.activeCaipNetwork)==null?void 0:y.id,l=a.find(g=>{const{chainId:w}=Je.parseCaipAddress(g);return w===(c==null?void 0:c.toString())})||a[0];if(l){const g=Je.validateCaipAddress(l),{chainId:w,address:b}=Je.parseCaipAddress(g);if(Oe.setProviderId(r,Es.CONNECTOR_TYPE_WALLET_CONNECT),this.caipNetworks&&f.state.activeCaipNetwork&&o.namespace!==I.CHAIN.EVM){const A=o.getWalletConnectProvider({caipNetworks:this.getCaipNetworks(),provider:this.universalProvider,activeCaipNetwork:f.state.activeCaipNetwork});Oe.setProvider(r,A)}else Oe.setProvider(r,this.universalProvider);U.setConnectorId(I.CONNECTOR_ID.WALLET_CONNECT,r),k.addConnectedNamespace(r),await this.syncAccount({address:b,chainId:w,chainNamespace:r})}else e.includes(r)&&this.setStatus("disconnected",r);const d=this.getApprovedCaipNetworksData();this.syncConnectedWalletInfo(r),f.setApprovedCaipNetworksData(r,{approvedCaipNetworkIds:d.approvedCaipNetworkIds,supportsAllNetworks:d.supportsAllNetworks})});await Promise.all(s)}syncProvider({type:e,provider:s,id:n,chainNamespace:i}){Oe.setProviderId(i,e),Oe.setProvider(i,s),U.setConnectorId(n,i)}async syncAccount(e){var h,u;const s=e.chainNamespace===f.state.activeChain,n=f.getCaipNetworkByNamespace(e.chainNamespace,e.chainId),{address:i,chainId:r,chainNamespace:o}=e,{chainId:a}=k.getActiveNetworkProps(),c=(n==null?void 0:n.id)||a,l=((h=f.state.activeCaipNetwork)==null?void 0:h.name)===I.UNSUPPORTED_NETWORK_NAME,d=f.getNetworkProp("supportsAllNetworks",o);if(this.setStatus("connected",o),!(l&&!d)&&c){let p=this.getCaipNetworks().find(w=>w.id.toString()===c.toString()),m=this.getCaipNetworks().find(w=>w.chainNamespace===o);if(!d&&!p&&!m){const w=this.getApprovedCaipNetworkIds()||[],b=w.find(x=>{var H;return((H=Je.parseCaipNetworkId(x))==null?void 0:H.chainId)===c.toString()}),A=w.find(x=>{var H;return((H=Je.parseCaipNetworkId(x))==null?void 0:H.chainNamespace)===o});p=this.getCaipNetworks().find(x=>x.caipNetworkId===b),m=this.getCaipNetworks().find(x=>x.caipNetworkId===A||"deprecatedCaipNetworkId"in x&&x.deprecatedCaipNetworkId===A)}const y=p||m;(y==null?void 0:y.chainNamespace)===f.state.activeChain?_.state.enableNetworkSwitch&&!_.state.allowUnsupportedChain&&((u=f.state.activeCaipNetwork)==null?void 0:u.name)===I.UNSUPPORTED_NETWORK_NAME?f.showUnsupportedChainUI():this.setCaipNetwork(y):s||n&&this.setCaipNetworkOfNamespace(n,o),this.syncConnectedWalletInfo(o);const g=this.getAddress(o);La.isLowerCaseMatch(i,g)||this.syncAccountInfo(i,y==null?void 0:y.id,o),s?await this.syncBalance({address:i,chainId:y==null?void 0:y.id,chainNamespace:o}):await this.syncBalance({address:i,chainId:n==null?void 0:n.id,chainNamespace:o}),this.syncIdentity({address:i,chainId:r,chainNamespace:o})}}async syncAccountInfo(e,s,n){const i=this.getCaipAddress(n),r=s||(i==null?void 0:i.split(":")[1]);if(!r)return;const o=`${n}:${r}:${e}`;this.setCaipAddress(o,n,!0),await this.syncIdentity({address:e,chainId:r,chainNamespace:n})}async syncReownName(e,s){try{const n=await this.getReownName(e);if(n[0]){const i=n[0];this.setProfileName(i.name,s)}else this.setProfileName(null,s)}catch{this.setProfileName(null,s)}}syncConnectedWalletInfo(e){var i;const s=U.getConnectorId(e),n=Oe.getProviderId(e);if(n===Es.CONNECTOR_TYPE_ANNOUNCED||n===Es.CONNECTOR_TYPE_INJECTED){if(s){const o=this.getConnectors().find(a=>{var h,u;const c=a.id===s,l=((h=a.info)==null?void 0:h.rdns)===s,d=(u=a.connectors)==null?void 0:u.some(p=>{var m;return p.id===s||((m=p.info)==null?void 0:m.rdns)===s});return c||l||!!d});if(o){const{info:a,name:c,imageUrl:l}=o,d=l||this.getConnectorImage(o);this.setConnectedWalletInfo({name:c,icon:d,...a},e)}}}else if(n===Es.CONNECTOR_TYPE_WALLET_CONNECT){const r=Oe.getProvider(e);r!=null&&r.session&&this.setConnectedWalletInfo({...r.session.peer.metadata,name:r.session.peer.metadata.name,icon:(i=r.session.peer.metadata.icons)==null?void 0:i[0]},e)}else if(s&&(s===I.CONNECTOR_ID.COINBASE_SDK||s===I.CONNECTOR_ID.COINBASE)){const r=this.getConnectors().find(l=>l.id===s),o=(r==null?void 0:r.name)||"Coinbase Wallet",a=(r==null?void 0:r.imageUrl)||this.getConnectorImage(r),c=r==null?void 0:r.info;this.setConnectedWalletInfo({...c,name:o,icon:a},e)}}async syncBalance(e){!zd.getNetworksByNamespace(this.getCaipNetworks(),e.chainNamespace).find(n=>{var i;return n.id.toString()===((i=e.chainId)==null?void 0:i.toString())})||!e.chainId||await this.updateNativeBalance(e.address,e.chainId,e.chainNamespace)}async ready(){await this.readyPromise}async updateNativeBalance(e,s,n){const i=this.getAdapter(n),r=f.getCaipNetworkByNamespace(n,s);if(i){const o=await i.getBalance({address:e,chainId:s,caipNetwork:r,tokens:this.options.tokens});return this.setBalance(o.balance,o.symbol,n),o}}async initializeUniversalAdapter(){var i,r,o,a,c,l,d,h,u,p,m;const e=NI.createLogger((y,...g)=>{y&&this.handleAlertError(y),console.error(...g)}),s={projectId:(i=this.options)==null?void 0:i.projectId,metadata:{name:(r=this.options)!=null&&r.metadata?(o=this.options)==null?void 0:o.metadata.name:"",description:(a=this.options)!=null&&a.metadata?(c=this.options)==null?void 0:c.metadata.description:"",url:(l=this.options)!=null&&l.metadata?(d=this.options)==null?void 0:d.metadata.url:"",icons:(h=this.options)!=null&&h.metadata?(u=this.options)==null?void 0:u.metadata.icons:[""]},logger:e};_.setManualWCControl(!!((p=this.options)!=null&&p.manualWCControl)),this.universalProvider=(m=this.options.universalProvider)!=null?m:await UA.init(s);const n=this.universalProvider.disconnect.bind(this.universalProvider);this.universalProvider.disconnect=async()=>{try{return await n()}catch(y){if(y instanceof Error&&y.message.includes("Missing or invalid. Record was recently deleted"))return;throw y}},_.state.enableReconnect===!1&&this.universalProvider.session&&await this.universalProvider.disconnect(),this.listenWalletConnect()}listenWalletConnect(){this.universalProvider&&this.chainNamespaces.forEach(e=>{Ys.listenWcProvider({universalProvider:this.universalProvider,namespace:e,onDisplayUri:s=>{D.setUri(s)},onConnect:s=>{const{address:n}=j.getAccount(s[0]);for(const i of this.chainNamespaces)k.removeDisconnectedConnectorId(I.CONNECTOR_ID.WALLET_CONNECT,i);D.finalizeWcConnection(n)},onDisconnect:()=>{f.state.noAdapters&&this.resetAccount(e),D.resetWcConnection()},onChainChanged:s=>{const n=f.state.activeChain,i=n&&U.state.activeConnectorIds[n]===I.CONNECTOR_ID.WALLET_CONNECT;if(n===e&&(f.state.noAdapters||i)){const r=this.getCaipNetworks().find(a=>a.id.toString()===s.toString()||a.caipNetworkId.toString()===s.toString()),o=this.getCaipNetwork();if(!r){this.setUnsupportedNetwork(s);return}(o==null?void 0:o.id.toString())!==(r==null?void 0:r.id.toString())&&(o==null?void 0:o.chainNamespace)===(r==null?void 0:r.chainNamespace)&&this.setCaipNetwork(r)}},onAccountsChanged:s=>{const n=f.state.activeChain,i=n&&U.state.activeConnectorIds[n]===I.CONNECTOR_ID.WALLET_CONNECT;if(n===e&&(f.state.noAdapters||i)){const r=s==null?void 0:s[0];r&&this.syncAccount({address:r.address,chainId:r.chainId,chainNamespace:r.chainNamespace})}}})})}createUniversalProvider(){var e;return!this.universalProviderInitPromise&&j.isClient()&&((e=this.options)!=null&&e.projectId)&&(this.universalProviderInitPromise=this.initializeUniversalAdapter()),this.universalProviderInitPromise}async getUniversalProvider(){if(!this.universalProvider)try{await this.createUniversalProvider()}catch(e){oe.sendEvent({type:"error",event:"INTERNAL_SDK_ERROR",properties:{errorType:"UniversalProviderInitError",errorMessage:e instanceof Error?e.message:"Unknown",uncaught:!1}}),console.error("AppKit:getUniversalProvider - Cannot create provider",e)}return this.universalProvider}getDisabledCaipNetworks(){const e=f.getAllApprovedCaipNetworkIds(),s=f.getAllRequestedCaipNetworks();return j.sortRequestedNetworks(e,s).filter(i=>f.isCaipNetworkDisabled(i))}handleAlertError(e){const s=Object.entries(Rt.UniversalProviderErrors).find(([,{message:a}])=>e.message.includes(a)),[n,i]=s!=null?s:[],{message:r,alertErrorKey:o}=i!=null?i:{};if(n&&r&&!this.reportedAlertErrors[n]){const a=Rt.ALERT_ERRORS[o];a&&(Ct.open(a,"error"),this.reportedAlertErrors[n]=!0)}}getAdapter(e){var s;if(e)return(s=this.chainAdapters)==null?void 0:s[e]}createAdapter(e){var i,r;if(!e)return;const s=e.namespace;if(!s)return;this.createClients();const n=e;n.namespace=s,n.construct({namespace:s,projectId:(i=this.options)==null?void 0:i.projectId,networks:(r=this.caipNetworks)==null?void 0:r.filter(({chainNamespace:o})=>o===s)}),this.chainNamespaces.includes(s)||this.chainNamespaces.push(s),this.chainAdapters&&(this.chainAdapters[s]=n)}async open(e){await this.injectModalUi(),e!=null&&e.uri&&D.setUri(e.uri);const{isSwap:s,isSend:n}=this.toModalOptions();return s(e)?de.open({...e,data:{swap:e.arguments}}):n(e)&&e.arguments?this.openSend(e.arguments):de.open(e)}async close(){await this.injectModalUi(),de.close()}setLoading(e,s){de.setLoading(e,s)}async disconnect(e){await D.disconnect({namespace:e})}getSIWX(){return _.state.siwx}getError(){return""}getChainId(){var e;return(e=f.state.activeCaipNetwork)==null?void 0:e.id}async switchNetwork(e,{throwOnFailure:s=!1}={}){const n=this.getCaipNetworks().find(i=>i.id===e.id);if(!n){Ct.open(Rt.ALERT_ERRORS.SWITCH_NETWORK_NOT_FOUND,"error");return}await f.switchActiveNetwork(n,{throwOnFailure:s})}getWalletProvider(){return f.state.activeChain?Oe.state.providers[f.state.activeChain]:null}getWalletProviderType(){return Oe.getProviderId(f.state.activeChain)}subscribeProviders(e){return Oe.subscribeProviders(e)}getThemeMode(){return At.state.themeMode}getThemeVariables(){return At.state.themeVariables}setThemeMode(e){At.setThemeMode(e),Da(At.state.themeMode)}setTermsConditionsUrl(e){_.setTermsConditionsUrl(e)}setPrivacyPolicyUrl(e){_.setPrivacyPolicyUrl(e)}setThemeVariables(e){At.setThemeVariables(e),vI(At.state.themeVariables)}subscribeTheme(e){return At.subscribe(e)}subscribeConnections(e){return this.remoteFeatures.multiWallet?D.subscribe(e):(Ct.open(I.REMOTE_FEATURES_ALERTS.MULTI_WALLET_NOT_ENABLED.DEFAULT,"info"),()=>{})}getWalletInfo(e){var n,i;if(e)return(i=(n=f.state.chains.get(e))==null?void 0:n.accountState)==null?void 0:i.connectedWalletInfo;const s=f.getAccountData();return s==null?void 0:s.connectedWalletInfo}getAccount(e){const s=e||f.state.activeChain,n=U.getAuthConnector(s),i=f.getAccountData(s),r=k.getConnectedConnectorId(f.state.activeChain),o=D.getConnections(s);if(!s)throw new Error("AppKit:getAccount - namespace is required");const a=o.flatMap(c=>c.accounts.map(({address:l,type:d,publicKey:h})=>j.createAccount(s,l,d||"eoa",h)));if(i)return{allAccounts:a,caipAddress:i.caipAddress,address:j.getPlainAddress(i.caipAddress),isConnected:!!i.caipAddress,status:i.status,embeddedWalletInfo:n&&r===I.CONNECTOR_ID.AUTH?{user:i.user?{...i.user,username:k.getConnectedSocialUsername()}:void 0,authProvider:i.socialProvider||"email",accountType:Bt(s),isSmartAccountDeployed:!!i.smartAccountDeployed}:void 0}}subscribeAccount(e,s){const n=[],i=()=>{const o=this.getAccount(s);o&&e(o)};if(s){const o=f.subscribeChainProp("accountState",i,s);n.push(o)}else{const o=f.subscribe(i);n.push(o)}const r=U.subscribe(i);return n.push(r),()=>{n.forEach(o=>o())}}subscribeNetwork(e){return f.subscribe(({activeCaipNetwork:s})=>{e({caipNetwork:s,chainId:s==null?void 0:s.id,caipNetworkId:s==null?void 0:s.caipNetworkId})})}subscribeWalletInfo(e,s){return s?f.subscribeChainProp("accountState",n=>e(n==null?void 0:n.connectedWalletInfo),s):f.subscribeChainProp("accountState",n=>e(n==null?void 0:n.connectedWalletInfo))}subscribeShouldUpdateToAddress(e){return f.subscribeChainProp("accountState",s=>e(s==null?void 0:s.shouldUpdateToAddress))}subscribeCaipNetworkChange(e){return f.subscribeKey("activeCaipNetwork",e)}getState(){return Jt.state}getRemoteFeatures(){return _.state.remoteFeatures}subscribeState(e){return Jt.subscribe(e)}subscribeRemoteFeatures(e){return _.subscribeKey("remoteFeatures",e)}showErrorMessage(e){as.showError(e)}showSuccessMessage(e){as.showSuccess(e)}getEvent(){return{...oe.state}}subscribeEvents(e){return oe.subscribe(e)}replace(e){ee.replace(e)}redirect(e){ee.push(e)}popTransactionStack(e){ee.popTransactionStack(e)}isOpen(){return de.state.open}isTransactionStackEmpty(){return ee.state.transactionStack.length===0}static getInstance(){return this.instance}updateFeatures(e){_.setFeatures(e)}updateRemoteFeatures(e){_.setRemoteFeatures(e)}updateOptions(e){const n={..._.state||{},...e};_.setOptions(n)}setConnectMethodsOrder(e){_.setConnectMethodsOrder(e)}setWalletFeaturesOrder(e){_.setWalletFeaturesOrder(e)}setCollapseWallets(e){_.setCollapseWallets(e)}setSocialsOrder(e){_.setSocialsOrder(e)}getConnectMethodsOrder(){return zs.getConnectOrderMethod(_.state.features,U.getConnectors())}addNetwork(e,s){if(this.chainAdapters&&!this.chainAdapters[e])throw new Error(`Adapter for namespace ${e} doesn't exist`);const n=this.extendCaipNetwork(s,this.options);this.getCaipNetworks().find(i=>i.id===n.id)||f.addNetwork(n)}removeNetwork(e,s){if(this.chainAdapters&&!this.chainAdapters[e])throw new Error(`Adapter for namespace ${e} doesn't exist`);this.getCaipNetworks().find(i=>i.id===s)&&f.removeNetwork(e,s)}}let $d=!1;class np extends kI{async open(e){U.isConnected()||await super.open(e)}async close(){var e;if(await super.close(),this.options.manualWCControl){const s=(e=f.getAccountData(this.activeChainNamespace))==null?void 0:e.address;D.finalizeWcConnection(s)}}async syncIdentity(e){return Promise.resolve()}async syncBalance(e){return Promise.resolve()}async injectModalUi(){if(!$d&&j.isClient()){if(await Or(()=>import("./basic-rtThR7jS.js"),__vite__mapDeps([6,7,1,2,8,4]),import.meta.url),await Or(()=>import("./w3m-modal-BPTH6HZr.js"),__vite__mapDeps([9,7,1,2,4]),import.meta.url),!document.querySelector("w3m-modal")){const s=document.createElement("w3m-modal");!_.state.disableAppend&&!_.state.enableEmbedded&&document.body.insertAdjacentElement("beforeend",s)}$d=!0}}}const xI="1.8.17-wc-circular-dependencies-fix.0";function PI(t){return new np({...t,basic:!0,sdkVersion:`html-core-${xI}`})}const cN=Object.freeze(Object.defineProperty({__proto__:null,AppKit:np,createAppKit:PI},Symbol.toStringTag,{value:"Module"}));export{Ua as $,z as A,te as B,U as C,Ha as D,oe as E,nh as F,Ze as G,La as H,Xe as I,xe as J,Yt as K,Dp as L,de as M,Xd as N,_ as O,Oe as P,Je as Q,ee as R,as as S,At as T,zi as U,$I as V,zs as W,CI as X,rN as Y,ih as Z,Ju as _,j as a,si as a0,zd as a1,Z as a2,ir as a3,X as a4,wc as a5,Ap as a6,cN as a7,D as b,I as c,sN as d,iN as e,Lt as f,at as g,Pr as h,Tr as i,f as j,aN as k,An as l,As as m,Rr as n,le as o,Hn as p,k as q,oN as r,Ke as s,Ks as t,Wt as u,Bt as v,nN as w,Is as x,Af as y,Ct as z};
