var h=Object.defineProperty;var l=(t,e,n)=>e in t?h(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var a=(t,e,n)=>l(t,typeof e!="symbol"?e+"":e,n);const r=[];for(let t=0;t<256;++t)r.push((t+256).toString(16).slice(1));function c(t,e=0){return(r[t[e+0]]+r[t[e+1]]+r[t[e+2]]+r[t[e+3]]+"-"+r[t[e+4]]+r[t[e+5]]+"-"+r[t[e+6]]+r[t[e+7]]+"-"+r[t[e+8]]+r[t[e+9]]+"-"+r[t[e+10]]+r[t[e+11]]+r[t[e+12]]+r[t[e+13]]+r[t[e+14]]+r[t[e+15]]).toLowerCase()}let o;const w=new Uint8Array(16);function m(){if(!o){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");o=crypto.getRandomValues.bind(crypto)}return o(w)}const y=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),p={randomUUID:y};function I(t,e,n){var d,i,u;t=t||{};const s=(u=(i=t.random)!=null?i:(d=t.rng)==null?void 0:d.call(t))!=null?u:m();if(s.length<16)throw new Error("Random bytes length must be >= 16");return s[6]=s[6]&15|64,s[8]=s[8]&63|128,c(s)}function E(t,e,n){return p.randomUUID&&!t?p.randomUUID():I(t)}const x="https://redirect.self.xyz";function U(t){return t?t.replace(/^https?:\/\//,"").split("/")[0]:""}function b(t,e){switch(e){case"hex":return/^[0-9A-Fa-f]+$/.test(t);case"uuid":return/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t);default:return!1}}class D{constructor(e){a(this,"config");var s,d;if(!e.appName)throw new Error("appName is required");if(!e.scope)throw new Error("scope is required");if(!e.endpoint)throw new Error("endpoint is required");if(!/^[\x00-\x7F]*$/.test(e.scope))throw new Error("Scope must contain only ASCII characters (0-127)");if(!/^[\x00-\x7F]*$/.test(e.endpoint))throw new Error("Endpoint must contain only ASCII characters (0-127)");if(e.scope.length>31)throw new Error("Scope must be less than 31 characters");const n=U(e.endpoint);if(n.length>496)throw new Error(`Endpoint must be less than 496 characters, current endpoint: ${n}, length: ${n.length}`);if(!e.userId)throw new Error("userId is required");if(e.endpointType==="https"&&!e.endpoint.startsWith("https://"))throw new Error("endpoint must start with https://");if(e.endpointType==="celo"&&!e.endpoint.startsWith("0x"))throw new Error("endpoint must be a valid address");if(e.endpoint&&(e.endpoint.includes("localhost")||e.endpoint.includes("127.0.0.1")))throw new Error("localhost endpoints are not allowed");if(e.userIdType==="hex"){if(!e.userId.startsWith("0x"))throw new Error("userId as hex must start with 0x");e.userId=e.userId.slice(2)}if(!b(e.userId,(s=e.userIdType)!=null?s:"uuid"))throw new Error("userId must be a valid UUID or address");this.config={sessionId:E(),userIdType:"uuid",devMode:!1,endpointType:"https",header:"",logoBase64:"",deeplinkCallback:"",disclosures:{},chainID:e.endpointType==="staging_celo"?11142220:42220,version:(d=e.version)!=null?d:2,userDefinedData:"",...e}}build(){return this.config}}function R(t){return`${x}?selfApp=${encodeURIComponent(JSON.stringify(t))}`}export{x as REDIRECT_URL,D as SelfAppBuilder,U as formatEndpoint,R as getUniversalLink,b as validateUserId};
