package com.pirate.app.music

import com.pirate.app.BuildConfig
import okhttp3.MediaType.Companion.toMediaType
import okhttp3.OkHttpClient

internal const val SHARED_WITH_YOU_TAG = "SharedWithYouApi"
internal const val SHARED_WITH_YOU_TEMPO_RPC = "https://rpc.moderato.tempo.xyz"
internal const val SHARED_WITH_YOU_SCROBBLE_V4 = "0xe00e82086480E61AaC8d5ad8B05B56A582dD0000"
internal const val SHARED_WITH_YOU_SUBGRAPH_PLAYLISTS =
  "https://graph.dotheaven.org/subgraphs/name/dotheaven/playlist-feed-tempo"

private const val DEFAULT_SUBGRAPH_MUSIC_SOCIAL =
  "https://graph.dotheaven.org/subgraphs/name/dotheaven/music-social-tempo"

internal val sharedWithYouClient = OkHttpClient()
internal val sharedWithYouJsonMediaType = "application/json; charset=utf-8".toMediaType()

internal fun musicSocialSubgraphUrl(): String {
  val fromMusicSocial = BuildConfig.SUBGRAPH_MUSIC_SOCIAL_URL.trim()
  if (fromMusicSocial.isNotBlank()) return fromMusicSocial
  return DEFAULT_SUBGRAPH_MUSIC_SOCIAL
}

internal data class ContentRow(
  val contentId: String,
  val trackId: String,
  val owner: String,
  val pieceCid: String,
  val datasetOwner: String,
  val algo: Int,
  val updatedAtSec: Long,
)

internal data class ContentMeta(
  val trackId: String,
  val contentId: String,
  val pieceCid: String,
  val datasetOwner: String,
  val algo: Int,
)

internal data class GrantedContentIndexes(
  val byMetaHash: Map<String, ContentMeta>,
  val byTrackId: Map<String, ContentMeta>,
  val byContentId: Map<String, ContentMeta>,
)

internal data class TrackMeta(
  val id: String,
  val title: String,
  val artist: String,
  val album: String,
  val coverCid: String? = null,
  val durationSec: Int = 0,
  val metaHash: String? = null,
)
